<!DOCTYPE html><html class=split data-revision="$Revision: 8891 $" lang=en-GB-x-hixie><title>HTML Standard</title><script>
   var loadTimer = new Date();
   var current_revision = "r" + document.documentElement.getAttribute('data-revision').substr(11);
   current_revision = current_revision.substr(0, current_revision.length - 2);
   var last_known_revision = current_revision;
   function F( /* varargs... */) {
     var fragment = document.createDocumentFragment();
     for (var index = 0; index < arguments.length; index += 1) {
       if (arguments[index] instanceof Array) {
         fragment.appendChild(F.apply(this, arguments[index]));
       } else if (typeof arguments[index] == 'string') {
         fragment.appendChild(document.createTextNode(arguments[index]));
       } else {
         fragment.appendChild(arguments[index]);
       }
     }
     return fragment;
   }
   function E(name, /* optional */ attributes /*, varargs... */) {
     var element = document.createElement(name);
     var index = 1;
     if ((arguments.length > 1) && (typeof attributes != 'string') &&
         (!(attributes instanceof Node)) && (!(attributes instanceof Array))) {
       for (var attName in attributes) {
         if (typeof attributes[attName] == 'boolean') {
           if (attributes[attName])
             element.setAttribute(attName, '');
         } else if (typeof attributes[attName] == 'function') {
           element[attName] = attributes[attName];
         } else {
           element.setAttribute(attName, attributes[attName]);
         }
       }
       index = 2;
     }
     for (; index < arguments.length; index += 1) {
       if (arguments[index] instanceof Array) {
         element.appendChild(F.apply(this, arguments[index]));
       } else if (typeof arguments[index] == 'string') {
         element.appendChild(document.createTextNode(arguments[index]));
       } else {
         element.appendChild(arguments[index]);
       }
     }
     return element;
   }
   function getCookie(name) {
     var params = location.search.substr(1).split("&");
     for (var index = 0; index < params.length; index++) {
       if (params[index] == name)
         return "1";
       var data = params[index].split("=");
       if (data[0] == name)
         return unescape(data[1]);
     }
     var cookies = document.cookie.split("; ");
     for (var index = 0; index < cookies.length; index++) {
       var data = cookies[index].split("=");
       if (data[0] == name)
         return unescape(data[1]);
     }
     return null;
   }
   var currentAlert;
   var currentAlertTimeout;
   function showAlert(s, href) {
     if (!currentAlert) {
       currentAlert = document.createElement('div');
       currentAlert.id = 'alert';
       var x = document.createElement('button');
       x.textContent = '\u2573';
       x.onclick = closeAlert2;
       currentAlert.appendChild(x);
       currentAlert.appendChild(document.createElement('span'));
       currentAlert.onmousemove = function () {
         clearTimeout(currentAlertTimeout);
         currentAlert.className = '';
         currentAlertTimeout = setTimeout(closeAlert, 10000);
       }
       document.body.appendChild(currentAlert);
     } else {
       clearTimeout(currentAlertTimeout);
       currentAlert.className = '';
     }
     currentAlert.lastChild.textContent = '';
     currentAlert.lastChild.appendChild(F(s));
     if (href) {
       var link = document.createElement('a');
       link.href = href;
       link.textContent = href;
       currentAlert.lastChild.appendChild(F(' ', link));
     }
     currentAlertTimeout = setTimeout(closeAlert, 10000);
   }
   function closeAlert() {
     clearTimeout(currentAlertTimeout);
     if (currentAlert) {
       currentAlert.className = 'closed';
       currentAlertTimeout = setTimeout(closeAlert2, 3000);
     }
   }
   function closeAlert2() {
     clearTimeout(currentAlertTimeout);
     if (currentAlert) {
       currentAlert.parentNode.removeChild(currentAlert);
       currentAlert = null;
     }
   }
   window.addEventListener('keydown', function (event) {
     if (event.keyCode == 27) {
       if (currentAlert)
         closeAlert2();
     } else {
       closeAlert();
     }
   }, false);
   window.addEventListener('scroll', function (event) {
     closeAlert();
   }, false);
   function load(script) {
     var e = document.createElement('script');
     e.setAttribute('src', '/' + script);
     document.body.appendChild(e);
   }

   var startedInit = 0;
   function init() {
     startedInit = 1;
     if (location.search == '?slow-browser')
       return;
     load('reviewer.js');
     if (document.documentElement.className == "big" || document.documentElement.className == "big split index")
       load('toc.js');
     load('updater.js');
     load('dfn.js');
     load('status.js');
     if (getCookie('profile') == '1')
       document.getElementsByTagName('h2')[0].textContent += '; load: ' + (new Date() - loadTimer) + 'ms';
   }
   if (document.documentElement.className == "")
     setTimeout(function () {
       if (!startedInit)
         showAlert("Too slow? Try reading the multipage copy of the spec instead:", "https://whatwg.org/html");
     }, 6000);

   window.addEventListener('keypress', function (event) {
     if ((event.which == 114) && (event.metaKey)) {
       if (!confirm('Are you sure you want to reload this page?'))
         event.preventDefault();
     }
   }, false);
  </script><script>
   function toggleStatus(div) {
     div.parentNode.classList.toggle('wrapped');
   }
  </script><link rel=stylesheet href=https://whatwg.org/style/specification><link rel=icon href=https://whatwg.org/images/icon><style>
   [hidden] { display: none; }

   .proposal { border: blue solid; padding: 1em; }
   .bad, .bad *:not(.X\58X) { color: gray; border-color: gray; background: transparent; }
   #updatesStatus { display: none; z-index: 10; }
   #updatesStatus.relevant { display: block; position: fixed; right: 1em; top: 1em; padding: 0.5em; font: bold small sans-serif; min-width: 25em; width: 30%; max-width: 40em; height: auto; border: ridge 4px gray; background: #EEEEEE; color: black; }
   div.head .logo { width: 11em; margin-bottom: 20em; }

   #configUI { position: absolute; z-index: 20; top: auto; right: 0; width: 11em; padding: 0 0.5em 0 0.5em; font-size: small; background: gray; background: rgba(32,32,32,0.9); color: white; border-radius: 0.5em 0 0 0.5em; }
   #configUI p { margin: 0.75em 0; padding: 0.3em; }
   #configUI p label { display: block; }
   #configUI #updateUI, #configUI .loginUI { text-align: center; }
   #configUI input[type=button] { display: block; margin: auto; }
   #configUI :link, #configUI :visited { color: white; }
   #configUI :link:hover, #configUI :visited:hover { background: transparent; }

   #alert { position: fixed; top: 20%; left: 20%; right: 20%; font-size: 2em; padding: 0.5em; z-index: 40; background: gray; background: rgba(32,32,32,0.9); color: white; border-radius: 0.5em; transition: opacity 1s linear; }
   #alert.closed { opacity: 0; }
   #alert button { position: absolute; top: -1em; right: 2em; border-radius: 0.5em 0.5em 0 0; border: none; line-height: 0.9; color: white; background: rgb(64,64,64); font-size: 0.6em; font-weight: 900; cursor: pointer; padding: 0.25em; }
   #alert :link, #alert :visited { color: white; text-decoration: underline; }
   #alert :link:hover, #alert :visited:hover { background: transparent; }

   @media print { #configUI, #alert { display: none; } }

   .fingerprint { position: absolute; right: 0; z-index: 5; }

   .status { font: 1em sans-serif; width: 9em; padding: 0.3em; position: absolute; z-index: 8; top: auto; right: 0.3em; background: #EEE; color: black; box-shadow: 0 0 3px #999; overflow: hidden; margin: -2em 0 0 0; border-collapse: initial; border-spacing: initial; }
   .status.wrapped { width: 1em; height: 1em; }
   .status.wrapped > :not(input) { display: none; }
   .status > input { position: absolute; right: 0; top: 0; width: 1em; height: 1em; border: none; background: transparent; padding: 0; margin: 0; }
   .status > p { font-size: 0.6em; margin: 0; padding: 0; }
   .status > p + p { padding-top: 0.5em; }
   .status > .support { display: block; }
   .status > .support > span { padding: 0.2em 0; display: block; display: table; }
   .status > .support > span.partial { color: #666666; filter: grayscale(50%); }
   .status > .support > span.no { color: #CCCCCC; filter: grayscale(100%); }
   .status > .support > span:first-of-type { padding-top: 0.5em; }
   .status > .support > span > span { padding: 0 0.5em; display: table-cell; vertical-align: top; }
   .status > .support > span > span:first-child { width: 100%; }
   .status > .support > span > span:last-child { width: 100%; white-space: pre; padding: 0; }
   .status > .support > span::before { content: ' '; display: table-cell; min-width: 1.5em; height: 1.5em; background: no-repeat center center; background-size: contain; text-align: right; font-size: 0.75em; font-weight: bold; }
   .status > .support > .and_chr::before { background-image: url(https://resources.whatwg.org/browser-logos/chrome-android.png); }
   .status > .support > .and_ff::before { background-image: url(https://resources.whatwg.org/browser-logos/firefox.png); }
   .status > .support > .and_uc::before { background-image: url(https://resources.whatwg.org/browser-logos/uc.png); } /* UC Browser for Android */
   .status > .support > .android::before { background-image: url(https://resources.whatwg.org/browser-logos/android.svg); }
   .status > .support > .bb::before { background-image: url(https://resources.whatwg.org/browser-logos/bb.jpg); } /* Blackberry Browser */
   .status > .support > .chrome::before { background-image: url(https://resources.whatwg.org/browser-logos/chrome.png); }
   .status > .support > .firefox::before { background-image: url(https://resources.whatwg.org/browser-logos/firefox.png); }
   .status > .support > .ie::before { background-image: url(https://resources.whatwg.org/browser-logos/ie.png); }
   .status > .support > .ie_mob::before { background-image: url(https://resources.whatwg.org/browser-logos/ie-mobile.svg); }
   .status > .support > .ios_saf::before { background-image: url(https://resources.whatwg.org/browser-logos/safari-ios.svg); }
   .status > .support > .op_mini::before { background-image: url(https://resources.whatwg.org/browser-logos/opera-mobile.png); }
   .status > .support > .op_mob::before { background-image: url(https://resources.whatwg.org/browser-logos/opera-mobile.png); }
   .status > .support > .opera::before { background-image: url(https://resources.whatwg.org/browser-logos/opera.png); }
   .status > .support > .safari::before { background-image: url(https://resources.whatwg.org/browser-logos/safari.png); }
   .status > .caniuse { text-align: right; font-style: italic; }

   .panel { position: fixed; z-index: 30; top: 10%; left: 0; margin: auto; right: 0; width: 35em; border: double thick; background: #EEEEEE; color: black; padding: 1em; font: 1em sans-serif; max-height: 70%; overflow: auto; }
   .panel h2 { margin: 0; text-align: center; }
   .panel ul { min-height: 6em; }
   .panel p { text-align: right; margin: 0; }
   .panel form { background: transparent; color: black; margin: 0.5em -0.5em 1em; padding: 0.5em; }
   .panel form.changed { background: yellow; color: black; }
   .panel form p { text-align: left; margin: 1em 0 0; }
   .panel form p:first-child { margin-top: 0; }
   .panel form p:last-child { margin-bottom: 0; }
   .panel form p textarea { width: 100% /* need the keyword that makes it fit to the parent here XXX */; min-height: 4em; display: block; }
   .panel form dl { line-height: 1.5em; }
   .panel form dt { display: inline-block; width: 20em; white-space: nowrap; text-align: right; font-weight: normal; margin: 0; padding: 0; }
   .panel form dd { display: inline; margin: 0 0 0 1em; padding: 0; }
   .panel form dd:after { display: block; }
   ul.checkboxes { list-style-type: none; }
   .progress { text-decoration: blink; }

   .applies .yes { background: yellow; }
  </style><style>
   .applies thead th > * { display: block; }
   .applies thead code { display: block; }
   .applies td { text-align: center; }

   .matrix, .matrix td { border: hidden; text-align: right; }
   .matrix { margin-left: 2em; }

   .vertical-summary-table tr > th[rowspan="2"]:first-child + th,
   .vertical-summary-table tr > td[rowspan="2"]:first-child + td { border-bottom: hidden; }

   .dice-example { border-collapse: collapse; border-style: hidden solid solid hidden; border-width: thin; margin-left: 3em; }
   .dice-example caption { width: 30em; font-size: smaller; font-style: italic; padding: 0.75em 0; text-align: left; }
   .dice-example td, .dice-example th { border: solid thin; width: 1.35em; height: 1.05em; text-align: center; padding: 0; }

   td.eg { border-width: thin; text-align: center; }

   #table-example-1 { border: solid thin; border-collapse: collapse; margin-left: 3em; }
   #table-example-1 caption { padding-bottom: 0.5em; }
   #table-example-1 thead, #table-example-1 tbody { border: none; }
   #table-example-1 th, #table-example-1 td { border: solid thin; }
   #table-example-1 th { font-weight: normal; }
   #table-example-1 td { border-style: none solid; vertical-align: top; }
   #table-example-1 th { padding: 0.5em; vertical-align: middle; text-align: center; }
   #table-example-1 tbody tr:first-child td { padding-top: 0.5em; }
   #table-example-1 tbody tr:last-child td { padding-bottom: 1.5em; }
   #table-example-1 tbody td:first-child { padding-left: 2.5em; padding-right: 0; width: 9em; }
   #table-example-1 tbody td:first-child::after { content: leader(". "); }
   #table-example-1 tbody td { padding-left: 2em; padding-right: 2em; }
   #table-example-1 tbody td:first-child + td { width: 10em; }
   #table-example-1 tbody td:first-child + td ~ td { width: 2.5em; }
   #table-example-1 tbody td:first-child + td + td + td ~ td { width: 1.25em; }

   .apple-table-examples { border: none; border-collapse: separate; border-spacing: 1.5em 0em; width: 40em; margin-left: 3em; }
   .apple-table-examples * { font-family: "Times", serif; }
   .apple-table-examples td, .apple-table-examples th { border: none; white-space: nowrap; padding-top: 0; padding-bottom: 0; }
   .apple-table-examples tbody th:first-child { border-left: none; width: 100%; }
   .apple-table-examples thead th:first-child ~ th { font-size: smaller; font-weight: bolder; border-bottom: solid 2px; text-align: center; }
   .apple-table-examples tbody th::after, .apple-table-examples tfoot th::after { content: leader(". ") }
   .apple-table-examples tbody th, .apple-table-examples tfoot th { font: inherit; text-align: left; }
   .apple-table-examples td { text-align: right; vertical-align: top; }
   .apple-table-examples.e1 tbody tr:last-child td { border-bottom: solid 1px; }
   .apple-table-examples.e1 tbody + tbody tr:last-child td { border-bottom: double 3px; }
   .apple-table-examples.e2 th[scope=row] { padding-left: 1em; }
   .apple-table-examples sup { line-height: 0; }

   .three-column-nowrap tr > td:first-child,
   .three-column-nowrap tr > td:first-child + td,
   .three-column-nowrap tr > td:first-child + td + td { white-space: nowrap; }

   .details-example img { vertical-align: top; }

   #base64-table {
     white-space: nowrap;
     font-size: 0.6em;
     column-width: 6em;
     column-count: 5;
     column-gap: 1em;
     -moz-column-width: 6em;
     -moz-column-count: 5;
     -moz-column-gap: 1em;
     -webkit-column-width: 6em;
     -webkit-column-count: 5;
     -webkit-column-gap: 1em;
   }
   #base64-table thead { display: none; }
   #base64-table * { border: none; }
   #base64-table tbody td:first-child:after { content: ':'; }
   #base64-table tbody td:last-child { text-align: right; }

   #named-character-references-table {
     white-space: nowrap;
     font-size: 0.6em;
     column-width: 30em;
     column-gap: 1em;
     -moz-column-width: 30em;
     -moz-column-gap: 1em;
     -webkit-column-width: 30em;
     -webkit-column-gap: 1em;
   }
   #named-character-references-table > table > tbody > tr > td:first-child + td,
   #named-character-references-table > table > tbody > tr > td:last-child { text-align: center; }
   #named-character-references-table > table > tbody > tr > td:last-child:hover > span { position: absolute; top: auto; left: auto; margin-left: 0.5em; line-height: 1.2; font-size: 5em; border: outset; padding: 0.25em 0.5em; background: white; width: 1.25em; height: auto; text-align: center; }
   #named-character-references-table > table > tbody > tr#entity-CounterClockwiseContourIntegral > td:first-child { font-size: 0.5em; }

   .glyph.control { color: red; }
  </style><style>
   #table-example-1 * { font-family: "Essays1743", serif; line-height: 1.01em; }
   @font-face {
     font-family: 'Essays1743';
     src: url('/fonts/Essays1743.ttf');
   }
   @font-face {
     font-family: 'Essays1743';
     font-weight: bold;
     src: url('/fonts/Essays1743-Bold.ttf');
   }
   @font-face {
     font-family: 'Essays1743';
     font-style: italic;
     src: url('/fonts/Essays1743-Italic.ttf');
   }
   @font-face {
     font-family: 'Essays1743';
     font-style: italic;
     font-weight: bold;
     src: url('/fonts/Essays1743-BoldItalic.ttf');
   }
  </style><script src=link-fixup.js></script><body onload=init()>
  <header id=head class="head with-buttons">
   <p><a href=https://whatwg.org/ class=logo><img alt=WHATWG src=//whatwg.org/images/logo width=101 height=101></a></p>
   <hgroup><h1 class=allcaps>HTML</h1><h2 id=living-standard class="no-num no-toc">Living Standard — Last Updated <span class=pubdate>21 July 2015</span></h2></hgroup>
   
   
  </header>

  

  

  
  

  
  

  

  <nav><a href=forms.html>← 4.10 Forms</a> — <a href=index.html>Table of Contents</a> — <a href=microdata.html>5 Microdata →</a></nav><ol class=toc><li id=toc-semantics><ol><li><a href=scripting.html#scripting-3>4.12 Scripting</a><ol><li><a href=scripting.html#the-script-element>4.12.1 The <code>script</code> element</a><ol><li><a href=scripting.html#scriptingLanguages>4.12.1.1 Scripting languages</a><li><a href=scripting.html#restrictions-for-contents-of-script-elements>4.12.1.2 Restrictions for contents of <code>script</code> elements</a><li><a href=scripting.html#inline-documentation-for-external-scripts>4.12.1.3 Inline documentation for external scripts</a><li><a href=scripting.html#scriptTagXSLT>4.12.1.4 Interaction of <code>script</code> elements and XSLT</a></ol><li><a href=scripting.html#the-noscript-element>4.12.2 The <code>noscript</code> element</a><li><a href=scripting.html#the-template-element>4.12.3 The <code>template</code> element</a><ol><li><a href=scripting.html#template-XSLT-XPath>4.12.3.1 Interaction of <code>template</code> elements with XSLT and XPath</a></ol><li><a href=scripting.html#the-canvas-element>4.12.4 The <code>canvas</code> element</a><ol><li><a href=scripting.html#proxying-canvases-to-workers>4.12.4.1 Proxying canvases to workers</a><li><a href=scripting.html#2dcontext>4.12.4.2 The 2D rendering context</a><ol><li><a href=scripting.html#implementation-notes>4.12.4.2.1 Implementation notes</a><li><a href=scripting.html#the-canvas-state>4.12.4.2.2 The canvas state</a><li><a href=scripting.html#drawingstyle-objects>4.12.4.2.3 <code>DrawingStyle</code> objects</a><li><a href=scripting.html#line-styles>4.12.4.2.4 Line styles</a><li><a href=scripting.html#text-styles>4.12.4.2.5 Text styles</a><li><a href=scripting.html#building-paths>4.12.4.2.6 Building paths</a><li><a href=scripting.html#path2d-objects>4.12.4.2.7 <code>Path2D</code> objects</a><li><a href=scripting.html#transformations>4.12.4.2.8 Transformations</a><li><a href=scripting.html#image-sources-for-2d-rendering-contexts>4.12.4.2.9 Image sources for 2D rendering contexts</a><li><a href=scripting.html#fill-and-stroke-styles>4.12.4.2.10 Fill and stroke styles</a><li><a href=scripting.html#drawing-rectangles-to-the-bitmap>4.12.4.2.11 Drawing rectangles to the bitmap</a><li><a href=scripting.html#drawing-text-to-the-bitmap>4.12.4.2.12 Drawing text to the bitmap</a><li><a href=scripting.html#drawing-paths-to-the-canvas>4.12.4.2.13 Drawing paths to the canvas</a><li><a href=scripting.html#drawing-images>4.12.4.2.14 Drawing images</a><li><a href=scripting.html#hit-regions>4.12.4.2.15 Hit regions</a><li><a href=scripting.html#pixel-manipulation>4.12.4.2.16 Pixel manipulation</a><li><a href=scripting.html#compositing>4.12.4.2.17 Compositing</a><li><a href=scripting.html#image-smoothing>4.12.4.2.18 Image smoothing</a><li><a href=scripting.html#shadows>4.12.4.2.19 Shadows</a><li><a href=scripting.html#drawing-model>4.12.4.2.20 Drawing model</a><li><a href=scripting.html#best-practices>4.12.4.2.21 Best practices</a><li><a href=scripting.html#examples>4.12.4.2.22 Examples</a></ol><li><a href=scripting.html#colour-spaces-and-colour-correction>4.12.4.3 Colour spaces and colour correction</a><li><a href=scripting.html#serialising-bitmaps-to-a-file>4.12.4.4 Serialising bitmaps to a file</a><li><a href=scripting.html#security-with-canvas-elements>4.12.4.5 Security with <code>canvas</code> elements</a></ol></ol><li><a href=scripting.html#common-idioms>4.13 Common idioms without dedicated elements</a><ol><li><a href=scripting.html#the-main-part-of-the-content>4.13.1 The main part of the content</a><li><a href=scripting.html#rel-up>4.13.2 Bread crumb navigation</a><li><a href=scripting.html#tag-clouds>4.13.3 Tag clouds</a><li><a href=scripting.html#conversations>4.13.4 Conversations</a><li><a href=scripting.html#footnotes>4.13.5 Footnotes</a></ol><li><a href=scripting.html#disabled-elements>4.14 Disabled elements</a><li><a href=scripting.html#selectors>4.15 Matching HTML elements using selectors</a><ol><li><a href=scripting.html#case-sensitivity>4.15.1 Case-sensitivity</a><li><a href=scripting.html#pseudo-classes>4.15.2 Pseudo-classes</a></ol></ol></ol><h3 id=scripting-3>4.12 Scripting</h3>

  <p>Scripts allow authors to add interactivity to their documents.</p>

  <p>Authors are encouraged to use declarative alternatives to scripting where possible, as
  declarative mechanisms are often more maintainable, and many users disable scripting.</p>

  <div class=example>

   <p>For example, instead of using script to show or hide a section to show more details, the
   <code id=scripting-3:the-details-element><a href=forms.html#the-details-element>details</a></code> element could be used.</p>

  </div>

  <p>Authors are also encouraged to make their applications degrade gracefully in the absence of
  scripting support.</p>

  <div class=example>

   <p>For example, if an author provides a link in a table header to dynamically resort the table,
   the link could also be made to function without scripts by requesting the sorted table from the
   server.</p>

  </div>


  <h4 id=the-script-element>4.12.1 The <dfn id=script><code>script</code></dfn> element</h4>

  <dl class=element><dt><a href=dom.html#concept-element-categories id=the-script-element:concept-element-categories>Categories</a>:<dd><a id=the-script-element:metadata-content-2 href=dom.html#metadata-content-2>Metadata content</a>.<dd><a id=the-script-element:flow-content-2 href=dom.html#flow-content-2>Flow content</a>.<dd><a id=the-script-element:phrasing-content-2 href=dom.html#phrasing-content-2>Phrasing content</a>.<dd><a href=dom.html#script-supporting-elements-2 id=the-script-element:script-supporting-elements-2>Script-supporting element</a>.<dt><a href=dom.html#concept-element-contexts id=the-script-element:concept-element-contexts>Contexts in which this element can be used</a>:<dd>Where <a id=the-script-element:metadata-content-2-2 href=dom.html#metadata-content-2>metadata content</a> is expected.<dd>Where <a id=the-script-element:phrasing-content-2-2 href=dom.html#phrasing-content-2>phrasing content</a> is expected.<dd>Where <a id=the-script-element:script-supporting-elements-2-2 href=dom.html#script-supporting-elements-2>script-supporting elements</a> are expected.<dt><a href=dom.html#concept-element-content-model id=the-script-element:concept-element-content-model>Content model</a>:<dd>If there is no <code id=the-script-element:attr-script-src><a href=#attr-script-src>src</a></code>
   attribute, depends on the value of the <code id=the-script-element:attr-script-type><a href=#attr-script-type>type</a></code> attribute, but must match
   <a href=#restrictions-for-contents-of-script-elements id=the-script-element:restrictions-for-contents-of-script-elements>script content restrictions</a>.<dd>If there <em>is</em> a <code id=the-script-element:attr-script-src-2><a href=#attr-script-src>src</a></code>
   attribute, the element must be either empty or contain only
   <a href=#inline-documentation-for-external-scripts id=the-script-element:inline-documentation-for-external-scripts>script documentation</a> that also matches <a href=#restrictions-for-contents-of-script-elements id=the-script-element:restrictions-for-contents-of-script-elements-2>script
   content restrictions</a>.<dt><a href=dom.html#concept-element-tag-omission id=the-script-element:concept-element-tag-omission>Tag omission in text/html</a>:<dd>Neither tag is omissible.<dt><a href=dom.html#concept-element-attributes id=the-script-element:concept-element-attributes>Content attributes</a>:<dd><a id=the-script-element:global-attributes href=dom.html#global-attributes>Global attributes</a><dd><code id=the-script-element:attr-script-src-3><a href=#attr-script-src>src</a></code> — Address of the resource<dd><code id=the-script-element:attr-script-type-2><a href=#attr-script-type>type</a></code> — Type of embedded resource<dd><code id=the-script-element:attr-script-charset><a href=#attr-script-charset>charset</a></code> — Character encoding of the external script resource<dd><code id=the-script-element:attr-script-async><a href=#attr-script-async>async</a></code> — Execute script when available, without blocking<dd><code id=the-script-element:attr-script-defer><a href=#attr-script-defer>defer</a></code> — Defer script execution<dd><code id=the-script-element:attr-script-crossorigin><a href=#attr-script-crossorigin>crossorigin</a></code> — How the element handles crossorigin requests<dt><a href=dom.html#concept-element-dom id=the-script-element:concept-element-dom>DOM interface</a>:<dd>
<pre class=idl>interface <dfn id=htmlscriptelement>HTMLScriptElement</dfn> : <a id=the-script-element:htmlelement href=dom.html#htmlelement>HTMLElement</a> {
  attribute DOMString <a href=#dom-script-src id=the-script-element:dom-script-src>src</a>;
  attribute DOMString <a href=#dom-script-type id=the-script-element:dom-script-type>type</a>;
  attribute DOMString <a href=#dom-script-charset id=the-script-element:dom-script-charset>charset</a>;
  attribute boolean <a href=#dom-script-async id=the-script-element:dom-script-async>async</a>;
  attribute boolean <a href=#dom-script-defer id=the-script-element:dom-script-defer>defer</a>;
  attribute DOMString? <a href=#dom-script-crossorigin id=the-script-element:dom-script-crossorigin>crossOrigin</a>;
  attribute DOMString <a href=#dom-script-text id=the-script-element:dom-script-text>text</a>;
};</pre>
   </dl>

  <p>The <code id=the-script-element:the-script-element><a href=#the-script-element>script</a></code> element allows authors to include dynamic script and data blocks in
  their documents. The element does not <a href=dom.html#represents id=the-script-element:represents>represent</a> content for the
  user.</p>

  <p>When used to include dynamic scripts, the scripts may either be embedded inline or may be
  imported from an external file using the <code id=the-script-element:attr-script-src-4><a href=#attr-script-src>src</a></code> attribute. If
  the language is not that described by "<code>text/javascript</code>", then the <code id=the-script-element:attr-script-type-3><a href=#attr-script-type>type</a></code> attribute must be present, as described below. Whatever
  language is used, the contents of the <code id=the-script-element:the-script-element-2><a href=#the-script-element>script</a></code> element must conform with the
  requirements of that language's specification.</p>

  <p>When used to include data blocks (as opposed to scripts), the data must be embedded inline, the
  format of the data must be given using the <code id=the-script-element:attr-script-type-4><a href=#attr-script-type>type</a></code> attribute,
  the <code id=the-script-element:attr-script-src-5><a href=#attr-script-src>src</a></code> attribute must not be specified, and the contents of
  the <code id=the-script-element:the-script-element-3><a href=#the-script-element>script</a></code> element must conform to the requirements defined for the format used.</p>

  <p>The <dfn id=attr-script-type><code>type</code></dfn> attribute gives the language of the
  script or format of the data. If the attribute is present, its value must be a <a id=the-script-element:valid-mime-type href=infrastructure.html#valid-mime-type>valid MIME
  type</a>. The <code>charset</code> parameter must not be specified. The default, which
  is used if the attribute is absent, is "<code>text/javascript</code>".</p>

  <p>The <dfn id=attr-script-src><code>src</code></dfn> attribute, if specified, gives the
  address of the external script resource to use. The value of the attribute must be a <a id=the-script-element:valid-non-empty-url-potentially-surrounded-by-spaces href=infrastructure.html#valid-non-empty-url-potentially-surrounded-by-spaces>valid
  non-empty URL potentially surrounded by spaces</a> identifying a script resource of the type
  given by the <code id=the-script-element:attr-script-type-5><a href=#attr-script-type>type</a></code> attribute, if the attribute is present, or
  of the type "<code>text/javascript</code>", if the attribute is absent. A resource is a
  script resource of a given type if that type identifies a scripting language and the resource
  conforms with the requirements of that language's specification.</p>

  <p>The <dfn id=attr-script-charset><code>charset</code></dfn> attribute gives the character
  encoding of the external script resource. The attribute must not be specified if the <code id=the-script-element:attr-script-src-6><a href=#attr-script-src>src</a></code> attribute is not present. If the attribute is set, its value
  must be an <a id=the-script-element:ascii-case-insensitive href=infrastructure.html#ascii-case-insensitive>ASCII case-insensitive</a> match for one of the <a href=infrastructure.html#encoding-label id=the-script-element:encoding-label>labels</a> of an <a id=the-script-element:encoding href=infrastructure.html#encoding>encoding</a>, and must specify the same <a id=the-script-element:encoding-2 href=infrastructure.html#encoding>encoding</a> as
  the <code>charset</code> parameter of the <a href=infrastructure.html#content-type id=the-script-element:content-type>Content-Type
  metadata</a> of the external file, if any. <a href=references.html#refsENCODING>[ENCODING]</a></p>

  <p>The <dfn id=attr-script-async><code>async</code></dfn> and <dfn id=attr-script-defer><code>defer</code></dfn> attributes are <a href=infrastructure.html#boolean-attribute id=the-script-element:boolean-attribute>boolean attributes</a> that indicate how the script should be executed. The <code id=the-script-element:attr-script-defer-2><a href=#attr-script-defer>defer</a></code> and <code id=the-script-element:attr-script-async-2><a href=#attr-script-async>async</a></code> attributes
  must not be specified if the <code id=the-script-element:attr-script-src-7><a href=#attr-script-src>src</a></code> attribute is not
  present.

  <p>There are three possible modes that can be selected using these attributes. If the <code id=the-script-element:attr-script-async-3><a href=#attr-script-async>async</a></code> attribute is present, then the script will be executed
  as soon as it is available, but without blocking further parsing of the page. If the <code id=the-script-element:attr-script-async-4><a href=#attr-script-async>async</a></code>
  attribute is not present but the <code id=the-script-element:attr-script-defer-3><a href=#attr-script-defer>defer</a></code> attribute is
  present, then the script is executed when the page has finished parsing. If neither attribute is
  present, then the script is fetched and executed immediately, before the user agent continues
  parsing the page.</p>

  <p class=note>The exact processing details for these attributes are, for mostly historical
  reasons, somewhat non-trivial, involving a number of aspects of HTML. The implementation
  requirements are therefore by necessity scattered throughout the specification. The algorithms
  below (in this section) describe the core of this processing, but these algorithms reference and
  are referenced by the parsing rules for <code id=the-script-element:the-script-element-4><a href=#the-script-element>script</a></code> <a href=syntax.html#scriptTag>start</a> and <a href=syntax.html#scriptEndTag>end</a> tags in HTML, <a href=syntax.html#scriptForeignEndTag>in foreign content</a>,
  and <a href=xhtml.html#scriptTagXML>in XML</a>, the rules for the <code id=the-script-element:dom-document-write><a href=webappapis.html#dom-document-write>document.write()</a></code> method, the handling of <a href=webappapis.html#scripting>scripting</a>, etc.</p>

  <p>The <code id=the-script-element:attr-script-defer-4><a href=#attr-script-defer>defer</a></code> attribute may be specified even if the <code id=the-script-element:attr-script-async-5><a href=#attr-script-async>async</a></code> attribute is specified, to cause legacy Web browsers that
  only support <code id=the-script-element:attr-script-defer-5><a href=#attr-script-defer>defer</a></code> (and not <code id=the-script-element:attr-script-async-6><a href=#attr-script-async>async</a></code>) to fall back to the <code id=the-script-element:attr-script-defer-6><a href=#attr-script-defer>defer</a></code> behaviour instead of the blocking behaviour that
  is the default.</p>

  <p>The <dfn id=attr-script-crossorigin><code>crossorigin</code></dfn> attribute is a
  <a id=the-script-element:cors-settings-attribute href=infrastructure.html#cors-settings-attribute>CORS settings attribute</a>. It controls, for scripts that are obtained from other <a href=browsers.html#origin-2 id=the-script-element:origin-2>origins</a>, whether error information will be exposed.</p>

  <p>Changing the <code id=the-script-element:attr-script-src-8><a href=#attr-script-src>src</a></code>, <code id=the-script-element:attr-script-type-6><a href=#attr-script-type>type</a></code>, <code id=the-script-element:attr-script-charset-2><a href=#attr-script-charset>charset</a></code>, <code id=the-script-element:attr-script-async-7><a href=#attr-script-async>async</a></code>, <code id=the-script-element:attr-script-defer-7><a href=#attr-script-defer>defer</a></code>, and <code id=the-script-element:attr-script-crossorigin-2><a href=#attr-script-crossorigin>crossorigin</a></code> attributes dynamically has no direct effect;
  these attribute are only used at specific times described below.</p> 

  

  <p>A <code id=the-script-element:the-script-element-5><a href=#the-script-element>script</a></code> element has several associated pieces of state.</p>

  <p>The first is a flag indicating whether or not the script block has been <dfn id=already-started>"already
  started"</dfn>. Initially, <code id=the-script-element:the-script-element-6><a href=#the-script-element>script</a></code> elements must have this flag unset (script blocks,
  when created, are not "already started"). The <a href=infrastructure.html#concept-node-clone-ext id=the-script-element:concept-node-clone-ext>cloning
  steps</a> for <code id=the-script-element:the-script-element-7><a href=#the-script-element>script</a></code> elements must set the "already started" flag on the copy if
  it is set on the element being cloned.</p>

  <p>The second is a flag indicating whether the element was <dfn id=parser-inserted>"parser-inserted"</dfn>.
  Initially, <code id=the-script-element:the-script-element-8><a href=#the-script-element>script</a></code> elements must have this flag unset. It is set by the <a id=the-script-element:html-parser href=syntax.html#html-parser>HTML
  parser</a> and the <a id=the-script-element:xml-parser href=xhtml.html#xml-parser>XML parser</a> on <code id=the-script-element:the-script-element-9><a href=#the-script-element>script</a></code> elements they insert and
  affects the processing of those elements.</p>

  <p>The third is a flag indicating whether the element will <dfn id=non-blocking>"non-blocking"</dfn>. Initially,
  <code id=the-script-element:the-script-element-10><a href=#the-script-element>script</a></code> elements must have this flag set. It is unset by the <a id=the-script-element:html-parser-2 href=syntax.html#html-parser>HTML parser</a>
  and the <a id=the-script-element:xml-parser-2 href=xhtml.html#xml-parser>XML parser</a> on <code id=the-script-element:the-script-element-11><a href=#the-script-element>script</a></code> elements they insert. In addition, whenever
  a <code id=the-script-element:the-script-element-12><a href=#the-script-element>script</a></code> element whose <a href=#non-blocking id=the-script-element:non-blocking>"non-blocking"</a> flag is set has a <code id=the-script-element:attr-script-async-8><a href=#attr-script-async>async</a></code> content attribute added, the element's
  <a href=#non-blocking id=the-script-element:non-blocking-2>"non-blocking"</a> flag must be unset.</p> 

  <p>The fourth is a flag indicating whether or not the script block is <dfn id=ready-to-be-parser-executed>"ready to be
  parser-executed"</dfn>. Initially, <code id=the-script-element:the-script-element-13><a href=#the-script-element>script</a></code> elements must have this flag unset (script
  blocks, when created, are not "ready to be parser-executed"). This flag is used only for elements
  that are also <a href=#parser-inserted id=the-script-element:parser-inserted>"parser-inserted"</a>, to let the parser know when to execute the
  script.</p>

  <p>The last few pieces of state are <dfn id=concept-script-type><var>the script block's
  type</var></dfn>, <dfn id=concept-script-encoding><var>the script block's character
  encoding</var></dfn>, and <dfn id=concept-script-fallback-encoding><var>the script block's
  fallback character encoding</var></dfn>. They are determined when the script is prepared, based on
  the attributes on the element at that time, and the
  <code id=the-script-element:the-script-element-14><a href=#the-script-element>script</a></code> element's <a id=the-script-element:node-document href=https://dom.spec.whatwg.org/#concept-node-document data-x-internal=node-document>node document</a>.</p>

  <p>When a <code id=the-script-element:the-script-element-15><a href=#the-script-element>script</a></code> element that is not marked as being <a href=#parser-inserted id=the-script-element:parser-inserted-2>"parser-inserted"</a>
  experiences one of the events listed in the following list, the user agent must <a id=the-script-element:immediately href=infrastructure.html#immediately>immediately</a>
  <a href=#prepare-a-script id=the-script-element:prepare-a-script>prepare</a> the <code id=the-script-element:the-script-element-16><a href=#the-script-element>script</a></code> element:</p>

  <ul><li>The <code id=the-script-element:the-script-element-17><a href=#the-script-element>script</a></code> element gets <a href=infrastructure.html#insert-an-element-into-a-document id=the-script-element:insert-an-element-into-a-document>inserted
   into a document</a>, at the time the <a href=infrastructure.html#nodes-are-inserted id=the-script-element:nodes-are-inserted>node is inserted</a>
   according to the DOM, after any other <code id=the-script-element:the-script-element-18><a href=#the-script-element>script</a></code> elements inserted at the same time that
   are earlier in the <code id=the-script-element:document><a href=dom.html#document>Document</a></code> in <a id=the-script-element:tree-order href=infrastructure.html#tree-order>tree order</a>.<li>The <code id=the-script-element:the-script-element-19><a href=#the-script-element>script</a></code> element is <a id=the-script-element:in-a-document href=infrastructure.html#in-a-document>in a <code>Document</code></a> and a node or
   document fragment is <a href=infrastructure.html#nodes-are-inserted id=the-script-element:nodes-are-inserted-2>inserted</a> into the
   <code id=the-script-element:the-script-element-20><a href=#the-script-element>script</a></code> element, after any <code id=the-script-element:the-script-element-21><a href=#the-script-element>script</a></code> elements <a href=infrastructure.html#nodes-are-inserted id=the-script-element:nodes-are-inserted-3>inserted</a> at that time.<li>The <code id=the-script-element:the-script-element-22><a href=#the-script-element>script</a></code> element is <a id=the-script-element:in-a-document-2 href=infrastructure.html#in-a-document>in a <code>Document</code></a> and has a <code id=the-script-element:attr-script-src-9><a href=#attr-script-src>src</a></code> attribute set where previously the element had no such
   attribute.</ul>

  <p>To <dfn id=prepare-a-script>prepare a script</dfn>, the user agent must act as
  follows:</p>

  <ol><li>

    <p>If the <code id=the-script-element:the-script-element-23><a href=#the-script-element>script</a></code> element is marked as having <a href=#already-started id=the-script-element:already-started>"already started"</a>, then
    the user agent must abort these steps at this point. The script is not executed.</p>

   <li>

    <p>If the element has its <a href=#parser-inserted id=the-script-element:parser-inserted-3>"parser-inserted"</a> flag set, then set <var>was-parser-inserted</var> to true and unset the element's
    <a href=#parser-inserted id=the-script-element:parser-inserted-4>"parser-inserted"</a> flag. Otherwise, set <var>was-parser-inserted</var> to
    false.</p>

    <p class=note>This is done so that if parser-inserted <code id=the-script-element:the-script-element-24><a href=#the-script-element>script</a></code> elements fail to run
    when the parser tries to run them, e.g. because they are empty or specify an unsupported
    scripting language, another script can later mutate them and cause them to run again.</p>

    

   <li>

    <p>If <var>was-parser-inserted</var> is true and the element does not have an <code id=the-script-element:attr-script-async-9><a href=#attr-script-async>async</a></code> attribute, then set the element's
    <a href=#non-blocking id=the-script-element:non-blocking-3>"non-blocking"</a> flag to true.</p>

    <p class=note>This is done so that if a parser-inserted <code id=the-script-element:the-script-element-25><a href=#the-script-element>script</a></code> element fails to
    run when the parser tries to run it, but it is later executed after a script dynamically updates
    it, it will execute in a non-blocking fashion even if the <code id=the-script-element:attr-script-async-10><a href=#attr-script-async>async</a></code>
    attribute isn't set.</p>

   <li id=script-processing-empty>

    <p>If the element has no <code id=the-script-element:attr-script-src-10><a href=#attr-script-src>src</a></code> attribute, and its child
    nodes, if any, consist only of comment nodes and empty <code id=the-script-element:text><a href=infrastructure.html#text>Text</a></code> nodes, then the user
    agent must abort these steps at this point. The script is not executed.</p>

   <li>

    <p>If the element is not <a id=the-script-element:in-a-document-3 href=infrastructure.html#in-a-document>in a <code>Document</code></a>, then the user agent must abort
    these steps at this point. The script is not executed.</p>

   <li id=script-processing-prepare>

    <p>If either:</p>

    <ul class=brief><li>the <code id=the-script-element:the-script-element-26><a href=#the-script-element>script</a></code> element has a <code id=the-script-element:attr-script-type-7><a href=#attr-script-type>type</a></code> attribute
     and its value is the empty string, or<li>the <code id=the-script-element:the-script-element-27><a href=#the-script-element>script</a></code> element has no <code id=the-script-element:attr-script-type-8><a href=#attr-script-type>type</a></code> attribute
     but it has a <code id=the-script-element:attr-script-language><a href=obsolete.html#attr-script-language>language</a></code> attribute and <em>that</em>
     attribute's value is the empty string, or<li>the <code id=the-script-element:the-script-element-28><a href=#the-script-element>script</a></code> element has neither a <code id=the-script-element:attr-script-type-9><a href=#attr-script-type>type</a></code>
     attribute nor a <code id=the-script-element:attr-script-language-2><a href=obsolete.html#attr-script-language>language</a></code> attribute, then</ul>

    <p>...let <var id=the-script-element:concept-script-type><a href=#concept-script-type>the script block's type</a></var> for this
    <code id=the-script-element:the-script-element-29><a href=#the-script-element>script</a></code> element be "<code>text/javascript</code>".</p>

    <p>Otherwise, if the <code id=the-script-element:the-script-element-30><a href=#the-script-element>script</a></code> element has a <code id=the-script-element:attr-script-type-10><a href=#attr-script-type>type</a></code> attribute, let <var id=the-script-element:concept-script-type-2><a href=#concept-script-type>the
    script block's type</a></var> for this <code id=the-script-element:the-script-element-31><a href=#the-script-element>script</a></code> element be the value of that attribute
    with any leading or trailing sequences of <a href=infrastructure.html#space-character id=the-script-element:space-character>space characters</a>
    removed.</p> 

    <p>Otherwise, the element has a non-empty <code id=the-script-element:attr-script-language-3><a href=obsolete.html#attr-script-language>language</a></code>
    attribute; let <var id=the-script-element:concept-script-type-3><a href=#concept-script-type>the script block's type</a></var> for this
    <code id=the-script-element:the-script-element-32><a href=#the-script-element>script</a></code> element be the concatenation of the string "<code>text/</code>"
    followed by the value of the <code id=the-script-element:attr-script-language-4><a href=obsolete.html#attr-script-language>language</a></code> attribute.</p>
    

    <p class=note>The <code id=the-script-element:attr-script-language-5><a href=obsolete.html#attr-script-language>language</a></code> attribute is never
    conforming, and is always ignored if there is a <code id=the-script-element:attr-script-type-11><a href=#attr-script-type>type</a></code>
    attribute present.</p>

   <li>

    <p>If the user agent does not <a href=#support-the-scripting-language id=the-script-element:support-the-scripting-language>support the scripting language</a> given by <var id=the-script-element:concept-script-type-4><a href=#concept-script-type>the script block's type</a></var> for this <code id=the-script-element:the-script-element-33><a href=#the-script-element>script</a></code> element,
    then the user agent must abort these steps at this point. The script is not executed.</p>

   <li>

    <p>If <var>was-parser-inserted</var> is true, then flag the element as
    <a href=#parser-inserted id=the-script-element:parser-inserted-5>"parser-inserted"</a> again, and set the element's <a href=#non-blocking id=the-script-element:non-blocking-4>"non-blocking"</a> flag to
    false.</p>

   <li id=script-processing-start>

    <p>The user agent must set the element's <a href=#already-started id=the-script-element:already-started-2>"already started"</a> flag.</p>

    <p class=note>The state of the element at this moment <a href=#establish-script-block-source>is later used</a> to determine the script source.</p>

   <li>

    <p>If the element is flagged as <a href=#parser-inserted id=the-script-element:parser-inserted-6>"parser-inserted"</a>, but the element's
    <a id=the-script-element:node-document-2 href=https://dom.spec.whatwg.org/#concept-node-document data-x-internal=node-document>node document</a> is not the <code id=the-script-element:document-2><a href=dom.html#document>Document</a></code> of the parser that created the element,
    then abort these steps.</p>

   <li id=script-processing-noscript>

    <p>If <a href=webappapis.html#concept-n-noscript id=the-script-element:concept-n-noscript>scripting is disabled</a> for the <code id=the-script-element:the-script-element-34><a href=#the-script-element>script</a></code>
    element, then the user agent must abort these steps at this point. The script is not
    executed.</p>

    <p class=note>The definition of <a href=webappapis.html#concept-n-noscript id=the-script-element:concept-n-noscript-2>scripting is disabled</a>
    means that, amongst others, the following scripts will not execute: scripts in
    <code id=the-script-element:xmlhttprequest><a href=infrastructure.html#xmlhttprequest>XMLHttpRequest</a></code>'s <code id=the-script-element:dom-xmlhttprequest-responsexml><a href=infrastructure.html#dom-xmlhttprequest-responsexml>responseXML</a></code>
    documents, scripts in <code id=the-script-element:domparser><a data-x-internal=domparser href=https://dvcs.w3.org/hg/innerhtml/raw-file/tip/index.html#the-domparser-interface>DOMParser</a></code>-created documents, scripts in documents created by
    <code id=the-script-element:xsltprocessor><a href=infrastructure.html#xsltprocessor>XSLTProcessor</a></code>'s <code id=the-script-element:dom-xsltprocessor-transformtodocument><a href=infrastructure.html#dom-xsltprocessor-transformtodocument>transformToDocument</a></code> feature, and scripts
    that are first inserted by a script into a <code id=the-script-element:document-3><a href=dom.html#document>Document</a></code> that was created using the
    <code id=the-script-element:dom-domimplementation-createdocument><a href=infrastructure.html#dom-domimplementation-createdocument>createDocument()</a></code> API. <a href=references.html#refsXHR>[XHR]</a>
    <a href=references.html#refsDOMPARSING>[DOMPARSING]</a>  <a href=references.html#refsDOM>[DOM]</a></p>


   <li id=script-processing-for>

    <p>If the <code id=the-script-element:the-script-element-35><a href=#the-script-element>script</a></code> element has an <code id=the-script-element:attr-script-event><a href=obsolete.html#attr-script-event>event</a></code>
    attribute and a <code id=the-script-element:attr-script-for><a href=obsolete.html#attr-script-for>for</a></code> attribute, then run these substeps:</p>

    <ol><li><p>Let <var>for</var> be the value of the <code id=the-script-element:attr-script-for-2><a href=obsolete.html#attr-script-for>for</a></code>
     attribute.<li><p>Let <var>event</var> be the value of the <code id=the-script-element:attr-script-event-2><a href=obsolete.html#attr-script-event>event</a></code> attribute.<li><p><a id=the-script-element:strip-leading-and-trailing-whitespace href=infrastructure.html#strip-leading-and-trailing-whitespace>Strip leading and trailing whitespace</a> from <var>event</var> and
     <var>for</var>.<li><p>If <var>for</var> is not an <a id=the-script-element:ascii-case-insensitive-2 href=infrastructure.html#ascii-case-insensitive>ASCII case-insensitive</a> match for the
     string "<code>window</code>", then the user agent must abort these steps at this
     point. The script is not executed.<li><p>If <var>event</var> is not an <a id=the-script-element:ascii-case-insensitive-3 href=infrastructure.html#ascii-case-insensitive>ASCII case-insensitive</a> match for
     either the string "<code>onload</code>" or the string "<code>onload()</code>", then the user agent must abort these steps at this point. The script
     is not executed.</ol>

   <li id=script-processing-encoding>

    <p>If the <code id=the-script-element:the-script-element-36><a href=#the-script-element>script</a></code> element has a <code id=the-script-element:attr-script-charset-3><a href=#attr-script-charset>charset</a></code>
    attribute, then let <var id=the-script-element:concept-script-encoding><a href=#concept-script-encoding>the script block's character
    encoding</a></var> for this <code id=the-script-element:the-script-element-37><a href=#the-script-element>script</a></code> element be the result of <a id=the-script-element:getting-an-encoding href=https://encoding.spec.whatwg.org/#concept-encoding-get data-x-internal=getting-an-encoding>getting an
    encoding</a> from the value of the <code id=the-script-element:attr-script-charset-4><a href=#attr-script-charset>charset</a></code>
    attribute.</p>

    <p>Otherwise, let <var id=the-script-element:concept-script-fallback-encoding><a href=#concept-script-fallback-encoding>the script block's fallback
    character encoding</a></var> for this <code id=the-script-element:the-script-element-38><a href=#the-script-element>script</a></code> element be the same as <a href="infrastructure.html#document's-character-encoding" id="the-script-element:document's-character-encoding">the encoding of the document itself</a>.</p>

    <p class=note>Only one of these two pieces of state is set.</p>

   <li id=script-processing-src-prepare>

    <p>If the element has a <code id=the-script-element:attr-script-src-11><a href=#attr-script-src>src</a></code> content attribute, run these
    substeps:</p>

    <ol><li><p>Let <var>src</var> be the value of the element's <code id=the-script-element:attr-script-src-12><a href=#attr-script-src>src</a></code> attribute.<li><p>If <var>src</var> is the empty string, <a id=the-script-element:queue-a-task href=webappapis.html#queue-a-task>queue a task</a> to <a id=the-script-element:fire-a-simple-event href=webappapis.html#fire-a-simple-event>fire
     a simple event</a> named <code id=the-script-element:event-error><a href=indices.html#event-error>error</a></code> at the element, and abort
     these steps.<li><p><a href=infrastructure.html#resolve-a-url id=the-script-element:resolve-a-url>Resolve</a> <var>src</var> relative to the
     element.<li><p>If the previous step failed, <a id=the-script-element:queue-a-task-2 href=webappapis.html#queue-a-task>queue a task</a> to <a id=the-script-element:fire-a-simple-event-2 href=webappapis.html#fire-a-simple-event>fire a simple
     event</a> named <code id=the-script-element:event-error-2><a href=indices.html#event-error>error</a></code> at the element, and abort these
     steps.<li>

      <p>Do a <a id=the-script-element:potentially-cors-enabled-fetch href=infrastructure.html#potentially-cors-enabled-fetch>potentially CORS-enabled fetch</a> of the resulting
      <a id=the-script-element:absolute-url href=infrastructure.html#absolute-url>absolute URL</a>, with the <i>mode</i> being the current state of the element's <code id=the-script-element:attr-script-crossorigin-3><a href=#attr-script-crossorigin>crossorigin</a></code> content attribute, the <i>origin</i> being
      the <a id=the-script-element:origin-2-2 href=browsers.html#origin-2>origin</a> of the <code id=the-script-element:the-script-element-39><a href=#the-script-element>script</a></code> element's <a id=the-script-element:node-document-3 href=https://dom.spec.whatwg.org/#concept-node-document data-x-internal=node-document>node document</a>, and the
      <i>default origin behaviour</i> set to <i>taint</i>.</p>

      <p>The resource obtained in this fashion can be either <a id=the-script-element:cors-same-origin href=infrastructure.html#cors-same-origin>CORS-same-origin</a> or
      <a id=the-script-element:cors-cross-origin href=infrastructure.html#cors-cross-origin>CORS-cross-origin</a>. This only affects how error reporting happens.</p>

      <p>For performance reasons, user agents may start fetching the script (as defined above) as
      soon as the <code id=the-script-element:attr-script-src-13><a href=#attr-script-src>src</a></code> attribute is set, instead, in the hope
      that the element will be inserted into the document (and that the <code id=the-script-element:attr-script-crossorigin-4><a href=#attr-script-crossorigin>crossorigin</a></code> attribute won't change value in the
      meantime). Either way, once the element is <a href=infrastructure.html#insert-an-element-into-a-document id=the-script-element:insert-an-element-into-a-document-2>inserted into the document</a>, the load must have started as described in this
      step. If the UA performs such prefetching, but the element is never inserted in the document,
      or the <code id=the-script-element:attr-script-src-14><a href=#attr-script-src>src</a></code> attribute is dynamically changed, or the <code id=the-script-element:attr-script-crossorigin-5><a href=#attr-script-crossorigin>crossorigin</a></code> attribute is dynamically changed, then the
      user agent will not execute the script so obtained, and the fetching process will have been
      effectively wasted.</p>

     </ol>

   <li>

    <p>Then, the first of the following options that describes the situation must be followed:</p>

    <dl class=switch><dt id=script-processing-defer>If the element has a <code id=the-script-element:attr-script-src-15><a href=#attr-script-src>src</a></code>
     attribute, and the element has a <code id=the-script-element:attr-script-defer-8><a href=#attr-script-defer>defer</a></code> attribute, and
     the element has been flagged as <a href=#parser-inserted id=the-script-element:parser-inserted-7>"parser-inserted"</a>, and the element does not have
     an <code id=the-script-element:attr-script-async-11><a href=#attr-script-async>async</a></code> attribute<dd>

      <p>The element must be added to the end of the <dfn id=list-of-scripts-that-will-execute-when-the-document-has-finished-parsing>list of scripts that will execute when the
      document has finished parsing</dfn> associated with the <code id=the-script-element:document-4><a href=dom.html#document>Document</a></code> of the parser
      that created the element.</p>

      <p>The <a href=webappapis.html#concept-task id=the-script-element:concept-task>task</a> that the <a id=the-script-element:networking-task-source href=webappapis.html#networking-task-source>networking task source</a>
      places on the <a id=the-script-element:task-queue href=webappapis.html#task-queue>task queue</a> once the <a href=infrastructure.html#fetch id=the-script-element:fetch>fetching algorithm</a>
      has completed must set the element's <a href=#ready-to-be-parser-executed id=the-script-element:ready-to-be-parser-executed>"ready to be parser-executed"</a> flag. The
      parser will handle executing the script.</p>

     <dt id=script-processing-parser-inserted>If the element has a <code id=the-script-element:attr-script-src-16><a href=#attr-script-src>src</a></code> attribute, and the element has been flagged as
     <a href=#parser-inserted id=the-script-element:parser-inserted-8>"parser-inserted"</a>, and the element does not have an <code id=the-script-element:attr-script-async-12><a href=#attr-script-async>async</a></code> attribute<dd>

      <p>The element is the <a href=#pending-parsing-blocking-script id=the-script-element:pending-parsing-blocking-script>pending parsing-blocking script</a> of the
      <code id=the-script-element:document-5><a href=dom.html#document>Document</a></code> of the parser that created the element. (There can only be one such
      script per <code id=the-script-element:document-6><a href=dom.html#document>Document</a></code> at a time.)</p>

      <p>The <a href=webappapis.html#concept-task id=the-script-element:concept-task-2>task</a> that the <a id=the-script-element:networking-task-source-2 href=webappapis.html#networking-task-source>networking task source</a>
      places on the <a id=the-script-element:task-queue-2 href=webappapis.html#task-queue>task queue</a> once the <a href=infrastructure.html#fetch id=the-script-element:fetch-2>fetching algorithm</a>
      has completed must set the element's <a href=#ready-to-be-parser-executed id=the-script-element:ready-to-be-parser-executed-2>"ready to be parser-executed"</a> flag. The
      parser will handle executing the script.</p>

     <dt id=script-processing-style-delayed>If the element does not have a <code id=the-script-element:attr-script-src-17><a href=#attr-script-src>src</a></code> attribute, and the element has been flagged as
     <a href=#parser-inserted id=the-script-element:parser-inserted-9>"parser-inserted"</a>, and either the parser that created the <code id=the-script-element:the-script-element-40><a href=#the-script-element>script</a></code> is
     an <a id=the-script-element:xml-parser-3 href=xhtml.html#xml-parser>XML parser</a> or it's an <a id=the-script-element:html-parser-3 href=syntax.html#html-parser>HTML parser</a> whose <a id=the-script-element:script-nesting-level href=syntax.html#script-nesting-level>script nesting
     level</a> is not greater than one, and the <code id=the-script-element:document-7><a href=dom.html#document>Document</a></code> of the <a id=the-script-element:html-parser-4 href=syntax.html#html-parser>HTML
     parser</a> or <a id=the-script-element:xml-parser-4 href=xhtml.html#xml-parser>XML parser</a> that created the <code id=the-script-element:the-script-element-41><a href=#the-script-element>script</a></code> element <a id=the-script-element:has-a-style-sheet-that-is-blocking-scripts href=semantics.html#has-a-style-sheet-that-is-blocking-scripts>has
     a style sheet that is blocking scripts</a><dd>

      <p>The element is the <a href=#pending-parsing-blocking-script id=the-script-element:pending-parsing-blocking-script-2>pending parsing-blocking script</a> of the
      <code id=the-script-element:document-8><a href=dom.html#document>Document</a></code> of the parser that created the element. (There can only be one such
      script per <code id=the-script-element:document-9><a href=dom.html#document>Document</a></code> at a time.)</p>

      <p>Set the element's <a href=#ready-to-be-parser-executed id=the-script-element:ready-to-be-parser-executed-3>"ready to be parser-executed"</a> flag. The parser will handle
      executing the script.</p>

     <dt id=script-processing-src-sync>If the element has a <code id=the-script-element:attr-script-src-18><a href=#attr-script-src>src</a></code> attribute, does not have an <code id=the-script-element:attr-script-async-13><a href=#attr-script-async>async</a></code> attribute, and does not have the
     <a href=#non-blocking id=the-script-element:non-blocking-5>"non-blocking"</a> flag set<dd>

      <p>The element must be added to the end of the <dfn id=list-of-scripts-that-will-execute-in-order-as-soon-as-possible>list of scripts that will execute in order
      as soon as possible</dfn> associated with the <a id=the-script-element:node-document-4 href=https://dom.spec.whatwg.org/#concept-node-document data-x-internal=node-document>node document</a> of the <code id=the-script-element:the-script-element-42><a href=#the-script-element>script</a></code>
      element at the time the <a href=#prepare-a-script id=the-script-element:prepare-a-script-2>prepare a script</a> algorithm started.</p>

      <p>The <a href=webappapis.html#concept-task id=the-script-element:concept-task-3>task</a> that the <a id=the-script-element:networking-task-source-3 href=webappapis.html#networking-task-source>networking task source</a>
      places on the <a id=the-script-element:task-queue-3 href=webappapis.html#task-queue>task queue</a> once the <a href=infrastructure.html#fetch id=the-script-element:fetch-3>fetching algorithm</a>
      has completed must run the following steps:</p>

      <ol><li><p>If the element is not now the first element in the <a href=#list-of-scripts-that-will-execute-in-order-as-soon-as-possible id=the-script-element:list-of-scripts-that-will-execute-in-order-as-soon-as-possible>list of scripts that will
       execute in order as soon as possible</a> to which it was added above, then mark the
       element as ready but abort these steps without executing the script yet.<li><p><i>Execution</i>: <a href=#execute-the-script-block id=the-script-element:execute-the-script-block>Execute the script block</a> corresponding to the first
       script element in this <a href=#list-of-scripts-that-will-execute-in-order-as-soon-as-possible id=the-script-element:list-of-scripts-that-will-execute-in-order-as-soon-as-possible-2>list of scripts that will execute in order as soon as
       possible</a>.<li><p>Remove the first element from this <a href=#list-of-scripts-that-will-execute-in-order-as-soon-as-possible id=the-script-element:list-of-scripts-that-will-execute-in-order-as-soon-as-possible-3>list of scripts that will execute in order as
       soon as possible</a>.<li><p>If this <a href=#list-of-scripts-that-will-execute-in-order-as-soon-as-possible id=the-script-element:list-of-scripts-that-will-execute-in-order-as-soon-as-possible-4>list of scripts that will execute in order as soon as possible</a> is
       still not empty and the first entry has already been marked as ready, then jump back to the
       step labeled <i>execution</i>.</ol>

     <dt id=script-processing-src>If the element has a <code id=the-script-element:attr-script-src-19><a href=#attr-script-src>src</a></code>
     attribute<dd>

      <p>The element must be added to the <dfn id=set-of-scripts-that-will-execute-as-soon-as-possible>set of scripts that will execute as soon as
      possible</dfn> of the <a id=the-script-element:node-document-5 href=https://dom.spec.whatwg.org/#concept-node-document data-x-internal=node-document>node document</a> of the <code id=the-script-element:the-script-element-43><a href=#the-script-element>script</a></code> element at the time the
      <a href=#prepare-a-script id=the-script-element:prepare-a-script-3>prepare a script</a> algorithm started.</p>

      <p>The <a href=webappapis.html#concept-task id=the-script-element:concept-task-4>task</a> that the <a id=the-script-element:networking-task-source-4 href=webappapis.html#networking-task-source>networking task source</a>
      places on the <a id=the-script-element:task-queue-4 href=webappapis.html#task-queue>task queue</a> once the <a href=infrastructure.html#fetch id=the-script-element:fetch-4>fetching algorithm</a>
      has completed must <a href=#execute-the-script-block id=the-script-element:execute-the-script-block-2>execute the script block</a> and then remove the element from the
      <a href=#set-of-scripts-that-will-execute-as-soon-as-possible id=the-script-element:set-of-scripts-that-will-execute-as-soon-as-possible>set of scripts that will execute as soon as possible</a>.</p>

     <dt id=script-processing-inline>Otherwise<dd>The user agent must <a id=the-script-element:immediately-2 href=infrastructure.html#immediately>immediately</a> <a href=#execute-the-script-block id=the-script-element:execute-the-script-block-3>execute the script block</a>, even if other
     scripts are already executing.</dl>

   </ol>

  
  <p>Fetching an external script must <a id=the-script-element:delay-the-load-event href=syntax.html#delay-the-load-event>delay the load event</a> of the element's <a id=the-script-element:node-document-6 href=https://dom.spec.whatwg.org/#concept-node-document data-x-internal=node-document>node document</a>
  until the <a href=webappapis.html#concept-task id=the-script-element:concept-task-5>task</a> that is <a href=webappapis.html#queue-a-task id=the-script-element:queue-a-task-3>queued</a>
  by the <a id=the-script-element:networking-task-source-5 href=webappapis.html#networking-task-source>networking task source</a> once the resource has been <a href=infrastructure.html#fetch id=the-script-element:fetch-5>fetched</a> (defined above) has been run.</p>

  <p>The <dfn id=pending-parsing-blocking-script>pending parsing-blocking script</dfn> of a <code id=the-script-element:document-10><a href=dom.html#document>Document</a></code> is used by the
  <code id=the-script-element:document-11><a href=dom.html#document>Document</a></code>'s parser(s).</p>

  <p class=note>If a <code id=the-script-element:the-script-element-44><a href=#the-script-element>script</a></code> element that blocks a parser gets moved to another
  <code id=the-script-element:document-12><a href=dom.html#document>Document</a></code> before it would normally have stopped blocking that parser, it nonetheless
  continues blocking that parser until the condition that causes it to be blocking the parser no
  longer applies (e.g. if the script is a <a href=#pending-parsing-blocking-script id=the-script-element:pending-parsing-blocking-script-3>pending parsing-blocking script</a> because there
  was <a id=the-script-element:a-style-sheet-that-is-blocking-scripts href=semantics.html#a-style-sheet-that-is-blocking-scripts>a style sheet that is blocking scripts</a> when it was parsed, but then the script is
  moved to another <code id=the-script-element:document-13><a href=dom.html#document>Document</a></code> before the style sheet loads, the script still blocks the
  parser until the style sheets are all loaded, at which time the script executes and the parser is
  unblocked).</p>

  

  <p>When the user agent is required to <dfn id=execute-the-script-block>execute a script
  block</dfn>, it must run the following steps:</p>

  <ol><li>

    <p>If the element is flagged as <a href=#parser-inserted id=the-script-element:parser-inserted-10>"parser-inserted"</a>, but the element's
    <a id=the-script-element:node-document-7 href=https://dom.spec.whatwg.org/#concept-node-document data-x-internal=node-document>node document</a> is not the <code id=the-script-element:document-14><a href=dom.html#document>Document</a></code> of the parser that created the element,
    then abort these steps.</p>

   <li>

    <p>Jump to the appropriate set of steps from the list below:</p>

    <dl class=switch><dt>If the load resulted in an error (for example a DNS error, or an HTTP 404 error)<dd><p>Executing the script block must just consist of <a href=webappapis.html#fire-a-simple-event id=the-script-element:fire-a-simple-event-3>firing
     a simple event</a> named <code id=the-script-element:event-error-3><a href=indices.html#event-error>error</a></code> at the element.<dt>If the load was successful<dd>

      <p>Executing the script block must consist of running the following steps. For the purposes of
      these steps, the script is considered to be from an <i>external file</i> if, while the
      <a href=#prepare-a-script id=the-script-element:prepare-a-script-4>prepare a script</a> algorithm above was running for this script, the
      <code id=the-script-element:the-script-element-45><a href=#the-script-element>script</a></code> element had a <code id=the-script-element:attr-script-src-20><a href=#attr-script-src>src</a></code> attribute
      specified.</p>

      <ol><li id=establish-script-block-source>

        <p>Initialise <dfn id=concept-script-source><var>the script block's source</var></dfn>
        as follows:</p>

        <dl class=switch><dt>If the script is from an external file and <var id=the-script-element:concept-script-type-5><a href=#concept-script-type>the script
         block's type</a></var> is a text-based language<dd>

          <p>The contents of that file, interpreted as a Unicode string, are the script source.</p>

          <p>To obtain the Unicode string, the user agent run the following steps:</p>

          <ol><li><p>If the resource's <a href=infrastructure.html#content-type id=the-script-element:content-type-2>Content Type metadata</a>, if any,
           specifies a character encoding, and the user agent supports that encoding, then let <var>character encoding</var> be that encoding, and jump to the bottom step in this
           series of steps.<li><p>If the algorithm above set <var id=the-script-element:concept-script-encoding-2><a href=#concept-script-encoding>the script
           block's character encoding</a></var>, then let <var>character encoding</var> be
           that encoding, and jump to the bottom step in this series of steps.<li><p>Let <var>character encoding</var> be <var id=the-script-element:concept-script-fallback-encoding-2><a href=#concept-script-fallback-encoding>the script block's fallback character
           encoding</a></var>.<li>

            <p>If the specification for <var id=the-script-element:concept-script-type-6><a href=#concept-script-type>the script block's
            type</a></var> gives specific rules for decoding files in that format to Unicode, follow
            them, using <var>character encoding</var> as the character encoding specified by
            higher-level protocols, if necessary.</p> 

            <p>Otherwise, <a id=the-script-element:decode href=infrastructure.html#decode>decode</a> the file to Unicode, using <var>character
            encoding</var> as the fallback encoding.</p>

            <p class=note>The <a id=the-script-element:decode-2 href=infrastructure.html#decode>decode</a> algorithm overrides <var>character
            encoding</var> if the file contains a BOM.</p>

           </ol>

         <dt>If the script is from an external file and <var id=the-script-element:concept-script-type-7><a href=#concept-script-type>the script
         block's type</a></var> is an XML-based language<dd>

          <p>The external file is the script source. When it is later executed, it must be
          interpreted in a manner consistent with the specification defining the language given by
          <var id=the-script-element:concept-script-type-8><a href=#concept-script-type>the script block's type</a></var>.</p>

         <dt>If the script is inline and <var id=the-script-element:concept-script-type-9><a href=#concept-script-type>the script block's
         type</a></var> is a text-based language<dd>

          <p>The value of the <code id=the-script-element:dom-script-text-2><a href=#dom-script-text>text</a></code> IDL attribute at the time
          the element's <a href=#already-started id=the-script-element:already-started-3>"already started"</a> flag was last set is the script source.</p>

         <dt>If the script is inline and <var id=the-script-element:concept-script-type-10><a href=#concept-script-type>the script block's
         type</a></var> is an XML-based language<dd>

          <p>The child nodes of the <code id=the-script-element:the-script-element-46><a href=#the-script-element>script</a></code> element at the time the element's
          <a href=#already-started id=the-script-element:already-started-4>"already started"</a> flag was last set are the script source.</p>

         </dl>

       <li>

        <p><a id=the-script-element:fire-a-simple-event-4 href=webappapis.html#fire-a-simple-event>Fire a simple event</a> named <code id=the-script-element:event-beforescriptexecute><a href=indices.html#event-beforescriptexecute>beforescriptexecute</a></code> that bubbles and is cancelable
        at the <code id=the-script-element:the-script-element-47><a href=#the-script-element>script</a></code> element.</p>

        <p>If the event is canceled, then abort these steps.</p>

       <li>

        <p>If the script is from an external file, then increment the
        <a id=the-script-element:ignore-destructive-writes-counter href=webappapis.html#ignore-destructive-writes-counter>ignore-destructive-writes counter</a> of the <code id=the-script-element:the-script-element-48><a href=#the-script-element>script</a></code> element's
        <a id=the-script-element:node-document-8 href=https://dom.spec.whatwg.org/#concept-node-document data-x-internal=node-document>node document</a>. Let <var>neutralised doc</var> be that
        <code id=the-script-element:document-15><a href=dom.html#document>Document</a></code>.</p>

       <li>

        <p>Let <var>old script element</var> be the value to which the <code id=the-script-element:the-script-element-49><a href=#the-script-element>script</a></code>
        element's <a id=the-script-element:node-document-9 href=https://dom.spec.whatwg.org/#concept-node-document data-x-internal=node-document>node document</a>'s <code id=the-script-element:dom-document-currentscript><a href=dom.html#dom-document-currentscript>currentScript</a></code> object was most recently
        initialised.</p>

       <li>

        <p>Initialise the <code id=the-script-element:the-script-element-50><a href=#the-script-element>script</a></code> element's <a id=the-script-element:node-document-10 href=https://dom.spec.whatwg.org/#concept-node-document data-x-internal=node-document>node document</a>'s <code id=the-script-element:dom-document-currentscript-2><a href=dom.html#dom-document-currentscript>currentScript</a></code> object to the <code id=the-script-element:the-script-element-51><a href=#the-script-element>script</a></code>
        element.</p>

       <li>

        <p><a id=the-script-element:create-a-script href=webappapis.html#create-a-script>Create a script</a>, using <var id=the-script-element:concept-script-source><a href=#concept-script-source>the script
        block's source</a></var>, the <a id=the-script-element:url href=infrastructure.html#url>URL</a> from which the script was obtained, <var id=the-script-element:concept-script-type-11><a href=#concept-script-type>the script block's type</a></var> as the scripting language, and
        the <a id=the-script-element:environment-settings-object href=webappapis.html#environment-settings-object>environment settings object</a> of the <code id=the-script-element:the-script-element-52><a href=#the-script-element>script</a></code> element's
        <a id=the-script-element:node-document-11 href=https://dom.spec.whatwg.org/#concept-node-document data-x-internal=node-document>node document</a>'s <code id=the-script-element:window><a href=browsers.html#window>Window</a></code> object.</p>

        <p>If the script came from a resource that was <a href=infrastructure.html#fetch id=the-script-element:fetch-6>fetched</a> in the
        steps above, and the resource was <a id=the-script-element:cors-cross-origin-2 href=infrastructure.html#cors-cross-origin>CORS-cross-origin</a>, then pass the <var>muted errors</var> flag to the <a id=the-script-element:create-a-script-2 href=webappapis.html#create-a-script>create a script</a> algorithm as well.</p>

        <p class=note>This is where the script is compiled and actually executed.</p>

       <li>

        <p>Initialise the <code id=the-script-element:the-script-element-53><a href=#the-script-element>script</a></code> element's <a id=the-script-element:node-document-12 href=https://dom.spec.whatwg.org/#concept-node-document data-x-internal=node-document>node document</a>'s <code id=the-script-element:dom-document-currentscript-3><a href=dom.html#dom-document-currentscript>currentScript</a></code> object to <var>old script
        element</var>.</p>

       <li>

        <p>Decrement the <a id=the-script-element:ignore-destructive-writes-counter-2 href=webappapis.html#ignore-destructive-writes-counter>ignore-destructive-writes counter</a> of <var>neutralised doc</var>, if it was incremented in the earlier step.</p>

       <li>

        <p><a id=the-script-element:fire-a-simple-event-5 href=webappapis.html#fire-a-simple-event>Fire a simple event</a> named <code id=the-script-element:event-afterscriptexecute><a href=indices.html#event-afterscriptexecute>afterscriptexecute</a></code> that bubbles (but is not
        cancelable) at the <code id=the-script-element:the-script-element-54><a href=#the-script-element>script</a></code> element.</p>

       <li>

        <p>If the script is from an external file, <a id=the-script-element:fire-a-simple-event-6 href=webappapis.html#fire-a-simple-event>fire a simple event</a> named <code id=the-script-element:event-load><a href=indices.html#event-load>load</a></code> at the <code id=the-script-element:the-script-element-55><a href=#the-script-element>script</a></code> element.</p>

        <p>Otherwise, the script is internal; <a id=the-script-element:queue-a-task-4 href=webappapis.html#queue-a-task>queue a task</a> to <a id=the-script-element:fire-a-simple-event-7 href=webappapis.html#fire-a-simple-event>fire a simple
        event</a> named <code id=the-script-element:event-load-2><a href=indices.html#event-load>load</a></code> at the <code id=the-script-element:the-script-element-56><a href=#the-script-element>script</a></code>
        element.</p>

       </ol>

     </dl>

   </ol>

  <p>The IDL attributes <dfn id=dom-script-src><code>src</code></dfn>, <dfn id=dom-script-type><code>type</code></dfn>, <dfn id=dom-script-charset><code>charset</code></dfn>, <dfn id=dom-script-defer><code>defer</code></dfn>, each must <a id=the-script-element:reflect href=infrastructure.html#reflect>reflect</a> the respective
  content attributes of the same name.</p>

  <p>The <dfn id=dom-script-crossorigin><code>crossOrigin</code></dfn> IDL attribute must
  <a id=the-script-element:reflect-2 href=infrastructure.html#reflect>reflect</a> the <code id=the-script-element:attr-script-crossorigin-6><a href=#attr-script-crossorigin>crossorigin</a></code> content attribute.</p>

  <p>The <dfn id=dom-script-async><code>async</code></dfn> IDL attribute controls whether the
  element will execute asynchronously or not. If the element's <a href=#non-blocking id=the-script-element:non-blocking-6>"non-blocking"</a> flag is
  set, then, on getting, the <code id=the-script-element:dom-script-async-2><a href=#dom-script-async>async</a></code> IDL attribute must return
  true, and on setting, the <a href=#non-blocking id=the-script-element:non-blocking-7>"non-blocking"</a> flag must first be unset, and then the
  content attribute must be removed if the IDL attribute's new value is false, and must be set to
  the empty string if the IDL attribute's new value is true. If the element's
  <a href=#non-blocking id=the-script-element:non-blocking-8>"non-blocking"</a> flag is <em>not</em> set, the IDL attribute must <a id=the-script-element:reflect-3 href=infrastructure.html#reflect>reflect</a>
  the <code id=the-script-element:attr-script-async-14><a href=#attr-script-async>async</a></code> content attribute.</p>

  


  <dl class=domintro><dt><var>script</var> . <code id=the-script-element:dom-script-text-3><a href=#dom-script-text>text</a></code> [ = <var>value</var> ]<dd>

    <p>Returns the contents of the element, ignoring child nodes that aren't <code id=the-script-element:text-2><a href=infrastructure.html#text>Text</a></code>
    nodes.</p>

    <p>Can be set, to replace the element's children with the given value.</p>

   </dl>

  

  <p>The IDL attribute <dfn id=dom-script-text><code>text</code></dfn> must return a
  concatenation of the contents of all the <code id=the-script-element:text-3><a href=infrastructure.html#text>Text</a></code> nodes that are children of the
  <code id=the-script-element:the-script-element-57><a href=#the-script-element>script</a></code> element (ignoring any other nodes such as comments or elements), in tree
  order. On setting, it must act the same way as the <code id=the-script-element:textcontent><a href=infrastructure.html#textcontent>textContent</a></code> IDL attribute.</p>

  


  <p class=note>When inserted using the <code id=the-script-element:dom-document-write-2><a href=webappapis.html#dom-document-write>document.write()</a></code>
  method, <code id=the-script-element:the-script-element-58><a href=#the-script-element>script</a></code> elements execute (typically blocking further script execution or HTML parsing), but when inserted using
  <code id=the-script-element:dom-innerhtml><a href=infrastructure.html#dom-innerhtml>innerHTML</a></code> and <code id=the-script-element:dom-outerhtml><a href=infrastructure.html#dom-outerhtml>outerHTML</a></code>
  attributes, they do not execute at all.</p>

  <div class=example>

   <p>In this example, two <code id=the-script-element:the-script-element-59><a href=#the-script-element>script</a></code> elements are used. One embeds an external script, and
   the other includes some data.</p>

   <pre>&lt;script src="game-engine.js">&lt;/script>
&lt;script type="text/x-game-map">
........U.........e
o............A....e
.....A.....AAA....e
.A..AAA...AAAAA...e
&lt;/script></pre>

   <p>The data in this case might be used by the script to generate the map of a video game. The
   data doesn't have to be used that way, though; maybe the map data is actually embedded in other
   parts of the page's markup, and the data block here is just used by the site's search engine to
   help users who are looking for particular features in their game maps.</p>

  </div>

  <div class=example>

   <p>The following sample shows how a script element can be used to define a function that is then
   used by other parts of the document. It also shows how a <code id=the-script-element:the-script-element-60><a href=#the-script-element>script</a></code> element can be used
   to invoke script while the document is being parsed, in this case to initialise the form's
   output.</p>

   <pre>&lt;script>
 function calculate(form) {
   var price = 52000;
   if (form.elements.brakes.checked)
     price += 1000;
   if (form.elements.radio.checked)
     price += 2500;
   if (form.elements.turbo.checked)
     price += 5000;
   if (form.elements.sticker.checked)
     price += 250;
   form.elements.result.value = price;
 }
&lt;/script>
&lt;form name="pricecalc" onsubmit="return false" onchange="calculate(this)">
 &lt;fieldset>
  &lt;legend>Work out the price of your car&lt;/legend>
  &lt;p>Base cost: £52000.&lt;/p>
  &lt;p>Select additional options:&lt;/p>
  &lt;ul>
   &lt;li>&lt;label>&lt;input type=checkbox name=brakes> Ceramic brakes (£1000)&lt;/label>&lt;/li>
   &lt;li>&lt;label>&lt;input type=checkbox name=radio> Satellite radio (£2500)&lt;/label>&lt;/li>
   &lt;li>&lt;label>&lt;input type=checkbox name=turbo> Turbo charger (£5000)&lt;/label>&lt;/li>
   &lt;li>&lt;label>&lt;input type=checkbox name=sticker> "XZ" sticker (£250)&lt;/label>&lt;/li>
  &lt;/ul>
  &lt;p>Total: £&lt;output name=result>&lt;/output>&lt;/p>
 &lt;/fieldset>
 &lt;script>
  calculate(document.forms.pricecalc);
 &lt;/script>
&lt;/form></pre>

  </div>



  <h5 id=scriptingLanguages>4.12.1.1 Scripting languages</h5>

  

  <p>A user agent is said to <dfn id=support-the-scripting-language>support the scripting language</dfn> if each component of <var id=scriptingLanguages:concept-script-type><a href=#concept-script-type>the script block's type</a></var> is an <a id=scriptingLanguages:ascii-case-insensitive href=infrastructure.html#ascii-case-insensitive>ASCII
  case-insensitive</a> match for the corresponding component in the <a id=scriptingLanguages:mime-type href=infrastructure.html#mime-type>MIME type</a> string
  of a scripting language that the user agent implements.</p>

  

  <p>The following lists the <a id=scriptingLanguages:mime-type-2 href=infrastructure.html#mime-type>MIME type</a> strings that user agents must recognize, and the
  languages to which they refer:</p>

  <dl><dt><code id=scriptingLanguages:application/ecmascript><a href=indices.html#application/ecmascript>application/ecmascript</a></code><dt><code id=scriptingLanguages:application/javascript><a href=indices.html#application/javascript>application/javascript</a></code><dt><code id=scriptingLanguages:application/x-ecmascript><a href=indices.html#application/x-ecmascript>application/x-ecmascript</a></code><dt><code id=scriptingLanguages:application/x-javascript><a href=indices.html#application/x-javascript>application/x-javascript</a></code><dt><code id=scriptingLanguages:text/ecmascript><a href=indices.html#text/ecmascript>text/ecmascript</a></code><dt><code id=scriptingLanguages:text/javascript><a href=indices.html#text/javascript>text/javascript</a></code><dt><code id=scriptingLanguages:text/javascript1.0><a href=indices.html#text/javascript1.0>text/javascript1.0</a></code><dt><code id=scriptingLanguages:text/javascript1.1><a href=indices.html#text/javascript1.1>text/javascript1.1</a></code><dt><code id=scriptingLanguages:text/javascript1.2><a href=indices.html#text/javascript1.2>text/javascript1.2</a></code><dt><code id=scriptingLanguages:text/javascript1.3><a href=indices.html#text/javascript1.3>text/javascript1.3</a></code><dt><code id=scriptingLanguages:text/javascript1.4><a href=indices.html#text/javascript1.4>text/javascript1.4</a></code><dt><code id=scriptingLanguages:text/javascript1.5><a href=indices.html#text/javascript1.5>text/javascript1.5</a></code><dt><code id=scriptingLanguages:text/jscript><a href=indices.html#text/jscript>text/jscript</a></code><dt><code id=scriptingLanguages:text/livescript><a href=indices.html#text/livescript>text/livescript</a></code><dt><code id=scriptingLanguages:text/x-ecmascript><a href=indices.html#text/x-ecmascript>text/x-ecmascript</a></code><dt><code id=scriptingLanguages:text/x-javascript><a href=indices.html#text/x-javascript>text/x-javascript</a></code><dd>JavaScript. <a href=references.html#refsECMA262>[ECMA262]</a></dl>

  

  <p>User agents may support other <a href=infrastructure.html#mime-type id=scriptingLanguages:mime-type-3>MIME types</a> for other languages,
  but must not support other <a href=infrastructure.html#mime-type id=scriptingLanguages:mime-type-4>MIME types</a> for the languages in the list
  above. User agents are not required to support the languages listed above.</p>

  <p>The following <a href=infrastructure.html#mime-type id=scriptingLanguages:mime-type-5>MIME types</a> (with or without parameters) must not
  be interpreted as scripting languages:</p>

  <ul class=brief><li><code id=scriptingLanguages:text/plain><a data-x-internal=text/plain href=http://tools.ietf.org/html/rfc2046#section-4.1.3>text/plain</a></code>
   <li><code id=scriptingLanguages:text/xml><a href=indices.html#text/xml>text/xml</a></code>
   
   <li><code id=scriptingLanguages:application/octet-stream><a data-x-internal=application/octet-stream href=http://tools.ietf.org/html/rfc2046#section-4.5.1>application/octet-stream</a></code>
   <li><code id=scriptingLanguages:application/xml><a href=indices.html#application/xml>application/xml</a></code>
   
   

   

  </ul>

  <p class=note>These types are explicitly listed here because they are poorly-defined types that
  are nonetheless likely to be used as formats for data blocks, and it would be problematic if they
  were suddenly to be interpreted as script by a user agent.</p>

  

  <p>When examining types to determine if they represent supported languages, user agents must not
  ignore MIME parameters. Types are to be compared including all parameters.</p> 

  <p class=note>For example, types that include the <code>charset</code> parameter will
  not be recognised as referencing any of the scripting languages listed above.</p>

  


  <h5 id=restrictions-for-contents-of-script-elements>4.12.1.2 <dfn>Restrictions for contents of <code>script</code> elements</dfn></h5>

  <p class=note>The easiest and safest way to avoid the rather strange restrictions described in
  this section is to always escape "<code>&lt;!--</code>" as "<code>&lt;\!--</code>", "<code>&lt;script</code>" as "<code>&lt;\script</code>", and "<code>&lt;/script</code>" as "<code>&lt;\/script</code>" when these sequences appear in literals in scripts (e.g. in
  strings, regular expressions, or comments), and to avoid writing code that uses such constructs in
  expressions. Doing so avoids the pitfalls that the restrictions in this section are prone to
  triggering: namely, that, for historical reasons, parsing of <code id=restrictions-for-contents-of-script-elements:the-script-element><a href=#the-script-element>script</a></code> blocks in HTML is
  a strange and exotic practice that acts unintuitively in the face of these sequences.</p>

  <p>The <code id=restrictions-for-contents-of-script-elements:textcontent><a href=infrastructure.html#textcontent>textContent</a></code> of a <code id=restrictions-for-contents-of-script-elements:the-script-element-2><a href=#the-script-element>script</a></code> element must match the <code>script</code> production in the following ABNF, the character set for which is Unicode.
  <a href=references.html#refsABNF>[ABNF]</a></p>

  <pre>script        = outer *( comment-open inner comment-close outer )

outer         = &lt; any string that doesn't contain a substring that matches not-in-outer >
not-in-outer  = comment-open
inner         = &lt; any string that doesn't contain a substring that matches not-in-inner >
not-in-inner  = comment-close / script-open

comment-open  = "&lt;!--"
comment-close = "-->"
script-open   = "&lt;" s c r i p t tag-end

s             =  %x0053 ; U+0053 LATIN CAPITAL LETTER S
s             =/ %x0073 ; U+0073 LATIN SMALL LETTER S
c             =  %x0043 ; U+0043 LATIN CAPITAL LETTER C
c             =/ %x0063 ; U+0063 LATIN SMALL LETTER C
r             =  %x0052 ; U+0052 LATIN CAPITAL LETTER R
r             =/ %x0072 ; U+0072 LATIN SMALL LETTER R
i             =  %x0049 ; U+0049 LATIN CAPITAL LETTER I
i             =/ %x0069 ; U+0069 LATIN SMALL LETTER I
p             =  %x0050 ; U+0050 LATIN CAPITAL LETTER P
p             =/ %x0070 ; U+0070 LATIN SMALL LETTER P
t             =  %x0054 ; U+0054 LATIN CAPITAL LETTER T
t             =/ %x0074 ; U+0074 LATIN SMALL LETTER T

tag-end       =  %x0009 ; U+0009 CHARACTER TABULATION (tab)
tag-end       =/ %x000A ; U+000A LINE FEED (LF)
tag-end       =/ %x000C ; U+000C FORM FEED (FF)
tag-end       =/ %x0020 ; U+0020 SPACE
tag-end       =/ %x002F ; U+002F SOLIDUS (/)
tag-end       =/ %x003E ; U+003E GREATER-THAN SIGN (>)</pre>

  <p>When a <code id=restrictions-for-contents-of-script-elements:the-script-element-3><a href=#the-script-element>script</a></code> element contains <a href=#inline-documentation-for-external-scripts id=restrictions-for-contents-of-script-elements:inline-documentation-for-external-scripts>script documentation</a>, there are
  further restrictions on the contents of the element, as described in the section below.</p>

  <div class=example>

   <p>The following script illustrates this issue. Suppose you have a script that contains a string,
   as in:</p>

   <pre>var example = 'Consider this string: &lt;!-- &lt;script>';
console.log(example);</pre>

   <p>If one were to put this string directly in a <code id=restrictions-for-contents-of-script-elements:the-script-element-4><a href=#the-script-element>script</a></code> block, it would violate the
   restrictions above:</p>

   <pre>&lt;script>
  var example = 'Consider this string: &lt;!-- &lt;script>';
  console.log(example);
&lt;/script></pre>

   <p>The bigger problem, though, and the reason why it would violate those restrictions, is that
   actually the script would get parsed weirdly: <em>the script block above is not terminated</em>.
   That is, what looks like a "<code>&lt;/script></code>" end tag in this snippet is
   actually still part of the <code id=restrictions-for-contents-of-script-elements:the-script-element-5><a href=#the-script-element>script</a></code> block. The script doesn't execute (since it's not
   terminated); if it somehow were to execute, as it might if the markup looked as follows, it would
   fail because the script (highlighted here) is not valid JavaScript:</p>

   <pre>&lt;script><mark>
  var example = 'Consider this string: &lt;!-- &lt;script>';
  console.log(example);
&lt;/script>
&lt;!-- despite appearances, this is actually part of the script still! -->
&lt;script>
 ... // this is the same script block still...
</mark>&lt;/script></pre>

   <p>What is going on here is that for legacy reasons, "<code>&lt;!--</code>" and "<code>&lt;script</code>" strings in <code id=restrictions-for-contents-of-script-elements:the-script-element-6><a href=#the-script-element>script</a></code> elements in HTML need to be balanced
   in order for the parser to consider closing the block.</p>

   <p>By escaping the problematic strings as mentioned at the top of this section, the problem is
   avoided entirely:</p>

   <pre>&lt;script><mark>
  var example = 'Consider this string: &lt;\!-- &lt;\script>';
  console.log(example);
</mark>&lt;/script>
&lt;!-- this is just a comment between script blocks -->
&lt;script><mark>
 ... // this is a new script block
</mark>&lt;/script></pre>

   <p>It is possible for these sequences to naturally occur in script expressions, as in the
   following examples:</p>

   <pre>if (x&lt;!--y) { ... }
if ( player&lt;script ) { ... }</pre>

   <p>In such cases the characters cannot be escaped, but the expressions can be rewritten so that
   the sequences don't occur, as in:</p>

   <pre>if (x &lt; !--y) { ... }
if (!--y > x) { ... }
if (!(--y) > x) { ... }
if (player &lt; script) { ... }
if (script > player) { ... }</pre>

   <p>Doing this also avoids a different pitfall as well: for related historical reasons, the string
   "&lt;!--" in JavaScript is actually treated as a line comment start, just like "//".</p>

  </div>


  <h5 id=inline-documentation-for-external-scripts>4.12.1.3 <dfn>Inline documentation for external scripts</dfn></h5>

  <p>If a <code id=inline-documentation-for-external-scripts:the-script-element><a href=#the-script-element>script</a></code> element's <code id=inline-documentation-for-external-scripts:attr-script-src><a href=#attr-script-src>src</a></code> attribute is
  specified, then the contents of the <code id=inline-documentation-for-external-scripts:the-script-element-2><a href=#the-script-element>script</a></code> element, if any, must be such that the
  value of the <code id=inline-documentation-for-external-scripts:dom-script-text><a href=#dom-script-text>text</a></code> IDL attribute, which is derived from the
  element's contents, matches the <code>documentation</code> production in the following
  ABNF, the character set for which is Unicode. <a href=references.html#refsABNF>[ABNF]</a></p>

  <pre>documentation = *( *( space / tab / comment ) [ line-comment ] newline )
comment       = slash star *( not-star / star not-slash ) 1*star slash
line-comment  = slash slash *not-newline

; characters
tab           = %x0009 ; U+0009 CHARACTER TABULATION (tab)
newline       = %x000A ; U+000A LINE FEED (LF)
space         = %x0020 ; U+0020 SPACE
star          = %x002A ; U+002A ASTERISK (*)
slash         = %x002F ; U+002F SOLIDUS (/)
not-newline   = %x0000-0009 / %x000B-10FFFF
                ; a <a id=inline-documentation-for-external-scripts:unicode-character href=infrastructure.html#unicode-character>Unicode character</a> other than U+000A LINE FEED (LF)
not-star      = %x0000-0029 / %x002B-10FFFF
                ; a <a id=inline-documentation-for-external-scripts:unicode-character-2 href=infrastructure.html#unicode-character>Unicode character</a> other than U+002A ASTERISK (*)
not-slash     = %x0000-002E / %x0030-10FFFF
                ; a <a id=inline-documentation-for-external-scripts:unicode-character-3 href=infrastructure.html#unicode-character>Unicode character</a> other than U+002F SOLIDUS (/)</pre>

  <p class=note>This corresponds to putting the contents of the element in JavaScript
  comments.</p>

  <p class=note>This requirement is in addition to the earlier restrictions on the syntax of
  contents of <code id=inline-documentation-for-external-scripts:the-script-element-3><a href=#the-script-element>script</a></code> elements.</p>

  <div class=example>

   <p>This allows authors to include documentation, such as license information or API information,
   inside their documents while still referring to external script files. The syntax is constrained
   so that authors don't accidentally include what looks like valid script while also providing a
   <code id=inline-documentation-for-external-scripts:attr-script-src-2><a href=#attr-script-src>src</a></code> attribute.</p>

   <pre>&lt;script src="cool-effects.js">
 // create new instances using:
 //    var e = new Effect();
 // start the effect using .play, stop using .stop:
 //    e.play();
 //    e.stop();
&lt;/script></pre>

  </div>


  

  <h5 id=scriptTagXSLT>4.12.1.4 Interaction of <code id=scriptTagXSLT:the-script-element><a href=#the-script-element>script</a></code> elements and XSLT</h5>

  <p><i>This section is non-normative.</i></p>

  <p>This specification does not define how XSLT interacts with the <code id=scriptTagXSLT:the-script-element-2><a href=#the-script-element>script</a></code> element.
  However, in the absence of another specification actually defining this, here are some guidelines
  for implementors, based on existing implementations:</p>

  <ul><li><p>When an XSLT transformation program is triggered by an <code>&lt;?xml-stylesheet?></code> processing instruction and the browser implements a
   direct-to-DOM transformation, <code id=scriptTagXSLT:the-script-element-3><a href=#the-script-element>script</a></code> elements created by the XSLT processor need to
   be marked <a href=#parser-inserted id=scriptTagXSLT:parser-inserted>"parser-inserted"</a> and run in document order (modulo scripts marked <code id=scriptTagXSLT:attr-script-defer><a href=#attr-script-defer>defer</a></code> or <code id=scriptTagXSLT:attr-script-async><a href=#attr-script-async>async</a></code>),
   <a id=scriptTagXSLT:immediately href=infrastructure.html#immediately>immediately</a>, as the transformation is occurring.<li><p>The <code id=scriptTagXSLT:dom-xsltprocessor-transformtodocument><a href=infrastructure.html#dom-xsltprocessor-transformtodocument>XSLTProcessor.transformToDocument()</a></code> method
   adds elements to a <code id=scriptTagXSLT:document><a href=dom.html#document>Document</a></code> that is not in a <a id=scriptTagXSLT:browsing-context href=browsers.html#browsing-context>browsing context</a>, and,
   accordingly, any <code id=scriptTagXSLT:the-script-element-4><a href=#the-script-element>script</a></code> elements they create need to have their <a href=#already-started id=scriptTagXSLT:already-started>"already
   started"</a> flag set in the <a href=#prepare-a-script id=scriptTagXSLT:prepare-a-script>prepare a script</a> algorithm and never get executed
   (<a href=webappapis.html#concept-bc-noscript id=scriptTagXSLT:concept-bc-noscript>scripting is disabled</a>). Such <code id=scriptTagXSLT:the-script-element-5><a href=#the-script-element>script</a></code>
   elements still need to be marked <a href=#parser-inserted id=scriptTagXSLT:parser-inserted-2>"parser-inserted"</a>, though, such that their <code id=scriptTagXSLT:dom-script-async><a href=#dom-script-async>async</a></code> IDL attribute will return false in the absence of an <code id=scriptTagXSLT:attr-script-async-2><a href=#attr-script-async>async</a></code> content attribute.<li><p>The <code id=scriptTagXSLT:dom-xsltprocessor-transformtofragment><a href=infrastructure.html#dom-xsltprocessor-transformtofragment>XSLTProcessor.transformToFragment()</a></code> method
   needs to create a fragment that is equivalent to one built manually by creating the elements
   using <code id=scriptTagXSLT:dom-document-createelementns><a href=infrastructure.html#dom-document-createelementns>document.createElementNS()</a></code>. For instance,
   it needs to create <code id=scriptTagXSLT:the-script-element-6><a href=#the-script-element>script</a></code> elements that aren't <a href=#parser-inserted id=scriptTagXSLT:parser-inserted-3>"parser-inserted"</a> and
   that don't have their <a href=#already-started id=scriptTagXSLT:already-started-2>"already started"</a> flag set, so that they will execute when the
   fragment is inserted into a document.</ul>

  <p>The main distinction between the first two cases and the last case is that the first two
  operate on <code id=scriptTagXSLT:document-2><a href=dom.html#document>Document</a></code>s and the last operates on a fragment.</p>

  



  <h4 id=the-noscript-element>4.12.2 The <dfn><code>noscript</code></dfn> element</h4>

  <dl class=element><dt><a href=dom.html#concept-element-categories id=the-noscript-element:concept-element-categories>Categories</a>:<dd><a id=the-noscript-element:metadata-content-2 href=dom.html#metadata-content-2>Metadata content</a>.<dd><a id=the-noscript-element:flow-content-2 href=dom.html#flow-content-2>Flow content</a>.<dd><a id=the-noscript-element:phrasing-content-2 href=dom.html#phrasing-content-2>Phrasing content</a>.<dt><a href=dom.html#concept-element-contexts id=the-noscript-element:concept-element-contexts>Contexts in which this element can be used</a>:<dd>In a <code id=the-noscript-element:the-head-element><a href=semantics.html#the-head-element>head</a></code> element of an <a href=infrastructure.html#html-documents id=the-noscript-element:html-documents>HTML document</a>, if there are no ancestor <code id=the-noscript-element:the-noscript-element><a href=#the-noscript-element>noscript</a></code> elements.<dd>Where <a id=the-noscript-element:phrasing-content-2-2 href=dom.html#phrasing-content-2>phrasing content</a> is expected in <a id=the-noscript-element:html-documents-2 href=infrastructure.html#html-documents>HTML documents</a>, if there are no ancestor <code id=the-noscript-element:the-noscript-element-2><a href=#the-noscript-element>noscript</a></code> elements.<dt><a href=dom.html#concept-element-content-model id=the-noscript-element:concept-element-content-model>Content model</a>:<dd>When <a href=webappapis.html#concept-n-noscript id=the-noscript-element:concept-n-noscript>scripting is disabled</a>, in a <code id=the-noscript-element:the-head-element-2><a href=semantics.html#the-head-element>head</a></code> element: in any order, zero or more <code id=the-noscript-element:the-link-element><a href=semantics.html#the-link-element>link</a></code> elements, zero or more <code id=the-noscript-element:the-style-element><a href=semantics.html#the-style-element>style</a></code> elements, and zero or more <code id=the-noscript-element:the-meta-element><a href=semantics.html#the-meta-element>meta</a></code> elements.<dd>When <a href=webappapis.html#concept-n-noscript id=the-noscript-element:concept-n-noscript-2>scripting is disabled</a>, not in a <code id=the-noscript-element:the-head-element-3><a href=semantics.html#the-head-element>head</a></code> element: <a id=the-noscript-element:transparent href=dom.html#transparent>transparent</a>, but there must be no <code id=the-noscript-element:the-noscript-element-3><a href=#the-noscript-element>noscript</a></code> element descendants.<dd>Otherwise: text that conforms to the requirements given in the prose.<dt><a href=dom.html#concept-element-tag-omission id=the-noscript-element:concept-element-tag-omission>Tag omission in text/html</a>:<dd>Neither tag is omissible.<dt><a href=dom.html#concept-element-attributes id=the-noscript-element:concept-element-attributes>Content attributes</a>:<dd><a id=the-noscript-element:global-attributes href=dom.html#global-attributes>Global attributes</a><dt><a href=dom.html#concept-element-dom id=the-noscript-element:concept-element-dom>DOM interface</a>:<dd>Uses <code id=the-noscript-element:htmlelement><a href=dom.html#htmlelement>HTMLElement</a></code>.</dl>

  <p>The <code id=the-noscript-element:the-noscript-element-4><a href=#the-noscript-element>noscript</a></code> element <a id=the-noscript-element:represents href=dom.html#represents>represents</a> nothing if <a href=webappapis.html#concept-n-script id=the-noscript-element:concept-n-script>scripting is enabled</a>, and <a id=the-noscript-element:represents-2 href=dom.html#represents>represents</a> its children if
  <a href=webappapis.html#concept-n-noscript id=the-noscript-element:concept-n-noscript-3>scripting is disabled</a>. It is used to present different
  markup to user agents that support scripting and those that don't support scripting, by affecting
  how the document is parsed.</p>

  <p>When used in <a id=the-noscript-element:html-documents-3 href=infrastructure.html#html-documents>HTML documents</a>, the allowed content model is as follows:</p>

  <dl><dt>In a <code id=the-noscript-element:the-head-element-4><a href=semantics.html#the-head-element>head</a></code> element, if <a href=webappapis.html#concept-n-noscript id=the-noscript-element:concept-n-noscript-4>scripting is
   disabled</a> for the <code id=the-noscript-element:the-noscript-element-5><a href=#the-noscript-element>noscript</a></code> element<dd><p>The <code id=the-noscript-element:the-noscript-element-6><a href=#the-noscript-element>noscript</a></code> element must contain only <code id=the-noscript-element:the-link-element-2><a href=semantics.html#the-link-element>link</a></code>, <code id=the-noscript-element:the-style-element-2><a href=semantics.html#the-style-element>style</a></code>,
   and <code id=the-noscript-element:the-meta-element-2><a href=semantics.html#the-meta-element>meta</a></code> elements.<dt>In a <code id=the-noscript-element:the-head-element-5><a href=semantics.html#the-head-element>head</a></code> element, if <a href=webappapis.html#concept-n-script id=the-noscript-element:concept-n-script-2>scripting is enabled</a>
   for the <code id=the-noscript-element:the-noscript-element-7><a href=#the-noscript-element>noscript</a></code> element<dd><p>The <code id=the-noscript-element:the-noscript-element-8><a href=#the-noscript-element>noscript</a></code> element must contain only text, except that invoking the
   <a id=the-noscript-element:html-fragment-parsing-algorithm href=syntax.html#html-fragment-parsing-algorithm>HTML fragment parsing algorithm</a>  with
   the <code id=the-noscript-element:the-noscript-element-9><a href=#the-noscript-element>noscript</a></code> element as the <var id=the-noscript-element:concept-frag-parse-context><a href=syntax.html#concept-frag-parse-context>context</a></var>
   element and the text contents as the <var>input</var> must result in a list of nodes
   that consists only of <code id=the-noscript-element:the-link-element-3><a href=semantics.html#the-link-element>link</a></code>, <code id=the-noscript-element:the-style-element-3><a href=semantics.html#the-style-element>style</a></code>, and <code id=the-noscript-element:the-meta-element-3><a href=semantics.html#the-meta-element>meta</a></code> elements that
   would be conforming if they were children of the <code id=the-noscript-element:the-noscript-element-10><a href=#the-noscript-element>noscript</a></code> element, and no <a href=syntax.html#parse-error id=the-noscript-element:parse-error>parse errors</a>.<dt>Outside of <code id=the-noscript-element:the-head-element-6><a href=semantics.html#the-head-element>head</a></code> elements, if <a href=webappapis.html#concept-n-noscript id=the-noscript-element:concept-n-noscript-5>scripting is
   disabled</a> for the <code id=the-noscript-element:the-noscript-element-11><a href=#the-noscript-element>noscript</a></code> element<dd><p>The <code id=the-noscript-element:the-noscript-element-12><a href=#the-noscript-element>noscript</a></code> element's content model is <a id=the-noscript-element:transparent-2 href=dom.html#transparent>transparent</a>, with the
   additional restriction that a <code id=the-noscript-element:the-noscript-element-13><a href=#the-noscript-element>noscript</a></code> element must not have a <code id=the-noscript-element:the-noscript-element-14><a href=#the-noscript-element>noscript</a></code>
   element as an ancestor (that is, <code id=the-noscript-element:the-noscript-element-15><a href=#the-noscript-element>noscript</a></code> can't be nested).<dt>Outside of <code id=the-noscript-element:the-head-element-7><a href=semantics.html#the-head-element>head</a></code> elements, if <a href=webappapis.html#concept-n-script id=the-noscript-element:concept-n-script-3>scripting is
   enabled</a> for the <code id=the-noscript-element:the-noscript-element-16><a href=#the-noscript-element>noscript</a></code> element<dd>

    <p>The <code id=the-noscript-element:the-noscript-element-17><a href=#the-noscript-element>noscript</a></code> element must contain only text, except that the text must be such
    that running the following algorithm results in a conforming document with no
    <code id=the-noscript-element:the-noscript-element-18><a href=#the-noscript-element>noscript</a></code> elements and no <code id=the-noscript-element:the-script-element><a href=#the-script-element>script</a></code> elements, and such that no step in the
    algorithm throws an exception or causes an <a id=the-noscript-element:html-parser href=syntax.html#html-parser>HTML parser</a> to flag a <a id=the-noscript-element:parse-error-2 href=syntax.html#parse-error>parse
    error</a>:</p>
    
    
    <ol><li>Remove every <code id=the-noscript-element:the-script-element-2><a href=#the-script-element>script</a></code> element from the document.<li>Make a list of every <code id=the-noscript-element:the-noscript-element-19><a href=#the-noscript-element>noscript</a></code> element in the document. For every
     <code id=the-noscript-element:the-noscript-element-20><a href=#the-noscript-element>noscript</a></code> element in that list, perform the following steps:

      <ol><li>Let <var>s</var> be the concatenation of all the <code id=the-noscript-element:text><a href=infrastructure.html#text>Text</a></code> node
       children of the <code id=the-noscript-element:the-noscript-element-21><a href=#the-noscript-element>noscript</a></code> element.<li>Set the <code id=the-noscript-element:dom-outerhtml><a href=infrastructure.html#dom-outerhtml>outerHTML</a></code> attribute of the
       <code id=the-noscript-element:the-noscript-element-22><a href=#the-noscript-element>noscript</a></code> element to the value of <var>s</var>. (This, as a
       side-effect, causes the <code id=the-noscript-element:the-noscript-element-23><a href=#the-noscript-element>noscript</a></code> element to be removed from the document.) <a href=references.html#refsDOMPARSING>[DOMPARSING]</a></ol>

     </ol>

   </dl>

  <p class=note>All these contortions are required because, for historical reasons, the
  <code id=the-noscript-element:the-noscript-element-24><a href=#the-noscript-element>noscript</a></code> element is handled differently by the <a id=the-noscript-element:html-parser-2 href=syntax.html#html-parser>HTML parser</a> based on
  whether <a href=syntax.html#scripting-flag id=the-noscript-element:scripting-flag>scripting was enabled or not</a> when the parser was
  invoked.</p>

  <p>The <code id=the-noscript-element:the-noscript-element-25><a href=#the-noscript-element>noscript</a></code> element must not be used in <a id=the-noscript-element:xml-documents href=infrastructure.html#xml-documents>XML documents</a>.</p>

  <p class=note>The <code id=the-noscript-element:the-noscript-element-26><a href=#the-noscript-element>noscript</a></code> element is only effective in <a id=the-noscript-element:syntax href=syntax.html#syntax>the HTML
  syntax</a>, it has no effect in <a id=the-noscript-element:the-xhtml-syntax href=xhtml.html#the-xhtml-syntax>the XHTML syntax</a>. This is because the way it works
  is by essentially "turning off" the parser when scripts are enabled, so that the contents of the
  element are treated as pure text and not as real elements. XML does not define a mechanism by
  which to do this.</p>

  

  <p>The <code id=the-noscript-element:the-noscript-element-27><a href=#the-noscript-element>noscript</a></code> element has no other requirements. In particular, children of the
  <code id=the-noscript-element:the-noscript-element-28><a href=#the-noscript-element>noscript</a></code> element are not exempt from <a id=the-noscript-element:form-submission-2 href=forms.html#form-submission-2>form submission</a>, scripting, and so
  forth, even when <a href=webappapis.html#concept-n-script id=the-noscript-element:concept-n-script-4>scripting is enabled</a> for the element.</p>

  

  <div class=example>

   <p>In the following example, a <code id=the-noscript-element:the-noscript-element-29><a href=#the-noscript-element>noscript</a></code> element is
   used to provide fallback for a script.</p>

   <pre>&lt;form action="calcSquare.php">
 &lt;p>
  &lt;label for=x>Number&lt;/label>:
  &lt;input id="x" name="x" type="number">
 &lt;/p>
 &lt;script>
  var x = document.getElementById('x');
  var output = document.createElement('p');
  output.textContent = 'Type a number; it will be squared right then!';
  x.form.appendChild(output);
  x.form.onsubmit = function () { return false; }
  x.oninput = function () {
    var v = x.valueAsNumber;
    output.textContent = v + ' squared is ' + v * v;
  };
 &lt;/script>
 &lt;noscript>
  &lt;input type=submit value="Calculate Square">
 &lt;/noscript>
&lt;/form></pre>

   <p>When script is disabled, a button appears to do the calculation on the server side. When
   script is enabled, the value is computed on-the-fly instead.</p>

   <p>The <code id=the-noscript-element:the-noscript-element-30><a href=#the-noscript-element>noscript</a></code> element is a blunt instrument. Sometimes, scripts might be enabled,
   but for some reason the page's script might fail. For this reason, it's generally better to avoid
   using <code id=the-noscript-element:the-noscript-element-31><a href=#the-noscript-element>noscript</a></code>, and to instead design the script to change the page from being a
   scriptless page to a scripted page on the fly, as in the next example:</p>

   <pre>&lt;form action="calcSquare.php">
 &lt;p>
  &lt;label for=x>Number&lt;/label>:
  &lt;input id="x" name="x" type="number">
 &lt;/p>
 <strong>&lt;input id="submit" type=submit value="Calculate Square"></strong>
 &lt;script>
  var x = document.getElementById('x');
  var output = document.createElement('p');
  output.textContent = 'Type a number; it will be squared right then!';
  x.form.appendChild(output);
  x.form.onsubmit = function () { return false; }
  x.oninput = function () {
    var v = x.valueAsNumber;
    output.textContent = v + ' squared is ' + v * v;
  };
<strong>  var submit = document.getElementById('submit');
  submit.parentNode.removeChild(submit);</strong>
 &lt;/script>
&lt;/form></pre>

   <p>The above technique is also useful in XHTML, since <code id=the-noscript-element:the-noscript-element-32><a href=#the-noscript-element>noscript</a></code> is not supported in
   <a id=the-noscript-element:the-xhtml-syntax-2 href=xhtml.html#the-xhtml-syntax>the XHTML syntax</a>.</p>

  </div>


  <h4 id=the-template-element>4.12.3 The <dfn><code>template</code></dfn> element</h4>

  <dl class=element><dt><a href=dom.html#concept-element-categories id=the-template-element:concept-element-categories>Categories</a>:<dd><a id=the-template-element:metadata-content-2 href=dom.html#metadata-content-2>Metadata content</a>.<dd><a id=the-template-element:flow-content-2 href=dom.html#flow-content-2>Flow content</a>.<dd><a id=the-template-element:phrasing-content-2 href=dom.html#phrasing-content-2>Phrasing content</a>.<dd><a href=dom.html#script-supporting-elements-2 id=the-template-element:script-supporting-elements-2>Script-supporting element</a>.<dt><a href=dom.html#concept-element-contexts id=the-template-element:concept-element-contexts>Contexts in which this element can be used</a>:<dd>Where <a id=the-template-element:metadata-content-2-2 href=dom.html#metadata-content-2>metadata content</a> is expected.<dd>Where <a id=the-template-element:phrasing-content-2-2 href=dom.html#phrasing-content-2>phrasing content</a> is expected.<dd>Where <a id=the-template-element:script-supporting-elements-2-2 href=dom.html#script-supporting-elements-2>script-supporting elements</a> are expected.<dd>As a child of a <code id=the-template-element:the-colgroup-element><a href=tables.html#the-colgroup-element>colgroup</a></code> element that doesn't have a <code id=the-template-element:attr-colgroup-span><a href=tables.html#attr-colgroup-span>span</a></code> attribute.<dt><a href=dom.html#concept-element-content-model id=the-template-element:concept-element-content-model>Content model</a>:<dd>Either: <a id=the-template-element:metadata-content-2-3 href=dom.html#metadata-content-2>Metadata content</a>.<dd>Or: <a id=the-template-element:flow-content-2-2 href=dom.html#flow-content-2>Flow content</a>.<dd>Or: The content model of <code id=the-template-element:the-ol-element><a href=semantics.html#the-ol-element>ol</a></code> and <code id=the-template-element:the-ul-element><a href=semantics.html#the-ul-element>ul</a></code> elements.<dd>Or: The content model of <code id=the-template-element:the-dl-element><a href=semantics.html#the-dl-element>dl</a></code> elements.<dd>Or: The content model of <code id=the-template-element:the-figure-element><a href=semantics.html#the-figure-element>figure</a></code> elements.<dd>Or: The content model of <code id=the-template-element:the-ruby-element><a href=semantics.html#the-ruby-element>ruby</a></code> elements.<dd>Or: The content model of <code id=the-template-element:the-object-element><a href=embedded-content.html#the-object-element>object</a></code> elements.<dd>Or: The content model of <code id=the-template-element:the-video-element><a href=embedded-content.html#the-video-element>video</a></code> and <code id=the-template-element:the-audio-element><a href=embedded-content.html#the-audio-element>audio</a></code> elements.<dd>Or: The content model of <code id=the-template-element:the-table-element><a href=tables.html#the-table-element>table</a></code> elements.<dd>Or: The content model of <code id=the-template-element:the-colgroup-element-2><a href=tables.html#the-colgroup-element>colgroup</a></code> elements.<dd>Or: The content model of <code id=the-template-element:the-thead-element><a href=tables.html#the-thead-element>thead</a></code>, <code id=the-template-element:the-tbody-element><a href=tables.html#the-tbody-element>tbody</a></code>, and <code id=the-template-element:the-tfoot-element><a href=tables.html#the-tfoot-element>tfoot</a></code> elements.<dd>Or: The content model of <code id=the-template-element:the-tr-element><a href=tables.html#the-tr-element>tr</a></code> elements.<dd>Or: The content model of <code id=the-template-element:the-fieldset-element><a href=forms.html#the-fieldset-element>fieldset</a></code> elements.<dd>Or: The content model of <code id=the-template-element:the-select-element><a href=forms.html#the-select-element>select</a></code> elements.<dd>Or: The content model of <code id=the-template-element:the-details-element><a href=forms.html#the-details-element>details</a></code> elements.<dd>Or: The content model of <code id=the-template-element:the-menu-element><a href=forms.html#the-menu-element>menu</a></code> elements whose <code id=the-template-element:attr-menu-type><a href=forms.html#attr-menu-type>type</a></code> attribute is in the <a id=the-template-element:popup-menu-state href=forms.html#popup-menu-state>popup menu state</a>.<dt><a href=dom.html#concept-element-tag-omission id=the-template-element:concept-element-tag-omission>Tag omission in text/html</a>:<dd>Neither tag is omissible.<dt><a href=dom.html#concept-element-attributes id=the-template-element:concept-element-attributes>Content attributes</a>:<dd><a id=the-template-element:global-attributes href=dom.html#global-attributes>Global attributes</a><dt><a href=dom.html#concept-element-dom id=the-template-element:concept-element-dom>DOM interface</a>:<dd>
<pre class=idl>interface <dfn id=htmltemplateelement>HTMLTemplateElement</dfn> : <a id=the-template-element:htmlelement href=dom.html#htmlelement>HTMLElement</a> {
  readonly attribute <a id=the-template-element:documentfragment href=infrastructure.html#documentfragment>DocumentFragment</a> <a href=#dom-template-content id=the-template-element:dom-template-content>content</a>;
};</pre>
</dl>

  <p>The <code id=the-template-element:the-template-element><a href=#the-template-element>template</a></code> element is used to declare fragments of HTML that can be cloned and
  inserted in the document by script.</p>

  <p>In a rendering, the <code id=the-template-element:the-template-element-2><a href=#the-template-element>template</a></code> element <a id=the-template-element:represents href=dom.html#represents>represents</a> nothing.</p>

  <dl class=domintro><dt><var>template</var> . <code id=the-template-element:dom-template-content-2><a href=#dom-template-content>content</a></code><dd>

    <p>Returns the contents of the <code id=the-template-element:the-template-element-3><a href=#the-template-element>template</a></code>, which are stored in a
    <code id=the-template-element:documentfragment-2><a href=infrastructure.html#documentfragment>DocumentFragment</a></code> associated with a different <code id=the-template-element:document><a href=dom.html#document>Document</a></code> so as to avoid
    the <code id=the-template-element:the-template-element-4><a href=#the-template-element>template</a></code> contents interfering with the main <code id=the-template-element:document-2><a href=dom.html#document>Document</a></code>. (For
    example, this avoids form controls from being submitted, scripts from executing, and so
    forth.)</p>

   </dl>

  

  <p>Each <code id=the-template-element:the-template-element-5><a href=#the-template-element>template</a></code> element has an associated <code id=the-template-element:documentfragment-3><a href=infrastructure.html#documentfragment>DocumentFragment</a></code> object that
  is its <dfn id=template-contents>template contents</dfn>. When a <code id=the-template-element:the-template-element-6><a href=#the-template-element>template</a></code> element is created, the user
  agent must run the following steps to establish the <a href=#template-contents id=the-template-element:template-contents>template contents</a>:</p>

  <ol><li><p>Let <var>doc</var> be the <code id=the-template-element:the-template-element-7><a href=#the-template-element>template</a></code> element's <a id=the-template-element:node-document href=https://dom.spec.whatwg.org/#concept-node-document data-x-internal=node-document>node document</a>'s <a href=#appropriate-template-contents-owner-document id=the-template-element:appropriate-template-contents-owner-document>appropriate template contents owner
   document</a>.<li><p>Create a <code id=the-template-element:documentfragment-4><a href=infrastructure.html#documentfragment>DocumentFragment</a></code> object whose <a id=the-template-element:node-document-2 href=https://dom.spec.whatwg.org/#concept-node-document data-x-internal=node-document>node document</a> is <var>doc</var>.<li><p>Set the <code id=the-template-element:the-template-element-8><a href=#the-template-element>template</a></code> element's <a href=#template-contents id=the-template-element:template-contents-2>template contents</a> to the newly
   created <code id=the-template-element:documentfragment-5><a href=infrastructure.html#documentfragment>DocumentFragment</a></code> object.</ol>

  <p>A <code id=the-template-element:document-3><a href=dom.html#document>Document</a></code> <var>doc</var>'s <dfn id=appropriate-template-contents-owner-document>appropriate template contents owner
  document</dfn> is the <code id=the-template-element:document-4><a href=dom.html#document>Document</a></code> returned by the following algorithm:</p>

  <ol><li>

    <p>If <var>doc</var> is not a <code id=the-template-element:document-5><a href=dom.html#document>Document</a></code> created by this algorithm, run
    these substeps:</p>

    <ol><li>

      <p>If <var>doc</var> does not yet have an <dfn id=associated-inert-template-document>associated inert template
      document</dfn> then run these substeps:</p>

      <ol><li><p>Let <var>new doc</var> be a new <code id=the-template-element:document-6><a href=dom.html#document>Document</a></code> (that does not have a
       <a id=the-template-element:browsing-context href=browsers.html#browsing-context>browsing context</a>). This is "a <code id=the-template-element:document-7><a href=dom.html#document>Document</a></code> created by this algorithm"
       for the purposes of the step above.<li><p>If <var>doc</var> is an <a href=infrastructure.html#html-documents id=the-template-element:html-documents>HTML document</a>, mark
       <var>new doc</var> as an <a href=infrastructure.html#html-documents id=the-template-element:html-documents-2>HTML document</a>
       also.<li><p>Let <var>doc</var>'s <a href=#associated-inert-template-document id=the-template-element:associated-inert-template-document>associated inert template document</a> be <var>new doc</var>.</ol>

     <li><p>Set <var>doc</var> to <var>doc</var>'s <a href=#associated-inert-template-document id=the-template-element:associated-inert-template-document-2>associated inert
     template document</a>.</ol>

    <p class=note>Each <code id=the-template-element:document-8><a href=dom.html#document>Document</a></code> not created by this algorithm thus gets a single
    <code id=the-template-element:document-9><a href=dom.html#document>Document</a></code> to act as its proxy for owning the <a href=#template-contents id=the-template-element:template-contents-3>template contents</a> of all
    its <code id=the-template-element:the-template-element-9><a href=#the-template-element>template</a></code> elements, so that they aren't in a <a id=the-template-element:browsing-context-2 href=browsers.html#browsing-context>browsing context</a> and
    thus remain inert (e.g. scripts do not run). Meanwhile, <code id=the-template-element:the-template-element-10><a href=#the-template-element>template</a></code> elements inside
    <code id=the-template-element:document-10><a href=dom.html#document>Document</a></code> objects that <em>are</em> created by this algorithm just reuse the same
    <code id=the-template-element:document-11><a href=dom.html#document>Document</a></code> owner for their contents.</p>

   <li><p>Return <var>doc</var>.</ol>

  <p>When a <code id=the-template-element:the-template-element-11><a href=#the-template-element>template</a></code> element's <a id=the-template-element:node-document-3 href=https://dom.spec.whatwg.org/#concept-node-document data-x-internal=node-document>node document</a> changes, the user agent must run the following
  steps:</p>

  <ol><li><p>Let <var>doc</var> be the <code id=the-template-element:the-template-element-12><a href=#the-template-element>template</a></code> element's new <a id=the-template-element:node-document-4 href=https://dom.spec.whatwg.org/#concept-node-document data-x-internal=node-document>node document</a>'s <a href=#appropriate-template-contents-owner-document id=the-template-element:appropriate-template-contents-owner-document-2>appropriate template contents owner
   document</a>.<li><p><a href=infrastructure.html#concept-node-adopt id=the-template-element:concept-node-adopt>Adopt</a> the <code id=the-template-element:the-template-element-13><a href=#the-template-element>template</a></code> element's
   <a href=#template-contents id=the-template-element:template-contents-4>template contents</a> (a <code id=the-template-element:documentfragment-6><a href=infrastructure.html#documentfragment>DocumentFragment</a></code> object) into <var>doc</var>.</ol>

  <p>The <dfn id=dom-template-content><code>content</code></dfn> IDL attribute must return the
  <code id=the-template-element:the-template-element-14><a href=#the-template-element>template</a></code> element's <a href=#template-contents id=the-template-element:template-contents-5>template contents</a>.</p>

  <hr>

  <p>The <a href=infrastructure.html#concept-node-clone-ext id=the-template-element:concept-node-clone-ext>cloning steps</a> for a <code id=the-template-element:the-template-element-15><a href=#the-template-element>template</a></code>
  element <var>node</var> being cloned to a copy <var>copy</var> must run the
  following steps:</p>

  <ol><li><p>If the <var>clone children flag</var> is not set in the calling <a href=infrastructure.html#concept-node-clone id=the-template-element:concept-node-clone>clone</a> algorithm, abort these steps.<li><p>Let <var>copied contents</var> be the result of <a href=infrastructure.html#concept-node-clone id=the-template-element:concept-node-clone-2>cloning</a> all the children of <var>node</var>'s
   <a href=#template-contents id=the-template-element:template-contents-6>template contents</a>, with <var>document</var> set to <var>copy</var>'s <a href=#template-contents id=the-template-element:template-contents-7>template contents</a>'s <a id=the-template-element:node-document-5 href=https://dom.spec.whatwg.org/#concept-node-document data-x-internal=node-document>node
   document</a>, and with the <var>clone children
   flag</var> set.<li><p>Append <var>copied contents</var> to <var>copy</var>'s <a href=#template-contents id=the-template-element:template-contents-8>template
   contents</a>.</ol>

  

  <div class=example>

   <p>In this example, a script populates a table four-column with data from a data structure, using
   a <code id=the-template-element:the-template-element-16><a href=#the-template-element>template</a></code> to provide the element structure instead of manually generating the
   structure from markup.</p>

   <pre>&lt;!DOCTYPE html>
&lt;title>Cat data&lt;/title>
&lt;script>
 // Data is hard-coded here, but could come from the server
 var data = [
   { name: 'Pillar', color: 'Ticked Tabby', sex: 'Female (neutered)', legs: 3 },
   { name: 'Hedral', color: 'Tuxedo', sex: 'Male (neutered)', legs: 4 },
 ];
&lt;/script>
&lt;table>
 &lt;thead>
  &lt;tr>
   &lt;th>Name &lt;th>Colour &lt;th>Sex &lt;th>Legs
 &lt;tbody>
  &lt;template id="row">
   &lt;tr>&lt;td>&lt;td>&lt;td>&lt;td>
  &lt;/template>
&lt;/table>
&lt;script>
 var template = document.querySelector('#row');
 for (var i = 0; i &lt; data.length; i += 1) {
   var cat = data[i];
   var clone = template.content.cloneNode(true);
   var cells = clone.querySelectorAll('td');
   cells[0].textContent = cat.name;
   cells[1].textContent = cat.color;
   cells[2].textContent = cat.sex;
   cells[3].textContent = cat.legs;
   template.parentNode.appendChild(clone);
 }
&lt;/script></pre>

   <p>This example uses <code id=the-template-element:dom-node-clonenode><a href=infrastructure.html#dom-node-clonenode>cloneNode()</a></code> on the
   <code id=the-template-element:the-template-element-17><a href=#the-template-element>template</a></code>'s contents; it could equivalently have used <code id=the-template-element:dom-document-importnode><a href=infrastructure.html#dom-document-importnode>document.importNode()</a></code>, which does the same thing. The
   only difference between these two APIs is when the <a id=the-template-element:node-document-6 href=https://dom.spec.whatwg.org/#concept-node-document data-x-internal=node-document>node document</a> is updated: with
   <code id=the-template-element:dom-node-clonenode-2><a href=infrastructure.html#dom-node-clonenode>cloneNode()</a></code> it is updated when the nodes are appended
   with <code id=the-template-element:dom-node-appendchild><a href=infrastructure.html#dom-node-appendchild>appendChild()</a></code>, with <code id=the-template-element:dom-document-importnode-2><a href=infrastructure.html#dom-document-importnode>document.importNode()</a></code> it is updated when the nodes are
   cloned.</p>

  </div>



  

  <h5 id=template-XSLT-XPath>4.12.3.1 Interaction of <code id=template-XSLT-XPath:the-template-element><a href=#the-template-element>template</a></code> elements with XSLT and XPath</h5>

  <p><i>This section is non-normative.</i></p>

  <p>This specification does not define how XSLT and XPath interact with the <code id=template-XSLT-XPath:the-template-element-2><a href=#the-template-element>template</a></code>
  element. However, in the absence of another specification actually defining this, here are some
  guidelines for implementors, which are intended to be consistent with other processing described
  in this specification:</p>

  <ul><li><p>An XSLT processor based on an XML parser that acts <a href=xhtml.html#xml-parser id=template-XSLT-XPath:xml-parser>as described
   in this specification</a> needs to act as if <code id=template-XSLT-XPath:the-template-element-3><a href=#the-template-element>template</a></code> elements contain as
   descendants their <a href=#template-contents id=template-XSLT-XPath:template-contents>template contents</a> for the purposes of the transform.<li><p>An XSLT processor that outputs a DOM needs to ensure that nodes that would go into a
   <code id=template-XSLT-XPath:the-template-element-4><a href=#the-template-element>template</a></code> element are instead placed into the element's <a href=#template-contents id=template-XSLT-XPath:template-contents-2>template
   contents</a>.<li><p>XPath evaluation using the XPath DOM API when applied to a <code id=template-XSLT-XPath:document><a href=dom.html#document>Document</a></code> parsed
   using the <a id=template-XSLT-XPath:html-parser href=syntax.html#html-parser>HTML parser</a> or the <a id=template-XSLT-XPath:xml-parser-2 href=xhtml.html#xml-parser>XML parser</a> described in this specification
   needs to ignore <a href=#template-contents id=template-XSLT-XPath:template-contents-3>template contents</a>.</p>

  </ul>

  




  <h4 id=the-canvas-element>4.12.4 The <dfn id=canvas><code>canvas</code></dfn> element</h4>

  <dl class=element><dt><a href=dom.html#concept-element-categories id=the-canvas-element:concept-element-categories>Categories</a>:<dd><a id=the-canvas-element:flow-content-2 href=dom.html#flow-content-2>Flow content</a>.<dd><a id=the-canvas-element:phrasing-content-2 href=dom.html#phrasing-content-2>Phrasing content</a>.<dd><a id=the-canvas-element:embedded-content-category href=dom.html#embedded-content-category>Embedded content</a>.<dd><a id=the-canvas-element:palpable-content-2 href=dom.html#palpable-content-2>Palpable content</a>.<dt><a href=dom.html#concept-element-contexts id=the-canvas-element:concept-element-contexts>Contexts in which this element can be used</a>:<dd>Where <a id=the-canvas-element:embedded-content-category-2 href=dom.html#embedded-content-category>embedded content</a> is expected.<dt><a href=dom.html#concept-element-content-model id=the-canvas-element:concept-element-content-model>Content model</a>:<dd><a id=the-canvas-element:transparent href=dom.html#transparent>Transparent</a>, but with no <a id=the-canvas-element:interactive-content-2 href=dom.html#interactive-content-2>interactive content</a> descendants except for <code id=the-canvas-element:the-a-element><a href=semantics.html#the-a-element>a</a></code> elements, <code id=the-canvas-element:the-img-element><a href=embedded-content.html#the-img-element>img</a></code> elements with <code id=the-canvas-element:attr-hyperlink-usemap><a href=embedded-content.html#attr-hyperlink-usemap>usemap</a></code> attributes, <code id=the-canvas-element:the-button-element><a href=forms.html#the-button-element>button</a></code> elements, <code id=the-canvas-element:the-input-element><a href=forms.html#the-input-element>input</a></code> elements whose <code id=the-canvas-element:attr-input-type><a href=forms.html#attr-input-type>type</a></code> attribute are in the <a href="forms.html#checkbox-state-(type=checkbox)" id="the-canvas-element:checkbox-state-(type=checkbox)">Checkbox</a> or <a href="forms.html#radio-button-state-(type=radio)" id="the-canvas-element:radio-button-state-(type=radio)">Radio Button</a> states, <code id=the-canvas-element:the-input-element-2><a href=forms.html#the-input-element>input</a></code> elements that are <a href=forms.html#concept-button id=the-canvas-element:concept-button>buttons</a>, <code id=the-canvas-element:the-select-element><a href=forms.html#the-select-element>select</a></code> elements with a <code id=the-canvas-element:attr-select-multiple><a href=forms.html#attr-select-multiple>multiple</a></code> attribute or a <a href=forms.html#concept-select-size id=the-canvas-element:concept-select-size>display size</a> greater than 1, <a href=tables.html#sorting-interface-th-element id=the-canvas-element:sorting-interface-th-element>sorting interface <code>th</code> elements</a>, and elements that would not be <a id=the-canvas-element:interactive-content-2-2 href=dom.html#interactive-content-2>interactive content</a> except for having the <code id=the-canvas-element:attr-tabindex><a href=interaction.html#attr-tabindex>tabindex</a></code> attribute specified.<dt><a href=dom.html#concept-element-tag-omission id=the-canvas-element:concept-element-tag-omission>Tag omission in text/html</a>:<dd>Neither tag is omissible.<dt><a href=dom.html#concept-element-attributes id=the-canvas-element:concept-element-attributes>Content attributes</a>:<dd><a id=the-canvas-element:global-attributes href=dom.html#global-attributes>Global attributes</a><dd><code id=the-canvas-element:attr-canvas-width><a href=#attr-canvas-width>width</a></code> — Horizontal dimension<dd><code id=the-canvas-element:attr-canvas-height><a href=#attr-canvas-height>height</a></code> — Vertical dimension<dt><a href=dom.html#concept-element-dom id=the-canvas-element:concept-element-dom>DOM interface</a>:<dd>
    <pre class=idl>typedef (<a href=#canvasrenderingcontext2d id=the-canvas-element:canvasrenderingcontext2d>CanvasRenderingContext2D</a> or <a id=the-canvas-element:webglrenderingcontext href=infrastructure.html#webglrenderingcontext>WebGLRenderingContext</a>) <dfn id=renderingcontext>RenderingContext</dfn>;

interface <dfn id=htmlcanvaselement>HTMLCanvasElement</dfn> : <a id=the-canvas-element:htmlelement href=dom.html#htmlelement>HTMLElement</a> {
  attribute unsigned long <a href=#dom-canvas-width id=the-canvas-element:dom-canvas-width>width</a>;
  attribute unsigned long <a href=#dom-canvas-height id=the-canvas-element:dom-canvas-height>height</a>;

  <a href=#renderingcontext id=the-canvas-element:renderingcontext>RenderingContext</a>? <a href=#dom-canvas-getcontext id=the-canvas-element:dom-canvas-getcontext>getContext</a>(DOMString contextId, any... arguments);
  boolean <a href=#dom-canvas-probablysupportscontext id=the-canvas-element:dom-canvas-probablysupportscontext>probablySupportsContext</a>(DOMString contextId, any... arguments);

  void <a href=#dom-canvas-setcontext id=the-canvas-element:dom-canvas-setcontext>setContext</a>(<a href=#renderingcontext id=the-canvas-element:renderingcontext-2>RenderingContext</a> context);
  <a href=#canvasproxy id=the-canvas-element:canvasproxy>CanvasProxy</a> <a href=#dom-canvas-transfercontroltoproxy id=the-canvas-element:dom-canvas-transfercontroltoproxy>transferControlToProxy</a>();

  DOMString <a href=#dom-canvas-todataurl id=the-canvas-element:dom-canvas-todataurl>toDataURL</a>(optional DOMString type, any... arguments);
  void <a href=#dom-canvas-toblob id=the-canvas-element:dom-canvas-toblob>toBlob</a>(<a id=the-canvas-element:filecallback href=infrastructure.html#filecallback>FileCallback</a>? _callback, optional DOMString type, any... arguments);
};</pre>
   </dl>

  <p>The <code id=the-canvas-element:the-canvas-element><a href=#the-canvas-element>canvas</a></code> element provides scripts with a resolution-dependent bitmap canvas,
  which can be used for rendering graphs, game graphics, art, or other visual images on the fly.</p>

  <p>Authors should not use the <code id=the-canvas-element:the-canvas-element-2><a href=#the-canvas-element>canvas</a></code> element in a document when a more suitable
  element is available. For example, it is inappropriate to use a <code id=the-canvas-element:the-canvas-element-3><a href=#the-canvas-element>canvas</a></code> element to
  render a page heading: if the desired presentation of the heading is graphically intense, it
  should be marked up using appropriate elements (typically <code id=the-canvas-element:the-h1,-h2,-h3,-h4,-h5,-and-h6-elements><a href=semantics.html#the-h1,-h2,-h3,-h4,-h5,-and-h6-elements>h1</a></code>) and then styled using
  CSS and supporting technologies such as Web Components.</p>

  <p>When authors use the <code id=the-canvas-element:the-canvas-element-4><a href=#the-canvas-element>canvas</a></code> element, they must also provide content that, when
  presented to the user, conveys essentially the same function or purpose as the
  <code id=the-canvas-element:the-canvas-element-5><a href=#the-canvas-element>canvas</a></code>' bitmap. This content may be placed as content of the <code id=the-canvas-element:the-canvas-element-6><a href=#the-canvas-element>canvas</a></code>
  element. The contents of the <code id=the-canvas-element:the-canvas-element-7><a href=#the-canvas-element>canvas</a></code> element, if any, are the element's <a id=the-canvas-element:fallback-content href=dom.html#fallback-content>fallback
  content</a>.</p>

  <hr>

  <p>In interactive visual media, if <a href=webappapis.html#concept-n-script id=the-canvas-element:concept-n-script>scripting is enabled</a> for
  the <code id=the-canvas-element:the-canvas-element-8><a href=#the-canvas-element>canvas</a></code> element, and if support for <code id=the-canvas-element:the-canvas-element-9><a href=#the-canvas-element>canvas</a></code> elements has been enabled,
  the <code id=the-canvas-element:the-canvas-element-10><a href=#the-canvas-element>canvas</a></code> element <a id=the-canvas-element:represents href=dom.html#represents>represents</a> <a id=the-canvas-element:embedded-content-category-3 href=dom.html#embedded-content-category>embedded content</a> consisting
  of a dynamically created image, the element's bitmap.</p>

  <p>In non-interactive, static, visual media, if the <code id=the-canvas-element:the-canvas-element-11><a href=#the-canvas-element>canvas</a></code> element has been
  previously associated with a rendering context (e.g. if the page was viewed in an interactive
  visual medium and is now being printed, or if some script that ran during the page layout process
  painted on the element), then the <code id=the-canvas-element:the-canvas-element-12><a href=#the-canvas-element>canvas</a></code> element <a id=the-canvas-element:represents-2 href=dom.html#represents>represents</a>
  <a id=the-canvas-element:embedded-content-category-4 href=dom.html#embedded-content-category>embedded content</a> with the element's current bitmap and size. Otherwise, the element
  represents its <a id=the-canvas-element:fallback-content-2 href=dom.html#fallback-content>fallback content</a> instead.</p>

  <p>In non-visual media, and in visual media if <a href=webappapis.html#concept-n-noscript id=the-canvas-element:concept-n-noscript>scripting is
  disabled</a> for the <code id=the-canvas-element:the-canvas-element-13><a href=#the-canvas-element>canvas</a></code> element or if support for <code id=the-canvas-element:the-canvas-element-14><a href=#the-canvas-element>canvas</a></code> elements
  has been disabled, the <code id=the-canvas-element:the-canvas-element-15><a href=#the-canvas-element>canvas</a></code> element <a id=the-canvas-element:represents-3 href=dom.html#represents>represents</a> its <a id=the-canvas-element:fallback-content-3 href=dom.html#fallback-content>fallback
  content</a> instead.</p>

  
  <p>When a <code id=the-canvas-element:the-canvas-element-16><a href=#the-canvas-element>canvas</a></code> element <a id=the-canvas-element:represents-4 href=dom.html#represents>represents</a> <a id=the-canvas-element:embedded-content-category-5 href=dom.html#embedded-content-category>embedded content</a>, the
  user can still focus descendants of the <code id=the-canvas-element:the-canvas-element-17><a href=#the-canvas-element>canvas</a></code> element (in the <a id=the-canvas-element:fallback-content-4 href=dom.html#fallback-content>fallback
  content</a>). When an element is <a id=the-canvas-element:focused href=interaction.html#focused>focused</a>, it is the target of keyboard interaction
  events (even though the element itself is not visible). This allows authors to make an interactive
  canvas keyboard-accessible: authors should have a one-to-one mapping of interactive regions to <i id=the-canvas-element:focusable-area><a href=interaction.html#focusable-area>focusable areas</a></i> in the <a id=the-canvas-element:fallback-content-5 href=dom.html#fallback-content>fallback content</a>. (Focus has no
  effect on mouse interaction events.) <a href=references.html#refsDOMEVENTS>[DOMEVENTS]</a></p> 

  <p>An element whose nearest <code id=the-canvas-element:the-canvas-element-18><a href=#the-canvas-element>canvas</a></code> element ancestor is <a id=the-canvas-element:being-rendered href=rendering.html#being-rendered>being rendered</a>
  and <a id=the-canvas-element:represents-5 href=dom.html#represents>represents</a> <a id=the-canvas-element:embedded-content-category-6 href=dom.html#embedded-content-category>embedded content</a> is an element that is <dfn id=being-used-as-relevant-canvas-fallback-content>being used as
  relevant canvas fallback content</dfn>.</p>

  <hr>

  <p>The <code id=the-canvas-element:the-canvas-element-19><a href=#the-canvas-element>canvas</a></code> element has two attributes to control the size of the element's bitmap:
  <dfn id=attr-canvas-width><code>width</code></dfn> and <dfn id=attr-canvas-height><code>height</code></dfn>. These attributes, when specified, must have
  values that are <a href=infrastructure.html#valid-non-negative-integer id=the-canvas-element:valid-non-negative-integer>valid non-negative integers</a>. The <a id=the-canvas-element:rules-for-parsing-non-negative-integers href=infrastructure.html#rules-for-parsing-non-negative-integers>rules for parsing non-negative integers</a> must be used to obtain their
  numeric values. If an attribute is missing, or if parsing its value returns an error, then the
  default value must be used instead. The <code id=the-canvas-element:attr-canvas-width-2><a href=#attr-canvas-width>width</a></code>
  attribute defaults to 300, and the <code id=the-canvas-element:attr-canvas-height-2><a href=#attr-canvas-height>height</a></code> attribute
  defaults to 150.</p>

  <p>The intrinsic dimensions of the <code id=the-canvas-element:the-canvas-element-20><a href=#the-canvas-element>canvas</a></code> element when it <a id=the-canvas-element:represents-6 href=dom.html#represents>represents</a>
  <a id=the-canvas-element:embedded-content-category-7 href=dom.html#embedded-content-category>embedded content</a> are equal to the dimensions of the element's bitmap.</p>

  <p>The user agent must use a square pixel density consisting of one pixel of image data per
  coordinate space unit for the bitmaps of a <code id=the-canvas-element:the-canvas-element-21><a href=#the-canvas-element>canvas</a></code> and its rendering contexts.</p>

  <p class=note>A <code id=the-canvas-element:the-canvas-element-22><a href=#the-canvas-element>canvas</a></code> element can be sized arbitrarily by a style sheet, its
  bitmap is then subject to the 'object-fit' CSS property. <a href=references.html#refsCSSIMAGES>[CSSIMAGES]</a></p>

  

  <hr>


  <p>The bitmaps of <code id=the-canvas-element:the-canvas-element-23><a href=#the-canvas-element>canvas</a></code> elements, as well as some of the bitmaps of rendering
  contexts, such as those described in the section on the <code id=the-canvas-element:canvasrenderingcontext2d-2><a href=#canvasrenderingcontext2d>CanvasRenderingContext2D</a></code>
  object below, have an <dfn id=concept-canvas-origin-clean>origin-clean</dfn> flag, which can
  be set to true or false. Initially, when the <code id=the-canvas-element:the-canvas-element-24><a href=#the-canvas-element>canvas</a></code> element is created, its bitmap's
  <a href=#concept-canvas-origin-clean id=the-canvas-element:concept-canvas-origin-clean>origin-clean</a> flag must be set to true.</p>


  <p>A <code id=the-canvas-element:the-canvas-element-25><a href=#the-canvas-element>canvas</a></code> bitmap can also have a <a href=#hit-region-list id=the-canvas-element:hit-region-list>hit region list</a>, as described in the
  <code id=the-canvas-element:canvasrenderingcontext2d-3><a href=#canvasrenderingcontext2d>CanvasRenderingContext2D</a></code> section below.</p>

  <p>A <code id=the-canvas-element:the-canvas-element-26><a href=#the-canvas-element>canvas</a></code> element can have a rendering context bound to it. Initially, it does not
  have a bound rendering context. To keep track of whether it has a rendering context or not, and
  what kind of rendering context it is, a <code id=the-canvas-element:the-canvas-element-27><a href=#the-canvas-element>canvas</a></code> also has a <dfn id=concept-canvas-context-mode>canvas context mode</dfn>, which is initially <dfn id=concept-canvas-none>none</dfn> but can be changed to either <dfn id=concept-canvas-direct-2d>direct-2d</dfn>, <dfn id=concept-canvas-direct-webgl>direct-webgl</dfn>, <dfn id=concept-canvas-indirect>indirect</dfn>, or <dfn id=concept-canvas-proxied>proxied</dfn> by algorithms defined in this specification.</p>

  <p>When its <a href=#concept-canvas-context-mode id=the-canvas-element:concept-canvas-context-mode>canvas context mode</a> is <a href=#concept-canvas-none id=the-canvas-element:concept-canvas-none>none</a>, a <code id=the-canvas-element:the-canvas-element-28><a href=#the-canvas-element>canvas</a></code> element has no rendering context,
  and its bitmap must be fully transparent black with an intrinsic width equal to the numeric value
  of the element's <code id=the-canvas-element:attr-canvas-width-3><a href=#attr-canvas-width>width</a></code> attribute and an intrinsic height
  equal to the numeric value of the element's <code id=the-canvas-element:attr-canvas-height-3><a href=#attr-canvas-height>height</a></code>
  attribute, those values being interpreted in CSS pixels, and being updated as the attributes are
  set, changed, or removed.</p>

  <p>When a <code id=the-canvas-element:the-canvas-element-29><a href=#the-canvas-element>canvas</a></code> element represents <a id=the-canvas-element:embedded-content-category-8 href=dom.html#embedded-content-category>embedded content</a>, it <a id=the-canvas-element:provides-a-paint-source href=infrastructure.html#provides-a-paint-source>provides
  a paint source</a> whose width is the element's intrinsic width, whose height is the element's
  intrinsic height, and whose appearance is the element's bitmap.</p>

  <p>Whenever the <code id=the-canvas-element:attr-canvas-width-4><a href=#attr-canvas-width>width</a></code> and <code id=the-canvas-element:attr-canvas-height-4><a href=#attr-canvas-height>height</a></code> content attributes are set, removed, changed, or
  redundantly set to the value they already have, if the <a href=#concept-canvas-context-mode id=the-canvas-element:concept-canvas-context-mode-2>canvas context mode</a> is <a href=#concept-canvas-direct-2d id=the-canvas-element:concept-canvas-direct-2d>direct-2d</a>, the user agent must <a href=#concept-canvas-set-bitmap-dimensions id=the-canvas-element:concept-canvas-set-bitmap-dimensions>set bitmap dimensions</a> to the numeric values of
  the <code id=the-canvas-element:attr-canvas-width-5><a href=#attr-canvas-width>width</a></code> and <code id=the-canvas-element:attr-canvas-height-5><a href=#attr-canvas-height>height</a></code> content attributes.</p>

  <p>The <dfn id=dom-canvas-width><code>width</code></dfn> and <dfn id=dom-canvas-height><code>height</code></dfn> IDL attributes must <a id=the-canvas-element:reflect href=infrastructure.html#reflect>reflect</a> the
  respective content attributes of the same name, with the same defaults.</p>

  

  <hr>

  
  <dl class=domintro><dt><var>context</var> = <var>canvas</var> . <code id=the-canvas-element:dom-canvas-getcontext-2><a href=#dom-canvas-getcontext>getContext</a></code>(<var>contextId</var> [, ... ] )<dd>

    <p>Returns an object that exposes an API for drawing on the canvas. The first argument specifies
    the desired API, either "<code id=the-canvas-element:canvas-context-2d><a href=#canvas-context-2d>2d</a></code>" or "<code id=the-canvas-element:canvas-context-webgl><a href=#canvas-context-webgl>webgl</a></code>". Subsequent arguments are handled by that API.</p>

    <p>This specification defines the "<code id=the-canvas-element:canvas-context-2d-2><a href=#canvas-context-2d>2d</a></code>" context below.
    There is also a specification that defines a "<code id=the-canvas-element:canvas-context-webgl-2><a href=#canvas-context-webgl>webgl</a></code>"
    context. <a href=references.html#refsWEBGL>[WEBGL]</a></p>

    <p>Returns null if the given context ID is not supported, if the canvas has already been
    initialised with the other context type (e.g. trying to get a "<code id=the-canvas-element:canvas-context-2d-3><a href=#canvas-context-2d>2d</a></code>" context after getting a "<code id=the-canvas-element:canvas-context-webgl-3><a href=#canvas-context-webgl>webgl</a></code>" context).</p>

    <p>Throws an <code id=the-canvas-element:invalidstateerror><a href=infrastructure.html#invalidstateerror>InvalidStateError</a></code> exception if the <code id=the-canvas-element:dom-canvas-setcontext-2><a href=#dom-canvas-setcontext>setContext()</a></code> or <code id=the-canvas-element:dom-canvas-transfercontroltoproxy-2><a href=#dom-canvas-transfercontroltoproxy>transferControlToProxy()</a></code> methods have been
    used.</p>

   <dt><var>supported</var> = <var>canvas</var> . <code id=the-canvas-element:dom-canvas-probablysupportscontext-2><a href=#dom-canvas-probablysupportscontext>probablySupportsContext</a></code>(<var>contextId</var> [, ... ] )<dd>

    <p>Returns false if calling <code id=the-canvas-element:dom-canvas-getcontext-3><a href=#dom-canvas-getcontext>getContext()</a></code> with the
    same arguments would definitely return null, and true otherwise.</p>

    <p>This return value is not a guarantee that <code id=the-canvas-element:dom-canvas-getcontext-4><a href=#dom-canvas-getcontext>getContext()</a></code> will or will not return an object, as
    conditions (e.g. availability of system resources) can vary over time.</p>

    <p>Throws an <code id=the-canvas-element:invalidstateerror-2><a href=infrastructure.html#invalidstateerror>InvalidStateError</a></code> exception if the <code id=the-canvas-element:dom-canvas-setcontext-3><a href=#dom-canvas-setcontext>setContext()</a></code> or <code id=the-canvas-element:dom-canvas-transfercontroltoproxy-3><a href=#dom-canvas-transfercontroltoproxy>transferControlToProxy()</a></code> methods have been
    used.</p>

   <dt><var>canvas</var> . <code id=the-canvas-element:dom-canvas-setcontext-4><a href=#dom-canvas-setcontext>setContext</a></code>(<var>context</var>)<dd>

    <p>Sets the <code id=the-canvas-element:the-canvas-element-30><a href=#the-canvas-element>canvas</a></code>' rendering context to the given object.</p>

    <p>Throws an <code id=the-canvas-element:invalidstateerror-3><a href=infrastructure.html#invalidstateerror>InvalidStateError</a></code> exception if the <code id=the-canvas-element:dom-canvas-getcontext-5><a href=#dom-canvas-getcontext>getContext()</a></code> or <code id=the-canvas-element:dom-canvas-transfercontroltoproxy-4><a href=#dom-canvas-transfercontroltoproxy>transferControlToProxy()</a></code> methods have been
    used.</p>

   </dl>

  

  <p>There are two ways for a <code id=the-canvas-element:the-canvas-element-31><a href=#the-canvas-element>canvas</a></code> element to acquire a rendering context: the
  <code id=the-canvas-element:the-canvas-element-32><a href=#the-canvas-element>canvas</a></code> element can provide one via the <code id=the-canvas-element:dom-canvas-getcontext-6><a href=#dom-canvas-getcontext>getContext()</a></code> method, and one can be assigned to it via the
  <code id=the-canvas-element:dom-canvas-setcontext-5><a href=#dom-canvas-setcontext>setContext()</a></code> method. In addition, the whole issue of a
  rendering context can be taken out of the <code id=the-canvas-element:the-canvas-element-33><a href=#the-canvas-element>canvas</a></code> element's hands and passed to a
  <code id=the-canvas-element:canvasproxy-2><a href=#canvasproxy>CanvasProxy</a></code> object, which itself can then be assigned a rendering context using its
  <code id=the-canvas-element:dom-canvasproxy-setcontext><a href=#dom-canvasproxy-setcontext>setContext()</a></code> method.</p>

  <p>These three methods are mutually exclusive; calling any of the three makes the other two start
  throwing <code id=the-canvas-element:invalidstateerror-4><a href=infrastructure.html#invalidstateerror>InvalidStateError</a></code> exceptions when called.</p>

  <p>Each rendering context has a <dfn id=concept-canvas-context-bitmap-mode>context bitmap
  mode</dfn>, which is one of <dfn id=concept-canvas-fixed>fixed</dfn>, <dfn id=concept-canvas-unbound>unbound</dfn>, or <dfn id=concept-canvas-bound>bound</dfn>.
  Initially, rendering contexts must be in the <a href=#concept-canvas-bound id=the-canvas-element:concept-canvas-bound>unbound</a>
  mode.</p>

  <hr>

  <p>The <dfn id=dom-canvas-getcontext><code>getContext(<var>contextId</var>, <var>arguments...</var>)</code></dfn> method of the <code id=the-canvas-element:the-canvas-element-34><a href=#the-canvas-element>canvas</a></code> element, when invoked,
  must run the steps in the cell of the following table whose column header describes the
  <code id=the-canvas-element:the-canvas-element-35><a href=#the-canvas-element>canvas</a></code> element's <a href=#concept-canvas-context-mode id=the-canvas-element:concept-canvas-context-mode-3>canvas context mode</a>
  and whose row header describes the method's first argument.</p>

  <table><thead><tr><td>
     <th><a href=#concept-canvas-none id=the-canvas-element:concept-canvas-none-2>none</a>
     <th><a href=#concept-canvas-direct-2d id=the-canvas-element:concept-canvas-direct-2d-2>direct-2d</a>
     <th><a href=#concept-canvas-direct-webgl id=the-canvas-element:concept-canvas-direct-webgl>direct-webgl</a>
     <th><a href=#concept-canvas-indirect id=the-canvas-element:concept-canvas-indirect>indirect</a>
     <th><a href=#concept-canvas-proxied id=the-canvas-element:concept-canvas-proxied>proxied</a>
   <tbody><tr><th>"<dfn id=canvas-context-2d><code>2d</code></dfn>"
     <td>

      Follow the <a href=#2d-context-creation-algorithm id=the-canvas-element:2d-context-creation-algorithm>2D
      context creation algorithm</a> defined in the section below, passing it the
      <code id=the-canvas-element:the-canvas-element-36><a href=#the-canvas-element>canvas</a></code> element and the method's <var>arguments...</var>, to obtain a <code id=the-canvas-element:canvasrenderingcontext2d-4><a href=#canvasrenderingcontext2d>CanvasRenderingContext2D</a></code> object;
      if this does not throw an exception, then 
      set the <code id=the-canvas-element:the-canvas-element-37><a href=#the-canvas-element>canvas</a></code> element's <a href=#concept-canvas-context-mode id=the-canvas-element:concept-canvas-context-mode-4>context
      mode</a> to <a href=#concept-canvas-direct-2d id=the-canvas-element:concept-canvas-direct-2d-3>direct-2d</a>, set
      the <code id=the-canvas-element:canvasrenderingcontext2d-5><a href=#canvasrenderingcontext2d>CanvasRenderingContext2D</a></code> object's <a href=#concept-canvas-context-bitmap-mode id=the-canvas-element:concept-canvas-context-bitmap-mode>context bitmap mode</a> to
      <a href=#concept-canvas-fixed id=the-canvas-element:concept-canvas-fixed>fixed</a>, and return the
      <code id=the-canvas-element:canvasrenderingcontext2d-6><a href=#canvasrenderingcontext2d>CanvasRenderingContext2D</a></code> object

     <td>
      Return the same object as was return the last time the method was invoked with this same
      first argument.
     <td>
      Return null.
     <td>
      Throw an <code id=the-canvas-element:invalidstateerror-5><a href=infrastructure.html#invalidstateerror>InvalidStateError</a></code> exception.
     <td>
      Throw an <code id=the-canvas-element:invalidstateerror-6><a href=infrastructure.html#invalidstateerror>InvalidStateError</a></code> exception.

    <tr><th>"<dfn id=canvas-context-webgl><code>webgl</code></dfn>", if the user agent supports the WebGL feature in its current configuration
     <td>

      Follow the instructions given in the WebGL specification's <i>Context Creation</i> section to
      obtain either a <code id=the-canvas-element:webglrenderingcontext-2><a href=infrastructure.html#webglrenderingcontext>WebGLRenderingContext</a></code> or null; if the returned value is null,
      then return null and abort these steps, otherwise, set the <code id=the-canvas-element:the-canvas-element-38><a href=#the-canvas-element>canvas</a></code> element's <a href=#concept-canvas-context-mode id=the-canvas-element:concept-canvas-context-mode-5>context mode</a> to <a href=#concept-canvas-direct-webgl id=the-canvas-element:concept-canvas-direct-webgl-2>direct-webgl</a>, set the new
      <code id=the-canvas-element:webglrenderingcontext-3><a href=infrastructure.html#webglrenderingcontext>WebGLRenderingContext</a></code> object's <a href=#concept-canvas-context-bitmap-mode id=the-canvas-element:concept-canvas-context-bitmap-mode-2>context bitmap mode</a> to <a href=#concept-canvas-fixed id=the-canvas-element:concept-canvas-fixed-2>fixed</a>, and return the <code id=the-canvas-element:webglrenderingcontext-4><a href=infrastructure.html#webglrenderingcontext>WebGLRenderingContext</a></code>
      object <a href=references.html#refsWEBGL>[WEBGL]</a>

     <td>
      Return null.
     <td>
      Return the same object as was return the last time the method was invoked with this same
      first argument.
     <td>
      Throw an <code id=the-canvas-element:invalidstateerror-7><a href=infrastructure.html#invalidstateerror>InvalidStateError</a></code> exception.
     <td>
      Throw an <code id=the-canvas-element:invalidstateerror-8><a href=infrastructure.html#invalidstateerror>InvalidStateError</a></code> exception.

    <tr><th>A vendor-specific extension*
     <td>
      Behave as defined for the extension.
     <td>
      Behave as defined for the extension.
     <td>
      Behave as defined for the extension.
     <td>
      Throw an <code id=the-canvas-element:invalidstateerror-9><a href=infrastructure.html#invalidstateerror>InvalidStateError</a></code> exception.
     <td>
      Throw an <code id=the-canvas-element:invalidstateerror-10><a href=infrastructure.html#invalidstateerror>InvalidStateError</a></code> exception.

    <tr><th>An unsupported value†
     <td>
      Return null.
     <td>
      Return null.
     <td>
      Return null.
     <td>
      Throw an <code id=the-canvas-element:invalidstateerror-11><a href=infrastructure.html#invalidstateerror>InvalidStateError</a></code> exception.
     <td>
      Throw an <code id=the-canvas-element:invalidstateerror-12><a href=infrastructure.html#invalidstateerror>InvalidStateError</a></code> exception.

  </table>

  <p class=tablenote><small>* Vendors may define experimental contexts using the syntax <code><var>vendorname</var>-<var>context</var></code>, for example, <code>moz-3d</code>.</small></p>

  <p class=tablenote><small>† For example, the "<code id=the-canvas-element:canvas-context-webgl-4><a href=#canvas-context-webgl>webgl</a></code>" value in the case of a user agent having exhausted the
  graphics hardware's abilities and having no software fallback implementation.</small></p>

  <hr>

  <p>The <dfn id=dom-canvas-probablysupportscontext><code>probablySupportsContext(<var>contextId</var>,
  <var>arguments...</var>)</code></dfn> method of the <code id=the-canvas-element:the-canvas-element-39><a href=#the-canvas-element>canvas</a></code> element, when
  invoked, must return false if calling <code id=the-canvas-element:dom-canvas-getcontext-7><a href=#dom-canvas-getcontext>getContext()</a></code> on
  the same object and with the same arguments would definitely return null at this time, and true
  otherwise.</p>

  <hr>

  <p>The <dfn id=dom-canvas-setcontext><code>setContext(<var>context</var>)</code></dfn> method of the <code id=the-canvas-element:the-canvas-element-40><a href=#the-canvas-element>canvas</a></code> element, when invoked, must
  run the following steps:</p>

  <ol><li><p>If the <code id=the-canvas-element:the-canvas-element-41><a href=#the-canvas-element>canvas</a></code> element's <a href=#concept-canvas-context-mode id=the-canvas-element:concept-canvas-context-mode-6>canvas
   context mode</a> is neither <a href=#concept-canvas-none id=the-canvas-element:concept-canvas-none-3>none</a> nor <a href=#concept-canvas-indirect id=the-canvas-element:concept-canvas-indirect-2>indirect</a>, throw an <code id=the-canvas-element:invalidstateerror-13><a href=infrastructure.html#invalidstateerror>InvalidStateError</a></code>
   exception and abort these steps.<li><p>If <var>context</var>'s <a href=#concept-canvas-context-bitmap-mode id=the-canvas-element:concept-canvas-context-bitmap-mode-3>context
   bitmap mode</a> is <a href=#concept-canvas-fixed id=the-canvas-element:concept-canvas-fixed-3>fixed</a>, then throw an
   <code id=the-canvas-element:invalidstateerror-14><a href=infrastructure.html#invalidstateerror>InvalidStateError</a></code> exception and abort these steps.<li><p>If <var>context</var>'s <a href=#concept-canvas-context-bitmap-mode id=the-canvas-element:concept-canvas-context-bitmap-mode-4>context
   bitmap mode</a> is <a href=#concept-canvas-bound id=the-canvas-element:concept-canvas-bound-2>bound</a>, then run <var>context</var>'s <a href=#concept-canvas-unbinding-steps id=the-canvas-element:concept-canvas-unbinding-steps>unbinding steps</a> and
   set its <var>context</var>'s <a href=#concept-canvas-context-bitmap-mode id=the-canvas-element:concept-canvas-context-bitmap-mode-5>context
   bitmap mode</a> to <a href=#concept-canvas-unbound id=the-canvas-element:concept-canvas-unbound>unbound</a>.<li><p>Run <var>context</var>'s <a href=#concept-canvas-binding-steps id=the-canvas-element:concept-canvas-binding-steps>binding
   steps</a> to bind it to this <code id=the-canvas-element:the-canvas-element-42><a href=#the-canvas-element>canvas</a></code> element.<li><p>Set the <code id=the-canvas-element:the-canvas-element-43><a href=#the-canvas-element>canvas</a></code> element's <a href=#concept-canvas-context-mode id=the-canvas-element:concept-canvas-context-mode-7>context
   mode</a> to <a href=#concept-canvas-indirect id=the-canvas-element:concept-canvas-indirect-3>indirect</a> and the <var>context</var>'s <a href=#concept-canvas-context-bitmap-mode id=the-canvas-element:concept-canvas-context-bitmap-mode-6>context bitmap
   mode</a> to <a href=#concept-canvas-bound id=the-canvas-element:concept-canvas-bound-3>bound</a>.</ol>

  <hr>

  

  <dl class=domintro><dt><var>url</var> = <var>canvas</var> . <code id=the-canvas-element:dom-canvas-todataurl-2><a href=#dom-canvas-todataurl>toDataURL</a></code>( [ <var>type</var>, ... ] )<dd>

    <p>Returns a <a href=http://tools.ietf.org/html/rfc2397#section-2 id=the-canvas-element:data-protocol data-x-internal=data-protocol><code>data:</code> URL</a> for the image in the
    canvas.</p>

    <p>The first argument, if provided, controls the type of the image to be returned (e.g. PNG or
    JPEG). The default is <code>image/png</code>; that type is also used if the given type
    isn't supported. The other arguments are specific to the type, and control the way that the
    image is generated, as given <a href=#canvas-serialisation-arguments>in the table
    below</a>.</p>

    <p>When trying to use types other than "<code id=the-canvas-element:image/png><a href=indices.html#image/png>image/png</a></code>", authors can check if the image
    was really returned in the requested format by checking to see if the returned string starts
    with one of the exact strings "<code>data:image/png,</code>" or "<code>data:image/png;</code>". If it does, the image is PNG, and thus the requested type was
    not supported. (The one exception to this is if the canvas has either no height or no width, in
    which case the result might simply be "<code>data:,</code>".)</p>

   <dt><var>canvas</var> . <code id=the-canvas-element:dom-canvas-toblob-2><a href=#dom-canvas-toblob>toBlob</a></code>(<var>callback</var> [, <var>type</var>, ... ] )<dd>

    <p>Creates a <code id=the-canvas-element:blob><a href=infrastructure.html#blob>Blob</a></code> object representing a file containing the image in the canvas,
    and invokes a callback with a handle to that object.</p>

    <p>The second argument, if provided, controls the type of the image to be returned (e.g. PNG or
    JPEG). The default is <code>image/png</code>; that type is also used if the given type
    isn't supported. The other arguments are specific to the type, and control the way that the
    image is generated, as given <a href=#canvas-serialisation-arguments>in the table
    below</a>.</p>

   </dl>

  

  <p>The <dfn id=dom-canvas-todataurl><code>toDataURL()</code></dfn> method must run the
  following steps:</p>

  <ol><li><p>If the <code id=the-canvas-element:the-canvas-element-44><a href=#the-canvas-element>canvas</a></code> element's bitmap's <a href=#concept-canvas-origin-clean id=the-canvas-element:concept-canvas-origin-clean-2>origin-clean</a> flag is set to false, throw a
   <code id=the-canvas-element:securityerror><a href=infrastructure.html#securityerror>SecurityError</a></code> exception and abort these steps.</p>


   <li><p>If the <code id=the-canvas-element:the-canvas-element-45><a href=#the-canvas-element>canvas</a></code> element's bitmap has no pixels (i.e. either its horizontal
   dimension or its vertical dimension is zero) then return the string "<code>data:,</code>" and abort these steps. (This is the shortest <a href=http://tools.ietf.org/html/rfc2397#section-2 id=the-canvas-element:data-protocol-2 data-x-internal=data-protocol><code>data:</code> URL</a>; it represents the empty string in a <code>text/plain</code> resource.)<li><p>Let <var>file</var> be <a href=#a-serialisation-of-the-bitmap-as-a-file id=the-canvas-element:a-serialisation-of-the-bitmap-as-a-file>a
   serialisation of the <code>canvas</code> element's bitmap as a file</a>, using the method's
   arguments (if any) as the <var>arguments</var>.<li><p>Return a <a href=http://tools.ietf.org/html/rfc2397#section-2 id=the-canvas-element:data-protocol-3 data-x-internal=data-protocol><code>data:</code> URL</a> representing
   <var>file</var>. <a href=references.html#refsRFC2397>[RFC2397]</a></p>

   

  </ol>

  <p>The <dfn id=dom-canvas-toblob><code>toBlob()</code></dfn> method must run the following
  steps:</p>

  <ol><li><p>If the <code id=the-canvas-element:the-canvas-element-46><a href=#the-canvas-element>canvas</a></code> element's bitmap's <a href=#concept-canvas-origin-clean id=the-canvas-element:concept-canvas-origin-clean-3>origin-clean</a> flag is set to false, throw a
   <code id=the-canvas-element:securityerror-2><a href=infrastructure.html#securityerror>SecurityError</a></code> exception and abort these steps.</p>


   <li><p>Let <var>callback</var> be the first argument.<li><p>Let <var>arguments</var> be the second and subsequent arguments to the method, if
   any.<li>

    <p>If the <code id=the-canvas-element:the-canvas-element-47><a href=#the-canvas-element>canvas</a></code> element's bitmap has no pixels (i.e. either its horizontal
    dimension or its vertical dimension is zero) then let <var>result</var> be null.</p>

    <p>Otherwise, let <var>result</var> be a <code id=the-canvas-element:blob-2><a href=infrastructure.html#blob>Blob</a></code> object representing <a href=#a-serialisation-of-the-bitmap-as-a-file id=the-canvas-element:a-serialisation-of-the-bitmap-as-a-file-2>a serialisation of the <code>canvas</code> element's
    bitmap as a file</a>, using <var>arguments</var>. <a href=references.html#refsFILEAPI>[FILEAPI]</a> </p>

   <li><p>Return, but continue running these steps <a id=the-canvas-element:in-parallel href=infrastructure.html#in-parallel>in parallel</a>.<li><p>If <var>callback</var> is null, abort these steps.<li><p><a id=the-canvas-element:queue-a-task href=webappapis.html#queue-a-task>Queue a task</a> to invoke the <code id=the-canvas-element:filecallback-2><a href=infrastructure.html#filecallback>FileCallback</a></code> <var>callback</var> with
   <var>result</var> as its argument. The <a id=the-canvas-element:task-source href=webappapis.html#task-source>task source</a> for this task is the <dfn id=canvas-blob-serialisation-task-source>canvas
   blob serialisation task source</dfn>.</ol>

  
  


  
  <h5 id=proxying-canvases-to-workers>4.12.4.1 Proxying canvases to workers</h5>

  <p>Since DOM nodes cannot be accessed across worker boundaries, a proxy object is needed to enable
  workers to render to <code id=proxying-canvases-to-workers:the-canvas-element><a href=#the-canvas-element>canvas</a></code> elements in <code id=proxying-canvases-to-workers:document><a href=dom.html#document>Document</a></code>s.</p>

  <pre class=idl>[Exposed=(Window,Worker)]
interface <dfn id=canvasproxy>CanvasProxy</dfn> {
  void <a href=#dom-canvasproxy-setcontext id=proxying-canvases-to-workers:dom-canvasproxy-setcontext>setContext</a>(<a href=#renderingcontext id=proxying-canvases-to-workers:renderingcontext>RenderingContext</a> context);
};
// <a href=#canvasproxy id=proxying-canvases-to-workers:canvasproxy>CanvasProxy</a> implements <a id=proxying-canvases-to-workers:transferable href=infrastructure.html#transferable>Transferable</a>;</pre>

  <dl class=domintro><dt><var>canvasProxy</var> = <var>canvas</var> . <code id=proxying-canvases-to-workers:dom-canvas-transfercontroltoproxy><a href=#dom-canvas-transfercontroltoproxy>transferControlToProxy</a></code>()<dd>

    <p>Returns a <code id=proxying-canvases-to-workers:canvasproxy-2><a href=#canvasproxy>CanvasProxy</a></code> object that can be used to transfer control for this
    canvas over to another document (e.g. an <code id=proxying-canvases-to-workers:the-iframe-element><a href=embedded-content.html#the-iframe-element>iframe</a></code> from another <a id=proxying-canvases-to-workers:origin-2 href=browsers.html#origin-2>origin</a>)
    or to a worker.</p>

    <p>Throws an <code id=proxying-canvases-to-workers:invalidstateerror><a href=infrastructure.html#invalidstateerror>InvalidStateError</a></code> exception if the <code id=proxying-canvases-to-workers:dom-canvas-getcontext><a href=#dom-canvas-getcontext>getContext()</a></code> or <code id=proxying-canvases-to-workers:dom-canvas-setcontext><a href=#dom-canvas-setcontext>setContext()</a></code> methods have been used.</p>

   <dt><var>canvasProxy</var> . <code id=proxying-canvases-to-workers:dom-canvasproxy-setcontext-2><a href=#dom-canvasproxy-setcontext>setContext</a></code>(<var>context</var>)<dd>

    <p>Sets the <code id=proxying-canvases-to-workers:canvasproxy-3><a href=#canvasproxy>CanvasProxy</a></code> object's <code id=proxying-canvases-to-workers:the-canvas-element-2><a href=#the-canvas-element>canvas</a></code> element's rendering context to
    the given object.</p>

    <p>Throws an <code id=proxying-canvases-to-workers:invalidstateerror-2><a href=infrastructure.html#invalidstateerror>InvalidStateError</a></code> exception if the <code id=proxying-canvases-to-workers:canvasproxy-4><a href=#canvasproxy>CanvasProxy</a></code> has been
    <a href=infrastructure.html#transfer-a-transferable-object id=proxying-canvases-to-workers:transfer-a-transferable-object>transfered</a>.</p>

   </dl>

  <hr>

  <p>The <dfn id=dom-canvas-transfercontroltoproxy><code>transferControlToProxy()</code></dfn>
  method of the <code id=proxying-canvases-to-workers:the-canvas-element-3><a href=#the-canvas-element>canvas</a></code> element, when invoked, must run the following steps:</p>

  <ol><li><p>If the <code id=proxying-canvases-to-workers:the-canvas-element-4><a href=#the-canvas-element>canvas</a></code> element's <a href=#concept-canvas-context-mode id=proxying-canvases-to-workers:concept-canvas-context-mode>canvas
   context mode</a> is not <a href=#concept-canvas-none id=proxying-canvases-to-workers:concept-canvas-none>none</a>, throw an
   <code id=proxying-canvases-to-workers:invalidstateerror-3><a href=infrastructure.html#invalidstateerror>InvalidStateError</a></code> exception and abort these steps.<li><p>Set the <code id=proxying-canvases-to-workers:the-canvas-element-5><a href=#the-canvas-element>canvas</a></code> element's <a href=#concept-canvas-context-mode id=proxying-canvases-to-workers:concept-canvas-context-mode-2>context
   mode</a> to <a href=#concept-canvas-proxied id=proxying-canvases-to-workers:concept-canvas-proxied>proxied</a>.<li><p>Return a <code id=proxying-canvases-to-workers:canvasproxy-5><a href=#canvasproxy>CanvasProxy</a></code> object bound to this <code id=proxying-canvases-to-workers:the-canvas-element-6><a href=#the-canvas-element>canvas</a></code>
   element.</ol>

  <p>A <code id=proxying-canvases-to-workers:canvasproxy-6><a href=#canvasproxy>CanvasProxy</a></code> object can be <a href=infrastructure.html#concept-transferable-neutered id=proxying-canvases-to-workers:concept-transferable-neutered>neutered</a> (like any <code id=proxying-canvases-to-workers:transferable-2><a href=infrastructure.html#transferable>Transferable</a></code> object),
  meaning it can no longer be <a href=infrastructure.html#transfer-a-transferable-object id=proxying-canvases-to-workers:transfer-a-transferable-object-2>transferred</a>, and
  can be <dfn id=concept-canvasproxy-disabled>disabled</dfn>, meaning it can no longer be bound
  to rendering contexts. When first created, a <code id=proxying-canvases-to-workers:canvasproxy-7><a href=#canvasproxy>CanvasProxy</a></code> object must be neither.</p>

  <p>A <code id=proxying-canvases-to-workers:canvasproxy-8><a href=#canvasproxy>CanvasProxy</a></code> is created with a link to a <code id=proxying-canvases-to-workers:the-canvas-element-7><a href=#the-canvas-element>canvas</a></code> element. A
  <code id=proxying-canvases-to-workers:canvasproxy-9><a href=#canvasproxy>CanvasProxy</a></code> object that has not been <a href=#concept-canvasproxy-disabled id=proxying-canvases-to-workers:concept-canvasproxy-disabled>disabled</a> must have a strong reference to its canvas
  element.</p>

  <p>The <dfn id=dom-canvasproxy-setcontext><code>setContext(<var>context</var>)</code></dfn> method of <code id=proxying-canvases-to-workers:canvasproxy-10><a href=#canvasproxy>CanvasProxy</a></code> objects, when invoked,
  must run the following steps:</p>

  <ol><li><p>If the <code id=proxying-canvases-to-workers:canvasproxy-11><a href=#canvasproxy>CanvasProxy</a></code> object has been <a href=#concept-canvasproxy-disabled id=proxying-canvases-to-workers:concept-canvasproxy-disabled-2>disabled</a>, throw an <code id=proxying-canvases-to-workers:invalidstateerror-4><a href=infrastructure.html#invalidstateerror>InvalidStateError</a></code>
   exception and abort these steps.<li><p>If the <code id=proxying-canvases-to-workers:canvasproxy-12><a href=#canvasproxy>CanvasProxy</a></code> object has not been <a href=infrastructure.html#concept-transferable-neutered id=proxying-canvases-to-workers:concept-transferable-neutered-2>neutered</a>, then <a href=infrastructure.html#concept-transferable-neutered id=proxying-canvases-to-workers:concept-transferable-neutered-3>neuter</a> it.<li><p>If <var>context</var>'s <a href=#concept-canvas-context-bitmap-mode id=proxying-canvases-to-workers:concept-canvas-context-bitmap-mode>context
   bitmap mode</a> is <a href=#concept-canvas-fixed id=proxying-canvases-to-workers:concept-canvas-fixed>fixed</a>, then throw an
   <code id=proxying-canvases-to-workers:invalidstateerror-5><a href=infrastructure.html#invalidstateerror>InvalidStateError</a></code> exception and abort these steps.<li><p>If <var>context</var>'s <a href=#concept-canvas-context-bitmap-mode id=proxying-canvases-to-workers:concept-canvas-context-bitmap-mode-2>context
   bitmap mode</a> is <a href=#concept-canvas-bound id=proxying-canvases-to-workers:concept-canvas-bound>bound</a>, then run <var>context</var>'s <a href=#concept-canvas-unbinding-steps id=proxying-canvases-to-workers:concept-canvas-unbinding-steps>unbinding steps</a> and
   set its <var>context</var>'s <a href=#concept-canvas-context-bitmap-mode id=proxying-canvases-to-workers:concept-canvas-context-bitmap-mode-3>context
   bitmap mode</a> to <a href=#concept-canvas-unbound id=proxying-canvases-to-workers:concept-canvas-unbound>unbound</a>.<li><p>Run <var>context</var>'s <a href=#concept-canvas-binding-steps id=proxying-canvases-to-workers:concept-canvas-binding-steps>binding
   steps</a> to bind it to this <code id=proxying-canvases-to-workers:canvasproxy-13><a href=#canvasproxy>CanvasProxy</a></code> object's <code id=proxying-canvases-to-workers:the-canvas-element-8><a href=#the-canvas-element>canvas</a></code>
   element.<li><p>Set the <var>context</var>'s <a href=#concept-canvas-context-bitmap-mode id=proxying-canvases-to-workers:concept-canvas-context-bitmap-mode-4>context bitmap mode</a> to <a href=#concept-canvas-bound id=proxying-canvases-to-workers:concept-canvas-bound-2>bound</a>.</ol>

  <p id=transferCanvasProxy>To <a href=infrastructure.html#transfer-a-transferable-object id=proxying-canvases-to-workers:transfer-a-transferable-object-3>transfer</a> a
  <code id=proxying-canvases-to-workers:canvasproxy-14><a href=#canvasproxy>CanvasProxy</a></code> object <var>old</var> to a new owner <var>owner</var>,
  a user agent must create a new <code id=proxying-canvases-to-workers:canvasproxy-15><a href=#canvasproxy>CanvasProxy</a></code> object linked to the same
  <code id=proxying-canvases-to-workers:the-canvas-element-9><a href=#the-canvas-element>canvas</a></code> element as <var>old</var>, thus obtaining <var>new</var>,
  must <a href=infrastructure.html#concept-transferable-neutered id=proxying-canvases-to-workers:concept-transferable-neutered-4>neuter</a> and <a href=#concept-canvasproxy-disabled id=proxying-canvases-to-workers:concept-canvasproxy-disabled-3>disable</a> the <var>old</var> object, and must
  finally return <var>new</var>.</p>

  <div class=example>

   <p>Here is a clock implemented on a worker. First, the main page:</p>

   <pre>&lt;!DOCTYPE HTML>
&lt;title>Clock&lt;/title>
&lt;canvas>&lt;/canvas> 
&lt;script>
  var canvas = document.getElementsByTagName('canvas')[0];
  var proxy = canvas.transferControlToProxy();
  var worker = new Worker('clock.js');
  worker.postMessage(proxy, [proxy]);
&lt;/script></pre>

   <p>Second, the worker:</p>

   <pre>onmessage = function (event) {
  var context = new CanvasRenderingContext2D();
  event.data.setContext(context); // event.data is the CanvasProxy object
  setInterval(function () {
    context.clearRect(0, 0, context.width, context.height);
    context.fillText(new Date(), 0, 100);
    context.commit();
  }, 1000);
};</pre>

  </div>

  


  <h5 id=2dcontext>4.12.4.2 The 2D rendering context</h5>

  

  <pre class=idl>typedef (<a id=2dcontext:htmlimageelement href=embedded-content.html#htmlimageelement>HTMLImageElement</a> or
         <a id=2dcontext:htmlvideoelement href=embedded-content.html#htmlvideoelement>HTMLVideoElement</a> or
         <a href=#htmlcanvaselement id=2dcontext:htmlcanvaselement>HTMLCanvasElement</a> or
         <a href=#canvasrenderingcontext2d id=2dcontext:canvasrenderingcontext2d>CanvasRenderingContext2D</a> or
         <a id=2dcontext:imagebitmap href=webappapis.html#imagebitmap>ImageBitmap</a>) <dfn id=canvasimagesource>CanvasImageSource</dfn>;

enum <dfn id=canvasfillrule>CanvasFillRule</dfn> { "<a href=#dom-context-2d-fillrule-nonzero id=2dcontext:dom-context-2d-fillrule-nonzero>nonzero</a>", "<a href=#dom-context-2d-fillrule-evenodd id=2dcontext:dom-context-2d-fillrule-evenodd>evenodd</a>" };

dictionary <dfn id=canvasrenderingcontext2dsettings>CanvasRenderingContext2DSettings</dfn> {
  boolean <a href=#dom-canvasrenderingcontext2dsettings-alpha id=2dcontext:dom-canvasrenderingcontext2dsettings-alpha>alpha</a> = true;
};

[<a href=#dom-context-2d id=2dcontext:dom-context-2d>Constructor</a>(),
 <a href=#dom-context-2d id=2dcontext:dom-context-2d-2>Constructor</a>(unsigned long width, unsigned long height),
 Exposed=(Window,Worker)]
interface <dfn id=canvasrenderingcontext2d>CanvasRenderingContext2D</dfn> {

  // back-reference to the canvas
  readonly attribute <a href=#htmlcanvaselement id=2dcontext:htmlcanvaselement-2>HTMLCanvasElement</a> <a href=#dom-context-2d-canvas id=2dcontext:dom-context-2d-canvas>canvas</a>;

  // canvas dimensions
  attribute unsigned long <a href=#dom-context-2d-width id=2dcontext:dom-context-2d-width>width</a>;
  attribute unsigned long <a href=#dom-context-2d-height id=2dcontext:dom-context-2d-height>height</a>;

  // for contexts that aren't directly <a href=#concept-canvas-fixed id=2dcontext:concept-canvas-fixed>fixed</a> to a specific canvas
  void <a href=#dom-context-2d-commit id=2dcontext:dom-context-2d-commit>commit</a>(); // push the image to the <a href=#output-bitmap id=2dcontext:output-bitmap>output bitmap</a>

  // state
  void <a href=#dom-context-2d-save id=2dcontext:dom-context-2d-save>save</a>(); // push state on state stack
  void <a href=#dom-context-2d-restore id=2dcontext:dom-context-2d-restore>restore</a>(); // pop state stack and restore state

  // transformations (default transform is the identity matrix)
  attribute <a id=2dcontext:svgmatrix href=infrastructure.html#svgmatrix>SVGMatrix</a> <a href=#dom-context-2d-currenttransform id=2dcontext:dom-context-2d-currenttransform>currentTransform</a>;
  void <a href=#dom-context-2d-scale id=2dcontext:dom-context-2d-scale>scale</a>(unrestricted double x, unrestricted double y);
  void <a href=#dom-context-2d-rotate id=2dcontext:dom-context-2d-rotate>rotate</a>(unrestricted double angle);
  void <a href=#dom-context-2d-translate id=2dcontext:dom-context-2d-translate>translate</a>(unrestricted double x, unrestricted double y);
  void <a href=#dom-context-2d-transform id=2dcontext:dom-context-2d-transform>transform</a>(unrestricted double a, unrestricted double b, unrestricted double c, unrestricted double d, unrestricted double e, unrestricted double f);
  void <a href=#dom-context-2d-settransform id=2dcontext:dom-context-2d-settransform>setTransform</a>(unrestricted double a, unrestricted double b, unrestricted double c, unrestricted double d, unrestricted double e, unrestricted double f);
  void <a href=#dom-context-2d-resettransform id=2dcontext:dom-context-2d-resettransform>resetTransform</a>();

  // compositing
  attribute unrestricted double <a href=#dom-context-2d-globalalpha id=2dcontext:dom-context-2d-globalalpha>globalAlpha</a>; // (default 1.0)
  attribute DOMString <a href=#dom-context-2d-globalcompositeoperation id=2dcontext:dom-context-2d-globalcompositeoperation>globalCompositeOperation</a>; // (default source-over)

  // image smoothing
  attribute boolean <a href=#dom-context-2d-imagesmoothingenabled id=2dcontext:dom-context-2d-imagesmoothingenabled>imageSmoothingEnabled</a>; // (default true)

  // colours and styles (see also the <a href=#canvasdrawingstyles id=2dcontext:canvasdrawingstyles>CanvasDrawingStyles</a> interface)
  attribute (DOMString or CanvasGradient or CanvasPattern) <a href=#dom-context-2d-strokestyle id=2dcontext:dom-context-2d-strokestyle>strokeStyle</a>; // (default black)
  attribute (DOMString or CanvasGradient or CanvasPattern) <a href=#dom-context-2d-fillstyle id=2dcontext:dom-context-2d-fillstyle>fillStyle</a>; // (default black)
  <a href=#canvasgradient id=2dcontext:canvasgradient>CanvasGradient</a> <a href=#dom-context-2d-createlineargradient id=2dcontext:dom-context-2d-createlineargradient>createLinearGradient</a>(double x0, double y0, double x1, double y1);
  <a href=#canvasgradient id=2dcontext:canvasgradient-2>CanvasGradient</a> <a href=#dom-context-2d-createradialgradient id=2dcontext:dom-context-2d-createradialgradient>createRadialGradient</a>(double x0, double y0, double r0, double x1, double y1, double r1);
  <a href=#canvaspattern id=2dcontext:canvaspattern>CanvasPattern</a> <a href=#dom-context-2d-createpattern id=2dcontext:dom-context-2d-createpattern>createPattern</a>(<a href=#canvasimagesource id=2dcontext:canvasimagesource>CanvasImageSource</a> image, [TreatNullAs=EmptyString] DOMString repetition);

  // shadows
  attribute unrestricted double <a href=#dom-context-2d-shadowoffsetx id=2dcontext:dom-context-2d-shadowoffsetx>shadowOffsetX</a>; // (default 0)
  attribute unrestricted double <a href=#dom-context-2d-shadowoffsety id=2dcontext:dom-context-2d-shadowoffsety>shadowOffsetY</a>; // (default 0)
  attribute unrestricted double <a href=#dom-context-2d-shadowblur id=2dcontext:dom-context-2d-shadowblur>shadowBlur</a>; // (default 0)
  attribute DOMString <a href=#dom-context-2d-shadowcolor id=2dcontext:dom-context-2d-shadowcolor>shadowColor</a>; // (default transparent black)

  // rects
  void <a href=#dom-context-2d-clearrect id=2dcontext:dom-context-2d-clearrect>clearRect</a>(unrestricted double x, unrestricted double y, unrestricted double w, unrestricted double h);
  void <a href=#dom-context-2d-fillrect id=2dcontext:dom-context-2d-fillrect>fillRect</a>(unrestricted double x, unrestricted double y, unrestricted double w, unrestricted double h);
  void <a href=#dom-context-2d-strokerect id=2dcontext:dom-context-2d-strokerect>strokeRect</a>(unrestricted double x, unrestricted double y, unrestricted double w, unrestricted double h);

  // path API (see also <a href=#canvaspathmethods id=2dcontext:canvaspathmethods>CanvasPathMethods</a>)
  void <a href=#dom-context-2d-beginpath id=2dcontext:dom-context-2d-beginpath>beginPath</a>();
  void <a href=#dom-context-2d-fill id=2dcontext:dom-context-2d-fill>fill</a>(optional <a href=#canvasfillrule id=2dcontext:canvasfillrule>CanvasFillRule</a> fillRule = "<a href=#dom-context-2d-fillrule-nonzero id=2dcontext:dom-context-2d-fillrule-nonzero-2>nonzero</a>");
  void <a href=#dom-context-2d-fill id=2dcontext:dom-context-2d-fill-2>fill</a>(<a href=#path2d id=2dcontext:path2d>Path2D</a> path, optional <a href=#canvasfillrule id=2dcontext:canvasfillrule-2>CanvasFillRule</a> fillRule = "<a href=#dom-context-2d-fillrule-nonzero id=2dcontext:dom-context-2d-fillrule-nonzero-3>nonzero</a>");
  void <a href=#dom-context-2d-stroke id=2dcontext:dom-context-2d-stroke>stroke</a>();
  void <a href=#dom-context-2d-stroke id=2dcontext:dom-context-2d-stroke-2>stroke</a>(<a href=#path2d id=2dcontext:path2d-2>Path2D</a> path);
  void <a href=#dom-context-2d-drawfocusifneeded id=2dcontext:dom-context-2d-drawfocusifneeded>drawFocusIfNeeded</a>(<a id=2dcontext:element href=infrastructure.html#element>Element</a> element);
  void <a href=#dom-context-2d-drawfocusifneeded id=2dcontext:dom-context-2d-drawfocusifneeded-2>drawFocusIfNeeded</a>(<a href=#path2d id=2dcontext:path2d-3>Path2D</a> path, <a id=2dcontext:element-2 href=infrastructure.html#element>Element</a> element);
  void <a href=#dom-context-2d-scrollpathintoview id=2dcontext:dom-context-2d-scrollpathintoview>scrollPathIntoView</a>();
  void <a href=#dom-context-2d-scrollpathintoview id=2dcontext:dom-context-2d-scrollpathintoview-2>scrollPathIntoView</a>(<a href=#path2d id=2dcontext:path2d-4>Path2D</a> path);
  void <a href=#dom-context-2d-clip id=2dcontext:dom-context-2d-clip>clip</a>(optional <a href=#canvasfillrule id=2dcontext:canvasfillrule-3>CanvasFillRule</a> fillRule = "<a href=#dom-context-2d-fillrule-nonzero id=2dcontext:dom-context-2d-fillrule-nonzero-4>nonzero</a>");
  void <a href=#dom-context-2d-clip id=2dcontext:dom-context-2d-clip-2>clip</a>(<a href=#path2d id=2dcontext:path2d-5>Path2D</a> path, optional <a href=#canvasfillrule id=2dcontext:canvasfillrule-4>CanvasFillRule</a> fillRule = "<a href=#dom-context-2d-fillrule-nonzero id=2dcontext:dom-context-2d-fillrule-nonzero-5>nonzero</a>");
  void <a href=#dom-context-2d-resetclip id=2dcontext:dom-context-2d-resetclip>resetClip</a>();
  boolean <a href=#dom-context-2d-ispointinpath id=2dcontext:dom-context-2d-ispointinpath>isPointInPath</a>(unrestricted double x, unrestricted double y, optional <a href=#canvasfillrule id=2dcontext:canvasfillrule-5>CanvasFillRule</a> fillRule = "<a href=#dom-context-2d-fillrule-nonzero id=2dcontext:dom-context-2d-fillrule-nonzero-6>nonzero</a>");
  boolean <a href=#dom-context-2d-ispointinpath id=2dcontext:dom-context-2d-ispointinpath-2>isPointInPath</a>(<a href=#path2d id=2dcontext:path2d-6>Path2D</a> path, unrestricted double x, unrestricted double y, optional <a href=#canvasfillrule id=2dcontext:canvasfillrule-6>CanvasFillRule</a> fillRule = "<a href=#dom-context-2d-fillrule-nonzero id=2dcontext:dom-context-2d-fillrule-nonzero-7>nonzero</a>");
  boolean <a href=#dom-context-2d-ispointinstroke id=2dcontext:dom-context-2d-ispointinstroke>isPointInStroke</a>(unrestricted double x, unrestricted double y);
  boolean <a href=#dom-context-2d-ispointinstroke id=2dcontext:dom-context-2d-ispointinstroke-2>isPointInStroke</a>(<a href=#path2d id=2dcontext:path2d-7>Path2D</a> path, unrestricted double x, unrestricted double y);

  // text (see also the <a href=#canvasdrawingstyles id=2dcontext:canvasdrawingstyles-2>CanvasDrawingStyles</a> interface)
  void <a href=#dom-context-2d-filltext id=2dcontext:dom-context-2d-filltext>fillText</a>(DOMString text, unrestricted double x, unrestricted double y, optional unrestricted double maxWidth);
  void <a href=#dom-context-2d-stroketext id=2dcontext:dom-context-2d-stroketext>strokeText</a>(DOMString text, unrestricted double x, unrestricted double y, optional unrestricted double maxWidth);
  <a href=#textmetrics id=2dcontext:textmetrics>TextMetrics</a> <a href=#dom-context-2d-measuretext id=2dcontext:dom-context-2d-measuretext>measureText</a>(DOMString text);

  // drawing images
  void <a href=#dom-context-2d-drawimage id=2dcontext:dom-context-2d-drawimage>drawImage</a>(<a href=#canvasimagesource id=2dcontext:canvasimagesource-2>CanvasImageSource</a> image, unrestricted double dx, unrestricted double dy);
  void <a href=#dom-context-2d-drawimage id=2dcontext:dom-context-2d-drawimage-2>drawImage</a>(<a href=#canvasimagesource id=2dcontext:canvasimagesource-3>CanvasImageSource</a> image, unrestricted double dx, unrestricted double dy, unrestricted double dw, unrestricted double dh);
  void <a href=#dom-context-2d-drawimage id=2dcontext:dom-context-2d-drawimage-3>drawImage</a>(<a href=#canvasimagesource id=2dcontext:canvasimagesource-4>CanvasImageSource</a> image, unrestricted double sx, unrestricted double sy, unrestricted double sw, unrestricted double sh, unrestricted double dx, unrestricted double dy, unrestricted double dw, unrestricted double dh);

  // hit regions
  void <a href=#dom-context-2d-addhitregion id=2dcontext:dom-context-2d-addhitregion>addHitRegion</a>(optional <a href=#hitregionoptions id=2dcontext:hitregionoptions>HitRegionOptions</a> options);
  void <a href=#dom-context-2d-removehitregion id=2dcontext:dom-context-2d-removehitregion>removeHitRegion</a>(DOMString id);
  void <a href=#dom-context-2d-clearhitregions id=2dcontext:dom-context-2d-clearhitregions>clearHitRegions</a>();

  // <a href=#pixel-manipulation id=2dcontext:pixel-manipulation>pixel manipulation</a>
  <a href=#imagedata id=2dcontext:imagedata>ImageData</a> <a href=#dom-context-2d-createimagedata id=2dcontext:dom-context-2d-createimagedata>createImageData</a>(double sw, double sh);
  <a href=#imagedata id=2dcontext:imagedata-2>ImageData</a> <a href=#dom-context-2d-createimagedata id=2dcontext:dom-context-2d-createimagedata-2>createImageData</a>(<a href=#imagedata id=2dcontext:imagedata-3>ImageData</a> imagedata);
  <a href=#imagedata id=2dcontext:imagedata-4>ImageData</a> <a href=#dom-context-2d-getimagedata id=2dcontext:dom-context-2d-getimagedata>getImageData</a>(double sx, double sy, double sw, double sh);
  void <a href=#dom-context-2d-putimagedata id=2dcontext:dom-context-2d-putimagedata>putImageData</a>(<a href=#imagedata id=2dcontext:imagedata-5>ImageData</a> imagedata, double dx, double dy);
  void <a href=#dom-context-2d-putimagedata id=2dcontext:dom-context-2d-putimagedata-2>putImageData</a>(<a href=#imagedata id=2dcontext:imagedata-6>ImageData</a> imagedata, double dx, double dy, double dirtyX, double dirtyY, double dirtyWidth, double dirtyHeight);
};
<a href=#canvasrenderingcontext2d id=2dcontext:canvasrenderingcontext2d-2>CanvasRenderingContext2D</a> implements <a href=#canvasdrawingstyles id=2dcontext:canvasdrawingstyles-3>CanvasDrawingStyles</a>;
<a href=#canvasrenderingcontext2d id=2dcontext:canvasrenderingcontext2d-3>CanvasRenderingContext2D</a> implements <a href=#canvaspathmethods id=2dcontext:canvaspathmethods-2>CanvasPathMethods</a>;

[NoInterfaceObject, Exposed=(Window,Worker)]
interface <dfn id=canvasdrawingstyles>CanvasDrawingStyles</dfn> {
  // line caps/joins
  attribute unrestricted double <a href=#dom-context-2d-linewidth id=2dcontext:dom-context-2d-linewidth>lineWidth</a>; // (default 1)
  attribute DOMString <a href=#dom-context-2d-linecap id=2dcontext:dom-context-2d-linecap>lineCap</a>; // "butt", "round", "square" (default "butt")
  attribute DOMString <a href=#dom-context-2d-linejoin id=2dcontext:dom-context-2d-linejoin>lineJoin</a>; // "round", "bevel", "miter" (default "miter")
  attribute unrestricted double <a href=#dom-context-2d-miterlimit id=2dcontext:dom-context-2d-miterlimit>miterLimit</a>; // (default 10)

  // dashed lines
  void <a href=#dom-context-2d-setlinedash id=2dcontext:dom-context-2d-setlinedash>setLineDash</a>(sequence&lt;unrestricted double> segments); // default empty
  sequence&lt;unrestricted double> <a href=#dom-context-2d-getlinedash id=2dcontext:dom-context-2d-getlinedash>getLineDash</a>();
  attribute unrestricted double <a href=#dom-context-2d-linedashoffset id=2dcontext:dom-context-2d-linedashoffset>lineDashOffset</a>;

  // text
  attribute DOMString <a href=#dom-context-2d-font id=2dcontext:dom-context-2d-font>font</a>; // (default 10px sans-serif)
  attribute DOMString <a href=#dom-context-2d-textalign id=2dcontext:dom-context-2d-textalign>textAlign</a>; // "start", "end", "left", "right", "center" (default: "start")
  attribute DOMString <a href=#dom-context-2d-textbaseline id=2dcontext:dom-context-2d-textbaseline>textBaseline</a>; // "top", "hanging", "middle", "alphabetic", "ideographic", "bottom" (default: "alphabetic")
  attribute DOMString <a href=#dom-context-2d-direction id=2dcontext:dom-context-2d-direction>direction</a>; // "ltr", "rtl", "inherit" (default: "inherit")
};

[NoInterfaceObject, Exposed=(Window,Worker)]
interface <dfn id=canvaspathmethods>CanvasPathMethods</dfn> {
  // shared path API methods
  void <a href=#dom-context-2d-closepath id=2dcontext:dom-context-2d-closepath>closePath</a>();
  void <a href=#dom-context-2d-moveto id=2dcontext:dom-context-2d-moveto>moveTo</a>(unrestricted double x, unrestricted double y);
  void <a href=#dom-context-2d-lineto id=2dcontext:dom-context-2d-lineto>lineTo</a>(unrestricted double x, unrestricted double y);
  void <a href=#dom-context-2d-quadraticcurveto id=2dcontext:dom-context-2d-quadraticcurveto>quadraticCurveTo</a>(unrestricted double cpx, unrestricted double cpy, unrestricted double x, unrestricted double y);
  void <a href=#dom-context-2d-beziercurveto id=2dcontext:dom-context-2d-beziercurveto>bezierCurveTo</a>(unrestricted double cp1x, unrestricted double cp1y, unrestricted double cp2x, unrestricted double cp2y, unrestricted double x, unrestricted double y);
  void <a href=#dom-context-2d-arcto id=2dcontext:dom-context-2d-arcto>arcTo</a>(unrestricted double x1, unrestricted double y1, unrestricted double x2, unrestricted double y2, unrestricted double radius); 
  void <a href=#dom-context-2d-arcto id=2dcontext:dom-context-2d-arcto-2>arcTo</a>(unrestricted double x1, unrestricted double y1, unrestricted double x2, unrestricted double y2, unrestricted double radiusX, unrestricted double radiusY, unrestricted double rotation); 
  void <a href=#dom-context-2d-rect id=2dcontext:dom-context-2d-rect>rect</a>(unrestricted double x, unrestricted double y, unrestricted double w, unrestricted double h);
  void <a href=#dom-context-2d-arc id=2dcontext:dom-context-2d-arc>arc</a>(unrestricted double x, unrestricted double y, unrestricted double radius, unrestricted double startAngle, unrestricted double endAngle, optional boolean anticlockwise = false); 
  void <a href=#dom-context-2d-ellipse id=2dcontext:dom-context-2d-ellipse>ellipse</a>(unrestricted double x, unrestricted double y, unrestricted double radiusX, unrestricted double radiusY, unrestricted double rotation, unrestricted double startAngle, unrestricted double endAngle, optional boolean anticlockwise = false); 
};

[Exposed=(Window,Worker)]
interface <dfn id=canvasgradient>CanvasGradient</dfn> {
  // opaque object
  void <a href=#dom-canvasgradient-addcolorstop id=2dcontext:dom-canvasgradient-addcolorstop>addColorStop</a>(double offset, DOMString color);
};

[Exposed=(Window,Worker)]
interface <dfn id=canvaspattern>CanvasPattern</dfn> {
  // opaque object
  void <a href=#dom-canvaspattern-settransform id=2dcontext:dom-canvaspattern-settransform>setTransform</a>(<a id=2dcontext:svgmatrix-2 href=infrastructure.html#svgmatrix>SVGMatrix</a> transform);
};

[Exposed=(Window,Worker)]
interface <dfn id=textmetrics>TextMetrics</dfn> {
  // x-direction
  readonly attribute double <a href=#dom-textmetrics-width id=2dcontext:dom-textmetrics-width>width</a>; // advance width
  readonly attribute double <a href=#dom-textmetrics-actualboundingboxleft id=2dcontext:dom-textmetrics-actualboundingboxleft>actualBoundingBoxLeft</a>;
  readonly attribute double <a href=#dom-textmetrics-actualboundingboxright id=2dcontext:dom-textmetrics-actualboundingboxright>actualBoundingBoxRight</a>;

  // y-direction
  readonly attribute double <a href=#dom-textmetrics-fontboundingboxascent id=2dcontext:dom-textmetrics-fontboundingboxascent>fontBoundingBoxAscent</a>;
  readonly attribute double <a href=#dom-textmetrics-fontboundingboxdescent id=2dcontext:dom-textmetrics-fontboundingboxdescent>fontBoundingBoxDescent</a>;
  readonly attribute double <a href=#dom-textmetrics-actualboundingboxascent id=2dcontext:dom-textmetrics-actualboundingboxascent>actualBoundingBoxAscent</a>;
  readonly attribute double <a href=#dom-textmetrics-actualboundingboxdescent id=2dcontext:dom-textmetrics-actualboundingboxdescent>actualBoundingBoxDescent</a>;
  readonly attribute double <a href=#dom-textmetrics-emheightascent id=2dcontext:dom-textmetrics-emheightascent>emHeightAscent</a>;
  readonly attribute double <a href=#dom-textmetrics-emheightdescent id=2dcontext:dom-textmetrics-emheightdescent>emHeightDescent</a>;
  readonly attribute double <a href=#dom-textmetrics-hangingbaseline id=2dcontext:dom-textmetrics-hangingbaseline>hangingBaseline</a>;
  readonly attribute double <a href=#dom-textmetrics-alphabeticbaseline id=2dcontext:dom-textmetrics-alphabeticbaseline>alphabeticBaseline</a>;
  readonly attribute double <a href=#dom-textmetrics-ideographicbaseline id=2dcontext:dom-textmetrics-ideographicbaseline>ideographicBaseline</a>;
};

dictionary <dfn id=hitregionoptions>HitRegionOptions</dfn> {
  <a href=#path2d id=2dcontext:path2d-8>Path2D</a>? <a href=#dom-hitregionoptions-path id=2dcontext:dom-hitregionoptions-path>path</a> = null;
  <a href=#canvasfillrule id=2dcontext:canvasfillrule-7>CanvasFillRule</a> <a href=#dom-hitregionoptions-fillrule id=2dcontext:dom-hitregionoptions-fillrule>fillRule</a> = "<a href=#dom-context-2d-fillrule-nonzero id=2dcontext:dom-context-2d-fillrule-nonzero-8>nonzero</a>";
  DOMString <a href=#dom-hitregionoptions-id id=2dcontext:dom-hitregionoptions-id>id</a> = ""; 
  DOMString? <a href=#dom-hitregionoptions-parentid id=2dcontext:dom-hitregionoptions-parentid>parentID</a> = null;
  DOMString <a href=#dom-hitregionoptions-cursor id=2dcontext:dom-hitregionoptions-cursor>cursor</a> = "inherit";
  // for control-backed regions:
  <a id=2dcontext:element-3 href=infrastructure.html#element>Element</a>? <a href=#dom-hitregionoptions-control id=2dcontext:dom-hitregionoptions-control>control</a> = null;
  // for unbacked regions:
  DOMString? <a href=#dom-hitregionoptions-label id=2dcontext:dom-hitregionoptions-label>label</a> = null;
  DOMString? <a href=#dom-hitregionoptions-role id=2dcontext:dom-hitregionoptions-role>role</a> = null;
};

[<a href=#dom-imagedata id=2dcontext:dom-imagedata>Constructor</a>(unsigned long sw, unsigned long sh),
 <a href=#dom-imagedata id=2dcontext:dom-imagedata-2>Constructor</a>(<a id=2dcontext:uint8clampedarray href=infrastructure.html#uint8clampedarray>Uint8ClampedArray</a> data, unsigned long sw, optional unsigned long sh),
 Exposed=(Window,Worker)]
interface <dfn id=imagedata>ImageData</dfn> {
  readonly attribute unsigned long <a href=#dom-imagedata-width id=2dcontext:dom-imagedata-width>width</a>;
  readonly attribute unsigned long <a href=#dom-imagedata-height id=2dcontext:dom-imagedata-height>height</a>;
  readonly attribute <a id=2dcontext:uint8clampedarray-2 href=infrastructure.html#uint8clampedarray>Uint8ClampedArray</a> <a href=#dom-imagedata-data id=2dcontext:dom-imagedata-data>data</a>;
};

[<a href=#dom-drawingstyle id=2dcontext:dom-drawingstyle>Constructor</a>(optional <a id=2dcontext:element-4 href=infrastructure.html#element>Element</a> scope), Exposed=(Window,Worker)]
interface <dfn id=drawingstyle>DrawingStyle</dfn> { };
<a href=#drawingstyle id=2dcontext:drawingstyle>DrawingStyle</a> implements <a href=#canvasdrawingstyles id=2dcontext:canvasdrawingstyles-4>CanvasDrawingStyles</a>;

[<a href=#dom-path2d id=2dcontext:dom-path2d>Constructor</a>,
 <a href=#dom-path2d-copy id=2dcontext:dom-path2d-copy>Constructor</a>(<a href=#path2d id=2dcontext:path2d-9>Path2D</a> path),
 <a href=#dom-path2d-merge id=2dcontext:dom-path2d-merge>Constructor</a>(<a href=#path2d id=2dcontext:path2d-10>Path2D</a>[] paths, optional <a href=#canvasfillrule id=2dcontext:canvasfillrule-8>CanvasFillRule</a> fillRule = "<a href=#dom-context-2d-fillrule-nonzero id=2dcontext:dom-context-2d-fillrule-nonzero-9>nonzero</a>"),
 <a href=#dom-path2d-withdata id=2dcontext:dom-path2d-withdata>Constructor</a>(DOMString d), Exposed=(Window,Worker)]
interface <dfn id=path2d>Path2D</dfn> {
  void <a href=#dom-path2d-addpath id=2dcontext:dom-path2d-addpath>addPath</a>(<a href=#path2d id=2dcontext:path2d-11>Path2D</a> path, optional <a id=2dcontext:svgmatrix-3 href=infrastructure.html#svgmatrix>SVGMatrix</a>? transformation = null);
  void <a href=#dom-path2d-addpathbystrokingpath id=2dcontext:dom-path2d-addpathbystrokingpath>addPathByStrokingPath</a>(<a href=#path2d id=2dcontext:path2d-12>Path2D</a> path, <a href=#canvasdrawingstyles id=2dcontext:canvasdrawingstyles-5>CanvasDrawingStyles</a> styles, optional <a id=2dcontext:svgmatrix-4 href=infrastructure.html#svgmatrix>SVGMatrix</a>? transformation = null);
  void <a href=#dom-path2d-addtext id=2dcontext:dom-path2d-addtext>addText</a>(DOMString text, <a href=#canvasdrawingstyles id=2dcontext:canvasdrawingstyles-6>CanvasDrawingStyles</a> styles, <a id=2dcontext:svgmatrix-5 href=infrastructure.html#svgmatrix>SVGMatrix</a>? transformation, unrestricted double x, unrestricted double y, optional unrestricted double maxWidth);
  void <a href=#dom-path2d-addpathbystrokingtext id=2dcontext:dom-path2d-addpathbystrokingtext>addPathByStrokingText</a>(DOMString text, <a href=#canvasdrawingstyles id=2dcontext:canvasdrawingstyles-7>CanvasDrawingStyles</a> styles, <a id=2dcontext:svgmatrix-6 href=infrastructure.html#svgmatrix>SVGMatrix</a>? transformation, unrestricted double x, unrestricted double y, optional unrestricted double maxWidth);
  void <a href=#dom-path2d-addtext id=2dcontext:dom-path2d-addtext-2>addText</a>(DOMString text, <a href=#canvasdrawingstyles id=2dcontext:canvasdrawingstyles-8>CanvasDrawingStyles</a> styles, <a id=2dcontext:svgmatrix-7 href=infrastructure.html#svgmatrix>SVGMatrix</a>? transformation, <a href=#path2d id=2dcontext:path2d-13>Path2D</a> path, optional unrestricted double maxWidth);
  void <a href=#dom-path2d-addpathbystrokingtext id=2dcontext:dom-path2d-addpathbystrokingtext-2>addPathByStrokingText</a>(DOMString text, <a href=#canvasdrawingstyles id=2dcontext:canvasdrawingstyles-9>CanvasDrawingStyles</a> styles, <a id=2dcontext:svgmatrix-8 href=infrastructure.html#svgmatrix>SVGMatrix</a>? transformation, <a href=#path2d id=2dcontext:path2d-14>Path2D</a> path, optional unrestricted double maxWidth);
};
<a href=#path2d id=2dcontext:path2d-15>Path2D</a> implements <a href=#canvaspathmethods id=2dcontext:canvaspathmethods-3>CanvasPathMethods</a>;</pre>

 

  <dl class=domintro><dt><var>context</var> = <var>canvas</var> . <code id=2dcontext:dom-canvas-getcontext><a href=#dom-canvas-getcontext>getContext</a></code>('2d' [, { [ <code id=2dcontext:dom-canvasrenderingcontext2dsettings-alpha-2><a href=#dom-canvasrenderingcontext2dsettings-alpha>alpha</a></code>: false ] } ] )<dd>

    <p>Returns a <code id=2dcontext:canvasrenderingcontext2d-4><a href=#canvasrenderingcontext2d>CanvasRenderingContext2D</a></code> object that is permanently bound to a
    particular <code id=2dcontext:the-canvas-element><a href=#the-canvas-element>canvas</a></code> element.</p>

    <p>If the <code id=2dcontext:dom-canvasrenderingcontext2dsettings-alpha-3><a href=#dom-canvasrenderingcontext2dsettings-alpha>alpha</a></code> setting is
    provided and set to false, then the canvas is forced to always be opaque.</p>

   <dt><var>context</var> = new <code id=2dcontext:dom-context-2d-3><a href=#dom-context-2d>CanvasRenderingContext2D</a></code>( [ <var>width</var>, <var>height</var> ] )<dd>

    <p>Returns an unbound <code id=2dcontext:canvasrenderingcontext2d-5><a href=#canvasrenderingcontext2d>CanvasRenderingContext2D</a></code> object with an implied bitmap with
    the given dimensions in CSS pixels (300x150, if the arguments are omitted).</p>

   <dt><var>context</var> . <code id=2dcontext:dom-context-2d-canvas-2><a href=#dom-context-2d-canvas>canvas</a></code><dd>

    <p>Returns the <code id=2dcontext:the-canvas-element-2><a href=#the-canvas-element>canvas</a></code> element, if the rendering context was obtained using the
    <code id=2dcontext:dom-canvas-getcontext-2><a href=#dom-canvas-getcontext>getContext()</a></code> method.</p>

   <dt><var>context</var> . <code id=2dcontext:dom-context-2d-width-2><a href=#dom-context-2d-width>width</a></code><dt><var>context</var> . <code id=2dcontext:dom-context-2d-height-2><a href=#dom-context-2d-height>height</a></code><dd>

    <p>Return the dimensions of the bitmap, in CSS pixels.</p>

    <p>Can be set, to update the bitmap's dimensions. If the rendering context is bound to a canvas,
    this will also update the canvas' intrinsic dimensions.</p>

   <dt><var>context</var> . <code id=2dcontext:dom-context-2d-commit-2><a href=#dom-context-2d-commit>commit</a></code>()<dd>

    <p>If the rendering context is bound to a <code id=2dcontext:the-canvas-element-3><a href=#the-canvas-element>canvas</a></code>, display the current frame.</p>

   </dl>

  

  <p>A <code id=2dcontext:canvasrenderingcontext2d-6><a href=#canvasrenderingcontext2d>CanvasRenderingContext2D</a></code> object can be obtained in two ways: the <code id=2dcontext:dom-canvas-getcontext-3><a href=#dom-canvas-getcontext>getContext()</a></code> method on a <code id=2dcontext:the-canvas-element-4><a href=#the-canvas-element>canvas</a></code> element (which
  invokes the <a href=#2d-context-creation-algorithm id=2dcontext:2d-context-creation-algorithm>2D context creation algorithm</a>), and the <code id=2dcontext:dom-context-2d-4><a href=#dom-context-2d>CanvasRenderingContext2D()</a></code> constructor.</p>

  <p>A <code id=2dcontext:canvasrenderingcontext2d-7><a href=#canvasrenderingcontext2d>CanvasRenderingContext2D</a></code> object has a <dfn id=scratch-bitmap>scratch bitmap</dfn> and can be bound
  to an <dfn id=output-bitmap>output bitmap</dfn>. These are initialised when the object is created, and can be
  subsequently adjusted when the rendering context is <a href=#concept-canvas-binding-steps id=2dcontext:concept-canvas-binding-steps>bound</a> or <a href=#concept-canvas-unbinding-steps id=2dcontext:concept-canvas-unbinding-steps>unbound</a>. In some cases, these bitmaps are the same
  underlying bitmap. In general, the <a href=#scratch-bitmap id=2dcontext:scratch-bitmap>scratch bitmap</a> is what scripts interact with, and
  the <a href=#output-bitmap id=2dcontext:output-bitmap-2>output bitmap</a> is what is being displayed. These bitmaps always have the same
  dimensions.</p>


  <p>Each such bitmap has an <a href=#concept-canvas-origin-clean id=2dcontext:concept-canvas-origin-clean>origin-clean</a> flag,
  which can be set to true or false. Initially, when one of these bitmaps is created, its <a href=#concept-canvas-origin-clean id=2dcontext:concept-canvas-origin-clean-2>origin-clean</a> flag must be set to true.</p>


  <p>These bitmaps also have a <a href=#hit-region-list id=2dcontext:hit-region-list>hit region list</a>, which is described in a later section.
  Initially, this list is empty.</p>

  <p><a href=#scratch-bitmap id=2dcontext:scratch-bitmap-2>Scratch bitmaps</a> have a
  <dfn id=list-of-pending-interface-actions>list of pending interface actions</dfn>, which can contain instructions to draw the user's
  attention to a location on the bitmap, and instructions to scroll to a location on the bitmap.
  Initially, this list is also empty.</p>

  <p><a href=#scratch-bitmap id=2dcontext:scratch-bitmap-3>Scratch bitmaps</a> also have an <dfn id=concept-canvas-alpha>alpha</dfn> flag, which can be set to true or false. Initially, when
  one of these bitmaps is created, its <a href=#concept-canvas-alpha id=2dcontext:concept-canvas-alpha>alpha</a> flag must be
  set to true. When a <a href=#scratch-bitmap id=2dcontext:scratch-bitmap-4>scratch bitmap</a> has its <a href=#concept-canvas-alpha id=2dcontext:concept-canvas-alpha-2>alpha</a> flag set to false, then its alpha channel must be fixed
  to 1.0 (fully opaque) for all pixels, and attempts to change the alpha component of any pixel must
  be silently ignored.</p>

  <p class=note>Thus, such a bitmap starts off as fully-opaque black instead of fully-tranparent
  black; <code id=2dcontext:dom-context-2d-clearrect-2><a href=#dom-context-2d-clearrect>clearRect()</a></code> always results in fully-opaque
  black pixels, every fourth byte from <code id=2dcontext:dom-context-2d-getimagedata-2><a href=#dom-context-2d-getimagedata>getImageData()</a></code> is always 255, the <code id=2dcontext:dom-context-2d-putimagedata-3><a href=#dom-context-2d-putimagedata>putImageData()</a></code> method effectively ignores every fourth
  byte in its input, and so on. However, the alpha component of styles and images drawn onto the
  canvas are still honoured up to the point where they would impact the <a href=#scratch-bitmap id=2dcontext:scratch-bitmap-5>scratch
  bitmap</a>'s alpha channel; for instance, drawing a 50% transparent white square on a freshly
  created <a href=#scratch-bitmap id=2dcontext:scratch-bitmap-6>scratch bitmap</a> with its <a href=#concept-canvas-alpha id=2dcontext:concept-canvas-alpha-3>alpha</a> flag
  set to false will result in a fully-opaque gray square.</p>

  <hr>

  <p>The <code id=2dcontext:canvasrenderingcontext2d-8><a href=#canvasrenderingcontext2d>CanvasRenderingContext2D</a></code> 2D rendering context represents a flat linear
  Cartesian surface whose origin (0,0) is at the top left corner, with the coordinate space having
  <var>x</var> values increasing when going right, and <var>y</var> values
  increasing when going down. The <var>x</var>-coordinate of the right-most edge is equal to
  the width of the rendering context's <a href=#scratch-bitmap id=2dcontext:scratch-bitmap-7>scratch bitmap</a> in CSS pixels; similarly, the
  <var>y</var>-coordinate of the bottom-most edge is equal to the height of the rendering
  context's <a href=#scratch-bitmap id=2dcontext:scratch-bitmap-8>scratch bitmap</a> in CSS pixels.</p>

  <p>The size of the coordinate space does not necessarily represent the size of the actual bitmaps
  that the user agent will use internally or during rendering. On high-definition displays, for
  instance, the user agent may internally use bitmaps with two device pixels per unit in the
  coordinate space, so that the rendering remains at high quality throughout. Anti-aliasing can
  similarly be implemented using over-sampling with bitmaps of a higher resolution than the final
  image on the display.</p>

  <hr>

  <p>The <dfn id=2d-context-creation-algorithm>2D context creation algorithm</dfn>, which is passed a <var>target</var> (a
  <code id=2dcontext:the-canvas-element-5><a href=#the-canvas-element>canvas</a></code> element) and optionally some arguments, consists of running the following steps:</p>

  <ol><li><p>If the algorithm was passed some arguments, let <var>arg</var> be the first such argument.
   Otherwise, let <var>arg</var> be <i>undefined</i>.<li><p>Let <var>settings</var> be the result of <a href=#coerce-context-arguments-for-2d id=2dcontext:coerce-context-arguments-for-2d>coercing the <var>arg</var> context arguments for 2D</a>.<li><p>Create a new <code id=2dcontext:canvasrenderingcontext2d-9><a href=#canvasrenderingcontext2d>CanvasRenderingContext2D</a></code> object.<li><p>Initialise its <code id=2dcontext:dom-context-2d-canvas-3><a href=#dom-context-2d-canvas>canvas</a></code> attribute to point to
   <var>target</var>.<li><p>Let the new <code id=2dcontext:canvasrenderingcontext2d-10><a href=#canvasrenderingcontext2d>CanvasRenderingContext2D</a></code> object's <a href=#output-bitmap id=2dcontext:output-bitmap-3>output bitmap</a> and
   <a href=#scratch-bitmap id=2dcontext:scratch-bitmap-9>scratch bitmap</a> both be the same bitmap as <var>target</var>'s bitmap (so
   that they are shared).<li><p><a href=#concept-canvas-set-bitmap-dimensions id=2dcontext:concept-canvas-set-bitmap-dimensions>Set bitmap dimensions</a> to the
   numeric values of <var>target</var>'s <code id=2dcontext:attr-canvas-width><a href=#attr-canvas-width>width</a></code> and
   <code id=2dcontext:attr-canvas-height><a href=#attr-canvas-height>height</a></code> content attributes.<li>

    <p>Process each of the members of <var>settings</var> as follows:</p>

    <dl><dt><dfn id=dom-canvasrenderingcontext2dsettings-alpha><code>alpha</code></dfn><dd>If false, then set the <var>target</var>'s bitmap's <a href=#concept-canvas-alpha id=2dcontext:concept-canvas-alpha-4>alpha</a> flag to false.</dl>

   <li><p>Return the new <code id=2dcontext:canvasrenderingcontext2d-11><a href=#canvasrenderingcontext2d>CanvasRenderingContext2D</a></code> object.</ol>

  <hr>

  <p>The <dfn id=dom-context-2d><code>CanvasRenderingContext2D()</code></dfn> constructor, when
  invoked, must run the following steps:</p>

  <ol><li><p>Create a new <code id=2dcontext:canvasrenderingcontext2d-12><a href=#canvasrenderingcontext2d>CanvasRenderingContext2D</a></code> object.<li><p>Initialise its <code id=2dcontext:dom-context-2d-canvas-4><a href=#dom-context-2d-canvas>canvas</a></code> attribute to
   null.<li><p>Let the new <code id=2dcontext:canvasrenderingcontext2d-13><a href=#canvasrenderingcontext2d>CanvasRenderingContext2D</a></code> object's <a href=#scratch-bitmap id=2dcontext:scratch-bitmap-10>scratch bitmap</a> be
   a new bitmap.<li><p>If the constructor was called with arguments, let <var>width</var> and <var>height</var> be the first and second arguments, respectively. Otherwise, let <var>width</var> and <var>height</var> be 300 and 150, respectively.<li><p><a href=#concept-canvas-set-bitmap-dimensions id=2dcontext:concept-canvas-set-bitmap-dimensions-2>Set bitmap dimensions</a> to <var>width</var> and <var>height</var>.<li><p>Let the new <code id=2dcontext:canvasrenderingcontext2d-14><a href=#canvasrenderingcontext2d>CanvasRenderingContext2D</a></code> object have no <a href=#output-bitmap id=2dcontext:output-bitmap-4>output
   bitmap</a>.<li><p>Return the new <code id=2dcontext:canvasrenderingcontext2d-15><a href=#canvasrenderingcontext2d>CanvasRenderingContext2D</a></code> object.</ol>

  <hr>

  <p>When a user agent is required to <dfn id=coerce-context-arguments-for-2d>coerce context arguments for 2D</dfn>, it must run the
  following steps:</p>

  <ol><li><p>Let <var>input</var> be the argument to coerce.<li><p>Let <var>jsval</var> be the result of <a href=http://heycam.github.io/webidl/#es-type-mapping id=2dcontext:concept-idl-convert data-x-internal=concept-idl-convert>converting</a>
   <var>input</var> to an ECMAScript value. If this throws an exception, then propagate the
   exception and abort these steps.<li><p>Let <var>dict</var> be the result of <a href=http://heycam.github.io/webidl/#es-type-mapping id=2dcontext:concept-idl-convert-2 data-x-internal=concept-idl-convert>converting</a>
   <var>jsval</var> to the dictionary type <code id=2dcontext:canvasrenderingcontext2dsettings><a href=#canvasrenderingcontext2dsettings>CanvasRenderingContext2DSettings</a></code>. If this
   throws an exception, then propagate the exception and abort these steps.<li><p>Return <var>dict</var>.</ol>

  <hr>

  <p>When the user agent is required to <dfn id=commit-the-scratch-bitmap>commit the scratch bitmap</dfn> for a rendering
  context, it must run the following steps:

  <ol><li><p>Let <var>bitmap copy</var> be a copy of the rendering context's <a href=#scratch-bitmap id=2dcontext:scratch-bitmap-11>scratch
   bitmap</a>.<li><p>Let <var>origin-clean flag copy</var> be a copy of the rendering context's
   <a href=#scratch-bitmap id=2dcontext:scratch-bitmap-12>scratch bitmap</a>'s <a href=#concept-canvas-origin-clean id=2dcontext:concept-canvas-origin-clean-3>origin-clean</a>
   flag.<li><p>Let <var>hit region list copy</var> be a copy of the rendering context's
   <a href=#scratch-bitmap id=2dcontext:scratch-bitmap-13>scratch bitmap</a>'s <a href=#hit-region-list id=2dcontext:hit-region-list-2>hit region list</a>.<li><p>Let <var>list of pending interface actions copy</var> be a copy of the rendering
   context's <a href=#scratch-bitmap id=2dcontext:scratch-bitmap-14>scratch bitmap</a>'s <a href=#list-of-pending-interface-actions id=2dcontext:list-of-pending-interface-actions>list of pending interface actions</a>.<li><p>Empty the <a href=#scratch-bitmap id=2dcontext:scratch-bitmap-15>scratch bitmap</a>'s <a href=#list-of-pending-interface-actions id=2dcontext:list-of-pending-interface-actions-2>list of pending interface actions</a>.<li><p>If the rendering context has no <a href=#output-bitmap id=2dcontext:output-bitmap-5>output bitmap</a>, abort these steps.<li><p>Let <var>output bitmap</var> be the rendering context's <a href=#output-bitmap id=2dcontext:output-bitmap-6>output
   bitmap</a>.<li><p>Let <var>canvas</var> be the <code id=2dcontext:the-canvas-element-6><a href=#the-canvas-element>canvas</a></code> element to which the rendering
   context was most recently <a href=#concept-canvas-binding-steps id=2dcontext:concept-canvas-binding-steps-2>bound</a>.<li>

    <p><a id=2dcontext:queue-a-task href=webappapis.html#queue-a-task>Queue a task</a> associated with <var>canvas</var>' <code id=2dcontext:document><a href=dom.html#document>Document</a></code>
    to perform the following substeps:</p>

    <ol><li><p>Overwrite <var>output bitmap</var> with <var>bitmap
     copy</var>.<li><p>Overwrite <var>output bitmap</var>'s <a href=#concept-canvas-origin-clean id=2dcontext:concept-canvas-origin-clean-4>origin-clean</a> flag with <var>origin-clean
     flag copy</var>.<li><p>Overwrite <var>output bitmap</var>'s <a href=#hit-region-list id=2dcontext:hit-region-list-3>hit region list</a> with <var>hit region list copy</var>.<li><p>Follow the directions in the <var>list of pending interface actions
     copy</var>.</ol>

   </ol>

  <p>The algorithm above must use the <dfn id=canvas-updating-task-source>canvas updating task source</dfn> (which is just used by
  this algorithm).</p>



  <p>The <dfn id=dom-context-2d-commit><code>commit()</code></dfn> method must run the
  following steps:</p>

  <ol><li><p>If the rendering context's <a href=#concept-canvas-context-bitmap-mode id=2dcontext:concept-canvas-context-bitmap-mode>context bitmap
   mode</a> is <a href=#concept-canvas-bound id=2dcontext:concept-canvas-bound>fixed</a>, throw an
   <code id=2dcontext:invalidstateerror><a href=infrastructure.html#invalidstateerror>InvalidStateError</a></code> exception and abort these steps.<li><p><a href=#commit-the-scratch-bitmap id=2dcontext:commit-the-scratch-bitmap>Commit the scratch bitmap</a> for the rendering context.</ol>

  <p class=note>The <a href=#scratch-bitmap id=2dcontext:scratch-bitmap-16>scratch bitmap</a> is only <a href=#commit-the-scratch-bitmap id=2dcontext:commit-the-scratch-bitmap-2>committed</a> when the <code id=2dcontext:dom-context-2d-commit-3><a href=#dom-context-2d-commit>commit()</a></code> method is
  called. (This doesn't matter for <code id=2dcontext:the-canvas-element-7><a href=#the-canvas-element>canvas</a></code> elements in <a href=#concept-canvas-direct-2d id=2dcontext:concept-canvas-direct-2d>direct-2d</a> mode, since there the <a href=#scratch-bitmap id=2dcontext:scratch-bitmap-17>scratch
  bitmap</a> is also the <code id=2dcontext:the-canvas-element-8><a href=#the-canvas-element>canvas</a></code> element's bitmap so every drawing operation is
  immediately drawn.)</p>

  <hr>

  <p>When the user agent is to <dfn id=concept-canvas-set-bitmap-dimensions>set bitmap
  dimensions</dfn> to <var>width</var> and <var>height</var>, it must run the
  following steps:</p>

  <ol><li><p><a href=#reset-the-rendering-context-to-its-default-state id=2dcontext:reset-the-rendering-context-to-its-default-state>Reset the rendering context to its default state</a>.<li><p>Clear the <a href=#scratch-bitmap id=2dcontext:scratch-bitmap-18>scratch bitmap</a>'s <a href=#hit-region-list id=2dcontext:hit-region-list-4>hit region list</a> and its <a href=#list-of-pending-interface-actions id=2dcontext:list-of-pending-interface-actions-3>list of
   pending interface actions</a>.<li><p>Resize the <a href=#scratch-bitmap id=2dcontext:scratch-bitmap-19>scratch bitmap</a> to the new <var>width</var> and <var>height</var> and clear it to fully transparent black.<li><p>If the rendering context has an <a href=#output-bitmap id=2dcontext:output-bitmap-7>output bitmap</a>, and the <a href=#scratch-bitmap id=2dcontext:scratch-bitmap-20>scratch
   bitmap</a> is a different bitmap than the <a href=#output-bitmap id=2dcontext:output-bitmap-8>output bitmap</a>, then resize the
   <a href=#output-bitmap id=2dcontext:output-bitmap-9>output bitmap</a> to the new <var>width</var> and <var>height</var>
   and clear it to fully transparent black.<li>

    <p>If the rendering context's <a href=#concept-canvas-context-bitmap-mode id=2dcontext:concept-canvas-context-bitmap-mode-2>context bitmap
    mode</a> is <a href=#concept-canvas-fixed id=2dcontext:concept-canvas-fixed-2>fixed</a>, then run these substeps:</p>

    <ol><li><p>Let <var>canvas</var> be the <code id=2dcontext:the-canvas-element-9><a href=#the-canvas-element>canvas</a></code> element to which the rendering
     context's <code id=2dcontext:dom-context-2d-canvas-5><a href=#dom-context-2d-canvas>canvas</a></code> attribute was initialised.<li><p>If the rendering context's <a href=#concept-canvas-context-bitmap-mode id=2dcontext:concept-canvas-context-bitmap-mode-3>context
     bitmap mode</a> is <a href=#concept-canvas-fixed id=2dcontext:concept-canvas-fixed-3>fixed</a> and the numeric value of
     the <var>canvas</var>' <code id=2dcontext:attr-canvas-width-2><a href=#attr-canvas-width>width</a></code> content attribute
     differs from <var>width</var>, then set <var>canvas</var>' <code id=2dcontext:attr-canvas-width-3><a href=#attr-canvas-width>width</a></code> content attribute to the shortest possible string
     representing <var>width</var> as a <a id=2dcontext:valid-non-negative-integer href=infrastructure.html#valid-non-negative-integer>valid non-negative integer</a>.<li><p>If the rendering context's <a href=#concept-canvas-context-bitmap-mode id=2dcontext:concept-canvas-context-bitmap-mode-4>context
     bitmap mode</a> is <a href=#concept-canvas-fixed id=2dcontext:concept-canvas-fixed-4>fixed</a> and the numeric value of
     the <var>canvas</var>' <code id=2dcontext:attr-canvas-height-2><a href=#attr-canvas-height>height</a></code> content attribute
     differs from <var>height</var>, then set <var>canvas</var>' <code id=2dcontext:attr-canvas-height-3><a href=#attr-canvas-height>height</a></code> content attribute to the shortest possible string
     representing <var>height</var> as a <a id=2dcontext:valid-non-negative-integer-2 href=infrastructure.html#valid-non-negative-integer>valid non-negative integer</a>.</ol>

   </ol>

  <div class=example>
   <p>Only one square appears to be drawn in the following example:</p>
   <pre>// canvas is a reference to a &lt;canvas> element
var context = canvas.getContext('2d');
context.fillRect(0,0,50,50);
canvas.setAttribute('width', '300'); // clears the canvas
context.fillRect(0,100,50,50);
canvas.width = canvas.width; // clears the canvas
context.fillRect(100,0,50,50); // only this square remains</pre>
  </div>

  <hr>

  <p>When the user agent is to run the <dfn id=concept-canvas-unbinding-steps>unbinding
  steps</dfn> for a rendering context, it must run the following steps:</p>

  <ol><li><p><a href=#reset-the-rendering-context-to-its-default-state id=2dcontext:reset-the-rendering-context-to-its-default-state-2>Reset the rendering context to its default state</a>.<li><p>Clear the <a href=#scratch-bitmap id=2dcontext:scratch-bitmap-21>scratch bitmap</a>'s <a href=#hit-region-list id=2dcontext:hit-region-list-5>hit region list</a> and its <a href=#list-of-pending-interface-actions id=2dcontext:list-of-pending-interface-actions-4>list of
   pending interface actions</a>.<li><p>Clear the <code id=2dcontext:canvasrenderingcontext2d-16><a href=#canvasrenderingcontext2d>CanvasRenderingContext2D</a></code> object's <a href=#scratch-bitmap id=2dcontext:scratch-bitmap-22>scratch bitmap</a> to a
   transparent black.<li><p>Set the <code id=2dcontext:canvasrenderingcontext2d-17><a href=#canvasrenderingcontext2d>CanvasRenderingContext2D</a></code> object's <a href=#scratch-bitmap id=2dcontext:scratch-bitmap-23>scratch bitmap</a>'s <a href=#concept-canvas-origin-clean id=2dcontext:concept-canvas-origin-clean-5>origin-clean</a> flag to true.<li><p>Let the <code id=2dcontext:canvasrenderingcontext2d-18><a href=#canvasrenderingcontext2d>CanvasRenderingContext2D</a></code> object have no <a href=#output-bitmap id=2dcontext:output-bitmap-10>output
   bitmap</a>.</ol>

  <p>When the user agent is to run the <dfn id=concept-canvas-binding-steps>binding steps</dfn>
  to bind the rendering context to the <code id=2dcontext:the-canvas-element-10><a href=#the-canvas-element>canvas</a></code> element <var>target</var>, it
  must run the following steps:</p>

  <ol><li><p><a href=#reset-the-rendering-context-to-its-default-state id=2dcontext:reset-the-rendering-context-to-its-default-state-3>Reset the rendering context to its default state</a>.<li><p>Clear the <a href=#scratch-bitmap id=2dcontext:scratch-bitmap-24>scratch bitmap</a>'s <a href=#hit-region-list id=2dcontext:hit-region-list-6>hit region list</a> and its <a href=#list-of-pending-interface-actions id=2dcontext:list-of-pending-interface-actions-5>list of
   pending interface actions</a>.<li><p>Resize the <code id=2dcontext:canvasrenderingcontext2d-19><a href=#canvasrenderingcontext2d>CanvasRenderingContext2D</a></code> object's <a href=#scratch-bitmap id=2dcontext:scratch-bitmap-25>scratch bitmap</a> to
   the dimensions of <var>target</var>'s bitmap and clear it to fully transparent
   black.<li><p>Set the <code id=2dcontext:canvasrenderingcontext2d-20><a href=#canvasrenderingcontext2d>CanvasRenderingContext2D</a></code> object's <a href=#scratch-bitmap id=2dcontext:scratch-bitmap-26>scratch bitmap</a>'s <a href=#concept-canvas-origin-clean id=2dcontext:concept-canvas-origin-clean-6>origin-clean</a> flag to true.<li><p>Let the <code id=2dcontext:canvasrenderingcontext2d-21><a href=#canvasrenderingcontext2d>CanvasRenderingContext2D</a></code> object's <a href=#output-bitmap id=2dcontext:output-bitmap-11>output bitmap</a> be <var>target</var>'s bitmap.</ol>

  <hr>

  <p>The <dfn id=dom-context-2d-canvas><code>canvas</code></dfn> attribute must return the
  value it was initialised to when the object was created.</p>

  <p>The <dfn id=dom-context-2d-width><code>width</code></dfn> attribute, on getting, must
  return the width of the rendering context's <a href=#scratch-bitmap id=2dcontext:scratch-bitmap-27>scratch bitmap</a>, in CSS pixels. On
  setting, it must <a href=#concept-canvas-set-bitmap-dimensions id=2dcontext:concept-canvas-set-bitmap-dimensions-3>set bitmap dimensions</a>
  to the new value and the current height of the rendering context's <a href=#scratch-bitmap id=2dcontext:scratch-bitmap-28>scratch bitmap</a> in
  CSS pixels, respectively.</p>

  <p>The <dfn id=dom-context-2d-height><code>height</code></dfn> attribute, on getting, must
  return the height of the rendering context's <a href=#scratch-bitmap id=2dcontext:scratch-bitmap-29>scratch bitmap</a>, in CSS pixels. On
  setting, it must <a href=#concept-canvas-set-bitmap-dimensions id=2dcontext:concept-canvas-set-bitmap-dimensions-4>set bitmap dimensions</a>
  to the current width of the rendering context's <a href=#scratch-bitmap id=2dcontext:scratch-bitmap-30>scratch bitmap</a> in CSS pixels and the
  new value, respectively.</p>

  <hr>

  <p>Except where otherwise specified, for the 2D context interface, <strong>any method call with a
  numeric argument whose value is infinite or a NaN value must be ignored</strong>.</p>

  

  <p>Whenever the CSS value <code>currentColor</code> is used as a colour in the
  <code id=2dcontext:canvasrenderingcontext2d-22><a href=#canvasrenderingcontext2d>CanvasRenderingContext2D</a></code> API, the "computed value of the 'color' property" for the
  purposes of determining the computed value of the <code>currentColor</code> keyword is
  the value described by the appropriate entry in the following list:</p>

  <dl><dt>If the rendering context's <a href=#concept-canvas-context-bitmap-mode id=2dcontext:concept-canvas-context-bitmap-mode-5>context bitmap
   mode</a> is <a href=#concept-canvas-fixed id=2dcontext:concept-canvas-fixed-5>fixed</a> and the <code id=2dcontext:the-canvas-element-11><a href=#the-canvas-element>canvas</a></code>
   element is <a id=2dcontext:being-rendered href=rendering.html#being-rendered>being rendered</a><dd><p>The "computed value of the 'color' property" for the purposes of determining the computed
   value of the <code>currentColor</code> keyword is the computed value of the 'color'
   property on the <code id=2dcontext:the-canvas-element-12><a href=#the-canvas-element>canvas</a></code> element at the time that the colour is specified (e.g. when
   the appropriate attribute is set, or when the method is called; not when the colour is rendered or
   otherwise used). <a href=references.html#refsCSSCOLOR>[CSSCOLOR]</a><dt>In all other cases<dd><p>The "computed value of the 'color' property" for the purposes of determining the computed
   value of the <code>currentColor</code> keyword is fully opaque black. <a href=references.html#refsCSSCOLOR>[CSSCOLOR]</a></dl>

  <p>In the case of <code id=2dcontext:dom-canvasgradient-addcolorstop-2><a href=#dom-canvasgradient-addcolorstop>addColorStop()</a></code> on
  <code id=2dcontext:canvasgradient-3><a href=#canvasgradient>CanvasGradient</a></code>, the "computed value of the 'color' property" for the purposes of
  determining the computed value of the <code>currentColor</code> keyword is always fully
  opaque black (there is no associated element). <a href=references.html#refsCSSCOLOR>[CSSCOLOR]</a></p>

  <p class=note>This is because <code id=2dcontext:canvasgradient-4><a href=#canvasgradient>CanvasGradient</a></code> objects are
  <code id=2dcontext:the-canvas-element-13><a href=#the-canvas-element>canvas</a></code>-neutral — a <code id=2dcontext:canvasgradient-5><a href=#canvasgradient>CanvasGradient</a></code> object created by one
  <code id=2dcontext:the-canvas-element-14><a href=#the-canvas-element>canvas</a></code> can be used by another, and there is therefore no way to know which is the
  "element in question" at the time that the colour is specified.</p>

  <p class=note>Similar concerns exist with font-related properties; the rules for those are
  described in detail in the relevant section below.</p>

  

  <hr>

  <p>The <code id=2dcontext:canvasfillrule-9><a href=#canvasfillrule>CanvasFillRule</a></code> enumeration is used to select the <dfn id=fill-rule>fill rule</dfn>
  algorithm by which to determine if a point is inside or outside a path.</p>

  <p>The value "<dfn id=dom-context-2d-fillrule-nonzero><code>nonzero</code></dfn>" value
  indicates the non-zero winding rule, wherein

     a point is considered to be outside a shape if the number of times a half-infinite straight
     line drawn from that point crosses the shape's path going in one direction is equal to the
     number of times it crosses the path going in the other direction.

  </p>


  <p>The "<dfn id=dom-context-2d-fillrule-evenodd><code>evenodd</code></dfn>" value indicates
  the even-odd rule, wherein

     a point is considered to be outside a shape if the number of times a half-infinite straight
     line drawn from that point crosses the shape's path is even.

  </p>

  <p>If a point is not outside a shape, it is inside the shape.</p>


  <h6 id=implementation-notes>4.12.4.2.1 Implementation notes</h6>

  <p><i>This section is non-normative.</i></p>

  <p>Although the way the specification is written it might sound like an implementation needs to
  track up to four bitmaps per canvas or rendering context — one <a href=#scratch-bitmap id=implementation-notes:scratch-bitmap>scratch bitmap</a>,
  one <a href=#output-bitmap id=implementation-notes:output-bitmap>output bitmap</a> for the rendering context, one bitmap for the <code id=implementation-notes:the-canvas-element><a href=#the-canvas-element>canvas</a></code>,
  and one bitmap for the actually currently rendered image — user agents can in fact generally
  optimise this to only one or two.</p>

  <p>The <a href=#scratch-bitmap id=implementation-notes:scratch-bitmap-2>scratch bitmap</a>, when it isn't the same bitmap as the <a href=#output-bitmap id=implementation-notes:output-bitmap-2>output
  bitmap</a>, is only directly observable if it is read, and therefore implementations can,
  instead of updating this bitmap, merely remember the sequence of drawing operations that have been
  applied to it until such time as the bitmap's actual data is needed (for example because of a call
  to <code id=implementation-notes:dom-context-2d-commit><a href=#dom-context-2d-commit>commit()</a></code>, <code id=implementation-notes:dom-context-2d-drawimage><a href=#dom-context-2d-drawimage>drawImage()</a></code>, or the <code id=implementation-notes:dom-createimagebitmap><a href=webappapis.html#dom-createimagebitmap>createImageBitmap()</a></code>
  factory method). In many cases, this will be more memory efficient.</p>

  <p>The bitmap of a <code id=implementation-notes:the-canvas-element-2><a href=#the-canvas-element>canvas</a></code> element is the one bitmap that's pretty much always going
  to be needed in practice. The <a href=#output-bitmap id=implementation-notes:output-bitmap-3>output bitmap</a> of a rendering context, when it has one,
  is always just an alias to a <code id=implementation-notes:the-canvas-element-3><a href=#the-canvas-element>canvas</a></code> element's bitmap.</p>

  <p>Additional bitmaps are sometimes needed, e.g. to enable fast drawing when the canvas is being
  painted at a different size than its intrinsic size, or to enable double buffering so that the
  rendering commands from the <a href=#scratch-bitmap id=implementation-notes:scratch-bitmap-3>scratch bitmap</a> can be applied without the rendering being
  updated midway.</p>




  <h6 id=the-canvas-state>4.12.4.2.2 The canvas state</h6>

  <p>Each <code id=the-canvas-state:canvasrenderingcontext2d><a href=#canvasrenderingcontext2d>CanvasRenderingContext2D</a></code> rendering context maintains a stack of drawing
  states. <dfn id=drawing-state>Drawing states</dfn> consist of:</p>

  <ul class=brief><li>The current <a href=#transformations id=the-canvas-state:transformations>transformation matrix</a>.<li>The current <a href=#clipping-region id=the-canvas-state:clipping-region>clipping region</a>.<li>The current values of the following attributes: <code id=the-canvas-state:dom-context-2d-strokestyle><a href=#dom-context-2d-strokestyle>strokeStyle</a></code>, <code id=the-canvas-state:dom-context-2d-fillstyle><a href=#dom-context-2d-fillstyle>fillStyle</a></code>, <code id=the-canvas-state:dom-context-2d-globalalpha><a href=#dom-context-2d-globalalpha>globalAlpha</a></code>, <code id=the-canvas-state:dom-context-2d-linewidth><a href=#dom-context-2d-linewidth>lineWidth</a></code>, <code id=the-canvas-state:dom-context-2d-linecap><a href=#dom-context-2d-linecap>lineCap</a></code>, <code id=the-canvas-state:dom-context-2d-linejoin><a href=#dom-context-2d-linejoin>lineJoin</a></code>, <code id=the-canvas-state:dom-context-2d-miterlimit><a href=#dom-context-2d-miterlimit>miterLimit</a></code>, <code id=the-canvas-state:dom-context-2d-linedashoffset><a href=#dom-context-2d-linedashoffset>lineDashOffset</a></code>, <code id=the-canvas-state:dom-context-2d-shadowoffsetx><a href=#dom-context-2d-shadowoffsetx>shadowOffsetX</a></code>, <code id=the-canvas-state:dom-context-2d-shadowoffsety><a href=#dom-context-2d-shadowoffsety>shadowOffsetY</a></code>, <code id=the-canvas-state:dom-context-2d-shadowblur><a href=#dom-context-2d-shadowblur>shadowBlur</a></code>, <code id=the-canvas-state:dom-context-2d-shadowcolor><a href=#dom-context-2d-shadowcolor>shadowColor</a></code>, <code id=the-canvas-state:dom-context-2d-globalcompositeoperation><a href=#dom-context-2d-globalcompositeoperation>globalCompositeOperation</a></code>, <code id=the-canvas-state:dom-context-2d-font><a href=#dom-context-2d-font>font</a></code>, <code id=the-canvas-state:dom-context-2d-textalign><a href=#dom-context-2d-textalign>textAlign</a></code>, <code id=the-canvas-state:dom-context-2d-textbaseline><a href=#dom-context-2d-textbaseline>textBaseline</a></code>, <code id=the-canvas-state:dom-context-2d-direction><a href=#dom-context-2d-direction>direction</a></code>, <code id=the-canvas-state:dom-context-2d-imagesmoothingenabled><a href=#dom-context-2d-imagesmoothingenabled>imageSmoothingEnabled</a></code>.<li>The current <a href=#dash-list id=the-canvas-state:dash-list>dash list</a>.</ul>

  <p class=note>The <a href=#current-default-path id=the-canvas-state:current-default-path>current default path</a> and the rendering context's bitmaps are not
  part of the drawing state. The <a href=#current-default-path id=the-canvas-state:current-default-path-2>current default path</a> is persistent, and can only be
  reset using the <code id=the-canvas-state:dom-context-2d-beginpath><a href=#dom-context-2d-beginpath>beginPath()</a></code> method. The bitmaps
  depend on whether and how the rendering context is bound to a <code id=the-canvas-state:the-canvas-element><a href=#the-canvas-element>canvas</a></code> element.</p>

  <dl class=domintro><dt><var>context</var> . <code id=the-canvas-state:dom-context-2d-save><a href=#dom-context-2d-save>save</a></code>()<dd>

    <p>Pushes the current state onto the stack.</p>

   <dt><var>context</var> . <code id=the-canvas-state:dom-context-2d-restore><a href=#dom-context-2d-restore>restore</a></code>()<dd>

    <p>Pops the top state on the stack, restoring the context to that state.</p>

   </dl>

  

  <p>The <dfn id=dom-context-2d-save><code>save()</code></dfn> method must push a copy of the
  current drawing state onto the drawing state stack.</p>

  <p>The <dfn id=dom-context-2d-restore><code>restore()</code></dfn> method must pop the top
  entry in the drawing state stack, and reset the drawing state it describes. If there is no saved
  state, the method must do nothing.</p>

  <p>When the user agent is to <dfn id=reset-the-rendering-context-to-its-default-state>reset the rendering context to its default state</dfn>, it must
  clear the drawing state stack and everything that <a href=#drawing-state id=the-canvas-state:drawing-state>drawing state</a> consists of to
  initial values.</p>

  

  


  <h6 id=drawingstyle-objects>4.12.4.2.3 <code id=drawingstyle-objects:drawingstyle><a href=#drawingstyle>DrawingStyle</a></code> objects</h6>

  <p>All the line styles (line width, caps, joins, and dash patterns) and text styles (fonts)
  described in the next two sections apply to <code id=drawingstyle-objects:canvasrenderingcontext2d><a href=#canvasrenderingcontext2d>CanvasRenderingContext2D</a></code> objects and to
  <code id=drawingstyle-objects:drawingstyle-2><a href=#drawingstyle>DrawingStyle</a></code> objects. This section defines the constructor used to obtain a
  <code id=drawingstyle-objects:drawingstyle-3><a href=#drawingstyle>DrawingStyle</a></code> object. This object is then used by methods on <code id=drawingstyle-objects:path2d><a href=#path2d>Path2D</a></code>
  objects to control how text and paths are rasterised and stroked.</p>

  <dl class=domintro><dt><var>styles</var> = new <code id=drawingstyle-objects:dom-drawingstyle><a href=#dom-drawingstyle>DrawingStyle</a></code>( [ <var>element</var> ] )<dd>

    <p>Creates a new <code id=drawingstyle-objects:drawingstyle-4><a href=#drawingstyle>DrawingStyle</a></code> object, optionally using a specific element for
    resolving relative keywords and sizes in font specifications.</p>

   </dl>

  

  <p>Each <code id=drawingstyle-objects:drawingstyle-5><a href=#drawingstyle>DrawingStyle</a></code> object can have a <dfn id=styles-scope-object>styles scope object</dfn>.</p>

  <p>The <dfn id=dom-drawingstyle><code>DrawingStyle()</code></dfn> constructor, when invoked,
  must return a newly created <code id=drawingstyle-objects:drawingstyle-6><a href=#drawingstyle>DrawingStyle</a></code> object. If the constructor was passed an
  argument, then the <code id=drawingstyle-objects:drawingstyle-7><a href=#drawingstyle>DrawingStyle</a></code> object's <a href=#styles-scope-object id=drawingstyle-objects:styles-scope-object>styles scope object</a> is that
  element. Otherwise, if the <a id=drawingstyle-objects:javascript-global-environment href=infrastructure.html#javascript-global-environment>JavaScript global environment</a> is a <a id=drawingstyle-objects:document-environment href=webappapis.html#document-environment>document
  environment</a>, the object's <a href=#styles-scope-object id=drawingstyle-objects:styles-scope-object-2>styles scope object</a> is the <code id=drawingstyle-objects:document><a href=dom.html#document>Document</a></code>
  object of the <a id=drawingstyle-objects:active-document href=browsers.html#active-document>active document</a> of the <a id=drawingstyle-objects:browsing-context href=browsers.html#browsing-context>browsing context</a> of the
  <code id=drawingstyle-objects:window><a href=browsers.html#window>Window</a></code> object on which the interface object of the invoked constructor is found.
  Otherwise, the <a id=drawingstyle-objects:javascript-global-environment-2 href=infrastructure.html#javascript-global-environment>JavaScript global environment</a> is a <a id=drawingstyle-objects:worker-environment href=webappapis.html#worker-environment>worker environment</a>,
  and the <a href=#styles-scope-object id=drawingstyle-objects:styles-scope-object-3>styles scope object</a> is the worker.</p>

  


  <h6 id=line-styles>4.12.4.2.4 Line styles</h6>

  <dl class=domintro><dt><var>context</var> . <code id=line-styles:dom-context-2d-linewidth><a href=#dom-context-2d-linewidth>lineWidth</a></code> [ = <var>value</var> ]<dt><var>styles</var> . <code id=line-styles:dom-context-2d-linewidth-2><a href=#dom-context-2d-linewidth>lineWidth</a></code> [ = <var>value</var> ]<dd>

    <p>Returns the current line width.</p>

    <p>Can be set, to change the line width. Values that are not finite values greater than zero are
    ignored.</p>

   <dt><var>context</var> . <code id=line-styles:dom-context-2d-linecap><a href=#dom-context-2d-linecap>lineCap</a></code> [ = <var>value</var> ]<dt><var>styles</var> . <code id=line-styles:dom-context-2d-linecap-2><a href=#dom-context-2d-linecap>lineCap</a></code> [ = <var>value</var> ]<dd>

    <p>Returns the current line cap style.</p>

    <p>Can be set, to change the line cap style.</p>

    <p>The possible line cap styles are "<code>butt"</code>", "<code>round"</code>", and "<code>square"</code>". Other values are ignored.</p>

   <dt><var>context</var> . <code id=line-styles:dom-context-2d-linejoin><a href=#dom-context-2d-linejoin>lineJoin</a></code> [ = <var>value</var> ]<dt><var>styles</var> . <code id=line-styles:dom-context-2d-linejoin-2><a href=#dom-context-2d-linejoin>lineJoin</a></code> [ = <var>value</var> ]<dd>

    <p>Returns the current line join style.</p>

    <p>Can be set, to change the line join style.</p>

    <p>The possible line join styles are "<code>bevel"</code>", "<code>round"</code>", and "<code>miter"</code>". Other values are ignored.</p>

   <dt><var>context</var> . <code id=line-styles:dom-context-2d-miterlimit><a href=#dom-context-2d-miterlimit>miterLimit</a></code> [ = <var>value</var> ]<dt><var>styles</var> . <code id=line-styles:dom-context-2d-miterlimit-2><a href=#dom-context-2d-miterlimit>miterLimit</a></code> [ = <var>value</var> ]<dd>

    <p>Returns the current miter limit ratio.</p>

    <p>Can be set, to change the miter limit ratio. Values that are not finite values greater than
    zero are ignored.</p>

   <dt><var>context</var> . <code id=line-styles:dom-context-2d-setlinedash><a href=#dom-context-2d-setlinedash>setLineDash</a></code>(<var>segments</var>)<dt><var>styles</var> . <code id=line-styles:dom-context-2d-setlinedash-2><a href=#dom-context-2d-setlinedash>setLineDash</a></code>(<var>segments</var>)<dd>

    <p>Sets the current line dash pattern (as used when stroking). The argument is a list of
    distances for which to alternately have the line on and the line off.</p>

   <dt><var>segments</var> = <var>context</var> . <code id=line-styles:dom-context-2d-getlinedash><a href=#dom-context-2d-getlinedash>getLineDash</a></code>()<dt><var>segments</var> = <var>styles</var> . <code id=line-styles:dom-context-2d-getlinedash-2><a href=#dom-context-2d-getlinedash>getLineDash</a></code>()<dd>

    <p>Returns a copy of the current line dash pattern. The array returned will always have an even
    number of entries (i.e. the pattern is normalized).</p>

   <dt><var>context</var> . <code id=line-styles:dom-context-2d-linedashoffset><a href=#dom-context-2d-linedashoffset>lineDashOffset</a></code><dt><var>styles</var> . <code id=line-styles:dom-context-2d-linedashoffset-2><a href=#dom-context-2d-linedashoffset>lineDashOffset</a></code><dd>

    <p>Returns the phase offset (in the same units as the line dash pattern).</p>

    <p>Can be set, to change the phase offset. Values that are not finite values are ignored.</p>

   </dl>

  

  <p>Objects that implement the <code id=line-styles:canvasdrawingstyles><a href=#canvasdrawingstyles>CanvasDrawingStyles</a></code> interface have attributes and
  methods (defined in this section) that control how lines are treated by the object.</p>

  <p>The <dfn id=dom-context-2d-linewidth><code>lineWidth</code></dfn> attribute gives the
  width of lines, in coordinate space units. On getting, it must return the current value. On
  setting, zero, negative, infinite, and NaN values must be ignored, leaving the value unchanged;
  other values must change the current value to the new value.</p>

  <p>When the object implementing the <code id=line-styles:canvasdrawingstyles-2><a href=#canvasdrawingstyles>CanvasDrawingStyles</a></code> interface is created, the
  <code id=line-styles:dom-context-2d-linewidth-3><a href=#dom-context-2d-linewidth>lineWidth</a></code> attribute must initially have the value
  1.0.</p>

  <hr>

  <p>The <dfn id=dom-context-2d-linecap><code>lineCap</code></dfn> attribute defines the type
  of endings that UAs will place on the end of lines. The three valid values are "<code>butt"</code>", "<code>round"</code>", and "<code>square"</code>".</p>

  <p>On getting, it must return the current value. On setting, if the new value is one of the
  literal strings "<code>butt"</code>", "<code>round"</code>", and "<code>square"</code>", then the current value must be changed to the new value; other values
  must ignored, leaving the value unchanged.</p>

  <p>When the object implementing the <code id=line-styles:canvasdrawingstyles-3><a href=#canvasdrawingstyles>CanvasDrawingStyles</a></code> interface is created, the
  <code id=line-styles:dom-context-2d-linecap-3><a href=#dom-context-2d-linecap>lineCap</a></code> attribute must initially have the value
  "<code>butt"</code>".</p>

  <hr>

  <p>The <dfn id=dom-context-2d-linejoin><code>lineJoin</code></dfn> attribute defines the type
  of corners that UAs will place where two lines meet. The three valid values are
  "<code>bevel"</code>", "<code>round"</code>", and "<code>miter"</code>".</p>

  <p>On getting, it must return the current value. On setting, if the new value is one of the
  literal strings "<code>bevel"</code>", "<code>round"</code>", and "<code>miter"</code>", then the current value must be changed to the new value; other values
  must be ignored, leaving the value unchanged.</p>

  <p>When the object implementing the <code id=line-styles:canvasdrawingstyles-4><a href=#canvasdrawingstyles>CanvasDrawingStyles</a></code> interface is created, the
  <code id=line-styles:dom-context-2d-linejoin-3><a href=#dom-context-2d-linejoin>lineJoin</a></code> attribute must initially have the value
  "<code>miter"</code>".</p>

  <hr>

  <p>When the <code id=line-styles:dom-context-2d-linejoin-4><a href=#dom-context-2d-linejoin>lineJoin</a></code> attribute has the value "<code>miter"</code>", strokes use the miter limit ratio to decide how to render joins. The
  miter limit ratio can be explicitly set using the <dfn id=dom-context-2d-miterlimit><code>miterLimit</code></dfn> attribute. On getting, it must return
  the current value. On setting, zero, negative, infinite, and NaN values must be ignored, leaving
  the value unchanged; other values must change the current value to the new value.</p>
  

  <p>When the object implementing the <code id=line-styles:canvasdrawingstyles-5><a href=#canvasdrawingstyles>CanvasDrawingStyles</a></code> interface is created, the
  <code id=line-styles:dom-context-2d-miterlimit-3><a href=#dom-context-2d-miterlimit>miterLimit</a></code> attribute must initially have the value
  10.0.</p>

  <hr>

  <p>Each <code id=line-styles:canvasdrawingstyles-6><a href=#canvasdrawingstyles>CanvasDrawingStyles</a></code> object has a <dfn id=dash-list>dash list</dfn>, which is either empty
  or consists of an even number of non-negative numbers. Initially, the <a href=#dash-list id=line-styles:dash-list>dash list</a> must
  be empty.</p>

  <p>When the <dfn id=dom-context-2d-setlinedash><code>setLineDash()</code></dfn> method is
  invoked, it must run the following steps:</p>

  <ol><li><p>Let <var>a</var> be the argument.<li><p>If any value in <var>a</var> is not finite (e.g. an Infinity or a NaN value), or
   if any value is negative (less than zero), then abort these steps (without throwing an exception;
   user agents could show a message on a developer console, though, as that would be helpful for
   debugging).<li><p>If the number of elements in <var>a</var> is odd, then let <var>a</var>
   be the concatentation of two copies of <var>a</var>.<li><p>Let the object's <a href=#dash-list id=line-styles:dash-list-2>dash list</a> be <var>a</var>.</ol>

  <p>When the <dfn id=dom-context-2d-getlinedash><code>getLineDash()</code></dfn> method is
  invoked, it must return a sequence whose values are the values of the object's <a href=#dash-list id=line-styles:dash-list-3>dash
  list</a>, in the same order.</p>

  <p>It is sometimes useful to change the "phase" of the dash pattern, e.g. to achieve a "marching
  ants" effect. The phase can be set using the <dfn id=dom-context-2d-linedashoffset><code>lineDashOffset</code></dfn> attribute. On getting, it must
  return the current value. On setting, infinite and NaN values must be ignored, leaving the value
  unchanged; other values must change the current value to the new value.</p>

  <p>When the object implementing the <code id=line-styles:canvasdrawingstyles-7><a href=#canvasdrawingstyles>CanvasDrawingStyles</a></code> interface is created, the
  <code id=line-styles:dom-context-2d-linedashoffset-3><a href=#dom-context-2d-linedashoffset>lineDashOffset</a></code> attribute must initially have
  the value 0.0.</p>

  <hr>

  <p>When a user agent is to <dfn id=trace-a-path>trace a path</dfn>, given an object <var>style</var>
  that implements the <code id=line-styles:canvasdrawingstyles-8><a href=#canvasdrawingstyles>CanvasDrawingStyles</a></code> interface, it must run the following
  algorithm. This algorithm returns a new <a href=#concept-path id=line-styles:concept-path>path</a>.</p>

  <ol><li><p>Let <var>path</var> be a copy of the path being traced.<li><p>Prune all zero-length <a href=#line-segments id=line-styles:line-segments>line segments</a> from <var>path</var>.<li><p>Remove from <var>path</var> any subpaths containing no lines (i.e. subpaths with
   just one point).<li><p>Replace each point in each subpath of <var>path</var> other than the first point
   and the last point of each subpath by a <i>join</i> that joins the line leading to that point to
   the line leading out of that point, such that the subpaths all consist of two points (a starting
   point with a line leading out of it, and an ending point with a line leading into it), one or
   more lines (connecting the points and the joins), and zero or more joins (each connecting one
   line to another), connected together such that each subpath is a series of one or more lines with
   a join between each one and a point on each end.<li><p>Add a straight closing line to each closed subpath in <var>path</var> connecting
   the last point and the first point of that subpath; change the last point to a join (from the
   previously last line to the newly added closing line), and change the first point to a join (from
   the newly added closing line to the first line).</p>

   <li><p>If the <var>styles</var> <a href=#dash-list id=line-styles:dash-list-4>dash list</a> is empty, jump to the step
   labeled <i>convert</i>.<li><p>Let <var>pattern width</var> be the concatenation of all the entries of the <var>styles</var> <a href=#dash-list id=line-styles:dash-list-5>dash list</a>, in coordinate space units.</p>

   <li><p>For each subpath <var>subpath</var> in <var>path</var>, run the
   following substeps. These substeps mutate the subpaths in <var>path</var> <i>in
   vivo</i>.</p>

    <ol><li><p>Let <var>subpath width</var> be the length of all the lines of <var>subpath</var>, in coordinate space units.</p>

     <li><p>Let <var>offset</var> be the value of the <var>styles</var> <code id=line-styles:dom-context-2d-linedashoffset-4><a href=#dom-context-2d-linedashoffset>lineDashOffset</a></code>, in coordinate space
     units.<li>

      <p>While <var>offset</var> is greater than <var>pattern width</var>,
      decrement it by <var>pattern width</var>.</p>

      <p>While <var>offset</var> is less than zero, increment it by <var>pattern
      width</var>.</p>

     <li><p>Define <var>L</var> to be a linear coordinate line defined along all lines in
     <var>subpath</var>, such that the start of the first line in the subpath is defined
     as coordinate 0, and the end of the last line in the subpath is defined as coordinate <var>subpath width</var>.<li><p>Let <var>position</var> be zero minus <var>offset</var>.<li><p>Let <var>index</var> be 0.<li><p>Let <var>current state</var> be <i>off</i> (the other states being <i>on</i>
     and <i>zero-on</i>).<li><p><i>Dash on</i>: Let <var>segment length</var> be
     the value of the <var>styles</var> <a href=#dash-list id=line-styles:dash-list-6>dash
     list</a>'s <var>index</var>th entry.<li><p>Increment <var>position</var> by <var>segment length</var>.<li><p>If <var>position</var> is greater than <var>subpath width</var>,
     then end these substeps for this subpath and start them again for the next subpath; if there
     are no more subpaths, then jump to the step labeled <i>convert</i> instead.<li><p>If <var>segment length</var> is non-zero, let <var>current state</var> be <i>on</i>.<li><p>Increment <var>index</var> by one.<li><p><i>Dash off</i>: Let <var>segment
     length</var> be the value of the <var>styles</var> <a href=#dash-list id=line-styles:dash-list-7>dash list</a>'s <var>index</var>th entry.<li><p>Let <var>start</var> be the offset <var>position</var> on <var>L</var>.<li><p>Increment <var>position</var> by <var>segment length</var>.<li><p>If <var>position</var> is less than zero, then jump to the step labeled
     <i>post-cut</i>.<li><p>If <var>start</var> is less than zero, then let <var>start</var> be
     zero.<li><p>If <var>position</var> is greater than <var>subpath width</var>,
     then let <var>end</var> be the offset <var>subpath width</var> on <var>L</var>. Otherwise, let <var>end</var> be the offset <var>position</var> on <var>L</var>.<li>

      <p>Jump to the first appropriate step:</p>

      <dl class=switch><dt>If <var>segment length</var> is zero and <var>current state</var> is
       <i>off</i><dd>

        <p>Do nothing, just continue to the next step.</p>

       <dt>If <var>current state</var> is <i>off</i><dd>

        <p>Cut the line on which <var>end</var> finds itself short at <var>end</var> and place a point there, cutting the subpath that it was in in two;
        remove all line segments, joins, points, and subpaths that are between <var>start</var> and <var>end</var>; and finally place a single point at <var>start</var> with no lines connecting to it.</p>

        <p>The point has a <i>directionality</i> for the purposes of drawing line caps (see below).
        The directionality is the direction that the original line had at that point (i.e. when <var>L</var> was defined above).</p>

       <dt>Otherwise<dd>

        <p>Cut the line on which <var>start</var> finds itself into two at <var>start</var> and place a point there, cutting the subpath that it was in in two, and
        similarly cut the line on which <var>end</var> finds itself short at <var>end</var> and place a point there, cutting the subpath that <em>it</em> was in in
        two, and then remove all line segments, joins, points, and subpaths that are between <var>start</var> and <var>end</var>.</p>

        <p>If <var>start</var> and <var>end</var> are the same point, then this
        results in just the line being cut in two and two points being inserted there, with nothing
        being removed, unless a join also happens to be at that point, in which case the join must
        be removed.</p>

       </dl>

     <li><p><i>Post-cut</i>: If <var>position</var> is greater than <var>subpath width</var>, then jump to the step labeled <i>convert</i>.<li><p>If <var>segment length</var> is greater than zero, let <var>positioned-at-on-dash</var> be false.<li><p>Increment <var>index</var> by one. If it is equal to the number of entries in
     the <var>styles</var> <a href=#dash-list id=line-styles:dash-list-8>dash list</a>, then let <var>index</var> be
     0.<li><p>Return to the step labeled <i>dash on</i>.</ol>

   <li>

    <p><i>Convert</i>: This is the step that converts the path to a new path that represents its
    stroke.</p>

    <p>Create a new <a href=#concept-path id=line-styles:concept-path-2>path</a> that describes the edge of the areas
    that would be covered if a straight line of length equal to the <var>styles</var>
    <code id=line-styles:dom-context-2d-linewidth-4><a href=#dom-context-2d-linewidth>lineWidth</a></code> was swept along each subpath in <var>path</var> while being kept at an angle such that the line is orthogonal to the path
    being swept, replacing each point with the end cap necessary to satisfy the <var>styles</var> <code id=line-styles:dom-context-2d-linecap-4><a href=#dom-context-2d-linecap>lineCap</a></code> attribute as
    described previously and elaborated below, and replacing each join with the join necessary to
    satisfy the <var>styles</var> <code id=line-styles:dom-context-2d-linejoin-5><a href=#dom-context-2d-linejoin>lineJoin</a></code>
    type, as defined below.</p>

    <p><strong>Caps</strong>: Each point has a flat edge perpendicular to the direction of the line
    coming out of it. This is them augmented according to the value of the <var>styles</var> <code id=line-styles:dom-context-2d-linecap-5><a href=#dom-context-2d-linecap>lineCap</a></code>. The "<code>butt"</code>" value means that no additional line cap is added. The "<code>round"</code>" value means that a semi-circle with the diameter equal to the <var>styles</var> <code id=line-styles:dom-context-2d-linewidth-5><a href=#dom-context-2d-linewidth>lineWidth</a></code> width must
    additionally be placed on to the line coming out of each point. The "<code>square"</code>" value means that a rectangle with the length of the <var>styles</var> <code id=line-styles:dom-context-2d-linewidth-6><a href=#dom-context-2d-linewidth>lineWidth</a></code> width and the
    width of half the <var>styles</var> <code id=line-styles:dom-context-2d-linewidth-7><a href=#dom-context-2d-linewidth>lineWidth</a></code> width, placed flat against the edge
    perpendicular to the direction of the line coming out of the point, must be added at each
    point.</p>

    <p>Points with no lines coming out of them must have two caps placed back-to-back as if it was
    really two points connected to each other by an infinitesimally short straight line in the
    direction of the point's <i>directionality</i> (as defined above).</p>

    <p><strong>Joins</strong>: In addition to the point where a join occurs, two additional points
    are relevant to each join, one for each line: the two corners found half the line width away
    from the join point, one perpendicular to each line, each on the side furthest from the other
    line.</p>

    <p>A triangle connecting these two opposite corners with a straight line, with the third point
    of the triangle being the join point, must be added at all joins. The <code id=line-styles:dom-context-2d-linejoin-6><a href=#dom-context-2d-linejoin>lineJoin</a></code> attribute controls whether anything else is
    rendered. The three aforementioned values have the following meanings:</p>

    <p>The "<code>bevel"</code>" value means that this is all that is rendered at
    joins.</p>

    <p>The "<code>round"</code>" value means that an arc connecting the two aforementioned
    corners of the join, abutting (and not overlapping) the aforementioned triangle, with the
    diameter equal to the line width and the origin at the point of the join, must be added at
    joins.</p>

    <p>The "<code>miter"</code>" value means that a second triangle must (if it can given
    the miter length) be added at the join, with one line being the line between the two
    aforementioned corners, abutting the first triangle, and the other two being continuations of
    the outside edges of the two joining lines, as long as required to intersect without going over
    the miter length.</p>

    <p>The miter length is the distance from the point where the join occurs to the intersection of
    the line edges on the outside of the join. The miter limit ratio is the maximum allowed ratio of
    the miter length to half the line width. If the miter length would cause the miter limit ratio
    (as set by the <var>style</var> <code id=line-styles:dom-context-2d-miterlimit-4><a href=#dom-context-2d-miterlimit>miterLimit</a></code> attribute) to be exceeded, this second
    triangle must not be added.</p> 



    <p>The subpaths in the newly created path must be oriented such that for any point, the number
    of times a half-infinite straight line drawn from that point crosses a subpath is even if and
    only if the number of times a half-infinite straight line drawn from that same point crosses a
    subpath going in one direction is equal to the number of times it crosses a subpath going in the
    other direction.</p>

   <li><p>Return the newly created path.</ol>



  


  <h6 id=text-styles>4.12.4.2.5 Text styles</h6>

  <dl class=domintro><dt><var>context</var> . <code id=text-styles:dom-context-2d-font><a href=#dom-context-2d-font>font</a></code> [ = <var>value</var> ]<dt><var>styles</var> . <code id=text-styles:dom-context-2d-font-2><a href=#dom-context-2d-font>font</a></code> [ = <var>value</var> ]<dd>

    <p>Returns the current font settings.</p>

    <p>Can be set, to change the font. The syntax is the same as for the CSS 'font' property; values
    that cannot be parsed as CSS font values are ignored.</p>

    <p>Relative keywords and lengths are computed relative to the font of the <code id=text-styles:the-canvas-element><a href=#the-canvas-element>canvas</a></code>
    element.</p>

   <dt><var>context</var> . <code id=text-styles:dom-context-2d-textalign><a href=#dom-context-2d-textalign>textAlign</a></code> [ = <var>value</var> ]<dt><var>styles</var> . <code id=text-styles:dom-context-2d-textalign-2><a href=#dom-context-2d-textalign>textAlign</a></code> [ = <var>value</var> ]<dd>

    <p>Returns the current text alignment settings.</p>

    <p>Can be set, to change the alignment. The possible values are and their meanings are given
    below. Other values are ignored. The default is "<code>start</code>".</p>

   <dt><var>context</var> . <code id=text-styles:dom-context-2d-textbaseline><a href=#dom-context-2d-textbaseline>textBaseline</a></code> [ = <var>value</var> ]<dt><var>styles</var> . <code id=text-styles:dom-context-2d-textbaseline-2><a href=#dom-context-2d-textbaseline>textBaseline</a></code> [ = <var>value</var> ]<dd>

    <p>Returns the current baseline alignment settings.</p>

    <p>Can be set, to change the baseline alignment. The possible values and their meanings are
    given below. Other values are ignored. The default is "<code id=text-styles:dom-context-2d-textbaseline-alphabetic><a href=#dom-context-2d-textbaseline-alphabetic>alphabetic</a></code>".</p>

   <dt><var>context</var> . <code id=text-styles:dom-context-2d-direction><a href=#dom-context-2d-direction>direction</a></code> [ = <var>value</var> ]<dt><var>styles</var> . <code id=text-styles:dom-context-2d-direction-2><a href=#dom-context-2d-direction>direction</a></code> [ = <var>value</var> ]<dd>

    <p>Returns the current directionality.</p>

    <p>Can be set, to change the directionality. The possible values and their meanings are given
    below. Other values are ignored. The default is "<code id=text-styles:dom-context-2d-direction-inherit><a href=#dom-context-2d-direction-inherit>inherit</a></code>".</p>

   </dl>

  

  <p>Objects that implement the <code id=text-styles:canvasdrawingstyles><a href=#canvasdrawingstyles>CanvasDrawingStyles</a></code> interface have attributes (defined
  in this section) that control how text is laid out (rasterised or outlined) by the object. Such
  objects can also have a <dfn id=font-style-source-object>font style source object</dfn>. For
  <code id=text-styles:canvasrenderingcontext2d><a href=#canvasrenderingcontext2d>CanvasRenderingContext2D</a></code> objects whose <a href=#concept-canvas-context-bitmap-mode id=text-styles:concept-canvas-context-bitmap-mode>context bitmap mode</a> is <a href=#concept-canvas-fixed id=text-styles:concept-canvas-fixed>fixed</a>, this is their <code id=text-styles:the-canvas-element-2><a href=#the-canvas-element>canvas</a></code> element; for other
  <code id=text-styles:canvasrenderingcontext2d-2><a href=#canvasrenderingcontext2d>CanvasRenderingContext2D</a></code> objects, if the <a id=text-styles:javascript-global-environment href=infrastructure.html#javascript-global-environment>JavaScript global environment</a>
  is a <a id=text-styles:document-environment href=webappapis.html#document-environment>document environment</a>, the object's <a href=#font-style-source-object id=text-styles:font-style-source-object>font style source object</a> is the
  <code id=text-styles:document><a href=dom.html#document>Document</a></code> object of the <a id=text-styles:active-document href=browsers.html#active-document>active document</a> of the <a id=text-styles:browsing-context href=browsers.html#browsing-context>browsing
  context</a> of the <code id=text-styles:window><a href=browsers.html#window>Window</a></code> object on which the interface object of the
  <code id=text-styles:canvasrenderingcontext2d-3><a href=#canvasrenderingcontext2d>CanvasRenderingContext2D</a></code> object is found; otherwise the <a id=text-styles:javascript-global-environment-2 href=infrastructure.html#javascript-global-environment>JavaScript global
  environment</a> is a <a id=text-styles:worker-environment href=webappapis.html#worker-environment>worker environment</a> and the <a href=#font-style-source-object id=text-styles:font-style-source-object-2>font style source
  object</a> is the worker. For <code id=text-styles:drawingstyle><a href=#drawingstyle>DrawingStyle</a></code> objects, it's the <a href=#styles-scope-object id=text-styles:styles-scope-object>styles scope
  object</a>.</p>

  <p>The <dfn id=dom-context-2d-font><code>font</code></dfn> IDL attribute, on setting, must
  be <a href=http://dev.w3.org/csswg/css-syntax/#parse-something-according-to-a-css-grammar id=text-styles:parse-something-according-to-a-css-grammar data-x-internal=parse-something-according-to-a-css-grammar>parsed as a CSS &lt;'font'> value</a> (but without supporting property-independent
  style sheet syntax like 'inherit'), and the resulting font must be assigned to the context, with
  the 'line-height' component forced to 'normal', with the 'font-size' component converted to CSS
  pixels, and with system fonts being computed to explicit values. If the new value is syntactically
  incorrect (including using property-independent style sheet syntax like 'inherit' or 'initial'),
  then it must be ignored, without assigning a new font value. <a href=references.html#refsCSS>[CSS]</a></p>

  <p>Font family names must be interpreted in the context of the <a href=#font-style-source-object id=text-styles:font-style-source-object-3>font style source
  object</a> when the font is to be used; any fonts embedded using <code>@font-face</code> or loaded using <code id=text-styles:fontface><a href=infrastructure.html#fontface>FontFace</a></code> objects that are visible to the
  <a href=#font-style-source-object id=text-styles:font-style-source-object-4>font style source object</a> must therefore be available once they are loaded. (Each <a href=#font-style-source-object id=text-styles:font-style-source-object-5>font style source
  object</a> has a <a id=text-styles:font-source href=http://dev.w3.org/csswg/css-font-loading/#font-source data-x-internal=font-source>font source</a>, which determines what fonts are available.) If a font
  is used before it is fully loaded, or if the <a href=#font-style-source-object id=text-styles:font-style-source-object-6>font style source object</a> does not have
  that font in scope at the time the font is to be used, then it must be treated as if it was an
  unknown font, falling back to another as described by the relevant CSS specifications. <a href=references.html#refsCSSFONTS>[CSSFONTS]</a> <a href=references.html#refsCSSFONTLOAD>[CSSFONTLOAD]</a></p>

  <p>On getting, the <code id=text-styles:dom-context-2d-font-3><a href=#dom-context-2d-font>font</a></code> attribute must return the <a href=infrastructure.html#serialising-a-css-value id=text-styles:serialising-a-css-value>serialised form</a> of the current font of the context (with
  no 'line-height' component). <a href=references.html#refsCSSOM>[CSSOM]</a></p>

  <div class=example>

   <p>For example, after the following statement:</p>

   <pre>context.font = 'italic 400 12px/2 Unknown Font, sans-serif';</pre>

   <p>...the expression <code>context.font</code> would evaluate to the string "<code>italic 12px "Unknown Font", sans-serif</code>". The "400"
   font-weight doesn't appear because that is the default value. The line-height doesn't appear
   because it is forced to "normal", the default value.</p>

  </div>

  <p>When the object implementing the <code id=text-styles:canvasdrawingstyles-2><a href=#canvasdrawingstyles>CanvasDrawingStyles</a></code> interface is created, the
  font of the context must be set to 10px sans-serif. When the 'font-size' component is set to
  lengths using percentages, 'em' or 'ex' units, or the 'larger' or 'smaller' keywords, these must
  be interpreted relative to the computed value of the 'font-size' property of the <a href=#font-style-source-object id=text-styles:font-style-source-object-7>font style
  source object</a> at the time that the attribute is set, if it is an element. When the
  'font-weight' component is set to the relative values 'bolder' and 'lighter', these must be
  interpreted relative to the computed value of the 'font-weight' property of the <a href=#font-style-source-object id=text-styles:font-style-source-object-8>font style
  source object</a> at the time that the attribute is set, if it is an element. If the computed
  values are undefined for a particular case (e.g. because the <a href=#font-style-source-object id=text-styles:font-style-source-object-9>font style source object</a>
  is not an element or is not <a id=text-styles:being-rendered href=rendering.html#being-rendered>being rendered</a>), then the relative keywords must be
  interpreted relative to the normal-weight 10px sans-serif default.</p>

  <p>The <dfn id=dom-context-2d-textalign><code>textAlign</code></dfn> IDL attribute, on
  getting, must return the current value. On setting, if the value is one of <code id=text-styles:dom-context-2d-textalign-start><a href=#dom-context-2d-textalign-start>start</a></code>, <code id=text-styles:dom-context-2d-textalign-end><a href=#dom-context-2d-textalign-end>end</a></code>, <code id=text-styles:dom-context-2d-textalign-left><a href=#dom-context-2d-textalign-left>left</a></code>, <code id=text-styles:dom-context-2d-textalign-right><a href=#dom-context-2d-textalign-right>right</a></code>, or <code id=text-styles:dom-context-2d-textalign-center><a href=#dom-context-2d-textalign-center>center</a></code>, then the value must be changed to the new
  value. Otherwise, the new value must be ignored. When the object implementing the
  <code id=text-styles:canvasdrawingstyles-3><a href=#canvasdrawingstyles>CanvasDrawingStyles</a></code> interface is created, the <code id=text-styles:dom-context-2d-textalign-3><a href=#dom-context-2d-textalign>textAlign</a></code> attribute must initially have the value <code id=text-styles:dom-context-2d-textalign-start-2><a href=#dom-context-2d-textalign-start>start</a></code>.</p>

  <p>The <dfn id=dom-context-2d-textbaseline><code>textBaseline</code></dfn> IDL attribute, on
  getting, must return the current value. On setting, if the value is one of <code id=text-styles:dom-context-2d-textbaseline-top><a href=#dom-context-2d-textbaseline-top>top</a></code>, <code id=text-styles:dom-context-2d-textbaseline-hanging><a href=#dom-context-2d-textbaseline-hanging>hanging</a></code>, <code id=text-styles:dom-context-2d-textbaseline-middle><a href=#dom-context-2d-textbaseline-middle>middle</a></code>, <code id=text-styles:dom-context-2d-textbaseline-alphabetic-2><a href=#dom-context-2d-textbaseline-alphabetic>alphabetic</a></code>, <code id=text-styles:dom-context-2d-textbaseline-ideographic><a href=#dom-context-2d-textbaseline-ideographic>ideographic</a></code>, or <code id=text-styles:dom-context-2d-textbaseline-bottom><a href=#dom-context-2d-textbaseline-bottom>bottom</a></code>, then the value must be changed to the
  new value. Otherwise, the new value must be ignored. When the object implementing the
  <code id=text-styles:canvasdrawingstyles-4><a href=#canvasdrawingstyles>CanvasDrawingStyles</a></code> interface is created, the <code id=text-styles:dom-context-2d-textbaseline-3><a href=#dom-context-2d-textbaseline>textBaseline</a></code> attribute must initially have the value
  <code id=text-styles:dom-context-2d-textbaseline-alphabetic-3><a href=#dom-context-2d-textbaseline-alphabetic>alphabetic</a></code>.</p>

  <p>The <dfn id=dom-context-2d-direction><code>direction</code></dfn> IDL attribute, on
  getting, must return the current value. On setting, if the value is one of "<code id=text-styles:dom-context-2d-direction-ltr><a href=#dom-context-2d-direction-ltr>ltr</a></code>", "<code id=text-styles:dom-context-2d-direction-rtl><a href=#dom-context-2d-direction-rtl>rtl</a></code>",  or "<code id=text-styles:dom-context-2d-direction-inherit-2><a href=#dom-context-2d-direction-inherit>inherit</a></code>", then the value must be changed to the
  new value. Otherwise, the new value must be ignored. When the object implementing the
  <code id=text-styles:canvasdrawingstyles-5><a href=#canvasdrawingstyles>CanvasDrawingStyles</a></code> interface is created, the <code id=text-styles:dom-context-2d-direction-3><a href=#dom-context-2d-direction>direction</a></code> attribute must initially have the value "<code id=text-styles:dom-context-2d-direction-inherit-3><a href=#dom-context-2d-direction-inherit>inherit</a></code>".</p>

  

  <p>The <code id=text-styles:dom-context-2d-textalign-4><a href=#dom-context-2d-textalign>textAlign</a></code> attribute's allowed keywords are
  as follows:</p>

  <dl><dt><dfn id=dom-context-2d-textalign-start><code>start</code></dfn>
   <dd><p>Align to the start edge of the text (left side in left-to-right text, right side in
   right-to-left text).<dt><dfn id=dom-context-2d-textalign-end><code>end</code></dfn>
   <dd><p>Align to the end edge of the text (right side in left-to-right text, left side in
   right-to-left text).<dt><dfn id=dom-context-2d-textalign-left><code>left</code></dfn>
   <dd><p>Align to the left.<dt><dfn id=dom-context-2d-textalign-right><code>right</code></dfn>
   <dd><p>Align to the right.<dt><dfn id=dom-context-2d-textalign-center><code>center</code></dfn>
   <dd><p>Align to the center.</dl>

  <p>The <code id=text-styles:dom-context-2d-textbaseline-4><a href=#dom-context-2d-textbaseline>textBaseline</a></code>
  attribute's allowed keywords correspond to alignment points in the
  font:</p>

  <p><img src=https://images.whatwg.org/baselines.png width=738 alt="The top of the em square is roughly at the top of the glyphs in a font, the hanging baseline is where some glyphs like आ are anchored, the middle is half-way between the top of the em square and the bottom of the em square, the alphabetic baseline is where characters like Á, ÿ, f, and Ω are anchored, the ideographic baseline is where glyphs like 私 and 達 are anchored, and the bottom of the em square is roughly at the bottom of the glyphs in a font. The top and bottom of the bounding box can be far from these baselines, due to glyphs extending far outside the em square." height=300></p>

  <p>The keywords map to these alignment points as follows:</p>

  <dl><dt><dfn id=dom-context-2d-textbaseline-top><code>top</code></dfn>
   <dd>The top of the em square<dt><dfn id=dom-context-2d-textbaseline-hanging><code>hanging</code></dfn>
   <dd>The hanging baseline<dt><dfn id=dom-context-2d-textbaseline-middle><code>middle</code></dfn>
   <dd>The middle of the em square<dt><dfn id=dom-context-2d-textbaseline-alphabetic><code>alphabetic</code></dfn>
   <dd>The alphabetic baseline<dt><dfn id=dom-context-2d-textbaseline-ideographic><code>ideographic</code></dfn>
   <dd>The ideographic baseline<dt><dfn id=dom-context-2d-textbaseline-bottom><code>bottom</code></dfn>
   <dd>The bottom of the em square</dl>

  <p>The <code id=text-styles:dom-context-2d-direction-4><a href=#dom-context-2d-direction>direction</a></code> attribute's allowed keywords are
  as follows:</p>

  <dl><dt><dfn id=dom-context-2d-direction-ltr><code>ltr</code></dfn>

   <dd><p>Treat input to the <a href=#text-preparation-algorithm id=text-styles:text-preparation-algorithm>text preparation algorithm</a> as left-to-right text.<dt><dfn id=dom-context-2d-direction-rtl><code>rtl</code></dfn>

   <dd><p>Treat input to the <a href=#text-preparation-algorithm id=text-styles:text-preparation-algorithm-2>text preparation algorithm</a> as right-to-left text.<dt><dfn id=dom-context-2d-direction-inherit><code>inherit</code></dfn>

   <dd><p>Default to the directionality of the <code id=text-styles:the-canvas-element-3><a href=#the-canvas-element>canvas</a></code> element or <code id=text-styles:document-2><a href=dom.html#document>Document</a></code>
   as appropriate.</dl>

  <p>The <dfn id=text-preparation-algorithm>text preparation algorithm</dfn> is as follows. It takes as input a string <var>text</var>, a <code id=text-styles:canvasdrawingstyles-6><a href=#canvasdrawingstyles>CanvasDrawingStyles</a></code> object <var>target</var>, and an
  optional length <var>maxWidth</var>. It returns an array of glyph shapes, each positioned
  on a common coordinate space, a <var>physical alignment</var> whose value is one of
  <i>left</i>, <i>right</i>, and <i>center</i>, and an inline box. (Most callers of this
  algorithm ignore the <var>physical alignment</var> and the inline box.)</p>

  <ol><li><p>If <var>maxWidth</var> was provided but is less than or equal to zero, return an
   empty array.<li><p>Replace all the <a href=infrastructure.html#space-character id=text-styles:space-character>space characters</a> in <var>text</var> with U+0020 SPACE characters.<li><p>Let <var>font</var> be the current font of <var>target</var>, as given
   by that object's <code id=text-styles:dom-context-2d-font-4><a href=#dom-context-2d-font>font</a></code> attribute.<li>

    <p>Apply the appropriate step from the following list to determine the value of <var>direction</var>:</p>

    <dl class=switch><dt>If the <var>target</var> object's <code id=text-styles:dom-context-2d-direction-5><a href=#dom-context-2d-direction>direction</a></code> attribute has the value "<code id=text-styles:dom-context-2d-direction-ltr-2><a href=#dom-context-2d-direction-ltr>ltr</a></code>"<dd>Let <var>direction</var> be '<a href=dom.html#concept-ltr id=text-styles:concept-ltr>ltr</a>'.<dt>If the <var>target</var> object's <code id=text-styles:dom-context-2d-direction-6><a href=#dom-context-2d-direction>direction</a></code> attribute has the value "<code id=text-styles:dom-context-2d-direction-rtl-2><a href=#dom-context-2d-direction-rtl>rtl</a></code>"<dd>Let <var>direction</var> be '<a href=dom.html#concept-rtl id=text-styles:concept-rtl>rtl</a>'.<dt>If the <var>target</var> object's <a href=#font-style-source-object id=text-styles:font-style-source-object-10>font style source object</a> is an
     element<dd>Let <var>direction</var> be <a id=text-styles:the-directionality href=dom.html#the-directionality>the directionality</a> of the <var>target</var> object's <a href=#font-style-source-object id=text-styles:font-style-source-object-11>font style source object</a>.<dt>If the <var>target</var> object's <a href=#font-style-source-object id=text-styles:font-style-source-object-12>font style source object</a> is a
     <code id=text-styles:document-3><a href=dom.html#document>Document</a></code> and that <code id=text-styles:document-4><a href=dom.html#document>Document</a></code> has a root element child<dd>Let <var>direction</var> be <a id=text-styles:the-directionality-2 href=dom.html#the-directionality>the directionality</a> of the <var>target</var> object's <a href=#font-style-source-object id=text-styles:font-style-source-object-13>font style source object</a>'s root element child.<dt>Otherwise<dd>Let <var>direction</var> be '<a href=dom.html#concept-ltr id=text-styles:concept-ltr-2>ltr</a>'.</dl>

   <li><p>Form a hypothetical infinitely-wide CSS line box containing a single inline box containing
   the text <var>text</var>, with all the properties at their initial values except the
   'font' property of the inline box set to <var>font</var>, the 'direction' property of
   the inline box set to <var>direction</var>, and the 'white-space' property set to 'pre'.
   <a href=references.html#refsCSS>[CSS]</a><li><p>If <var>maxWidth</var> was provided and the hypothetical width of the inline box
   in the hypothetical line box is greater than <var>maxWidth</var> CSS pixels, then change
   <var>font</var> to have a more condensed font (if one is available or if a reasonably
   readable one can be synthesized by applying a horizontal scale factor to the font) or a smaller
   font, and return to the previous step.<li>

    <p>The <var>anchor point</var> is a point on the inline box, and the <var>physical alignment</var> is one of the values <i>left</i>, <i>right</i>, and <i>center</i>. These variables are determined by the <code id=text-styles:dom-context-2d-textalign-5><a href=#dom-context-2d-textalign>textAlign</a></code> and <code id=text-styles:dom-context-2d-textbaseline-5><a href=#dom-context-2d-textbaseline>textBaseline</a></code> values as follows:</p>

    <p>Horizontal position:</p>

    <dl><dt>If <code id=text-styles:dom-context-2d-textalign-6><a href=#dom-context-2d-textalign>textAlign</a></code> is <code id=text-styles:dom-context-2d-textalign-left-2><a href=#dom-context-2d-textalign-left>left</a></code><dt>If <code id=text-styles:dom-context-2d-textalign-7><a href=#dom-context-2d-textalign>textAlign</a></code> is <code id=text-styles:dom-context-2d-textalign-start-3><a href=#dom-context-2d-textalign-start>start</a></code> and <var>direction</var> is
     'ltr'<dt>If <code id=text-styles:dom-context-2d-textalign-8><a href=#dom-context-2d-textalign>textAlign</a></code> is <code id=text-styles:dom-context-2d-textalign-end-2><a href=#dom-context-2d-textalign-end>end</a></code> and <var>direction</var> is 'rtl'<dd>Let the <var>anchor point</var>'s horizontal position be the left edge of the
     inline box, and let <var>physical alignment</var> be <i>left</i>.<dt>If <code id=text-styles:dom-context-2d-textalign-9><a href=#dom-context-2d-textalign>textAlign</a></code> is <code id=text-styles:dom-context-2d-textalign-right-2><a href=#dom-context-2d-textalign-right>right</a></code><dt>If <code id=text-styles:dom-context-2d-textalign-10><a href=#dom-context-2d-textalign>textAlign</a></code> is <code id=text-styles:dom-context-2d-textalign-end-3><a href=#dom-context-2d-textalign-end>end</a></code> and <var>direction</var> is 'ltr'<dt>If <code id=text-styles:dom-context-2d-textalign-11><a href=#dom-context-2d-textalign>textAlign</a></code> is <code id=text-styles:dom-context-2d-textalign-start-4><a href=#dom-context-2d-textalign-start>start</a></code> and <var>direction</var> is
     'rtl'<dd>Let the <var>anchor point</var>'s horizontal position be the right edge of the
     inline box, and let <var>physical alignment</var> be <i>right</i>.<dt>If <code id=text-styles:dom-context-2d-textalign-12><a href=#dom-context-2d-textalign>textAlign</a></code> is <code id=text-styles:dom-context-2d-textalign-center-2><a href=#dom-context-2d-textalign-center>center</a></code><dd>Let the <var>anchor point</var>'s horizontal position be half way between the left
     and right edges of the inline box, and let <var>physical alignment</var> be <i>center</i>.</dl>

    <p>Vertical position:</p>

    <dl><dt>If <code id=text-styles:dom-context-2d-textbaseline-6><a href=#dom-context-2d-textbaseline>textBaseline</a></code> is <code id=text-styles:dom-context-2d-textbaseline-top-2><a href=#dom-context-2d-textbaseline-top>top</a></code><dd>Let the <var>anchor point</var>'s vertical position be the top of the em box of
     the first available font of the inline box.<dt>If <code id=text-styles:dom-context-2d-textbaseline-7><a href=#dom-context-2d-textbaseline>textBaseline</a></code> is <code id=text-styles:dom-context-2d-textbaseline-hanging-2><a href=#dom-context-2d-textbaseline-hanging>hanging</a></code><dd>Let the <var>anchor point</var>'s vertical position be the hanging baseline of the
     first available font of the inline box.<dt>If <code id=text-styles:dom-context-2d-textbaseline-8><a href=#dom-context-2d-textbaseline>textBaseline</a></code> is <code id=text-styles:dom-context-2d-textbaseline-middle-2><a href=#dom-context-2d-textbaseline-middle>middle</a></code><dd>Let the <var>anchor point</var>'s vertical position be half way between the bottom
     and the top of the em box of the first available font of the inline box.<dt>If <code id=text-styles:dom-context-2d-textbaseline-9><a href=#dom-context-2d-textbaseline>textBaseline</a></code> is <code id=text-styles:dom-context-2d-textbaseline-alphabetic-4><a href=#dom-context-2d-textbaseline-alphabetic>alphabetic</a></code><dd>Let the <var>anchor point</var>'s vertical position be the alphabetic baseline of
     the first available font of the inline box.<dt>If <code id=text-styles:dom-context-2d-textbaseline-10><a href=#dom-context-2d-textbaseline>textBaseline</a></code> is <code id=text-styles:dom-context-2d-textbaseline-ideographic-2><a href=#dom-context-2d-textbaseline-ideographic>ideographic</a></code><dd>Let the <var>anchor point</var>'s vertical position be the ideographic baseline of
     the first available font of the inline box.<dt>If <code id=text-styles:dom-context-2d-textbaseline-11><a href=#dom-context-2d-textbaseline>textBaseline</a></code> is <code id=text-styles:dom-context-2d-textbaseline-bottom-2><a href=#dom-context-2d-textbaseline-bottom>bottom</a></code><dd>Let the <var>anchor point</var>'s vertical position be the bottom of the em box of
     the first available font of the inline box.</dl>

   <li>

    <p>Let <var>result</var> be an array constructed by iterating over each glyph in the
    inline box from left to right (if any), adding to the array, for each glyph, the shape of the
    glyph as it is in the inline box, positioned on a coordinate space using CSS pixels with its
    origin is at the <var>anchor point</var>.</p>

   <li><p>Return <var>result</var>, <var>physical alignment</var>, and the inline
   box.</ol>


  <h6 id=building-paths>4.12.4.2.6 Building paths</h6>

  <p>Each object implementing the <code id=building-paths:canvaspathmethods><a href=#canvaspathmethods>CanvasPathMethods</a></code> interface has a <a href=#concept-path id=building-paths:concept-path>path</a>. A <dfn id=concept-path>path</dfn> has a list of zero or
  more subpaths. Each subpath consists of a list of one or more points, connected by straight or
  curved <dfn id=line-segments>line segments</dfn>, and a flag indicating whether the subpath is closed or not. A
  closed subpath is one where the last point of the subpath is connected to the first point of the
  subpath by a straight line. Subpaths with only one point are ignored when painting the path.</p>

  <p><a href=#concept-path id=building-paths:concept-path-2>Paths</a> have a <dfn id=need-new-subpath>need new subpath</dfn> flag. When this
  flag is set, certain APIs create a new subpath rather than extending the previous one. When a
  <a href=#concept-path id=building-paths:concept-path-3>path</a> is created, its <a href=#need-new-subpath id=building-paths:need-new-subpath>need new subpath</a> flag must be
  set.</p>

  <p>When an object implementing the <code id=building-paths:canvaspathmethods-2><a href=#canvaspathmethods>CanvasPathMethods</a></code> interface is created, its <a href=#concept-path id=building-paths:concept-path-4>path</a> must be initialised to zero subpaths.</p>

  <dl class=domintro><dt><var>context</var> . <code id=building-paths:dom-context-2d-moveto><a href=#dom-context-2d-moveto>moveTo</a></code>(<var>x</var>, <var>y</var>)<dt><var>path</var> . <code id=building-paths:dom-context-2d-moveto-2><a href=#dom-context-2d-moveto>moveTo</a></code>(<var>x</var>, <var>y</var>)<dd>

    <p>Creates a new subpath with the given point.</p>

   <dt><var>context</var> . <code id=building-paths:dom-context-2d-closepath><a href=#dom-context-2d-closepath>closePath</a></code>()<dt><var>path</var> . <code id=building-paths:dom-context-2d-closepath-2><a href=#dom-context-2d-closepath>closePath</a></code>()<dd>

    <p>Marks the current subpath as closed, and starts a new subpath with a point the same as the
    start and end of the newly closed subpath.</p>

   <dt><var>context</var> . <code id=building-paths:dom-context-2d-lineto><a href=#dom-context-2d-lineto>lineTo</a></code>(<var>x</var>, <var>y</var>)<dt><var>path</var> . <code id=building-paths:dom-context-2d-lineto-2><a href=#dom-context-2d-lineto>lineTo</a></code>(<var>x</var>, <var>y</var>)<dd>

    <p>Adds the given point to the current subpath, connected to the previous one by a straight
    line.</p>

   <dt><var>context</var> . <code id=building-paths:dom-context-2d-quadraticcurveto><a href=#dom-context-2d-quadraticcurveto>quadraticCurveTo</a></code>(<var>cpx</var>, <var>cpy</var>, <var>x</var>, <var>y</var>)<dt><var>path</var> . <code id=building-paths:dom-context-2d-quadraticcurveto-2><a href=#dom-context-2d-quadraticcurveto>quadraticCurveTo</a></code>(<var>cpx</var>, <var>cpy</var>, <var>x</var>, <var>y</var>)<dd>

    <p>Adds the given point to the current subpath, connected to the previous one by a quadratic
    Bézier curve with the given control point.</p>

   <dt><var>context</var> . <code id=building-paths:dom-context-2d-beziercurveto><a href=#dom-context-2d-beziercurveto>bezierCurveTo</a></code>(<var>cp1x</var>, <var>cp1y</var>, <var>cp2x</var>, <var>cp2y</var>, <var>x</var>, <var>y</var>)<dt><var>path</var> . <code id=building-paths:dom-context-2d-beziercurveto-2><a href=#dom-context-2d-beziercurveto>bezierCurveTo</a></code>(<var>cp1x</var>, <var>cp1y</var>, <var>cp2x</var>, <var>cp2y</var>, <var>x</var>, <var>y</var>)<dd>

    <p>Adds the given point to the current subpath, connected to the previous one by a cubic
    Bézier curve with the given control points.</p>

   <dt><var>context</var> . <code id=building-paths:dom-context-2d-arcto><a href=#dom-context-2d-arcto>arcTo</a></code>(<var>x1</var>, <var>y1</var>, <var>x2</var>, <var>y2</var>, <var>radiusX</var> [, <var>radiusY</var>, <var>rotation</var> ] )<dt><var>path</var> . <code id=building-paths:dom-context-2d-arcto-2><a href=#dom-context-2d-arcto>arcTo</a></code>(<var>x1</var>, <var>y1</var>, <var>x2</var>, <var>y2</var>, <var>radiusX</var> [, <var>radiusY</var>, <var>rotation</var> ] )<dd>

    <p>Adds an arc with the given control points and radius to the current subpath, connected to the
    previous point by a straight line.</p>

    <p>If two radii are provided, the first controls the width of the arc's ellipse, and the second
    controls the height. If only one is provided, or if they are the same, the arc is from a circle.
    In the case of an ellipse, the rotation argument controls the clockwise inclination of the
    ellipse relative to the x-axis.</p>

    <p>Throws an <code id=building-paths:indexsizeerror><a href=infrastructure.html#indexsizeerror>IndexSizeError</a></code> exception if the given radius is negative.</p>

    <figure class=diagrams>
     
     <img width=357 src=https://images.whatwg.org/arcTo1.png height=254 alt="">
     <img width=468 src=https://images.whatwg.org/arcTo2.png height=310 alt="">
     <img width=513 src=https://images.whatwg.org/arcTo3.png height=233 alt="">
    </figure>



   <dt><var>context</var> . <code id=building-paths:dom-context-2d-arc><a href=#dom-context-2d-arc>arc</a></code>(<var>x</var>, <var>y</var>, <var>radius</var>, <var>startAngle</var>, <var>endAngle</var> [, <var>anticlockwise</var> ] )<dt><var>path</var> . <code id=building-paths:dom-context-2d-arc-2><a href=#dom-context-2d-arc>arc</a></code>(<var>x</var>, <var>y</var>, <var>radius</var>, <var>startAngle</var>, <var>endAngle</var> [, <var>anticlockwise</var> ] )<dd>

    <p>Adds points to the subpath such that the arc described by the circumference of the circle
    described by the arguments, starting at the given start angle and ending at the given end angle,
    going in the given direction (defaulting to clockwise), is added to the path, connected to the
    previous point by a straight line.</p>

    <p>Throws an <code id=building-paths:indexsizeerror-2><a href=infrastructure.html#indexsizeerror>IndexSizeError</a></code> exception if the given radius is negative.</p>

    <figure class=diagrams>
     
     <img width=590 src=https://images.whatwg.org/arc1.png height=255 alt="">
    </figure>



   <dt><var>context</var> . <code id=building-paths:dom-context-2d-ellipse><a href=#dom-context-2d-ellipse>ellipse</a></code>(<var>x</var>, <var>y</var>, <var>radiusX</var>, <var>radiusY</var>, <var>rotation</var>, <var>startAngle</var>, <var>endAngle</var> [, <var>anticlockwise</var>] )<dt><var>path</var> . <code id=building-paths:dom-context-2d-ellipse-2><a href=#dom-context-2d-ellipse>ellipse</a></code>(<var>x</var>, <var>y</var>, <var>radiusX</var>, <var>radiusY</var>, <var>rotation</var>, <var>startAngle</var>, <var>endAngle</var> [, <var>anticlockwise</var>] )<dd>

    <p>Adds points to the subpath such that the arc described by the circumference of the ellipse
    described by the arguments, starting at the given start angle and ending at the given end angle,
    going in the given direction (defaulting to clockwise), is added to the path, connected to the
    previous point by a straight line.</p>

    <p>Throws an <code id=building-paths:indexsizeerror-3><a href=infrastructure.html#indexsizeerror>IndexSizeError</a></code> exception if the given radius is negative.</p>

   <dt><var>context</var> . <code id=building-paths:dom-context-2d-rect><a href=#dom-context-2d-rect>rect</a></code>(<var>x</var>, <var>y</var>, <var>w</var>, <var>h</var>)<dt><var>path</var> . <code id=building-paths:dom-context-2d-rect-2><a href=#dom-context-2d-rect>rect</a></code>(<var>x</var>, <var>y</var>, <var>w</var>, <var>h</var>)<dd>

    <p>Adds a new closed subpath to the path, representing the given rectangle.</p>

   </dl>

  

  <p>The following methods allow authors to manipulate the <a href=#concept-path id=building-paths:concept-path-5>paths</a>
  of objects implementing the <code id=building-paths:canvaspathmethods-3><a href=#canvaspathmethods>CanvasPathMethods</a></code> interface.</p>

  <p>For <code id=building-paths:canvasrenderingcontext2d><a href=#canvasrenderingcontext2d>CanvasRenderingContext2D</a></code> objects, the points passed to the methods, and the
  resulting lines added to <a href=#current-default-path id=building-paths:current-default-path>current default path</a> by these methods, must be transformed
  according to the <a href=#transformations id=building-paths:transformations>current transformation matrix</a>
  before being added to the path.</p>


  <p>The <dfn id=dom-context-2d-moveto><code>moveTo(<var>x</var>, <var>y</var>)</code></dfn> method must create a new subpath with the specified point as its
  first (and only) point.</p>

  <p>When the user agent is to <dfn id=ensure-there-is-a-subpath>ensure there is a subpath</dfn> for a coordinate (<var>x</var>, <var>y</var>) on a <a href=#concept-path id=building-paths:concept-path-6>path</a>, the user
  agent must check to see if the <a href=#concept-path id=building-paths:concept-path-7>path</a> has its <a href=#need-new-subpath id=building-paths:need-new-subpath-2>need new
  subpath</a> flag set. If it does, the user agent must create a new subpath with the point (<var>x</var>, <var>y</var>) as its first (and only) point, as if the <code id=building-paths:dom-context-2d-moveto-3><a href=#dom-context-2d-moveto>moveTo()</a></code> method had been called, and must then unset the
  <a href=#concept-path id=building-paths:concept-path-8>path</a>'s <a href=#need-new-subpath id=building-paths:need-new-subpath-3>need new subpath</a> flag.</p>


  <p>The <dfn id=dom-context-2d-closepath><code>closePath()</code></dfn> method must do nothing
  if the object's path has no subpaths. Otherwise, it must mark the last subpath as closed, create a
  new subpath whose first point is the same as the previous subpath's first point, and finally add
  this new subpath to the path.</p>

  <p class=note>If the last subpath had more than one point in its list of points, then this is
  equivalent to adding a straight line connecting the last point back to the first point, thus
  "closing" the shape, and then repeating the last (possibly implied) <code id=building-paths:dom-context-2d-moveto-4><a href=#dom-context-2d-moveto>moveTo()</a></code> call.</p>


  <p>New points and the lines connecting them are added to subpaths using the methods described
  below. In all cases, the methods only modify the last subpath in the object's path.</p>


  <p>The <dfn id=dom-context-2d-lineto><code>lineTo(<var>x</var>, <var>y</var>)</code></dfn> method must <a href=#ensure-there-is-a-subpath id=building-paths:ensure-there-is-a-subpath>ensure there is a subpath</a> for <span>(<var>x</var>, <var>y</var>)</span> if the object's path has no
  subpaths. Otherwise, it must connect the last point in the subpath to the given point (<var>x</var>, <var>y</var>) using a straight line, and must then add the given point
  (<var>x</var>, <var>y</var>) to the subpath.</p>


  <p>The <dfn id=dom-context-2d-quadraticcurveto><code>quadraticCurveTo(<var>cpx</var>, <var>cpy</var>, <var>x</var>, <var>y</var>)</code></dfn> method must <a href=#ensure-there-is-a-subpath id=building-paths:ensure-there-is-a-subpath-2>ensure there is a subpath</a> for <span>(<var>cpx</var>, <var>cpy</var>)</span>, and then must connect the last
  point in the subpath to the given point (<var>x</var>, <var>y</var>) using a
  quadratic Bézier curve with control point (<var>cpx</var>, <var>cpy</var>), and must then add the given point (<var>x</var>, <var>y</var>) to the subpath. <a href=references.html#refsBEZIER>[BEZIER]</a></p>


  <p>The <dfn id=dom-context-2d-beziercurveto><code>bezierCurveTo(<var>cp1x</var>,
  <var>cp1y</var>, <var>cp2x</var>, <var>cp2y</var>, <var>x</var>, <var>y</var>)</code></dfn> method must <a href=#ensure-there-is-a-subpath id=building-paths:ensure-there-is-a-subpath-3>ensure there is a
  subpath</a> for <span>(<var>cp1x</var>, <var>cp1y</var>)</span>, and
  then must connect the last point in the subpath to the given point (<var>x</var>, <var>y</var>) using a cubic Bézier curve with control points (<var>cp1x</var>,
  <var>cp1y</var>) and (<var>cp2x</var>, <var>cp2y</var>). Then, it must
  add the point (<var>x</var>, <var>y</var>) to the subpath. <a href=references.html#refsBEZIER>[BEZIER]</a></p>

  <hr>

  <p>The <dfn id=dom-context-2d-arcto><code>arcTo(<var>x1</var>, <var>y1</var>, <var>x2</var>, <var>y2</var>, <var>radiusX</var>,
  <var>radiusY</var>, <var>rotation</var>)</code></dfn> method must first
  <a href=#ensure-there-is-a-subpath id=building-paths:ensure-there-is-a-subpath-4>ensure there is a subpath</a> for <span>(<var>x1</var>, <var>y1</var>)</span>. Then, the behaviour depends on the arguments and the last point in the
  subpath, as described below.</p>

  <p>Negative values for <var>radiusX</var> or <var>radiusY</var> must cause the
  implementation to throw an <code id=building-paths:indexsizeerror-4><a href=infrastructure.html#indexsizeerror>IndexSizeError</a></code> exception. If <var>radiusY</var>
  is omitted, user agents must act as if it had the same value as <var>radiusX</var>.</p>

  <p>Let the point (<var>x0</var>, <var>y0</var>) be the last point in the
  subpath, transformed by the inverse of the <a href=#transformations id=building-paths:transformations-2>current
  transformation matrix</a> (so that it is in the same coordinate system as the points passed to
  the method).</p>

  <p>If the point (<var>x0</var>, <var>y0</var>) is equal to the point (<var>x1</var>, <var>y1</var>), or if the point (<var>x1</var>, <var>y1</var>) is equal to the point (<var>x2</var>, <var>y2</var>), or if
  both <var>radiusX</var> and <var>radiusY</var> are zero, then the method must
  add the point (<var>x1</var>, <var>y1</var>) to the subpath, and connect that
  point to the previous point (<var>x0</var>, <var>y0</var>) by a straight
  line.</p>

  <p>Otherwise, if the points (<var>x0</var>, <var>y0</var>), (<var>x1</var>, <var>y1</var>), and (<var>x2</var>, <var>y2</var>)
  all lie on a single straight line, then the method must add the point (<var>x1</var>,
  <var>y1</var>) to the subpath, and connect that point to the previous point (<var>x0</var>, <var>y0</var>) by a straight line.</p>

  <p>Otherwise, let <var>The Arc</var> be the shortest arc given by circumference of the
  ellipse that has radius <var>radiusX</var> on the major axis and radius <var>radiusY</var> on the minor axis, and whose semi-major axis is rotated <var>rotation</var> radians clockwise from the positive x-axis, and that has one point tangent
  to the half-infinite line that crosses the point (<var>x0</var>, <var>y0</var>)
  and ends at the point (<var>x1</var>, <var>y1</var>), and that has a different
  point tangent to the half-infinite line that ends at the point (<var>x1</var>, <var>y1</var>) and crosses the point (<var>x2</var>, <var>y2</var>). The
  points at which this ellipse touches these two lines are called the start and end tangent points
  respectively. The method must connect the point (<var>x0</var>, <var>y0</var>)
  to the start tangent point by a straight line, adding the start tangent point to the subpath, and
  then must connect the start tangent point to the end tangent point by <var>The Arc</var>,
  adding the end tangent point to the subpath.</p>

  <hr>

  <p>The <dfn id=dom-context-2d-arc><code>arc(<var>x</var>, <var>y</var>,
  <var>radius</var>, <var>startAngle</var>, <var>endAngle</var>, <var>anticlockwise</var>)</code></dfn> and <dfn id=dom-context-2d-ellipse><code>ellipse(<var>x</var>, <var>y</var>, <var>radiusX</var>, <var>radiusY</var>, <var>rotation</var>, <var>startAngle</var>, <var>endAngle</var>, <var>anticlockwise</var>)</code></dfn> methods draw arcs.</p>

  <p>The <code id=building-paths:dom-context-2d-arc-3><a href=#dom-context-2d-arc>arc()</a></code> method is equivalent to the <code id=building-paths:dom-context-2d-ellipse-3><a href=#dom-context-2d-ellipse>ellipse()</a></code> method in the case where the two radii are equal.
  When the <code id=building-paths:dom-context-2d-arc-4><a href=#dom-context-2d-arc>arc()</a></code> method is invoked, it must act as if the
  <code id=building-paths:dom-context-2d-ellipse-4><a href=#dom-context-2d-ellipse>ellipse()</a></code> method had been invoked with the <var>radiusX</var> and <var>radiusY</var> arguments set to the value of the <var>radius</var> argument, the <var>rotation</var> argument set to zero, and the
  other arguments set to the same values as their identically named arguments on the <code id=building-paths:dom-context-2d-arc-5><a href=#dom-context-2d-arc>arc()</a></code> method.</p>

  <p>When the <code id=building-paths:dom-context-2d-ellipse-5><a href=#dom-context-2d-ellipse>ellipse()</a></code> method is invoked, it must
  proceed as follows. First, if the object's path has any subpaths, then the method must add a
  straight line from the last point in the subpath to the start point of the arc. Then, it must add
  the start and end points of the arc to the subpath, and connect them with an arc. The arc and its
  start and end points are defined as follows:</p>

  <p>Consider an ellipse that has its origin at (<var>x</var>, <var>y</var>), that
  has a major-axis radius <var>radiusX</var> and a minor-axis radius <var>radiusY</var>, and that is rotated about its origin such that its semi-major axis is
  inclined <var>rotation</var> radians clockwise from the x-axis.</p>

  <p>If the <var>anticlockwise</var> argument is false and <span><var>endAngle</var>-<var>startAngle</var></span> is equal to or greater than <span>2π</span>, or, if the <var>anticlockwise</var> argument is <em>true</em>
  and <span><var>startAngle</var>-<var>endAngle</var></span> is equal
  to or greater than <span>2π</span>, then the arc is the whole circumference of this
  ellipse, and the point at <var>startAngle</var> along this circle's circumference,
  measured in radians clockwise from the ellipse's semi-major axis, acts as both the start point and
  the end point.</p>

  <p>Otherwise, the points at <var>startAngle</var> and <var>endAngle</var>
  along this circle's circumference, measured in radians clockwise from the ellipse's semi-major
  axis, are the start and end points respectively, and the arc is the path along the circumference
  of this ellipse from the start point to the end point, going anti-clockwise if the <var>anticlockwise</var> argument is true, and clockwise otherwise. Since the points are on
  the ellipse, as opposed to being simply angles from zero, the arc can never cover an angle greater
  than <span>2π</span> radians.</p>

  <p class=note>Even if the arc covers the entire circumference of the ellipse and there are no
  other points in the subpath, the path is not closed unless the <code id=building-paths:dom-context-2d-closepath-3><a href=#dom-context-2d-closepath>closePath()</a></code> method is appropriately invoked.</p>

  <p>Negative values for <var>radiusX</var> or <var>radiusY</var> must cause the
  implementation to throw an <code id=building-paths:indexsizeerror-5><a href=infrastructure.html#indexsizeerror>IndexSizeError</a></code> exception.</p>

  <hr>

  <p>The <dfn id=dom-context-2d-rect><code>rect(<var>x</var>, <var>y</var>, <var>w</var>, <var>h</var>)</code></dfn> method must create
  a new subpath containing just the four points (<var>x</var>, <var>y</var>),
  (<var>x</var>+<var>w</var>, <var>y</var>), (<var>x</var>+<var>w</var>, <var>y</var>+<var>h</var>), (<var>x</var>, <var>y</var>+<var>h</var>), in that order, with those four
  points connected by straight lines, and must then mark the subpath as closed. It must then create
  a new subpath with the point (<var>x</var>, <var>y</var>) as the only point in
  the subpath.</p>

  

  



  <h6 id=path2d-objects>4.12.4.2.7 <code id=path2d-objects:path2d><a href=#path2d>Path2D</a></code> objects</h6>

  <p><code id=path2d-objects:path2d-2><a href=#path2d>Path2D</a></code> objects can be used to declare paths that are then later used on
  <code id=path2d-objects:canvasrenderingcontext2d><a href=#canvasrenderingcontext2d>CanvasRenderingContext2D</a></code> objects. In addition to many of the APIs described in
  earlier sections, <code id=path2d-objects:path2d-3><a href=#path2d>Path2D</a></code> objects have methods to combine paths, and to add text to
  paths.</p>

  <dl class=domintro><dt><var>path</var> = new <code id=path2d-objects:dom-path2d><a href=#dom-path2d>Path2D</a></code>()<dd>

    <p>Creates a new empty <code id=path2d-objects:path2d-4><a href=#path2d>Path2D</a></code> object.</p>

   <dt><var>path</var> = new <code id=path2d-objects:dom-path2d-copy><a href=#dom-path2d-copy>Path2D</a></code>(<var>path</var>)<dd>

    <p>Creates a new <code id=path2d-objects:path2d-5><a href=#path2d>Path2D</a></code> object that is a copy of the argument.</p>

   <dt><var>path</var> = new <code id=path2d-objects:dom-path2d-merge><a href=#dom-path2d-merge>Path2D</a></code>(<var>paths</var> [, <var>fillRule</var> ] )<dd>

    <p>Creates a new <code id=path2d-objects:path2d-6><a href=#path2d>Path2D</a></code> object that describes a path that outlines the given <var>paths</var>, using the given fill rule.</p>

   <dt><var>path</var> = new <code id=path2d-objects:dom-path2d-withdata><a href=#dom-path2d-withdata>Path2D</a></code>(<var>d</var>)<dd>

    <p>Creates a new path with the path described by the argument, interpreted as SVG path data. <a href=references.html#refsSVG>[SVG]</a></p>

   <dt><var>path</var> . <code id=path2d-objects:dom-path2d-addpath><a href=#dom-path2d-addpath>addPath</a></code>(<var>path</var> [, <var>transform</var> ] )<dt><var>path</var> . <code id=path2d-objects:dom-path2d-addpathbystrokingpath><a href=#dom-path2d-addpathbystrokingpath>addPathByStrokingPath</a></code>(<var>path</var>, <var>styles</var> [, <var>transform</var> ] )<dd>

    <p>Adds to the path the path given by the argument.</p>

    <p>In the case of the stroking variants, the line styles are taken from the <var>styles</var> argument, which can be either a <code id=path2d-objects:drawingstyle><a href=#drawingstyle>DrawingStyle</a></code> object or a
    <code id=path2d-objects:canvasrenderingcontext2d-2><a href=#canvasrenderingcontext2d>CanvasRenderingContext2D</a></code> object.</p>

   <dt><var>path</var> . <code id=path2d-objects:dom-path2d-addtext><a href=#dom-path2d-addtext>addText</a></code>(<var>text</var>, <var>styles</var>, <var>transform</var>, <var>x</var>, <var>y</var> [, <var>maxWidth</var> ] )<dt><var>path</var> . <code id=path2d-objects:dom-path2d-addtext-2><a href=#dom-path2d-addtext>addText</a></code>(<var>text</var>, <var>styles</var>, <var>transform</var>, <var>path</var> [, <var>maxWidth</var> ] )<dt><var>path</var> . <code id=path2d-objects:dom-path2d-addpathbystrokingtext><a href=#dom-path2d-addpathbystrokingtext>addPathByStrokingText</a></code>(<var>text</var>, <var>styles</var>, <var>transform</var>, <var>x</var>, <var>y</var> [, <var>maxWidth</var> ] )<dt><var>path</var> . <code id=path2d-objects:dom-path2d-addpathbystrokingtext-2><a href=#dom-path2d-addpathbystrokingtext>addPathByStrokingText</a></code>(<var>text</var>, <var>styles</var>, <var>transform</var>, <var>path</var> [, <var>maxWidth</var> ] )<dd>

    <p>Adds to the path a series of subpaths corresponding to the given text. If the arguments give
    a coordinate, the text is drawn horizontally at the given coordinates. If the arguments give a
    path, the text is drawn along the path. If a maximum width is provided, the text will be scaled
    to fit that width if necessary.</p>

    <p>The font, and in the case of the stroking variants, the line styles, are taken from the <var>styles</var> argument, which can be either a <code id=path2d-objects:drawingstyle-2><a href=#drawingstyle>DrawingStyle</a></code> object or a
    <code id=path2d-objects:canvasrenderingcontext2d-3><a href=#canvasrenderingcontext2d>CanvasRenderingContext2D</a></code> object.</p>

   </dl>

  

  <p>The <dfn id=dom-path2d><code>Path2D()</code></dfn> constructor, when invoked, must return a
  newly created <code id=path2d-objects:path2d-7><a href=#path2d>Path2D</a></code> object.</p>

  <hr>

  <p>The <dfn id=dom-path2d-copy><code>Path2D(<var>path</var>)</code></dfn>
  constructor, when invoked, must return a newly created <code id=path2d-objects:path2d-8><a href=#path2d>Path2D</a></code> object, to which the
  subpaths of the argument are added. (In other words, it returns a copy of the argument.)</p>

  <hr>

  <p>The <dfn id=dom-path2d-merge><code>Path2D(<var>paths</var>, <var>fillRule</var>)</code></dfn> constructor, when invoked, must run the following
  steps:</p>

  <ol><li>

    <p>Run the appropriate step from the following list, based on the constructor's sectond
    argument:</p>

    <dl class=switch><dt>If it is "nonzero"<dd>

      <p>Let <var>merged path</var> be a <a href=#concept-path id=path2d-objects:concept-path>path</a> that
      consists of a set of non-overlapping subpaths that exactly outline the points from which, in
      any of the <a href=#concept-path id=path2d-objects:concept-path-2>paths</a> provided in the constructor's first
      argument, the number of times a half-infinite straight line drawn from that point crosses a
      subpath going in one direction is not equal to the number of times it crosses a subpath going
      in the other direction.</p>

     <dt>If it is "evenodd"<dd>

      <p>Let <var>merged path</var> be a <a href=#concept-path id=path2d-objects:concept-path-3>path</a> that
      consists of a set of non-overlapping subpaths that exactly outline the points from which, in
      any of the <a href=#concept-path id=path2d-objects:concept-path-4>paths</a> provided in the constructor's first
      argument, the number of times a half-infinite straight line drawn from that point crosses that
      path is odd.</p>

     </dl>

    <p>The subpaths in <var>merged path</var> must be oriented such that for any point,
    the number of times a half-infinite straight line drawn from that point crosses a subpath is
    even if and only if the number of times a half-infinite straight line drawn from that same point
    crosses a subpath going in one direction is equal to the number of times it crosses a subpath
    going in the other direction.</p>

   <li><p>Add all the subpaths in <var>merged path</var> to the <code id=path2d-objects:path2d-9><a href=#path2d>Path2D</a></code>
   object.<li><p>Set the <code id=path2d-objects:path2d-10><a href=#path2d>Path2D</a></code> object's <a href=#need-new-subpath id=path2d-objects:need-new-subpath>need new subpath</a> flag.</ol>

  <hr>

  <p>The <dfn id=dom-path2d-withdata><code>Path2D(<var>d</var>)</code></dfn>
  constructor must run the following steps:</p>

  <ol><li>

    <p>Parse and interpret the <var>d</var> argument according to the SVG specification's
    rules for path data, thus obtaining an SVG path. <a href=references.html#refsSVG>[SVG]</a></p>

    <p class=note>The resulting path could be empty. SVG defines error handling rules for parsing
    and applying path data.</p>

   <li><p>Let (<var>x</var>, <var>y</var>) be the last point in the SVG
   path.<li><p>Create a new <code id=path2d-objects:path2d-11><a href=#path2d>Path2D</a></code> object and add all the subpaths in the SVG path, if any,
   to that <code id=path2d-objects:path2d-12><a href=#path2d>Path2D</a></code> object. </p>

   <li><p>Create a new subpath in the <code id=path2d-objects:path2d-13><a href=#path2d>Path2D</a></code> object with (<var>x</var>, <var>y</var>) as the only point in the subpath.<li><p>Return the <code id=path2d-objects:path2d-14><a href=#path2d>Path2D</a></code> object as the constructed object.</ol>

  <hr>

  <p>The <dfn id=dom-path2d-addpath><code>addPath(<var>b</var>, <var>transform</var>)</code></dfn> method, when invoked on a <code id=path2d-objects:path2d-15><a href=#path2d>Path2D</a></code> object <var>a</var>, must run the following steps:</p>

  <ol><li><p>If the <code id=path2d-objects:path2d-16><a href=#path2d>Path2D</a></code> object <var>b</var> has no subpaths, abort these
   steps.<li><p>Create a copy of all the subpaths in <var>b</var>. Let this copy be known as <var>c</var>.<li><p>Transform all the coordinates and lines in <var>c</var> by the transform matrix
   <var>transform</var>, if it is not null.<li><p>Let (<var>x</var>, <var>y</var>) be the last point in the last subpath
   of <var>c</var>.<li><p>Add all the subpaths in <var>c</var> to <var>a</var>.<li><p>Create a new subpath in <var>a</var> with (<var>x</var>, <var>y</var>) as the only point in the subpath.</ol>

  <hr>

  <p>The <dfn id=dom-path2d-addpathbystrokingpath><code>addPathByStrokingPath(<var>b</var>, <var>styles</var>, <var>transform</var>)</code></dfn>
  method, when invoked on a <code id=path2d-objects:path2d-17><a href=#path2d>Path2D</a></code> object <var>a</var>, must run the
  following steps:</p>

  <ol><li><p>If the <code id=path2d-objects:path2d-18><a href=#path2d>Path2D</a></code> object <var>b</var> has no subpaths, abort these
   steps.<li><p>Create a copy of all the subpaths in <var>b</var>. Let this copy be known as <var>c</var>.<li><p>Transform all the coordinates and lines in <var>c</var> by transformation matrix
   <var>transform</var>, if it is not null.<li><p>Let a new list of subpaths <var>d</var> be the result of <a href=#trace-a-path id=path2d-objects:trace-a-path>tracing</a> <var>c</var>, using the <var>styles</var> argument for the
   line styles.</p>

   <li><p>Let (<var>x</var>, <var>y</var>) be the last point in the last subpath
   of <var>d</var>.<li><p>Add all the subpaths in <var>d</var> to <var>a</var>.<li><p>Create a new subpath in <var>a</var> with (<var>x</var>, <var>y</var>) as the only point in the subpath.</ol>

  <hr>

  <p>The <dfn id=dom-path2d-addtext><code>addText()</code></dfn> and <dfn id=dom-path2d-addpathbystrokingtext><code>addPathByStrokingText()</code></dfn> methods each
  come in two variants: one rendering text at a given coordinate, and one rendering text along a
  given path. In both cases, the methods take a <code id=path2d-objects:canvasdrawingstyles><a href=#canvasdrawingstyles>CanvasDrawingStyles</a></code> object argument for
  the text and (if appropriate) line styles to use, an <code id=path2d-objects:svgmatrix><a href=infrastructure.html#svgmatrix>SVGMatrix</a></code> object <var>transform</var> (which can be null), and a maximum width can optionally be provided.</p>

  <p>When one of the <code id=path2d-objects:dom-path2d-addtext-3><a href=#dom-path2d-addtext>addText()</a></code> and <code id=path2d-objects:dom-path2d-addpathbystrokingtext-3><a href=#dom-path2d-addpathbystrokingtext>addPathByStrokingText()</a></code> variants that take as
  argument an (<var>x</var>, <var>y</var>) coordinate is invoked, the method
  must run the following algorithm:</p>

  <ol><li><p>Run the <a href=#text-preparation-algorithm id=path2d-objects:text-preparation-algorithm>text preparation algorithm</a>, passing it <var>text</var>, the
   <code id=path2d-objects:canvasdrawingstyles-2><a href=#canvasdrawingstyles>CanvasDrawingStyles</a></code> object argument, and, if the <var>maxWidth</var>
   argument was provided, that argument. Let <var>glyphs</var> be the result.</p>

   <li><p>Move all the shapes in <var>glyphs</var> to the right by <var>x</var>
   CSS pixels and down by <var>y</var> CSS pixels.<li><p>Let <var>glyph paths</var> be a list of <a href=#concept-path id=path2d-objects:concept-path-5>paths</a>
   describing the shapes given in <var>glyphs</var>, with each CSS pixel in the coordinate
   space of <var>glyphs</var> mapped to one coordinate space unit in <var>glyph
   paths</var>. Subpaths in <var>glyph paths</var> must wind clockwise, regardless of how
   the user agent's font subsystem renders fonts and regardless of how the fonts themselves are
   defined.</p>

   <li><p>Transform all the coordinates and lines in <var>glyph paths</var> by the
   transformation matrix <var>transform</var>, if it is not null.<li><p>If the method is <code id=path2d-objects:dom-path2d-addpathbystrokingtext-4><a href=#dom-path2d-addpathbystrokingtext>addPathByStrokingText()</a></code>, replace <var>glyph paths</var> by the result of <a href=#trace-a-path id=path2d-objects:trace-a-path-2>tracing</a> each
   <a href=#concept-path id=path2d-objects:concept-path-6>path</a> in <var>glyph paths</var>, using the
   <code id=path2d-objects:canvasdrawingstyles-3><a href=#canvasdrawingstyles>CanvasDrawingStyles</a></code> object argument for the line styles.</p>

   <li id=mergeGlyphs>

    <p>Let <var>merged path</var> be a <a href=#concept-path id=path2d-objects:concept-path-7>path</a> that
    consists of a set of non-overlapping subpaths that exactly outline the points from which, in any
    of the <a href=#concept-path id=path2d-objects:concept-path-8>paths</a> in <var>glyph paths</var>, the number
    of times a half-infinite straight line drawn from that point crosses that path is odd.</p>

    <p>The subpaths in <var>merged path</var> must be oriented such that for any point,
    the number of times a half-infinite straight line drawn from that point crosses a subpath is
    even if and only if the number of times a half-infinite straight line drawn from that same point
    crosses a subpath going in one direction is equal to the number of times it crosses a subpath
    going in the other direction.</p>

    <div class=example>

     <p>For example, suppose <var>text</var> consists of two overlapping glyphs "Q" and
     "p" (maybe the "Q" has a flourish that crosses into the tail of the "p"). The <var>glyph paths</var> therefore consist of two paths, each with two subpaths: one for the
     outside of the letter shape, and one for the inside of the letter shape. There are points that,
     according to the even-odd fill rule, are filled in both shapes simultaneously: where they
     overlap. As such, the subpaths from the two glyphs actually cross each other.</p>

     <p><img src=https://images.whatwg.org/Qp-overlap.png alt=""></p> 
     

     <p>The resulting <var>merged path</var> in such a situation would have just one path
     for these two letters, with a total of just three subpaths (one big outer outline, one for the
     inside of the "Q", and one for inside of the "p"). This single path would have no subpaths that
     cross each other.</p>

     <p><img src=https://images.whatwg.org/Qp-overlap-outline.png alt=""></p> 
     

    </div>

   <li><p>Add all the subpaths in <var>merged path</var> to the <code id=path2d-objects:path2d-19><a href=#path2d>Path2D</a></code>
   object.<li><p>Set the <code id=path2d-objects:path2d-20><a href=#path2d>Path2D</a></code> object's <a href=#need-new-subpath id=path2d-objects:need-new-subpath-2>need new subpath</a> flag.</ol>

  <p>When one of the <code id=path2d-objects:dom-path2d-addtext-4><a href=#dom-path2d-addtext>addText()</a></code> and <code id=path2d-objects:dom-path2d-addpathbystrokingtext-5><a href=#dom-path2d-addpathbystrokingtext>addPathByStrokingText()</a></code> variants that take as
  argument a <code id=path2d-objects:path2d-21><a href=#path2d>Path2D</a></code> object is invoked, the method must run the following algorithm:</p>

  <ol><li><p>Let <var>target</var> be the <code id=path2d-objects:path2d-22><a href=#path2d>Path2D</a></code> object on which the method was
   invoked.<li><p>Let <var>path</var> be the <code id=path2d-objects:path2d-23><a href=#path2d>Path2D</a></code> object that was provided in the
   method's arguments.<li><p>Run the <a href=#text-preparation-algorithm id=path2d-objects:text-preparation-algorithm-2>text preparation algorithm</a>, passing it <var>text</var>, the
   <code id=path2d-objects:canvasdrawingstyles-4><a href=#canvasdrawingstyles>CanvasDrawingStyles</a></code> object argument, and, if the <var>maxWidth</var>
   argument was provided, that argument. Let <var>glyphs</var> be the resulting array, and
   <var>physical alignment</var> be the resulting alignment value.</p>

   <li><p>Let <var>width</var> be the aggregate length of all the subpaths in <var>path</var>, including the distances from the last point of each closed subpath to the
   first point of that subpath.<li><p>Define <var>L</var> to be a linear coordinate line for of all the subpaths in
   <var>path</var>, with additional lines drawn between the last point and the first point
   of each closed subpath, such that the first point of the first subpath is defined as point 0, and
   the last point of the last subpath, if the last subpath is not closed, or the second occurrence
   first point of that subpath, if it is closed, is defined as point <var>width</var>.<li>

    <p>Let <var>offset</var> be determined according to the appropriate step below:</p>

    <dl class=switch><dt>If <var>physical alignment</var> is <i>left</i><dd>Let <var>offset</var> be zero.<dt>If <var>physical alignment</var> is <i>right</i><dd>Let <var>offset</var> be <var>width</var>.<dt>If <var>physical alignment</var> is <i>center</i><dd>Let <var>offset</var> be half of <var>width</var>.</dl>

   <li><p>Move all the shapes in <var>glyphs</var> to the right by <var>offset</var> CSS pixels.<li><p>Let <var>transformed path list</var> be an empty list of paths.<li>

    <p>For each glyph <var>glyph</var> in the <var>glyphs</var> array, run these
    substeps:</p>

    <ol><li><p>Let <var>dx</var> be the <var>x</var>-coordinate of the horizontal
     center of the bounding box of the shape described by <var>glyph</var>, in CSS
     pixels.<li><p>If <var>dx</var> is negative or greater than <var>width</var>, skip
     the remainder of these substeps for this glyph.<li><p>Recast <var>dx</var> to coordinate spaces units in <var>path</var>.
     (This just changes the dimensionality of <var>dx</var>, not its numeric value.)</p>
     

     <li><p>Find the point <var>p</var> on <var>path</var> (or implied closing
     lines in <var>path</var>) that corresponds to the position <var>dx</var> on
     the coordinate line <var>L</var>.</p>

     <li><p>Let <var>θ</var> be the clockwise angle from the positive x-axis to the
     side of the line that is tangential to <var>path</var> at the point <var>p</var> that is going in the same direction as the line at point <var>p</var>.<li><p>Rotate the shape described by <var>glyph</var> clockwise by <var>θ</var> about the point that is at the <var>dx</var> coordinate
     horizontally and the zero coordinate vertically.<li><p>Let (<var>x</var>, <var>y</var>) be the coordinate of the point <var>p</var>.<li><p>Move the shape described by <var>glyph</var> to the right by <var>x</var> and down by <var>y</var>.<li><p>Let <var>glyph subpaths</var> be a list of subpaths describing the shape given
     in <var>glyph</var>, with each CSS pixel in the coordinate space of <var>glyph</var> mapped to one coordinate space unit in <var>glyph subpaths</var>.
     Subpaths in <var>glyph subpaths</var> must wind clockwise, regardless of how the user
     agent's font subsystem renders fonts and regardless of how the fonts themselves are
     defined.</p>

     <li><p>Transform all the coordinates and lines in <var>glyph subpaths</var> by the
     transformation matrix <var>transform</var>, if it is not null.<li><p>If the method is <code id=path2d-objects:dom-path2d-addpathbystrokingtext-6><a href=#dom-path2d-addpathbystrokingtext>addPathByStrokingText()</a></code>, replace <var>glyph subpaths</var> by the result of <a href=#trace-a-path id=path2d-objects:trace-a-path-3>tracing</a> <var>glyph subpaths</var>, using the <code id=path2d-objects:canvasdrawingstyles-5><a href=#canvasdrawingstyles>CanvasDrawingStyles</a></code> object argument for
     the line styles.</p>

     <li><p>Add all the subpaths in <var>glyph subpaths</var> to <var>transformed path list</var>.</ol>

   <li>

    <p>Let <var>merged path</var> be a <a href=#concept-path id=path2d-objects:concept-path-9>path</a> that
    consists of a set of non-overlapping subpaths that exactly outline the points from which, in any
    of the <a href=#concept-path id=path2d-objects:concept-path-10>paths</a> in <var>transformed path list</var>,
    the number of times a half-infinite straight line drawn from that point crosses that path is
    odd.</p>

    <p>The subpaths in <var>merged path</var> must be oriented such that for any point,
    the number of times a half-infinite straight line drawn from that point crosses a subpath is
    even if and only if the number of times a half-infinite straight line drawn from that same point
    crosses a subpath going in one direction is equal to the number of times it crosses a subpath
    going in the other direction.</p>

    <p class=note>See <a href=#mergeGlyphs>the equivalent step in the earlier algorithm</a> for
    an example of this step. It's even more likely that there will be overlap with this method,
    since neighboring glyphs are likely to be rotated relative to each other.</p>

   <li><p>Add all the subpaths in <var>merged path</var> to <var>target</var>.<li><p>Set the <code id=path2d-objects:path2d-24><a href=#path2d>Path2D</a></code> object's <a href=#need-new-subpath id=path2d-objects:need-new-subpath-3>need new subpath</a> flag.</ol>

  


  <h6 id=transformations>4.12.4.2.8 <dfn>Transformations</dfn></h6>

  <p>Each <code id=transformations:canvasrenderingcontext2d><a href=#canvasrenderingcontext2d>CanvasRenderingContext2D</a></code> object has a <i>current transformation matrix</i>,
  as well as methods (described in this section) to manipulate it. When a
  <code id=transformations:canvasrenderingcontext2d-2><a href=#canvasrenderingcontext2d>CanvasRenderingContext2D</a></code> object is created, its transformation matrix must be
  initialised to the identity transform.</p>

  <p>The transformation matrix is applied to coordinates when creating the <a href=#current-default-path id=transformations:current-default-path>current default
  path</a>, and when painting text, shapes, and <code id=transformations:path2d><a href=#path2d>Path2D</a></code> objects, on
  <code id=transformations:canvasrenderingcontext2d-3><a href=#canvasrenderingcontext2d>CanvasRenderingContext2D</a></code> objects.</p> 

  <p class=note>Most of the API uses <code id=transformations:svgmatrix><a href=infrastructure.html#svgmatrix>SVGMatrix</a></code> objects rather than this API. This API
  remains mostly for historical reasons.</p>

  

  <p>The transformations must be performed in reverse order.</p>

  <p class=note>For instance, if a scale transformation that doubles the width is applied to the
  canvas, followed by a rotation transformation that rotates drawing operations by a quarter turn,
  and a rectangle twice as wide as it is tall is then drawn on the canvas, the actual result will be
  a square.</p> 

  

  <dl class=domintro><dt><var>context</var> . <code id=transformations:dom-context-2d-currenttransform><a href=#dom-context-2d-currenttransform>currentTransform</a></code> [ = <var>value</var> ]<dd>

    <p>Returns the transformation matrix, as an <code id=transformations:svgmatrix-2><a href=infrastructure.html#svgmatrix>SVGMatrix</a></code> object.</p>

    <p>Can be set, to change the transformation matrix.</p>

   <dt><var>context</var> . <code id=transformations:dom-context-2d-scale><a href=#dom-context-2d-scale>scale</a></code>(<var>x</var>, <var>y</var>)<dd>

    <p>Changes the transformation matrix to apply a scaling transformation with the given characteristics.</p>

   <dt><var>context</var> . <code id=transformations:dom-context-2d-rotate><a href=#dom-context-2d-rotate>rotate</a></code>(<var>angle</var>)<dd>

    <p>Changes the transformation matrix to apply a rotation transformation with the given characteristics. The angle is in radians.</p>

   <dt><var>context</var> . <code id=transformations:dom-context-2d-translate><a href=#dom-context-2d-translate>translate</a></code>(<var>x</var>, <var>y</var>)<dd>

    <p>Changes the transformation matrix to apply a translation transformation with the given characteristics.</p>

   <dt><var>context</var> . <code id=transformations:dom-context-2d-transform><a href=#dom-context-2d-transform>transform</a></code>(<var>a</var>, <var>b</var>, <var>c</var>, <var>d</var>, <var>e</var>, <var>f</var>)<dd>

    <p>Changes the transformation matrix to apply the matrix given by the arguments as described below.</p>

   <dt><var>context</var> . <code id=transformations:dom-context-2d-settransform><a href=#dom-context-2d-settransform>setTransform</a></code>(<var>a</var>, <var>b</var>, <var>c</var>, <var>d</var>, <var>e</var>, <var>f</var>)<dd>

    <p>Changes the transformation matrix <em>to</em> the matrix given by the arguments as described below.</p>

   <dt><var>context</var> . <code id=transformations:dom-context-2d-resettransform><a href=#dom-context-2d-resettransform>resetTransform</a></code>()<dd>

    <p>Changes the transformation matrix to the identity transform.</p>

   </dl>

  

  <p>The <dfn id=dom-context-2d-currenttransform><code>currentTransform</code></dfn>, on
  getting, must return the last object that it was set to. On setting, its value must be changed to
  the new value, and the transformation matrix must be updated to match the matrix described by the
  new value. When the <code id=transformations:canvasrenderingcontext2d-4><a href=#canvasrenderingcontext2d>CanvasRenderingContext2D</a></code> object is created, the <code id=transformations:dom-context-2d-currenttransform-2><a href=#dom-context-2d-currenttransform>currentTransform</a></code> attribute must be set a newly
  created <code id=transformations:svgmatrix-3><a href=infrastructure.html#svgmatrix>SVGMatrix</a></code> object. When the transformation matrix is mutated by the methods
  described in this section, the last <code id=transformations:svgmatrix-4><a href=infrastructure.html#svgmatrix>SVGMatrix</a></code> object to which the attribute has been
  set must be mutated in a corresponding fashion.</p>

  <p>The <dfn id=dom-context-2d-scale><code>scale(<var>x</var>, <var>y</var>)</code></dfn>
  method must add the scaling transformation described by the arguments to the transformation
  matrix. The <var>x</var> argument represents the scale factor in the horizontal direction and the
  <var>y</var> argument represents the scale factor in the vertical direction. The factors are
  multiples.</p>

  <p>The <dfn id=dom-context-2d-rotate><code>rotate(<var>angle</var>)</code></dfn> method must
  add the rotation transformation described by the argument to the transformation matrix. The
  <var>angle</var> argument represents a clockwise rotation angle expressed in radians.</p>

  <p>The <dfn id=dom-context-2d-translate><code>translate(<var>x</var>,
  <var>y</var>)</code></dfn> method must add the translation transformation described by the
  arguments to the transformation matrix. The <var>x</var> argument represents the translation
  distance in the horizontal direction and the <var>y</var> argument represents the translation
  distance in the vertical direction. The arguments are in coordinate space units.</p>

  <p>The <dfn id=dom-context-2d-transform><code>transform(<var>a</var>, <var>b</var>,
  <var>c</var>, <var>d</var>, <var>e</var>, <var>f</var>)</code></dfn> method must replace the
  current transformation matrix with the result of multiplying the current transformation matrix
  with the matrix described by:</p>

  

  <table class=matrix><tr><td><var>a</var><td><var>c</var><td><var>e</var><tr><td><var>b</var><td><var>d</var><td><var>f</var><tr><td>0<td>0<td>1</table>

  <p class=note>The arguments <var>a</var>, <var>b</var>, <var>c</var>, <var>d</var>,
  <var>e</var>, and <var>f</var> are sometimes called <var>m11</var>, <var>m12</var>,
  <var>m21</var>, <var>m22</var>, <var>dx</var>, and <var>dy</var> or <var>m11</var>,
  <var>m21</var>, <var>m12</var>, <var>m22</var>, <var>dx</var>, and <var>dy</var>. Care should be
  taken in particular with the order of the second and third arguments (<var>b</var> and
  <var>c</var>) as their order varies from API to API and APIs sometimes use the notation
  <var>m12</var>/<var>m21</var> and sometimes <var>m21</var>/<var>m12</var> for those positions.</p>

  

  <p>The <dfn id=dom-context-2d-settransform><code>setTransform(<var>a</var>, <var>b</var>,
  <var>c</var>, <var>d</var>, <var>e</var>, <var>f</var>)</code></dfn> method must reset the current
  transform to the identity matrix, and then invoke the <code><a href=#dom-context-2d-transform id=transformations:dom-context-2d-transform-2>transform</a>(<var>a</var>, <var>b</var>, <var>c</var>,
  <var>d</var>, <var>e</var>, <var>f</var>)</code> method with the same arguments.</p>

  <p>The <dfn id=dom-context-2d-resettransform><code>resetTransform()</code></dfn> method must
  reset the current transform to the identity matrix.</p>

  



  <h6 id=image-sources-for-2d-rendering-contexts>4.12.4.2.9 Image sources for 2D rendering contexts</h6>

  <p>Several methods in the <code id=image-sources-for-2d-rendering-contexts:canvasrenderingcontext2d><a href=#canvasrenderingcontext2d>CanvasRenderingContext2D</a></code> API take the union type
  <code id=image-sources-for-2d-rendering-contexts:canvasimagesource><a href=#canvasimagesource>CanvasImageSource</a></code> as an argument.</p>

  <p>This union type allows objects implementing any of the following interfaces to be used as image
  sources:</p>

  <ul><li><code id=image-sources-for-2d-rendering-contexts:htmlimageelement><a href=embedded-content.html#htmlimageelement>HTMLImageElement</a></code> (<code id=image-sources-for-2d-rendering-contexts:the-img-element><a href=embedded-content.html#the-img-element>img</a></code> elements)<li><code id=image-sources-for-2d-rendering-contexts:htmlvideoelement><a href=embedded-content.html#htmlvideoelement>HTMLVideoElement</a></code> (<code id=image-sources-for-2d-rendering-contexts:the-video-element><a href=embedded-content.html#the-video-element>video</a></code> elements)<li><code id=image-sources-for-2d-rendering-contexts:htmlcanvaselement><a href=#htmlcanvaselement>HTMLCanvasElement</a></code> (<code id=image-sources-for-2d-rendering-contexts:the-canvas-element><a href=#the-canvas-element>canvas</a></code> elements)<li><code id=image-sources-for-2d-rendering-contexts:canvasrenderingcontext2d-2><a href=#canvasrenderingcontext2d>CanvasRenderingContext2D</a></code><li><code id=image-sources-for-2d-rendering-contexts:imagebitmap><a href=webappapis.html#imagebitmap>ImageBitmap</a></code></ul>

  <p class=note>The <code id=image-sources-for-2d-rendering-contexts:imagebitmap-2><a href=webappapis.html#imagebitmap>ImageBitmap</a></code> interface can be created from a number of other
  image-representing types, including <code id=image-sources-for-2d-rendering-contexts:imagedata><a href=#imagedata>ImageData</a></code>.</p>

  <p>When a user agent is required to <dfn id=check-the-usability-of-the-image-argument>check the usability of the <var>image</var>
  argument</dfn>, where <var>image</var> is a <code id=image-sources-for-2d-rendering-contexts:canvasimagesource-2><a href=#canvasimagesource>CanvasImageSource</a></code> object, the
  user agent must run these steps, which return either <i>good</i>, <i>bad</i>, or
  <i>aborted</i>:</p>

  <ol><li><p>If the <var>image</var> argument is an <code id=image-sources-for-2d-rendering-contexts:htmlimageelement-2><a href=embedded-content.html#htmlimageelement>HTMLImageElement</a></code> object that
   is in the <a href=embedded-content.html#img-error id=image-sources-for-2d-rendering-contexts:img-error>broken</a> state, then throw an
   <code id=image-sources-for-2d-rendering-contexts:invalidstateerror><a href=infrastructure.html#invalidstateerror>InvalidStateError</a></code> exception, return <i>aborted</i>, and abort these steps.</p>

   <li><p>If the <var>image</var> argument is an <code id=image-sources-for-2d-rendering-contexts:htmlimageelement-3><a href=embedded-content.html#htmlimageelement>HTMLImageElement</a></code> object that
   is not <a href=embedded-content.html#img-good id=image-sources-for-2d-rendering-contexts:img-good>fully decodable</a>, or if the <var>image</var>
   argument is an <code id=image-sources-for-2d-rendering-contexts:htmlvideoelement-2><a href=embedded-content.html#htmlvideoelement>HTMLVideoElement</a></code> object whose <code id=image-sources-for-2d-rendering-contexts:dom-media-readystate><a href=embedded-content.html#dom-media-readystate>readyState</a></code> attribute is either <code id=image-sources-for-2d-rendering-contexts:dom-media-have_nothing><a href=embedded-content.html#dom-media-have_nothing>HAVE_NOTHING</a></code> or <code id=image-sources-for-2d-rendering-contexts:dom-media-have_metadata><a href=embedded-content.html#dom-media-have_metadata>HAVE_METADATA</a></code>, then return <i>bad</i> and abort these
   steps.<li><p>If the <var>image</var> argument is an <code id=image-sources-for-2d-rendering-contexts:htmlimageelement-4><a href=embedded-content.html#htmlimageelement>HTMLImageElement</a></code> object with
   an intrinsic width or intrinsic height (or both) equal to zero, then return <i>bad</i> and abort
   these steps.</p> 

   <li><p>If the <var>image</var> argument is an <code id=image-sources-for-2d-rendering-contexts:htmlcanvaselement-2><a href=#htmlcanvaselement>HTMLCanvasElement</a></code> object with
   either a horizontal dimension or a vertical dimension equal to zero, then return <i>bad</i> and
   abort these steps.</p>

   <li><p>Return <i>good</i>.</ol>

  <p>When a <code id=image-sources-for-2d-rendering-contexts:canvasimagesource-3><a href=#canvasimagesource>CanvasImageSource</a></code> object represents an <code id=image-sources-for-2d-rendering-contexts:htmlimageelement-5><a href=embedded-content.html#htmlimageelement>HTMLImageElement</a></code>, the
  element's image must be used as the source image.</p>

  <p>Specifically, when a <code id=image-sources-for-2d-rendering-contexts:canvasimagesource-4><a href=#canvasimagesource>CanvasImageSource</a></code> object represents an animated image in an
  <code id=image-sources-for-2d-rendering-contexts:htmlimageelement-6><a href=embedded-content.html#htmlimageelement>HTMLImageElement</a></code>, the user agent must use the default image of the animation (the
  one that the format defines is to be used when animation is not supported or is disabled), or, if
  there is no such image, the first frame of the animation, when rendering the image for
  <code id=image-sources-for-2d-rendering-contexts:canvasrenderingcontext2d-3><a href=#canvasrenderingcontext2d>CanvasRenderingContext2D</a></code> APIs.</p>

  <p>When a <code id=image-sources-for-2d-rendering-contexts:canvasimagesource-5><a href=#canvasimagesource>CanvasImageSource</a></code> object represents an <code id=image-sources-for-2d-rendering-contexts:htmlvideoelement-3><a href=embedded-content.html#htmlvideoelement>HTMLVideoElement</a></code>, then
  the frame at the <a id=image-sources-for-2d-rendering-contexts:current-playback-position href=embedded-content.html#current-playback-position>current playback position</a> when the method with the argument is
  invoked must be used as the source image when rendering the image for
  <code id=image-sources-for-2d-rendering-contexts:canvasrenderingcontext2d-4><a href=#canvasrenderingcontext2d>CanvasRenderingContext2D</a></code> APIs, and the source image's dimensions must be the <a href=embedded-content.html#concept-video-intrinsic-width id=image-sources-for-2d-rendering-contexts:concept-video-intrinsic-width>intrinsic width</a> and <a href=embedded-content.html#concept-video-intrinsic-height id=image-sources-for-2d-rendering-contexts:concept-video-intrinsic-height>intrinsic height</a> of the <a id=image-sources-for-2d-rendering-contexts:media-resource href=embedded-content.html#media-resource>media resource</a>
  (i.e. after any aspect-ratio correction has been applied).</p>

  <p>When a <code id=image-sources-for-2d-rendering-contexts:canvasimagesource-6><a href=#canvasimagesource>CanvasImageSource</a></code> object represents an <code id=image-sources-for-2d-rendering-contexts:htmlcanvaselement-3><a href=#htmlcanvaselement>HTMLCanvasElement</a></code>, the
  element's bitmap must be used as the source image.</p>

  <p>When a <code id=image-sources-for-2d-rendering-contexts:canvasimagesource-7><a href=#canvasimagesource>CanvasImageSource</a></code> object represents a <code id=image-sources-for-2d-rendering-contexts:canvasrenderingcontext2d-5><a href=#canvasrenderingcontext2d>CanvasRenderingContext2D</a></code>, the
  object's <a href=#scratch-bitmap id=image-sources-for-2d-rendering-contexts:scratch-bitmap>scratch bitmap</a> must be used as the source image.</p>

  <p>When a <code id=image-sources-for-2d-rendering-contexts:canvasimagesource-8><a href=#canvasimagesource>CanvasImageSource</a></code> object represents an element that is <a id=image-sources-for-2d-rendering-contexts:being-rendered href=rendering.html#being-rendered>being
  rendered</a> and that element has been resized, the original image data of the source image
  must be used, not the image as it is rendered (e.g. <code id=image-sources-for-2d-rendering-contexts:attr-dim-width><a href=embedded-content.html#attr-dim-width>width</a></code> and
  <code id=image-sources-for-2d-rendering-contexts:attr-dim-height><a href=embedded-content.html#attr-dim-height>height</a></code> attributes on the source element have no effect on how
  the object is interpreted when rendering the image for <code id=image-sources-for-2d-rendering-contexts:canvasrenderingcontext2d-6><a href=#canvasrenderingcontext2d>CanvasRenderingContext2D</a></code>
  APIs).</p>

  <p>When a <code id=image-sources-for-2d-rendering-contexts:canvasimagesource-9><a href=#canvasimagesource>CanvasImageSource</a></code> object represents an <code id=image-sources-for-2d-rendering-contexts:imagebitmap-3><a href=webappapis.html#imagebitmap>ImageBitmap</a></code>, the
  object's bitmap image data must be used as the source image.</p>


  <p><dfn id=the-image-argument-is-not-origin-clean>The <var>image argument</var> is not origin-clean</dfn> if it is an
  <code id=image-sources-for-2d-rendering-contexts:htmlimageelement-7><a href=embedded-content.html#htmlimageelement>HTMLImageElement</a></code> or <code id=image-sources-for-2d-rendering-contexts:htmlvideoelement-4><a href=embedded-content.html#htmlvideoelement>HTMLVideoElement</a></code> whose <a id=image-sources-for-2d-rendering-contexts:origin-2 href=browsers.html#origin-2>origin</a> is not
  the <a href=browsers.html#same-origin id=image-sources-for-2d-rendering-contexts:same-origin>same</a> as the <a id=image-sources-for-2d-rendering-contexts:origin-2-2 href=browsers.html#origin-2>origin</a> specified by the <a id=image-sources-for-2d-rendering-contexts:entry-settings-object href=webappapis.html#entry-settings-object>entry
  settings object</a>, or if it is an <code id=image-sources-for-2d-rendering-contexts:htmlcanvaselement-4><a href=#htmlcanvaselement>HTMLCanvasElement</a></code> whose bitmap's <a href=#concept-canvas-origin-clean id=image-sources-for-2d-rendering-contexts:concept-canvas-origin-clean>origin-clean</a> flag is false, or if it is a
  <code id=image-sources-for-2d-rendering-contexts:canvasrenderingcontext2d-7><a href=#canvasrenderingcontext2d>CanvasRenderingContext2D</a></code> object whose <a href=#scratch-bitmap id=image-sources-for-2d-rendering-contexts:scratch-bitmap-2>scratch bitmap</a>'s <a href=#concept-canvas-origin-clean id=image-sources-for-2d-rendering-contexts:concept-canvas-origin-clean-2>origin-clean</a> flag is false.</p>




  <h6 id=fill-and-stroke-styles>4.12.4.2.10 Fill and stroke styles</h6>

  <dl class=domintro><dt><var>context</var> . <code id=fill-and-stroke-styles:dom-context-2d-fillstyle><a href=#dom-context-2d-fillstyle>fillStyle</a></code> [ = <var>value</var> ]<dd>

    <p>Returns the current style used for filling shapes.</p>

    <p>Can be set, to change the fill style.</p>

    <p>The style can be either a string containing a CSS colour, or a <code id=fill-and-stroke-styles:canvasgradient><a href=#canvasgradient>CanvasGradient</a></code> or
    <code id=fill-and-stroke-styles:canvaspattern><a href=#canvaspattern>CanvasPattern</a></code> object. Invalid values are ignored.</p>

   <dt><var>context</var> . <code id=fill-and-stroke-styles:dom-context-2d-strokestyle><a href=#dom-context-2d-strokestyle>strokeStyle</a></code> [ = <var>value</var> ]<dd>

    <p>Returns the current style used for stroking shapes.</p>

    <p>Can be set, to change the stroke style.</p>

    <p>The style can be either a string containing a CSS colour, or a <code id=fill-and-stroke-styles:canvasgradient-2><a href=#canvasgradient>CanvasGradient</a></code> or
    <code id=fill-and-stroke-styles:canvaspattern-2><a href=#canvaspattern>CanvasPattern</a></code> object. Invalid values are ignored.</p>

   </dl>

  

  

  <p>The <dfn id=dom-context-2d-fillstyle><code>fillStyle</code></dfn> attribute represents the
  colour or style to use inside shapes, and the <dfn id=dom-context-2d-strokestyle><code>strokeStyle</code></dfn> attribute represents the colour
  or style to use for the lines around the shapes.</p>

  <p>Both attributes can be either strings, <code id=fill-and-stroke-styles:canvasgradient-3><a href=#canvasgradient>CanvasGradient</a></code>s, or
  <code id=fill-and-stroke-styles:canvaspattern-3><a href=#canvaspattern>CanvasPattern</a></code>s. On setting, strings must be <a href=infrastructure.html#parsed-as-a-css-color-value id=fill-and-stroke-styles:parsed-as-a-css-color-value>parsed as CSS &lt;color> values</a> and the colour assigned, and
  <code id=fill-and-stroke-styles:canvasgradient-4><a href=#canvasgradient>CanvasGradient</a></code> and <code id=fill-and-stroke-styles:canvaspattern-4><a href=#canvaspattern>CanvasPattern</a></code> objects must be assigned themselves. <a href=references.html#refsCSSCOLOR>[CSSCOLOR]</a> If the value is a string but cannot be <a id=fill-and-stroke-styles:parsed-as-a-css-color-value-2 href=infrastructure.html#parsed-as-a-css-color-value>parsed as a CSS
  &lt;color> value</a>, then it must be ignored, and the attribute must retain its previous
  value.

  If the new value is a <code id=fill-and-stroke-styles:canvaspattern-5><a href=#canvaspattern>CanvasPattern</a></code> object that is marked as <a href=#concept-canvas-pattern-not-origin-clean id=fill-and-stroke-styles:concept-canvas-pattern-not-origin-clean>not origin-clean</a>, then the <a href=#scratch-bitmap id=fill-and-stroke-styles:scratch-bitmap>scratch
  bitmap</a>'s <a href=#concept-canvas-origin-clean id=fill-and-stroke-styles:concept-canvas-origin-clean>origin-clean</a> flag must be set to
  false.

  </p>

  <p>When set to a <code id=fill-and-stroke-styles:canvaspattern-6><a href=#canvaspattern>CanvasPattern</a></code> or <code id=fill-and-stroke-styles:canvasgradient-5><a href=#canvasgradient>CanvasGradient</a></code> object, the assignment
  is <a id=fill-and-stroke-styles:live href=infrastructure.html#live>live</a>, meaning that changes made to the object after the assignment do affect
  subsequent stroking or filling of shapes.</p>

  <p>On getting, if the value is a colour, then the <a href=#serialisation-of-a-colour id=fill-and-stroke-styles:serialisation-of-a-colour>serialisation of the colour</a> must be returned. Otherwise, if it is not a colour but a
  <code id=fill-and-stroke-styles:canvasgradient-6><a href=#canvasgradient>CanvasGradient</a></code> or <code id=fill-and-stroke-styles:canvaspattern-7><a href=#canvaspattern>CanvasPattern</a></code>, then the respective object must be
  returned. (Such objects are opaque and therefore only useful for assigning to other attributes or
  for comparison to other gradients or patterns.)</p>

  <p>The <dfn id=serialisation-of-a-colour>serialisation of a colour</dfn> for a colour value is a string, computed as follows: if
  it has alpha equal to 1.0, then the string is a lowercase six-digit hex value, prefixed with a "#"
  character (U+0023 NUMBER SIGN), with the first two digits representing the red component, the next
  two digits representing the green component, and the last two digits representing the blue
  component, the digits being <a id=fill-and-stroke-styles:lowercase-ascii-hex-digits href=infrastructure.html#lowercase-ascii-hex-digits>lowercase ASCII hex digits</a>. Otherwise, the colour value
  has alpha less than 1.0, and the string is the colour value in the CSS <code>rgba()</code>
  functional-notation format: the literal string "<code>rgba</code>" (U+0072 U+0067 U+0062
  U+0061) followed by a U+0028 LEFT PARENTHESIS, a base-ten integer in the range 0-255 representing
  the red component (using <a id=fill-and-stroke-styles:ascii-digits href=infrastructure.html#ascii-digits>ASCII digits</a> in the shortest form possible), a literal
  U+002C COMMA and U+0020 SPACE, an integer for the green component, a comma and a space, an integer
  for the blue component, another comma and space, a U+0030 DIGIT ZERO, if the alpha value is
  greater than zero then a U+002E FULL STOP (representing the decimal point), if the alpha value is
  greater than zero then one or more <a id=fill-and-stroke-styles:ascii-digits-2 href=infrastructure.html#ascii-digits>ASCII digits</a> representing the fractional part of
  the alpha, and finally a U+0029
  RIGHT PARENTHESIS. User agents must express the fractional part of the alpha value, if any, with
  the level of precision necessary for the alpha value, when reparsed, to be interpreted as the same
  alpha value.</p> 

  <p>When the context is created, the <code id=fill-and-stroke-styles:dom-context-2d-fillstyle-2><a href=#dom-context-2d-fillstyle>fillStyle</a></code> and <code id=fill-and-stroke-styles:dom-context-2d-strokestyle-2><a href=#dom-context-2d-strokestyle>strokeStyle</a></code> attributes
  must initially have the string value <code>#000000</code>.</p>

  <p>When the value is a colour, it must not be affected by the transformation matrix when used to
  draw on bitmaps.</p> 

  

  <hr>

  <p>There are two types of gradients, linear gradients and radial gradients, both represented by
  objects implementing the opaque <code id=fill-and-stroke-styles:canvasgradient-7><a href=#canvasgradient>CanvasGradient</a></code> interface.</p>

  <p id=interpolation>Once a gradient has been created (see below), stops are placed along it to
  define how the colours are distributed along the gradient. The colour of the
  gradient at each stop is the colour specified for that stop. Between each such stop, the colours and
  the alpha component must be linearly interpolated over the RGBA space without premultiplying the
  alpha value to find the colour to use at that offset. Before the first stop, the colour must be the
  colour of the first stop. After the last stop, the colour must be the colour of the last stop. When
  there are no stops, the gradient is transparent black.</p>

  <dl class=domintro><dt><var>gradient</var> . <code id=fill-and-stroke-styles:dom-canvasgradient-addcolorstop><a href=#dom-canvasgradient-addcolorstop>addColorStop</a></code>(<var>offset</var>, <var>color</var>)<dd>

    <p>Adds a colour stop with the given colour to the gradient at the given offset. 0.0 is the offset
    at one end of the gradient, 1.0 is the offset at the other end.</p>

    <p>Throws an <code id=fill-and-stroke-styles:indexsizeerror><a href=infrastructure.html#indexsizeerror>IndexSizeError</a></code> exception if the offset is out of range. Throws a
    <code id=fill-and-stroke-styles:syntaxerror><a href=infrastructure.html#syntaxerror>SyntaxError</a></code> exception if the colour cannot be parsed.</p>

   <dt><var>gradient</var> = <var>context</var> . <code id=fill-and-stroke-styles:dom-context-2d-createlineargradient><a href=#dom-context-2d-createlineargradient>createLinearGradient</a></code>(<var>x0</var>, <var>y0</var>, <var>x1</var>, <var>y1</var>)<dd>

    <p>Returns a <code id=fill-and-stroke-styles:canvasgradient-8><a href=#canvasgradient>CanvasGradient</a></code> object that represents a
    linear gradient that paints along the line given by the
    coordinates represented by the arguments.</p>

   <dt><var>gradient</var> = <var>context</var> . <code id=fill-and-stroke-styles:dom-context-2d-createradialgradient><a href=#dom-context-2d-createradialgradient>createRadialGradient</a></code>(<var>x0</var>, <var>y0</var>, <var>r0</var>, <var>x1</var>, <var>y1</var>, <var>r1</var>)<dd>

    <p>Returns a <code id=fill-and-stroke-styles:canvasgradient-9><a href=#canvasgradient>CanvasGradient</a></code> object that represents a
    radial gradient that paints along the cone given by the circles
    represented by the arguments.</p>

    <p>If either of the radii are negative, throws an
    <code id=fill-and-stroke-styles:indexsizeerror-2><a href=infrastructure.html#indexsizeerror>IndexSizeError</a></code> exception.</p>

   </dl>

  

  <p>The <dfn id=dom-canvasgradient-addcolorstop><code>addColorStop(<var>offset</var>,
  <var>color</var>)</code></dfn> method on the <code id=fill-and-stroke-styles:canvasgradient-10><a href=#canvasgradient>CanvasGradient</a></code> interface adds a
  new stop to a gradient. If the <var>offset</var> is less than 0 or greater than 1 then an
  <code id=fill-and-stroke-styles:indexsizeerror-3><a href=infrastructure.html#indexsizeerror>IndexSizeError</a></code> exception must be thrown. If the <var>color</var> cannot be
  <a id=fill-and-stroke-styles:parsed-as-a-css-color-value-3 href=infrastructure.html#parsed-as-a-css-color-value>parsed as a CSS &lt;color> value</a>, then a <code id=fill-and-stroke-styles:syntaxerror-2><a href=infrastructure.html#syntaxerror>SyntaxError</a></code> exception must
  be thrown. Otherwise, the gradient must have a new stop placed, at offset <var>offset</var> relative to the whole gradient, and with the colour obtained by parsing <var>color</var> as a CSS &lt;color> value. If multiple stops are added at the same offset
  on a gradient, they must be placed in the order added, with the first one closest to the start of
  the gradient, and each subsequent one infinitesimally further along towards the end point (in
  effect causing all but the first and last stop added at each point to be ignored).</p>

  <p>The <dfn id=dom-context-2d-createlineargradient><code>createLinearGradient(<var>x0</var>, <var>y0</var>, <var>x1</var>, <var>y1</var>)</code></dfn> method takes four arguments that represent the start point (<var>x0</var>, <var>y0</var>) and end point (<var>x1</var>, <var>y1</var>) of the gradient. The method must return a linear <code id=fill-and-stroke-styles:canvasgradient-11><a href=#canvasgradient>CanvasGradient</a></code>
  initialised with the specified line.</p>

  <p>Linear gradients must be rendered such that all points on a line perpendicular to the line that
  crosses the start and end points have the colour at the point where those two lines cross (with the
  colours coming from the <a href=#interpolation>interpolation and extrapolation</a> described
  above). The points in the linear gradient must be transformed as described by the <a href=#transformations id=fill-and-stroke-styles:transformations>current transformation matrix</a> when rendering.</p>

  <p>If <span><var>x0</var> = <var>x1</var></span> and <span><var>y0</var> = <var>y1</var></span>, then the linear
  gradient must paint nothing.</p>

  <p>The <dfn id=dom-context-2d-createradialgradient><code>createRadialGradient(<var>x0</var>, <var>y0</var>, <var>r0</var>, <var>x1</var>, <var>y1</var>, <var>r1</var>)</code></dfn> method takes six arguments, the first
  three representing the start circle with origin (<var>x0</var>, <var>y0</var>)
  and radius <var>r0</var>, and the last three representing the end circle with origin
  (<var>x1</var>, <var>y1</var>) and radius <var>r1</var>. The values are
  in coordinate space units. If either of <var>r0</var> or <var>r1</var> are
  negative, an <code id=fill-and-stroke-styles:indexsizeerror-4><a href=infrastructure.html#indexsizeerror>IndexSizeError</a></code> exception must be thrown. Otherwise, the method must
  return a radial <code id=fill-and-stroke-styles:canvasgradient-12><a href=#canvasgradient>CanvasGradient</a></code> initialised with the two specified circles.</p>

  <p>Radial gradients must be rendered by following these steps:</p>

  <ol><li><p>If <span><var>x<sub>0</sub></var> = <var>x<sub>1</sub></var></span> and <span><var>y<sub>0</sub></var> = <var>y<sub>1</sub></var></span> and <span><var>r<sub>0</sub></var> = <var>r<sub>1</sub></var></span>, then the radial gradient must
   paint nothing. Abort these steps.<li>

    <p>Let <span>x(<var>ω</var>) = (<var>x<sub>1</sub></var>-<var>x<sub>0</sub></var>)<var>ω</var> + <var>x<sub>0</sub></var></span></p>

    <p>Let <span>y(<var>ω</var>) = (<var>y<sub>1</sub></var>-<var>y<sub>0</sub></var>)<var>ω</var> + <var>y<sub>0</sub></var></span></p>

    <p>Let <span>r(<var>ω</var>) = (<var>r<sub>1</sub></var>-<var>r<sub>0</sub></var>)<var>ω</var> + <var>r<sub>0</sub></var></span></p>

    <p>Let the colour at <var>ω</var> be the colour at that position on the gradient
    (with the colours coming from the <a href=#interpolation>interpolation and extrapolation</a>
    described above).</p>

   <li><p>For all values of <var>ω</var> where <span>r(<var>ω</var>) > 0</span>, starting with the value of <var>ω</var> nearest to positive infinity and ending with the value of <var>ω</var> nearest to negative infinity, draw the circumference of the circle with
   radius <span>r(<var>ω</var>)</span> at position (<span>x(<var>ω</var>)</span>, <span>y(<var>ω</var>)</span>), with the
   colour at <var>ω</var>, but only painting on the parts of the bitmap that have not
   yet been painted on by earlier circles in this step for this rendering of the gradient.</ol>

  <p class=note>This effectively creates a cone, touched by the two circles defined in the
  creation of the gradient, with the part of the cone before the start circle (0.0) using the colour
  of the first offset, the part of the cone after the end circle (1.0) using the colour of the last
  offset, and areas outside the cone untouched by the gradient (transparent black).</p>

  <p>The resulting radial gradient must then be transformed as described by the <a href=#transformations id=fill-and-stroke-styles:transformations-2>current transformation matrix</a> when rendering.</p>

  <p>Gradients must be painted only where the relevant stroking or filling effects requires that
  they be drawn.</p>

  

  <hr>

  <p>Patterns are represented by objects implementing the opaque <code id=fill-and-stroke-styles:canvaspattern-8><a href=#canvaspattern>CanvasPattern</a></code>
  interface.</p>

  <dl class=domintro><dt><var>pattern</var> = <var>context</var> . <code id=fill-and-stroke-styles:dom-context-2d-createpattern><a href=#dom-context-2d-createpattern>createPattern</a></code>(<var>image</var>, <var>repetition</var>)<dd>

    <p>Returns a <code id=fill-and-stroke-styles:canvaspattern-9><a href=#canvaspattern>CanvasPattern</a></code> object that uses the given image and repeats in the
    direction(s) given by the <var>repetition</var> argument.</p>

    <p>The allowed values for <var>repetition</var> are <code>repeat</code> (both
    directions), <code>repeat-x</code> (horizontal only), <code>repeat-y</code>
    (vertical only), and <code>no-repeat</code> (neither). If the <var>repetition</var> argument is empty, the value <code>repeat</code> is used.</p>

    <p>If the image isn't yet fully decoded, then nothing is drawn. If the image is a canvas with no
    data, throws an <code id=fill-and-stroke-styles:invalidstateerror><a href=infrastructure.html#invalidstateerror>InvalidStateError</a></code> exception.</p>

   <dt><var>pattern</var> . <code id=fill-and-stroke-styles:dom-canvaspattern-settransform><a href=#dom-canvaspattern-settransform>setTransform</a></code>(<var>transform</var>)<dd>

    <p>Sets the transformation matrix that will be used when rendering the pattern during a fill or
    stroke painting operation.</p>

   </dl>

  

  <p>To create objects of this type, the <dfn id=dom-context-2d-createpattern><code>createPattern(<var>image</var>, <var>repetition</var>)</code></dfn> method is used. When the method is invoked, the user agent
  must run the following steps:</p>

  <ol><li><p>Let <var>image</var> be the first argument and <var>repetition</var> be
   the second argument.<li><p><a href=#check-the-usability-of-the-image-argument id=fill-and-stroke-styles:check-the-usability-of-the-image-argument>Check the usability of the <var>image</var> argument</a>. If this
   returns <i>aborted</i>, then an exception has been thrown and the method doesn't return anything;
   abort these steps. If it returns <i>bad</i>, then return null and abort these steps. Otherwise it
   returns <i>good</i>; continue with these steps.<li><p>If <var>repetition</var> is the empty string, let it be "<code>repeat</code>".</p>

   <li><p>If <var>repetition</var> is not a <a id=fill-and-stroke-styles:case-sensitive href=infrastructure.html#case-sensitive>case-sensitive</a> match for one of
   "<code>repeat</code>", "<code>repeat-x</code>", "<code>repeat-y</code>", or "<code>no-repeat</code>", throw a <code id=fill-and-stroke-styles:syntaxerror-3><a href=infrastructure.html#syntaxerror>SyntaxError</a></code>
   exception and abort these steps.<li><p>Create a new <code id=fill-and-stroke-styles:canvaspattern-10><a href=#canvaspattern>CanvasPattern</a></code> object with the image <var>image</var>
   and the repetition behaviour given by <var>repetition</var>.<li><p>If <a href=#the-image-argument-is-not-origin-clean id=fill-and-stroke-styles:the-image-argument-is-not-origin-clean>the <var>image argument</var> is not origin-clean</a>, then mark the
   <code id=fill-and-stroke-styles:canvaspattern-11><a href=#canvaspattern>CanvasPattern</a></code> object as <dfn id=concept-canvas-pattern-not-origin-clean>not
   origin-clean</dfn>.<li><p>Return the <code id=fill-and-stroke-styles:canvaspattern-12><a href=#canvaspattern>CanvasPattern</a></code> object.</ol>

  <p>Modifying the <var>image</var> used when creating a <code id=fill-and-stroke-styles:canvaspattern-13><a href=#canvaspattern>CanvasPattern</a></code> object
  after calling the <code id=fill-and-stroke-styles:dom-context-2d-createpattern-2><a href=#dom-context-2d-createpattern>createPattern()</a></code> method must
  not affect the pattern(s) rendered by the <code id=fill-and-stroke-styles:canvaspattern-14><a href=#canvaspattern>CanvasPattern</a></code> object.</p>

  <p>Patterns have a transformation matrix, which controls how the pattern is used when it is
  painted. Initially, a pattern's transformation matrix must be the identity transform.</p>

  <p>When the <dfn id=dom-canvaspattern-settransform><code>setTransform()</code></dfn> method
  is invoked on the pattern, the user agent must replace the pattern's transformation matrix with
  the one described by the <code id=fill-and-stroke-styles:svgmatrix><a href=infrastructure.html#svgmatrix>SVGMatrix</a></code> object provided as an argument to the method.</p>

  <p>When a pattern is to be rendered within an area, the user agent must run the following steps to
  determine what is rendered:</p>

  <ol><li><p>Create an infinite transparent black bitmap.<li>

    <p>Place a copy of the image on the bitmap, anchored such that its top left corner is at the
    origin of the coordinate space, with one coordinate space unit per CSS pixel of the image, then
    place repeated copies of this image horizontally to the left and right, if the repetition
    behaviour is "<code>repeat-x</code>", or vertically up and down, if the repetition
    behaviour is "<code>repeat-y</code>", or in all four directions all over the bitmap, if
    the repetition behaviour is "<code>repeat</code>".</p>

    <p>If the original image data is a bitmap image, the value painted at a point in the area of the
    repetitions is computed by filtering the original image data. When scaling up, if the <code id=fill-and-stroke-styles:dom-context-2d-imagesmoothingenabled><a href=#dom-context-2d-imagesmoothingenabled>imageSmoothingEnabled</a></code> attribute is set to
    false, the image must be rendered using nearest-neighbor interpolation. Otherwise, the user agent
    may use any filtering algorithm (for example bilinear interpolation or nearest-neighbor). When
    such a filtering algorithm requires a pixel value from outside the original image data, it must
    instead use the value from wrapping the pixel's coordinates to the original image's dimensions.
    (That is, the filter uses 'repeat' behaviour, regardless of the value of the pattern's repetition
    behaviour.)</p>
    

   <li><p>Transform the resulting bitmap according to the pattern's transformation matrix.<li><p>Transform the resulting bitmap again, this time according to the <a href=#transformations id=fill-and-stroke-styles:transformations-3>current transformation matrix</a>.<li><p>Replace any part of the image outside the area in which the pattern is to be rendered with
   transparent black.<li><p>The resulting bitmap is what is to be rendered, with the same origin and same
   scale.</ol>

  <hr>

  <p>If a radial gradient or repeated pattern is used when the transformation matrix is singular,
  the resulting style must be transparent black (otherwise the gradient or pattern would be
  collapsed to a point or line, leaving the other pixels undefined). Linear gradients and solid
  colours always define all points even with singular tranformation matrices.</p>

  




  <h6 id=drawing-rectangles-to-the-bitmap>4.12.4.2.11 Drawing rectangles to the bitmap</h6>

  <p>There are three methods that immediately draw rectangles to the bitmap. They each take four
  arguments; the first two give the <var>x</var> and <var>y</var> coordinates of
  the top left of the rectangle, and the second two give the width <var>w</var> and height
  <var>h</var> of the rectangle, respectively.</p>

  

  <p>The <a href=#transformations id=drawing-rectangles-to-the-bitmap:transformations>current transformation matrix</a> must be
  applied to the following four coordinates, which form the path that must then be closed to get the
  specified rectangle: <span>(<var>x</var>, <var>y</var>)</span>, <span>(<span><var>x</var>+<var>w</var></span>, <var>y</var>)</span>, <span>(<span><var>x</var>+<var>w</var></span>, <span><var>y</var>+<var>h</var></span>)</span>, <span>(<var>x</var>, <span><var>y</var>+<var>h</var></span>)</span>.</p>

  <p>Shapes are painted without affecting the <a href=#current-default-path id=drawing-rectangles-to-the-bitmap:current-default-path>current default path</a>, and are subject to
  the <a href=#clipping-region id=drawing-rectangles-to-the-bitmap:clipping-region>clipping region</a>, and, with the exception of <code id=drawing-rectangles-to-the-bitmap:dom-context-2d-clearrect><a href=#dom-context-2d-clearrect>clearRect()</a></code>, also <a href=#shadows id=drawing-rectangles-to-the-bitmap:shadows>shadow
  effects</a>, <a href=#dom-context-2d-globalalpha id=drawing-rectangles-to-the-bitmap:dom-context-2d-globalalpha>global alpha</a>, and <a href=#dom-context-2d-globalcompositeoperation id=drawing-rectangles-to-the-bitmap:dom-context-2d-globalcompositeoperation>global composition operators</a>.</p>

  

  <dl class=domintro><dt><var>context</var> . <code id=drawing-rectangles-to-the-bitmap:dom-context-2d-clearrect-2><a href=#dom-context-2d-clearrect>clearRect</a></code>(<var>x</var>, <var>y</var>, <var>w</var>, <var>h</var>)<dd>

    <p>Clears all pixels on the bitmap in the given rectangle to transparent black.</p>

   <dt><var>context</var> . <code id=drawing-rectangles-to-the-bitmap:dom-context-2d-fillrect><a href=#dom-context-2d-fillrect>fillRect</a></code>(<var>x</var>, <var>y</var>, <var>w</var>, <var>h</var>)<dd>

    <p>Paints the given rectangle onto the bitmap, using the current fill style.</p>

   <dt><var>context</var> . <code id=drawing-rectangles-to-the-bitmap:dom-context-2d-strokerect><a href=#dom-context-2d-strokerect>strokeRect</a></code>(<var>x</var>, <var>y</var>, <var>w</var>, <var>h</var>)<dd>

    <p>Paints the box that outlines the given rectangle onto the bitmap, using the current stroke
    style.</p>

   </dl>

  

  <p>The <dfn id=dom-context-2d-clearrect><code>clearRect(<var>x</var>, <var>y</var>, <var>w</var>, <var>h</var>)</code></dfn> method must run the
  following steps:</p>

  <ol><li><p>Let <var>pixels</var> be the set of pixels in the specified rectangle that also
   intersect the current <a href=#clipping-region id=drawing-rectangles-to-the-bitmap:clipping-region-2>clipping region</a>.<li><p>Clear the pixels in <var>pixels</var> to a fully transparent black, erasing any
   previous image.<li><p><a href=#clear-regions-that-cover-the-pixels id=drawing-rectangles-to-the-bitmap:clear-regions-that-cover-the-pixels>Clear regions that cover the pixels</a> in <var>pixels</var> on the
   <a href=#scratch-bitmap id=drawing-rectangles-to-the-bitmap:scratch-bitmap>scratch bitmap</a>.</ol>

  <p class=note>If either height or width are zero, this method has no effect, since the set of
  pixels would be empty.</p>

  <p>The <dfn id=dom-context-2d-fillrect><code>fillRect(<var>x</var>, <var>y</var>, <var>w</var>, <var>h</var>)</code></dfn> method must paint the
  specified rectangular area using the <code id=drawing-rectangles-to-the-bitmap:dom-context-2d-fillstyle><a href=#dom-context-2d-fillstyle>fillStyle</a></code>. If
  either height or width are zero, this method has no effect.</p>

  <p>The <dfn id=dom-context-2d-strokerect><code>strokeRect(<var>x</var>, <var>y</var>, <var>w</var>, <var>h</var>)</code></dfn> method must take the
  result of <a href=#trace-a-path id=drawing-rectangles-to-the-bitmap:trace-a-path>tracing the path</a> described below, using the
  <code id=drawing-rectangles-to-the-bitmap:canvasrenderingcontext2d><a href=#canvasrenderingcontext2d>CanvasRenderingContext2D</a></code> object's line styles, and fill it with the <code id=drawing-rectangles-to-the-bitmap:dom-context-2d-strokestyle><a href=#dom-context-2d-strokestyle>strokeStyle</a></code>.</p>

  <p>If both <var>w</var> and <var>h</var> are zero, the path has a single subpath
  with just one point (<var>x</var>, <var>y</var>), and no lines, and this method
  thus has no effect (the <a href=#trace-a-path id=drawing-rectangles-to-the-bitmap:trace-a-path-2>trace a path</a> algorithm returns an empty path in that
  case).</p>

  <p>If just one of either <var>w</var> or <var>h</var> is zero, then the path has
  a single subpath consisting of two points, with coordinates (<span><var>x</var></span>, <span><var>y</var></span>) and (<span><var>x</var>+<var>w</var></span>, <span><var>y</var></span>+<var>h</var>), in that order, connected by a single straight line.</p>

  <p>Otherwise, the path has a single subpath consisting of four points, with coordinates (<span><var>x</var></span>, <span><var>y</var></span>), (<span><var>x</var>+<var>w</var></span>, <span><var>y</var></span>), (<span><var>x</var>+<var>w</var></span>,
  <span><var>y</var></span>+<var>h</var>), and (<span><var>x</var></span>, <span><var>y</var>+<var>h</var></span>),
  connected to each other in that order by straight lines.</p>

  



  <h6 id=drawing-text-to-the-bitmap>4.12.4.2.12 Drawing text to the bitmap</h6>

  <dl id=text-0 class=domintro><dt><var>context</var> . <code id=drawing-text-to-the-bitmap:dom-context-2d-filltext><a href=#dom-context-2d-filltext>fillText</a></code>(<var>text</var>, <var>x</var>, <var>y</var> [, <var>maxWidth</var> ] )<dt><var>context</var> . <code id=drawing-text-to-the-bitmap:dom-context-2d-stroketext><a href=#dom-context-2d-stroketext>strokeText</a></code>(<var>text</var>, <var>x</var>, <var>y</var> [, <var>maxWidth</var> ] )<dd>

    <p>Fills or strokes (respectively) the given text at the given position. If a maximum width is
    provided, the text will be scaled to fit that width if necessary.</p>

   <dt><var>metrics</var> = <var>context</var> . <code id=drawing-text-to-the-bitmap:dom-context-2d-measuretext><a href=#dom-context-2d-measuretext>measureText</a></code>(<var>text</var>)<dd>

    <p>Returns a <code id=drawing-text-to-the-bitmap:textmetrics><a href=#textmetrics>TextMetrics</a></code> object with the metrics of the given text in the current
    font.</p>

   <dt><var>metrics</var> . <code id=drawing-text-to-the-bitmap:dom-textmetrics-width><a href=#dom-textmetrics-width>width</a></code><dt><var>metrics</var> . <code id=drawing-text-to-the-bitmap:dom-textmetrics-actualboundingboxleft><a href=#dom-textmetrics-actualboundingboxleft>actualBoundingBoxLeft</a></code><dt><var>metrics</var> . <code id=drawing-text-to-the-bitmap:dom-textmetrics-actualboundingboxright><a href=#dom-textmetrics-actualboundingboxright>actualBoundingBoxRight</a></code><dt><var>metrics</var> . <code id=drawing-text-to-the-bitmap:dom-textmetrics-fontboundingboxascent><a href=#dom-textmetrics-fontboundingboxascent>fontBoundingBoxAscent</a></code><dt><var>metrics</var> . <code id=drawing-text-to-the-bitmap:dom-textmetrics-fontboundingboxdescent><a href=#dom-textmetrics-fontboundingboxdescent>fontBoundingBoxDescent</a></code><dt><var>metrics</var> . <code id=drawing-text-to-the-bitmap:dom-textmetrics-actualboundingboxascent><a href=#dom-textmetrics-actualboundingboxascent>actualBoundingBoxAscent</a></code><dt><var>metrics</var> . <code id=drawing-text-to-the-bitmap:dom-textmetrics-actualboundingboxdescent><a href=#dom-textmetrics-actualboundingboxdescent>actualBoundingBoxDescent</a></code><dt><var>metrics</var> . <code id=drawing-text-to-the-bitmap:dom-textmetrics-emheightascent><a href=#dom-textmetrics-emheightascent>emHeightAscent</a></code><dt><var>metrics</var> . <code id=drawing-text-to-the-bitmap:dom-textmetrics-emheightdescent><a href=#dom-textmetrics-emheightdescent>emHeightDescent</a></code><dt><var>metrics</var> . <code id=drawing-text-to-the-bitmap:dom-textmetrics-hangingbaseline><a href=#dom-textmetrics-hangingbaseline>hangingBaseline</a></code><dt><var>metrics</var> . <code id=drawing-text-to-the-bitmap:dom-textmetrics-alphabeticbaseline><a href=#dom-textmetrics-alphabeticbaseline>alphabeticBaseline</a></code><dt><var>metrics</var> . <code id=drawing-text-to-the-bitmap:dom-textmetrics-ideographicbaseline><a href=#dom-textmetrics-ideographicbaseline>ideographicBaseline</a></code><dd>

    <p>Returns the measurement described below.</p>

   </dl>

  

  <p>The <code id=drawing-text-to-the-bitmap:canvasrenderingcontext2d><a href=#canvasrenderingcontext2d>CanvasRenderingContext2D</a></code> interface provides the following methods for
  rendering text.</p>

  <p>The <dfn id=dom-context-2d-filltext><code>fillText()</code></dfn> and <dfn id=dom-context-2d-stroketext><code>strokeText()</code></dfn> methods take three or four
  arguments, <var>text</var>, <var>x</var>, <var>y</var>, and optionally
  <var>maxWidth</var>, and render the given <var>text</var> at the given (<var>x</var>, <var>y</var>) coordinates ensuring that the text isn't wider than <var>maxWidth</var> if specified, using the current <code id=drawing-text-to-the-bitmap:dom-context-2d-font><a href=#dom-context-2d-font>font</a></code>, <code id=drawing-text-to-the-bitmap:dom-context-2d-textalign><a href=#dom-context-2d-textalign>textAlign</a></code>,
  and <code id=drawing-text-to-the-bitmap:dom-context-2d-textbaseline><a href=#dom-context-2d-textbaseline>textBaseline</a></code> values. Specifically, when the
  methods are called, the user agent must run the following steps:</p>

  <ol><li><p>Run the <a href=#text-preparation-algorithm id=drawing-text-to-the-bitmap:text-preparation-algorithm>text preparation algorithm</a>, passing it <var>text</var>, the
   <code id=drawing-text-to-the-bitmap:canvasrenderingcontext2d-2><a href=#canvasrenderingcontext2d>CanvasRenderingContext2D</a></code> object, and, if the <var>maxWidth</var> argument
   was provided, that argument. Let <var>glyphs</var> be the result.</p>

   <li><p>Move all the shapes in <var>glyphs</var> to the right by <var>x</var>
   CSS pixels and down by <var>y</var> CSS pixels.<li>

    <p>Paint the shapes given in <var>glyphs</var>, as transformed by the <a href=#transformations id=drawing-text-to-the-bitmap:transformations>current transformation matrix</a>, with each CSS pixel
    in the coordinate space of <var>glyphs</var> mapped to one coordinate space unit.</p>

    <p>For <code id=drawing-text-to-the-bitmap:dom-context-2d-filltext-2><a href=#dom-context-2d-filltext>fillText()</a></code>, <code id=drawing-text-to-the-bitmap:dom-context-2d-fillstyle><a href=#dom-context-2d-fillstyle>fillStyle</a></code> must be applied to the shapes and <code id=drawing-text-to-the-bitmap:dom-context-2d-strokestyle><a href=#dom-context-2d-strokestyle>strokeStyle</a></code> must be ignored. For <code id=drawing-text-to-the-bitmap:dom-context-2d-stroketext-2><a href=#dom-context-2d-stroketext>strokeText()</a></code>, the reverse holds: <code id=drawing-text-to-the-bitmap:dom-context-2d-strokestyle-2><a href=#dom-context-2d-strokestyle>strokeStyle</a></code> must be applied to the result of <a href=#trace-a-path id=drawing-text-to-the-bitmap:trace-a-path>tracing</a> the shapes using the <code id=drawing-text-to-the-bitmap:canvasrenderingcontext2d-3><a href=#canvasrenderingcontext2d>CanvasRenderingContext2D</a></code>
    object for the line styles, and <code id=drawing-text-to-the-bitmap:dom-context-2d-fillstyle-2><a href=#dom-context-2d-fillstyle>fillStyle</a></code> must be
    ignored.</p>

    <p>These shapes are painted without affecting the current path, and are subject to <a href=#shadows id=drawing-text-to-the-bitmap:shadows>shadow effects</a>, <a href=#dom-context-2d-globalalpha id=drawing-text-to-the-bitmap:dom-context-2d-globalalpha>global
    alpha</a>, the <a href=#clipping-region id=drawing-text-to-the-bitmap:clipping-region>clipping region</a>, and <a href=#dom-context-2d-globalcompositeoperation id=drawing-text-to-the-bitmap:dom-context-2d-globalcompositeoperation>global composition operators</a>.</p>

   <li><p>If the <a href=#text-preparation-algorithm id=drawing-text-to-the-bitmap:text-preparation-algorithm-2>text preparation algorithm</a> used a font that has an <a id=drawing-text-to-the-bitmap:origin-2 href=browsers.html#origin-2>origin</a>
   that is not the <a href=browsers.html#same-origin id=drawing-text-to-the-bitmap:same-origin>same</a> as the <a id=drawing-text-to-the-bitmap:origin-2-2 href=browsers.html#origin-2>origin</a> specified by
   the <a id=drawing-text-to-the-bitmap:entry-settings-object href=webappapis.html#entry-settings-object>entry settings object</a> (even if "using a font" means just checking if that font
   has a particular glyph in it before falling back to another font), then set the <a href=#scratch-bitmap id=drawing-text-to-the-bitmap:scratch-bitmap>scratch
   bitmap</a>'s <a href=#concept-canvas-origin-clean id=drawing-text-to-the-bitmap:concept-canvas-origin-clean>origin-clean</a> flag to
   false.</ol>



  <p>The <dfn id=dom-context-2d-measuretext><code>measureText()</code></dfn> method takes one
  argument, <var>text</var>. When the method is invoked, the user agent must run the
  <a href=#text-preparation-algorithm id=drawing-text-to-the-bitmap:text-preparation-algorithm-3>text preparation algorithm</a>, passing it <var>text</var> and the
  <code id=drawing-text-to-the-bitmap:canvasrenderingcontext2d-4><a href=#canvasrenderingcontext2d>CanvasRenderingContext2D</a></code> object, and then using the returned inline box must create a
  new <code id=drawing-text-to-the-bitmap:textmetrics-2><a href=#textmetrics>TextMetrics</a></code> object with its attributes set as described in the following list.

  If doing these measurements requires using a font that has an <a id=drawing-text-to-the-bitmap:origin-2-3 href=browsers.html#origin-2>origin</a> that is not the
  <a href=browsers.html#same-origin id=drawing-text-to-the-bitmap:same-origin-2>same</a> as that of the <code id=drawing-text-to-the-bitmap:document><a href=dom.html#document>Document</a></code> object that owns the
  <code id=drawing-text-to-the-bitmap:the-canvas-element><a href=#the-canvas-element>canvas</a></code> element (even if "using a font" means just checking if that font has a
  particular glyph in it before falling back to another font), then the method must throw a
  <code id=drawing-text-to-the-bitmap:securityerror><a href=infrastructure.html#securityerror>SecurityError</a></code> exception.

  Otherwise, it must return the new <code id=drawing-text-to-the-bitmap:textmetrics-3><a href=#textmetrics>TextMetrics</a></code> object.
  <a href=references.html#refsCSS>[CSS]</a>
  <a id=drawing-text-to-the-bitmap:fingerprinting-vector title="There is a potential fingerprinting vector here." href=introduction.html#fingerprinting-vector class=fingerprint><img alt="(This is a fingerprinting vector.)" src=https://images.whatwg.org/fingerprint.png width=46 height=64></a>
  </p>

  

  <dl><dt><dfn id=dom-textmetrics-width><code>width</code></dfn> attribute<dd><p>The width of that inline box, in CSS pixels. (The text's advance width.)<dt><dfn id=dom-textmetrics-actualboundingboxleft><code>actualBoundingBoxLeft</code></dfn> attribute<dd>

    <p>The distance parallel to the baseline from the alignment point given by the <code id=drawing-text-to-the-bitmap:dom-context-2d-textalign-2><a href=#dom-context-2d-textalign>textAlign</a></code> attribute to the left side of the bounding
    rectangle of the given text, in CSS pixels; positive numbers indicating a distance going left
    from the given alignment point.

    <p class=note>The sum of this value and the next (<code id=drawing-text-to-the-bitmap:dom-textmetrics-actualboundingboxright-2><a href=#dom-textmetrics-actualboundingboxright>actualBoundingBoxRight</a></code>) can be wider than
    the width of the inline box (<code id=drawing-text-to-the-bitmap:dom-textmetrics-width-2><a href=#dom-textmetrics-width>width</a></code>), in particular
    with slanted fonts where characters overhang their advance width.</p>

   <dt><dfn id=dom-textmetrics-actualboundingboxright><code>actualBoundingBoxRight</code></dfn> attribute<dd>

    <p>The distance parallel to the baseline from the alignment point given by the <code id=drawing-text-to-the-bitmap:dom-context-2d-textalign-3><a href=#dom-context-2d-textalign>textAlign</a></code> attribute to the right side of the bounding
    rectangle of the given text, in CSS pixels; positive numbers indicating a distance going right
    from the given alignment point.</p>

   <dt><dfn id=dom-textmetrics-fontboundingboxascent><code>fontBoundingBoxAscent</code></dfn> attribute<dd>

    <p>The distance from the horizontal line indicated by the <code id=drawing-text-to-the-bitmap:dom-context-2d-textbaseline-2><a href=#dom-context-2d-textbaseline>textBaseline</a></code> attribute to the top of the highest
    bounding rectangle of all the fonts used to render the text, in CSS pixels; positive numbers
    indicating a distance going up from the given baseline.</p>

    <p class=note>This value and the next are useful when rendering a background that must have a
    consistent height even if the exact text being rendered changes. The <code id=drawing-text-to-the-bitmap:dom-textmetrics-actualboundingboxascent-2><a href=#dom-textmetrics-actualboundingboxascent>actualBoundingBoxAscent</a></code> attribute (and
    its corresponding attribute for the descent) are useful when drawing a bounding box around
    specific text.</p>

   <dt><dfn id=dom-textmetrics-fontboundingboxdescent><code>fontBoundingBoxDescent</code></dfn> attribute<dd><p>The distance from the horizontal line indicated by the <code id=drawing-text-to-the-bitmap:dom-context-2d-textbaseline-3><a href=#dom-context-2d-textbaseline>textBaseline</a></code> attribute to the bottom of the lowest
   bounding rectangle of all the fonts used to render the text, in CSS pixels; positive numbers
   indicating a distance going down from the given baseline.<dt><dfn id=dom-textmetrics-actualboundingboxascent><code>actualBoundingBoxAscent</code></dfn> attribute<dd>

    <p>The distance from the horizontal line indicated by the <code id=drawing-text-to-the-bitmap:dom-context-2d-textbaseline-4><a href=#dom-context-2d-textbaseline>textBaseline</a></code> attribute to the top of the bounding
    rectangle of the given text, in CSS pixels; positive numbers indicating a distance going up from
    the given baseline.

    <p class=note>This number can vary greatly based on the input text, even if the first font
    specified covers all the characters in the input. For example, the <code id=drawing-text-to-the-bitmap:dom-textmetrics-actualboundingboxascent-3><a href=#dom-textmetrics-actualboundingboxascent>actualBoundingBoxAscent</a></code> of a lowercase
    "o" from an alphabetic baseline would be less than that of an uppercase "F". The value can
    easily be negative; for example, the distance from the top of the em box (<code id=drawing-text-to-the-bitmap:dom-context-2d-textbaseline-5><a href=#dom-context-2d-textbaseline>textBaseline</a></code> value "<code id=drawing-text-to-the-bitmap:dom-context-2d-textbaseline-top><a href=#dom-context-2d-textbaseline-top>top</a></code>") to the top of the bounding rectangle when
    the given text is just a single comma "<code>,</code>" would likely (unless the font is
    quite unusual) be negative.</p>

   <dt><dfn id=dom-textmetrics-actualboundingboxdescent><code>actualBoundingBoxDescent</code></dfn> attribute<dd><p>The distance from the horizontal line indicated by the <code id=drawing-text-to-the-bitmap:dom-context-2d-textbaseline-6><a href=#dom-context-2d-textbaseline>textBaseline</a></code> attribute to the bottom of the bounding
   rectangle of the given text, in CSS pixels; positive numbers indicating a distance going down
   from the given baseline.<dt><dfn id=dom-textmetrics-emheightascent><code>emHeightAscent</code></dfn> attribute<dd><p>The distance from the horizontal line indicated by the <code id=drawing-text-to-the-bitmap:dom-context-2d-textbaseline-7><a href=#dom-context-2d-textbaseline>textBaseline</a></code> attribute to the highest top of the em
   squares in the line box, in CSS pixels; positive numbers indicating that the given baseline is
   below the top of that em square (so this value will usually be positive). Zero if the given
   baseline is the top of that em square; half the font size if the given baseline is the middle of
   that em square.<dt><dfn id=dom-textmetrics-emheightdescent><code>emHeightDescent</code></dfn> attribute<dd><p>The distance from the horizontal line indicated by the <code id=drawing-text-to-the-bitmap:dom-context-2d-textbaseline-8><a href=#dom-context-2d-textbaseline>textBaseline</a></code> attribute to the lowest bottom of the em
   squares in the line box, in CSS pixels; positive numbers indicating that the given baseline is
   below the bottom of that em square (so this value will usually be negative). (Zero if the given
   baseline is the top of that em square.)<dt><dfn id=dom-textmetrics-hangingbaseline><code>hangingBaseline</code></dfn> attribute<dd><p>The distance from the horizontal line indicated by the <code id=drawing-text-to-the-bitmap:dom-context-2d-textbaseline-9><a href=#dom-context-2d-textbaseline>textBaseline</a></code> attribute to the hanging baseline of the
   line box, in CSS pixels; positive numbers indicating that the given baseline is below the hanging
   baseline. (Zero if the given baseline is the hanging baseline.)<dt><dfn id=dom-textmetrics-alphabeticbaseline><code>alphabeticBaseline</code></dfn> attribute<dd><p>The distance from the horizontal line indicated by the <code id=drawing-text-to-the-bitmap:dom-context-2d-textbaseline-10><a href=#dom-context-2d-textbaseline>textBaseline</a></code> attribute to the alphabetic baseline of
   the line box, in CSS pixels; positive numbers indicating that the given baseline is below the
   alphabetic baseline. (Zero if the given baseline is the alphabetic baseline.)<dt><dfn id=dom-textmetrics-ideographicbaseline><code>ideographicBaseline</code></dfn> attribute<dd><p>The distance from the horizontal line indicated by the <code id=drawing-text-to-the-bitmap:dom-context-2d-textbaseline-11><a href=#dom-context-2d-textbaseline>textBaseline</a></code> attribute to the ideographic baseline of
   the line box, in CSS pixels; positive numbers indicating that the given baseline is below the
   ideographic baseline. (Zero if the given baseline is the ideographic baseline.)</dl>

  <p class=note>Glyphs rendered using <code id=drawing-text-to-the-bitmap:dom-context-2d-filltext-3><a href=#dom-context-2d-filltext>fillText()</a></code> and
  <code id=drawing-text-to-the-bitmap:dom-context-2d-stroketext-3><a href=#dom-context-2d-stroketext>strokeText()</a></code> can spill out of the box given by the
  font size (the em square size) and the width returned by <code id=drawing-text-to-the-bitmap:dom-context-2d-measuretext-2><a href=#dom-context-2d-measuretext>measureText()</a></code> (the text width). Authors are encouraged
  to use the bounding box values described above if this is an issue.</p>

  <p class=note>A future version of the 2D context API may provide a way to render fragments of
  documents, rendered using CSS, straight to the canvas. This would be provided in preference to a
  dedicated way of doing multiline layout.</p>



  <h6 id=drawing-paths-to-the-canvas>4.12.4.2.13 Drawing paths to the canvas</h6>

  <p>The context always has a <dfn id=current-default-path>current default path</dfn>. There is only one <a href=#current-default-path id=drawing-paths-to-the-canvas:current-default-path>current
  default path</a>, it is not part of the <a href=#drawing-state id=drawing-paths-to-the-canvas:drawing-state>drawing state</a>. The <a href=#current-default-path id=drawing-paths-to-the-canvas:current-default-path-2>current default
  path</a> is a <a href=#concept-path id=drawing-paths-to-the-canvas:concept-path>path</a>, as described above.</p>

  <dl class=domintro><dt><var>context</var> . <code id=drawing-paths-to-the-canvas:dom-context-2d-beginpath><a href=#dom-context-2d-beginpath>beginPath</a></code>()<dd>

    <p>Resets the <a href=#current-default-path id=drawing-paths-to-the-canvas:current-default-path-3>current default path</a>.</p>

   <dt><var>context</var> . <code id=drawing-paths-to-the-canvas:dom-context-2d-fill><a href=#dom-context-2d-fill>fill</a></code>( [ <var>fillRule</var> ] )<dt><var>context</var> . <code id=drawing-paths-to-the-canvas:dom-context-2d-fill-2><a href=#dom-context-2d-fill>fill</a></code>(<var>path</var> [, <var>fillRule</var> ] )<dd>

    <p>Fills the subpaths of the <a href=#current-default-path id=drawing-paths-to-the-canvas:current-default-path-4>current default path</a> or the given path with the
    current fill style, obeying the given fill rule.</p>

   <dt><var>context</var> . <code id=drawing-paths-to-the-canvas:dom-context-2d-stroke><a href=#dom-context-2d-stroke>stroke</a></code>()<dt><var>context</var> . <code id=drawing-paths-to-the-canvas:dom-context-2d-stroke-2><a href=#dom-context-2d-stroke>stroke</a></code>(<var>path</var>)<dd>

    <p>Strokes the subpaths of the <a href=#current-default-path id=drawing-paths-to-the-canvas:current-default-path-5>current default path</a> or the given path with the
    current stroke style.</p>

   <dt><var>context</var> . <code id=drawing-paths-to-the-canvas:dom-context-2d-drawfocusifneeded><a href=#dom-context-2d-drawfocusifneeded>drawFocusIfNeeded</a></code>(<var>element</var>)<dt><var>context</var> . <code id=drawing-paths-to-the-canvas:dom-context-2d-drawfocusifneeded-2><a href=#dom-context-2d-drawfocusifneeded>drawFocusIfNeeded</a></code>(<var>path</var>, <var>element</var>)<dd>

    <p>If the given element is <a id=drawing-paths-to-the-canvas:focused href=interaction.html#focused>focused</a>, draws a focus ring around the <a href=#current-default-path id=drawing-paths-to-the-canvas:current-default-path-6>current
    default path</a> or the given path, following the platform conventions for focus rings.</p>

   <dt><var>context</var> . <code id=drawing-paths-to-the-canvas:dom-context-2d-scrollpathintoview><a href=#dom-context-2d-scrollpathintoview>scrollPathIntoView</a></code>()<dt><var>context</var> . <code id=drawing-paths-to-the-canvas:dom-context-2d-scrollpathintoview-2><a href=#dom-context-2d-scrollpathintoview>scrollPathIntoView</a></code>(<var>path</var>)<dd>

    <p>Scrolls the <a href=#current-default-path id=drawing-paths-to-the-canvas:current-default-path-7>current default path</a> or the given path into view. This is especially
    useful on devices with small screens, where the whole canvas might not be visible at once.</p>

   <dt><var>context</var> . <code id=drawing-paths-to-the-canvas:dom-context-2d-clip><a href=#dom-context-2d-clip>clip</a></code>( [ <var>fillRule</var> ] )<dt><var>context</var> . <code id=drawing-paths-to-the-canvas:dom-context-2d-clip-2><a href=#dom-context-2d-clip>clip</a></code>(<var>path</var> [, <var>fillRule</var> ] )<dd>

    <p>Further constrains the clipping region to the <a href=#current-default-path id=drawing-paths-to-the-canvas:current-default-path-8>current default path</a> or the given
    path, using the given fill rule to determine what points are in the path.</p>

   <dt><var>context</var> . <code id=drawing-paths-to-the-canvas:dom-context-2d-resetclip><a href=#dom-context-2d-resetclip>resetClip</a></code>()<dd>

    <p>Unconstrains the clipping region.</p>

   <dt><var>context</var> . <code id=drawing-paths-to-the-canvas:dom-context-2d-ispointinpath><a href=#dom-context-2d-ispointinpath>isPointInPath</a></code>(<var>x</var>, <var>y</var> [, <var>fillRule</var> ] )<dt><var>context</var> . <code id=drawing-paths-to-the-canvas:dom-context-2d-ispointinpath-2><a href=#dom-context-2d-ispointinpath>isPointInPath</a></code>(<var>path</var>, <var>x</var>, <var>y</var> [, <var>fillRule</var> ] )<dd>

    <p>Returns true if the given point is in the <a href=#current-default-path id=drawing-paths-to-the-canvas:current-default-path-9>current default path</a> or the given
    path, using the given fill rule to determine what points are in the path.</p>

   <dt><var>context</var> . <code id=drawing-paths-to-the-canvas:dom-context-2d-ispointinstroke><a href=#dom-context-2d-ispointinstroke>isPointInStroke</a></code>(<var>x</var>, <var>y</var>)<dt><var>context</var> . <code id=drawing-paths-to-the-canvas:dom-context-2d-ispointinstroke-2><a href=#dom-context-2d-ispointinstroke>isPointInStroke</a></code>(<var>path</var>, <var>x</var>, <var>y</var>)<dd>

    <p>Returns true if the given point would be in the region covered by the stroke of the
    <a href=#current-default-path id=drawing-paths-to-the-canvas:current-default-path-10>current default path</a> or the given path, given the current stroke style.</p>

   </dl>

  

  <p>The <dfn id=dom-context-2d-beginpath><code>beginPath()</code></dfn> method must empty the
  list of subpaths in the context's <a href=#current-default-path id=drawing-paths-to-the-canvas:current-default-path-11>current default path</a> so that the it once again has
  zero subpaths.</p>

  <p>Where the following method definitions use the term <i>intended path</i>, it means the
  <code id=drawing-paths-to-the-canvas:path2d><a href=#path2d>Path2D</a></code> argument, if one was provided, or the <a href=#current-default-path id=drawing-paths-to-the-canvas:current-default-path-12>current default path</a>
  otherwise.</p>

  <p>When the intended path is a <code id=drawing-paths-to-the-canvas:path2d-2><a href=#path2d>Path2D</a></code> object, the coordinates and lines of its
  subpaths must be transformed according to the <code id=drawing-paths-to-the-canvas:canvasrenderingcontext2d><a href=#canvasrenderingcontext2d>CanvasRenderingContext2D</a></code> object's <a href=#transformations id=drawing-paths-to-the-canvas:transformations>current transformation matrix</a> when used by these
  methods (without affecting the <code id=drawing-paths-to-the-canvas:path2d-3><a href=#path2d>Path2D</a></code> object itself). When the intended path is the
  <a href=#current-default-path id=drawing-paths-to-the-canvas:current-default-path-13>current default path</a>, it is not affected by the transform. (This is because
  transformations already affect the <a href=#current-default-path id=drawing-paths-to-the-canvas:current-default-path-14>current default path</a> when it is constructed, so
  applying it when it is painted as well would result in a double transformation.)</p>

  <p>The <dfn id=dom-context-2d-fill><code>fill()</code></dfn> method must fill all the
  subpaths of the intended path, using <code id=drawing-paths-to-the-canvas:dom-context-2d-fillstyle><a href=#dom-context-2d-fillstyle>fillStyle</a></code>, and
  using the <a href=#fill-rule id=drawing-paths-to-the-canvas:fill-rule>fill rule</a> indicated by the <var>fillRule</var> argument. Open
  subpaths must be implicitly closed when being filled (without affecting the actual subpaths).</p>

  <p>The <dfn id=dom-context-2d-stroke><code>stroke()</code></dfn> method must <a href=#trace-a-path id=drawing-paths-to-the-canvas:trace-a-path>trace</a> the intended path, using the
  <code id=drawing-paths-to-the-canvas:canvasrenderingcontext2d-2><a href=#canvasrenderingcontext2d>CanvasRenderingContext2D</a></code> object for the line styles, and then fill the resulting path
  using the <code id=drawing-paths-to-the-canvas:dom-context-2d-strokestyle><a href=#dom-context-2d-strokestyle>strokeStyle</a></code> attribute, using the <a href=#dom-context-2d-fillrule-nonzero id=drawing-paths-to-the-canvas:dom-context-2d-fillrule-nonzero>non-zero winding rule</a>.</p>

  <p class=note>As a result of how the algorithm to <a href=#trace-a-path id=drawing-paths-to-the-canvas:trace-a-path-2>trace a path</a> is defined,
  overlapping parts of the paths in one stroke operation are treated as if their union was what was
  painted.</p>

  <p class=note>The stroke <em>style</em> is affected by the transformation during painting, even
  if the intended path is the <a href=#current-default-path id=drawing-paths-to-the-canvas:current-default-path-15>current default path</a>.</p>

  <p>Paths, when filled or stroked, must be painted without affecting the <a href=#current-default-path id=drawing-paths-to-the-canvas:current-default-path-16>current default
  path</a> or any <code id=drawing-paths-to-the-canvas:path2d-4><a href=#path2d>Path2D</a></code> objects, and must be subject to <a href=#shadows id=drawing-paths-to-the-canvas:shadows>shadow effects</a>, <a href=#dom-context-2d-globalalpha id=drawing-paths-to-the-canvas:dom-context-2d-globalalpha>global
  alpha</a>, the <a href=#clipping-region id=drawing-paths-to-the-canvas:clipping-region>clipping region</a>, and <a href=#dom-context-2d-globalcompositeoperation id=drawing-paths-to-the-canvas:dom-context-2d-globalcompositeoperation>global composition operators</a>. (The effect
  of transformations is described above and varies based on which path is being used.)</p>

  <hr>

  <p id=dom-context-2d-drawosfocusring>The <dfn id=dom-context-2d-drawfocusifneeded><code>drawFocusIfNeeded(<var>element</var>)</code></dfn> method, when invoked, must run the following steps:</p>

  <ol><li><p>If <var>element</var> is not <a id=drawing-paths-to-the-canvas:focused-2 href=interaction.html#focused>focused</a> or is not a descendant of the element with
   whose context the method is associated, then abort these steps.<li>

    <p>Draw a focus ring of the appropriate style along the intended path, following platform
    conventions.</p>

    <p class=note>Some platforms only draw focus rings around elements that have been focused from
    the keyboard, and not those focused from the mouse. Other platforms simply don't draw focus
    rings around some elements at all unless relevant accessibility features are enabled. This API
    is intended to follow these conventions. User agents that implement distinctions based on the
    manner in which the element was focused are encouraged to classify focus driven by the <code id=drawing-paths-to-the-canvas:dom-focus><a href=interaction.html#dom-focus>focus()</a></code> method based on the kind of user interaction event from which
    the call was triggered (if any).</p>

    <p>The focus ring should not be subject to the <a href=#shadows id=drawing-paths-to-the-canvas:shadows-2>shadow effects</a>, the
    <a href=#dom-context-2d-globalalpha id=drawing-paths-to-the-canvas:dom-context-2d-globalalpha-2>global alpha</a>, the <a href=#dom-context-2d-globalcompositeoperation id=drawing-paths-to-the-canvas:dom-context-2d-globalcompositeoperation-2>global composition operators</a>, the <code id=drawing-paths-to-the-canvas:dom-context-2d-fillstyle-2><a href=#dom-context-2d-fillstyle>fillStyle</a></code> attribute, the <code id=drawing-paths-to-the-canvas:dom-context-2d-strokestyle-2><a href=#dom-context-2d-strokestyle>strokeStyle</a></code> attribute, or any of the
    <code id=drawing-paths-to-the-canvas:canvasdrawingstyles><a href=#canvasdrawingstyles>CanvasDrawingStyles</a></code> members, but <em>should</em> be subject to the <a href=#clipping-region id=drawing-paths-to-the-canvas:clipping-region-2>clipping
    region</a>. (The effect of transformations is described above and varies based on which path
    is being used.)</p>

   <li>

    <p>Optionally, run the appropriate step from the following list:</p>

    <dl><dt>If the <code id=drawing-paths-to-the-canvas:canvasrenderingcontext2d-3><a href=#canvasrenderingcontext2d>CanvasRenderingContext2D</a></code> object's <a href=#concept-canvas-context-bitmap-mode id=drawing-paths-to-the-canvas:concept-canvas-context-bitmap-mode>context bitmap mode</a> is <a href=#concept-canvas-fixed id=drawing-paths-to-the-canvas:concept-canvas-fixed>fixed</a><dd><p><a href=#inform>Inform the user</a> that the focus is at the location given by the
     intended path. User agents may wait until the next time the <a id=drawing-paths-to-the-canvas:event-loop href=webappapis.html#event-loop>event loop</a> reaches its
     <i>update the rendering</i> step to optionally inform the user.<dt>Otherwise<dd><p>Add instructions to the <a href=#scratch-bitmap id=drawing-paths-to-the-canvas:scratch-bitmap>scratch bitmap</a>'s <a href=#list-of-pending-interface-actions id=drawing-paths-to-the-canvas:list-of-pending-interface-actions>list of pending interface
     actions</a> that <a href=#inform>inform the user</a> that the focus is at the location of
     the bitmap given by the intended path.</dl>

   </ol>

  <p>User agents should not implicitly close open subpaths in the intended path when drawing the
  focus ring.</p>

  <p class=note>This might be a moot point, however. For example, if the focus ring is drawn as an
  axis-aligned bounding rectangle around the points in the intended path, then whether the subpaths
  are closed or not has no effect. This specification intentionally does not specify precisely how
  focus rings are to be drawn: user agents are expected to honor their platform's native
  conventions.</p>

  <hr>

  <p>The <dfn id=dom-context-2d-scrollpathintoview><code>scrollPathIntoView()</code></dfn>
  method, when invoked, if the <code id=drawing-paths-to-the-canvas:canvasrenderingcontext2d-4><a href=#canvasrenderingcontext2d>CanvasRenderingContext2D</a></code> object's <a href=#concept-canvas-context-bitmap-mode id=drawing-paths-to-the-canvas:concept-canvas-context-bitmap-mode-2>context bitmap mode</a> is <a href=#concept-canvas-fixed id=drawing-paths-to-the-canvas:concept-canvas-fixed-2>fixed</a>, must run the following steps; and otherwise, must add
  instructions to the <a href=#scratch-bitmap id=drawing-paths-to-the-canvas:scratch-bitmap-2>scratch bitmap</a>'s <a href=#list-of-pending-interface-actions id=drawing-paths-to-the-canvas:list-of-pending-interface-actions-2>list of pending interface actions</a>
  that run the following steps:</p>

  <ol><li><p>Let <var>the specified rectangle</var> be the rectangle of the bounding box of
   the intended path.<li><p>Let <var>notional child</var> be a hypothetical element that is a rendered child
   of the <code id=drawing-paths-to-the-canvas:the-canvas-element><a href=#the-canvas-element>canvas</a></code> element whose dimensions are those of <var>the specified
   rectangle</var>.<li><p><a href=infrastructure.html#scroll-an-element-into-view id=drawing-paths-to-the-canvas:scroll-an-element-into-view>Scroll <var>notional child</var> into
   view</a> with the <var>align to top flag</var> set.</p>

   <li><p>Optionally, <a href=#inform>inform the user</a> that the caret or selection (or both)
   cover <var>the specified rectangle</var> of the canvas. If the
   <code id=drawing-paths-to-the-canvas:canvasrenderingcontext2d-5><a href=#canvasrenderingcontext2d>CanvasRenderingContext2D</a></code> object's <a href=#concept-canvas-context-bitmap-mode id=drawing-paths-to-the-canvas:concept-canvas-context-bitmap-mode-3>context bitmap mode</a> was <a href=#concept-canvas-fixed id=drawing-paths-to-the-canvas:concept-canvas-fixed-3>fixed</a> when the method was invoked, the user agent may wait
   until the next time the <a id=drawing-paths-to-the-canvas:event-loop-2 href=webappapis.html#event-loop>event loop</a> reaches its <i>update the rendering</i> step to
   optionally inform the user.</ol>

  <p id=inform>"Inform the user", as used in this section, does not imply any persistent state
  change. It could mean, for instance, calling a system accessibility API to notify assistive
  technologies such as magnification tools so that the user's magnifier moves to the given area of
  the canvas. However, it does not associate the path with the element, or provide a region for
  tactile feedback, etc. To persistently associate a region with information provided to
  accessibility tools, use the <code id=drawing-paths-to-the-canvas:dom-context-2d-addhitregion><a href=#dom-context-2d-addhitregion>addHitRegion()</a></code>
  API.</p>

  <hr>

  <p>The <dfn id=dom-context-2d-clip><code>clip()</code></dfn> method must create a new
  <dfn id=clipping-region>clipping region</dfn> by calculating the intersection of the current clipping region and the
  area described by the intended path, using the <a href=#fill-rule id=drawing-paths-to-the-canvas:fill-rule-2>fill rule</a> indicated by the <var>fillRule</var> argument. Open subpaths must be implicitly closed when computing the
  clipping region, without affecting the actual subpaths. The new clipping region replaces the
  current clipping region.</p>

  <p>When the context is initialised, the clipping region must be set to the largest infinite
  surface (i.e. by default, no clipping occurs).</p>

  

  <p>The <dfn id=dom-context-2d-resetclip><code>resetClip()</code></dfn> method must create a
  new <a href=#clipping-region id=drawing-paths-to-the-canvas:clipping-region-3>clipping region</a> that is the largest infinite surface. The new clipping region
  replaces the current clipping region.</p>

  <hr>

  <p>The <dfn id=dom-context-2d-ispointinpath><code>isPointInPath()</code></dfn> method must
  return true if the point given by the <var>x</var> and <var>y</var> coordinates
  passed to the method, when treated as coordinates in the canvas coordinate space unaffected by the
  current transformation, is inside the intended path as determined by the <a href=#fill-rule id=drawing-paths-to-the-canvas:fill-rule-3>fill rule</a>
  indicated by the <var>fillRule</var> argument; and must return false otherwise. Open
  subpaths must be implicitly closed when computing the area inside the path, without affecting the
  actual subpaths. Points on the path itself must be considered to be inside the path. If either of
  the arguments is infinite or NaN, then the method must return false.</p>

  <hr>

  <p>The <dfn id=dom-context-2d-ispointinstroke><code>isPointInStroke()</code></dfn> method
  must return true if the point given by the <var>x</var> and <var>y</var>
  coordinates passed to the method, when treated as coordinates in the canvas coordinate space
  unaffected by the current transformation, is inside the path that results from <a href=#trace-a-path id=drawing-paths-to-the-canvas:trace-a-path-3>tracing</a> the intended path, using the <a href=#dom-context-2d-fillrule-nonzero id=drawing-paths-to-the-canvas:dom-context-2d-fillrule-nonzero-2>non-zero winding rule</a>, and using the
  <code id=drawing-paths-to-the-canvas:canvasrenderingcontext2d-6><a href=#canvasrenderingcontext2d>CanvasRenderingContext2D</a></code> object for the line styles; and must return false otherwise.
  Points on the resulting path must be considered to be inside the path. If either of the arguments
  is infinite or NaN, then the method must return false.</p>

  <hr>

  

  <div id=drawCustomFocusRingExample class=example>

   <p>This <code id=drawing-paths-to-the-canvas:the-canvas-element-2><a href=#the-canvas-element>canvas</a></code> element has a couple of checkboxes. The path-related commands are
   highlighted:</p>

   <pre>&lt;canvas height=400 width=750>
 &lt;label>&lt;input type=checkbox id=showA> Show As&lt;/label>
 &lt;label>&lt;input type=checkbox id=showB> Show Bs&lt;/label>
 &lt;!-- ... -->
&lt;/canvas>
&lt;script>
 function drawCheckbox(context, element, x, y, paint) {
   context.save();
   context.font = '10px sans-serif';
   context.textAlign = 'left';
   context.textBaseline = 'middle';
   var metrics = context.measureText(element.labels[0].textContent);
   if (paint) {
<strong>     context.beginPath();
     context.strokeStyle = 'black';
     context.rect(x-5, y-5, 10, 10);
     context.stroke();
     context.addHitRegion({ control: element });
</strong>     if (element.checked) {
<strong>       context.fillStyle = 'black';
       context.fill();
</strong>     }
     context.fillText(element.labels[0].textContent, x+5, y);
   }
<strong>   context.beginPath();
   context.rect(x-7, y-7, 12 + metrics.width+2, 14);
   context.drawFocusIfNeeded(element)) {
</strong>   context.restore();
 }
 function drawBase() { /* ... */ }
 function drawAs() { /* ... */ }
 function drawBs() { /* ... */ }
 function redraw() {
   var canvas = document.getElementsByTagName('canvas')[0];
   var context = canvas.getContext('2d');
   context.clearRect(0, 0, canvas.width, canvas.height);
   drawCheckbox(context, document.getElementById('showA'), 20, 40, true);
   drawCheckbox(context, document.getElementById('showB'), 20, 60, true);
   drawBase();
   if (document.getElementById('showA').checked)
     drawAs();
   if (document.getElementById('showB').checked)
     drawBs();
 }
 function processClick(event) {
   var canvas = document.getElementsByTagName('canvas')[0];
   var context = canvas.getContext('2d');
   var x = event.clientX;
   var y = event.clientY;
   var node = event.target;
   while (node) {
     x -= node.offsetLeft - node.scrollLeft;
     y -= node.offsetTop - node.scrollTop;
     node = node.offsetParent;
   }
   drawCheckbox(context, document.getElementById('showA'), 20, 40, false);
   if (<strong>context.isPointInPath(x, y)</strong>)
     document.getElementById('showA').checked = !(document.getElementById('showA').checked);
   drawCheckbox(context, document.getElementById('showB'), 20, 60, false);
   if (<strong>context.isPointInPath(x, y)</strong>)
     document.getElementById('showB').checked = !(document.getElementById('showB').checked);
   redraw();
 }
 document.getElementsByTagName('canvas')[0].addEventListener('focus', redraw, true);
 document.getElementsByTagName('canvas')[0].addEventListener('blur', redraw, true);
 document.getElementsByTagName('canvas')[0].addEventListener('change', redraw, true);
 document.getElementsByTagName('canvas')[0].addEventListener('click', processClick, false);
 redraw();
&lt;/script></pre>


  </div>



  <h6 id=drawing-images>4.12.4.2.14 Drawing images</h6>

  <p>To draw images, the <dfn id=dom-context-2d-drawimage><code>drawImage</code></dfn> method
  can be used.</p>

  

  <p>This method can be invoked with three different sets of arguments:</p>

  <ul class=brief><li><code>drawImage(<var>image</var>, <var>dx</var>, <var>dy</var>)</code>
   <li><code>drawImage(<var>image</var>, <var>dx</var>, <var>dy</var>, <var>dw</var>, <var>dh</var>)</code>
   <li><code>drawImage(<var>image</var>, <var>sx</var>, <var>sy</var>, <var>sw</var>, <var>sh</var>, <var>dx</var>, <var>dy</var>, <var>dw</var>, <var>dh</var>)</code>
  </ul>

  

  <dl class=domintro><dt><var>context</var> . <code id=drawing-images:dom-context-2d-drawimage><a href=#dom-context-2d-drawimage>drawImage</a></code>(<var>image</var>, <var>dx</var>, <var>dy</var>)<dt><var>context</var> . <code id=drawing-images:dom-context-2d-drawimage-2><a href=#dom-context-2d-drawimage>drawImage</a></code>(<var>image</var>, <var>dx</var>, <var>dy</var>, <var>dw</var>, <var>dh</var>)<dt><var>context</var> . <code id=drawing-images:dom-context-2d-drawimage-3><a href=#dom-context-2d-drawimage>drawImage</a></code>(<var>image</var>, <var>sx</var>, <var>sy</var>, <var>sw</var>, <var>sh</var>, <var>dx</var>, <var>dy</var>, <var>dw</var>, <var>dh</var>)<dd>

    <p>Draws the given image onto the canvas. The arguments are
    interpreted as follows:</p>

    <p><img src=https://images.whatwg.org/drawImage.png width=356 alt="The sx and sy parameters give the x and y coordinates of the source rectangle; the sw and sh arguments give the width and height of the source rectangle; the dx and dy give the x and y coordinates of the destination rectangle; and the dw and dh arguments give the width and height of the destination rectangle." height=356></p>

    <p>If the image isn't yet fully decoded, then nothing is drawn. If the image is a canvas with no
    data, throws an <code id=drawing-images:invalidstateerror><a href=infrastructure.html#invalidstateerror>InvalidStateError</a></code> exception.</p>

   </dl>

  

  <p>When the <code id=drawing-images:dom-context-2d-drawimage-4><a href=#dom-context-2d-drawimage>drawImage()</a></code> method is invoked, the user
  agent must run the following steps:</p>

  <ol><li><p><a href=#check-the-usability-of-the-image-argument id=drawing-images:check-the-usability-of-the-image-argument>Check the usability of the <var>image</var> argument</a>. If this
   returns <i>aborted</i>, then an exception has been thrown and the method doesn't return anything;
   abort these steps. If it returns <i>bad</i>, then abort these steps without drawing anything.
   Otherwise it returns <i>good</i>; continue with these steps.<li>

    <p>Establish the source and destination rectangles as follows:</p>

    <p>If not specified, the <var>dw</var> and <var>dh</var> arguments must default to the values of
    <var>sw</var> and <var>sh</var>, interpreted such that one CSS pixel in the image is treated as
    one unit in the <a href=#scratch-bitmap id=drawing-images:scratch-bitmap>scratch bitmap</a>'s coordinate space. If the <var>sx</var>,
    <var>sy</var>, <var>sw</var>, and <var>sh</var> arguments are omitted, they must default to 0,
    0, the image's intrinsic width in image pixels, and the image's intrinsic height in image
    pixels, respectively. If the image has no intrinsic dimensions, the <i>concrete object size</i>
    must be used instead, as determined using the CSS "<a href=http://dev.w3.org/csswg/css-images/#default-sizing>Concrete Object Size Resolution</a>"
    algorithm, with the <i>specified size</i> having neither a definite width nor height, nor any
    additional contraints, the object's intrinsic properties being those of the <var>image</var>
    argument, and the <a id=drawing-images:default-object-size href=infrastructure.html#default-object-size>default object size</a> being the size of the <a href=#scratch-bitmap id=drawing-images:scratch-bitmap-2>scratch
    bitmap</a>. <a href=references.html#refsCSSIMAGES>[CSSIMAGES]</a></p>

    <p>The source rectangle is the rectangle whose corners are the four points (<var>sx</var>, <var>sy</var>), (<span><var>sx</var>+<var>sw</var></span>, <var>sy</var>), (<span><var>sx</var>+<var>sw</var></span>, <span><var>sy</var>+<var>sh</var></span>),
    (<var>sx</var>, <span><var>sy</var>+<var>sh</var></span>).</p>

    <p>The destination rectangle is the rectangle whose corners are the four points (<var>dx</var>, <var>dy</var>), (<span><var>dx</var>+<var>dw</var></span>, <var>dy</var>), (<span><var>dx</var>+<var>dw</var></span>, <span><var>dy</var>+<var>dh</var></span>),
    (<var>dx</var>, <span><var>dy</var>+<var>dh</var></span>).</p>

    <p>When the source rectangle is outside the source image, the source rectangle must be clipped
    to the source image and the destination rectangle must be clipped in the same proportion.</p>

    <p class=note>When the destination rectangle is outside the destination image (the
    <a href=#scratch-bitmap id=drawing-images:scratch-bitmap-3>scratch bitmap</a>), the pixels that land outside the <a href=#scratch-bitmap id=drawing-images:scratch-bitmap-4>scratch bitmap</a> are
    discarded, as if the destination was an infinite canvas whose rendering was clipped to the
    dimensions of the <a href=#scratch-bitmap id=drawing-images:scratch-bitmap-5>scratch bitmap</a>.</p>

   <li><p>If one of the <var>sw</var> or <var>sh</var> arguments is zero, abort
   these steps. Nothing is painted.<li>

    <p>Paint the region of the <var>image</var> argument specified by the source rectangle
    on the region of the rendering context's <a href=#scratch-bitmap id=drawing-images:scratch-bitmap-6>scratch bitmap</a> specified by the
    destination rectangle, after applying the <a href=#transformations id=drawing-images:transformations>current
    transformation matrix</a> to the destination rectangle.</p>

    <p>The image data must be processed in the original direction, even if the dimensions given are
    negative. </p>

    <p>When scaling up, if the <code id=drawing-images:dom-context-2d-imagesmoothingenabled><a href=#dom-context-2d-imagesmoothingenabled>imageSmoothingEnabled</a></code> attribute is set to
    true, the user agent should attempt to apply a smoothing algorithm to the image data when it is
    scaled. Otherwise, the image must be rendered using nearest-neighbor interpolation.</p>

    <p class=note>This specification does not define the precise algorithm to use when scaling an
    image down, or when scaling an image up when the <code id=drawing-images:dom-context-2d-imagesmoothingenabled-2><a href=#dom-context-2d-imagesmoothingenabled>imageSmoothingEnabled</a></code> attribute is set to
    true.</p>

    <p class=note>When a <code id=drawing-images:the-canvas-element><a href=#the-canvas-element>canvas</a></code> or <code id=drawing-images:canvasrenderingcontext2d><a href=#canvasrenderingcontext2d>CanvasRenderingContext2D</a></code> object is
    drawn onto itself, the <a href=#drawing-model id=drawing-images:drawing-model>drawing model</a> requires the source to be copied before the
    image is drawn, so it is possible to copy parts of a <code id=drawing-images:the-canvas-element-2><a href=#the-canvas-element>canvas</a></code> or <a href=#scratch-bitmap id=drawing-images:scratch-bitmap-7>scratch
    bitmap</a> onto overlapping parts of itself.</p>

    <p>If the original image data is a bitmap image, the value painted at a point in the destination
    rectangle is computed by filtering the original image data. The user agent may use any filtering
    algorithm (for example bilinear interpolation or nearest-neighbor). When the filtering algorithm
    requires a pixel value from outside the original image data, it must instead use the value from
    the nearest edge pixel. (That is, the filter uses 'clamp-to-edge' behaviour.) When the filtering
    algorithm requires a pixel value from outside the source rectangle but inside the original image
    data, then the value from the original image data must be used.</p>
    
    

    <p class=note>Thus, scaling an image in parts or in whole will have the same effect. This does
    mean that when sprites coming from a single sprite sheet are to be scaled, adjacent images in
    the sprite sheet can interfere. This can be avoided by ensuring each sprite in the sheet is
    surrounded by a border of transparent black, or by copying sprites to be scaled into temporary
    <code id=drawing-images:the-canvas-element-3><a href=#the-canvas-element>canvas</a></code> elements and drawing the scaled sprites from there.</p>

    <p>Images are painted without affecting the current path, and are subject to <a href=#shadows id=drawing-images:shadows>shadow effects</a>, <a href=#dom-context-2d-globalalpha id=drawing-images:dom-context-2d-globalalpha>global
    alpha</a>, the <a href=#clipping-region id=drawing-images:clipping-region>clipping region</a>, and <a href=#dom-context-2d-globalcompositeoperation id=drawing-images:dom-context-2d-globalcompositeoperation>global composition operators</a>.</p>

   <li><p>If <a href=#the-image-argument-is-not-origin-clean id=drawing-images:the-image-argument-is-not-origin-clean>the <var>image argument</var> is not origin-clean</a>, set the
   <a href=#scratch-bitmap id=drawing-images:scratch-bitmap-8>scratch bitmap</a>'s <a href=#concept-canvas-origin-clean id=drawing-images:concept-canvas-origin-clean>origin-clean</a> flag
   to false.</ol>

  


  <h6 id=hit-regions>4.12.4.2.15 Hit regions</h6>

  <p>A <dfn id=hit-region-list>hit region list</dfn> is a list of <a href=#hit-region id=hit-regions:hit-region>hit regions</a> for a
  bitmap.</p>

  <p>Each <dfn id=hit-region>hit region</dfn> consists of the following information:</p>

  <ul><li><p>A <dfn id="hit-region's-set-of-pixels">set of pixels</dfn> on the bitmap for which this
   region is responsible.<li><p>A <dfn id="hit-region's-bounding-circumference">bounding circumference</dfn> on the
   bitmap that surrounds the <a href="#hit-region's-set-of-pixels" id="hit-regions:hit-region's-set-of-pixels">hit region's set of pixels</a> as they stood when it was
   created.<li><p>Optionally, a non-empty string representing an <dfn id="hit-region's-id">ID</dfn> for
   distinguishing the region from others.<li><p>Optionally, a reference to another region that acts as the <dfn id="hit-region's-parent">parent</dfn> for this one.<li><p>A count of regions that have this one as their <a href="#hit-region's-parent" id="hit-regions:hit-region's-parent">parent</a>, known as the <dfn id="hit-region's-child-count">hit region's child count</dfn>.<li><p>A <dfn id="hit-region's-cursor-specification">cursor specification</dfn>, in the form
   of either a CSS cursor value, or the string "<code>inherit</code>" meaning that the
   cursor of the <a href="#hit-region's-parent" id="hit-regions:hit-region's-parent-2">hit region's parent</a>, if any, or of the <code id=hit-regions:the-canvas-element><a href=#the-canvas-element>canvas</a></code> element, if
   not, is to be used instead.<li>

    <p>Optionally, either a <a href="#hit-region's-control" id="hit-regions:hit-region's-control">control</a>, or an <a href="#hit-region's-unbacked-region-description" id="hit-regions:hit-region's-unbacked-region-description">unbacked region description</a>.</p>

    <p>A <dfn id="hit-region's-control">control</dfn> is a reference to an <code id=hit-regions:element><a href=infrastructure.html#element>Element</a></code>
    node, to which, in certain conditions, the user agent will route events, and from which the user
    agent will determine the state of the hit region for the purposes of accessibility tools. (The
    control is ignored when it is not a descendant of the <code id=hit-regions:the-canvas-element-2><a href=#the-canvas-element>canvas</a></code> element.)</p>

    <p>An <dfn id="hit-region's-unbacked-region-description">unbacked region description</dfn>
    consists of the following:</p>

    <ul class=brief><li><p>Optionally, a <dfn id="hit-region's-label">label</dfn>.</p>

     <li><p>An <dfn id="hit-region's-aria-role">ARIA role</dfn>, which, if the <a href="#hit-region's-unbacked-region-description" id="hit-regions:hit-region's-unbacked-region-description-2">unbacked region description</a> also has a label,
     could be the empty string.</ul>

   </ul>

  <dl class=domintro><dt><var>context</var> . <code id=hit-regions:dom-context-2d-addhitregion><a href=#dom-context-2d-addhitregion>addHitRegion</a></code>(<var>options</var>)<dd>

    <p>Adds a hit region to the bitmap. The argument is an object with the following members:</p>

    <dl><dt><dfn id=dom-hitregionoptions-path><code>path</code></dfn> (default null)<dd>A <code id=hit-regions:path2d><a href=#path2d>Path2D</a></code> object that describes the pixels that form part of the region. If
     this member is not provided or is set to null, the <a href=#current-default-path id=hit-regions:current-default-path>current default path</a> is used
     instead.<dt><dfn id=dom-hitregionoptions-fillrule><code>fillRule</code></dfn> (default "<code id=hit-regions:dom-context-2d-fillrule-nonzero><a href=#dom-context-2d-fillrule-nonzero>nonzero</a></code>")<dd>The <a href=#fill-rule id=hit-regions:fill-rule>fill rule</a> to use when determining which pixels are inside the path.<dt><dfn id=dom-hitregionoptions-id><code>id</code></dfn> (default empty string) <dd>The ID to use for this region. This is used in <code id=hit-regions:mouseevent><a href=infrastructure.html#mouseevent>MouseEvent</a></code> events on the
     <code id=hit-regions:the-canvas-element-3><a href=#the-canvas-element>canvas</a></code> (<code id=hit-regions:dom-mouseevent-region><a href=#dom-mouseevent-region>event.region</a></code>) and as a way to
     reference this region in later calls to <code id=hit-regions:dom-context-2d-addhitregion-2><a href=#dom-context-2d-addhitregion>addHitRegion()</a></code>.<dt><dfn id=dom-hitregionoptions-parentid><code>parentID</code></dfn> (default null)<dd>The ID of the parent region, for purposes of navigation by accessibility tools and for
     cursor fallback.<dt><dfn id=dom-hitregionoptions-cursor><code>cursor</code></dfn> (default "<code>inherit</code>")<dd>The cursor to use when the mouse is over this region. The value "<code>inherit</code>" means to use the cursor for the parent region (as specified by the
     <code id=hit-regions:dom-hitregionoptions-parentid><a href=#dom-hitregionoptions-parentid>parentID</a></code> member), if any, or to use the
     <code id=hit-regions:the-canvas-element-4><a href=#the-canvas-element>canvas</a></code> element's cursor if the region has no parent.<dt><dfn id=dom-hitregionoptions-control><code>control</code></dfn> (default null)<dd>An element (that is a descendant of the <code id=hit-regions:the-canvas-element-5><a href=#the-canvas-element>canvas</a></code>) to which events are to be
     routed, and which accessibility tools are to use as a surrogate for describing and interacting
     with this region.<dt><dfn id=dom-hitregionoptions-label><code>label</code></dfn> (default null)<dd>A text label for accessibility tools to use as a description of this region, if there is no
     control.<dt><dfn id=dom-hitregionoptions-role><code>role</code></dfn> (default null)<dd>An ARIA role for accessibility tools to use to determine how to represent this region, if
     there is no control.</dl>

    <p>Hit regions can be used for a variety of purposes:</p>

    <ul><li>With an ID, they can make hit detection easier by having the user agent check which region
     the mouse is over and include the ID in the mouse events.<li>With a control, they can make routing events to DOM elements automatic, allowing e.g.
     clicks on a <code id=hit-regions:the-canvas-element-6><a href=#the-canvas-element>canvas</a></code> to automatically submit a form via a <code id=hit-regions:the-button-element><a href=forms.html#the-button-element>button</a></code>
     element.<li>With a label, they can make it easier for users to explore a <code id=hit-regions:the-canvas-element-7><a href=#the-canvas-element>canvas</a></code> without
     seeing it, e.g. by touch on a mobile device.<li>With a cursor, they can make it easier for different regions of the <code id=hit-regions:the-canvas-element-8><a href=#the-canvas-element>canvas</a></code> to
     have different cursors, with the user agent automatically switching between them.</ul>

   <dt><var>context</var> . <code id=hit-regions:dom-context-2d-removehitregion><a href=#dom-context-2d-removehitregion>removeHitRegion</a></code>(<var>id</var>)<dd>

    <p>Removes a hit region (and all its descendants) from the canvas bitmap. The argument is the ID
    of a region added using <code id=hit-regions:dom-context-2d-addhitregion-3><a href=#dom-context-2d-addhitregion>addHitRegion()</a></code>.</p>

    <p>The pixels that were covered by this region and its descendants are effectively cleared by
    this operation, leaving the regions non-interactive. In particular, regions that occupied the
    same pixels before the removed regions were added, overlapping them, do not resume their
    previous role.</p>

   <dt><var>context</var> . <code id=hit-regions:dom-context-2d-clearhitregions><a href=#dom-context-2d-clearhitregions>clearHitRegions</a></code>()<dd>

    <p>Removes all hit regions from the canvas bitmap.</p>

   </dl>

  

  <p>A <a href=#hit-region id=hit-regions:hit-region-2>hit region</a> <var>A</var> is an <dfn id=ancestor-region>ancestor region</dfn> of a <a href=#hit-region id=hit-regions:hit-region-3>hit
  region</a> <var>B</var> if <var>B</var> has a <a href="#hit-region's-parent" id="hit-regions:hit-region's-parent-3">parent</a> and its <a href="#hit-region's-parent" id="hit-regions:hit-region's-parent-4">parent</a> is either <var>A</var> or another <a href=#hit-region id=hit-regions:hit-region-4>hit region</a> for which <var>A</var> is an
  <a href=#ancestor-region id=hit-regions:ancestor-region>ancestor region</a>.</p>

  <p><dfn id=the-region-identified-by-the-id>The region identified by the ID</dfn> <var>ID</var> in a bitmap <var>bitmap</var> is the value returned by the following algorithm (which can return a
  <a href=#hit-region id=hit-regions:hit-region-5>hit region</a> or nothing):</p>

  <ol><li><p>If <var>ID</var> is null, return nothing and abort these steps.<li><p>Let <var>list</var> be the <a href=#hit-region-list id=hit-regions:hit-region-list>hit region list</a> associated with <var>bitmap</var>.<li><p>If there is a <a href=#hit-region id=hit-regions:hit-region-6>hit region</a> in <var>list</var> whose <a href="#hit-region's-id" id="hit-regions:hit-region's-id">ID</a> is a <a id=hit-regions:case-sensitive href=infrastructure.html#case-sensitive>case-sensitive</a> match for <var>ID</var>, then
   return that <a href=#hit-region id=hit-regions:hit-region-7>hit region</a> and abort these steps.<li><p>Otherwise, return nothing.</ol>

  <p><dfn id=the-region-representing-the-control>The region representing the control</dfn> <var>control</var> for a bitmap <var>bitmap</var> is the value returned by the following algorithm (which can return a
  <a href=#hit-region id=hit-regions:hit-region-8>hit region</a> or nothing):</p>

  <ol><li><p>Let <var>list</var> be the <a href=#hit-region-list id=hit-regions:hit-region-list-2>hit region list</a> associated with <var>bitmap</var>.<li><p>If there is a <a href=#hit-region id=hit-regions:hit-region-9>hit region</a> in <var>list</var> whose <a href="#hit-region's-control" id="hit-regions:hit-region's-control-2">control</a> is <var>control</var>, then return that <a href=#hit-region id=hit-regions:hit-region-10>hit
   region</a> and abort these steps.<li><p>Otherwise, return nothing.</ol>

  <p><dfn id=the-control-represented-by-a-region>The control represented by a region</dfn> <var>region</var> for a
  <code id=hit-regions:the-canvas-element-9><a href=#the-canvas-element>canvas</a></code> element <var>ancestor</var> is the value returned by the following
  algorithm (which can return an element or nothing):</p>

  <ol><li><p>If <var>region</var> has no <a href="#hit-region's-control" id="hit-regions:hit-region's-control-3">control</a>,
   return nothing and abort these steps.<li><p>Let <var>control</var> be <var>region</var>'s <a href="#hit-region's-control" id="hit-regions:hit-region's-control-4">control</a>.<li><p>If <var>control</var> is not a descendant of <var>ancestor</var>, then
   return nothing and abort these steps.<li><p>If <var>control</var> is no longer a <a href=#supported-interactive-canvas-fallback-element id=hit-regions:supported-interactive-canvas-fallback-element>supported interactive canvas fallback
   element</a>, then return nothing and abort these steps.<li><p>Otherwise, return <var>control</var>.</ol>

  <p><dfn id=the-cursor-for-a-hit-region>The cursor for a hit region</dfn> <var>region</var> of a <code id=hit-regions:the-canvas-element-10><a href=#the-canvas-element>canvas</a></code>
  element <var>ancestor</var> is the value returned by the following algorithm:</p>

  <ol><li><p><i>Loop</i>: If <var>region</var> has a <a href="#hit-region's-cursor-specification" id="hit-regions:hit-region's-cursor-specification">cursor specification</a> other than "<code>inherit</code>", then
   return that <a href="#hit-region's-cursor-specification" id="hit-regions:hit-region's-cursor-specification-2">hit region's cursor specification</a> and abort these steps.<li><p>If <var>region</var> has a <a href="#hit-region's-parent" id="hit-regions:hit-region's-parent-5">parent</a>, then
   let <var>region</var> be that <a href="#hit-region's-parent" id="hit-regions:hit-region's-parent-6">hit region's parent</a>, and return to the step
   labeled <i>loop</i>.<li><p>Otherwise, return the used value of the 'cursor' property for the <code id=hit-regions:the-canvas-element-11><a href=#the-canvas-element>canvas</a></code>
   element, if any; if there isn't one, return 'auto'. <a href=references.html#refsCSSUI>[CSSUI]</a></ol>

  <p><dfn id=the-region-for-a-pixel>The region for a pixel</dfn> <var>pixel</var> on a bitmap <var>bitmap</var> is the value returned by the following algorithm (which can return a
  <a href=#hit-region id=hit-regions:hit-region-11>hit region</a> or nothing):</p>

  <ol><li><p>Let <var>list</var> be the <a href=#hit-region-list id=hit-regions:hit-region-list-3>hit region list</a> associated with <var>bitmap</var>.<li><p>If there is a <a href=#hit-region id=hit-regions:hit-region-12>hit region</a> in <var>list</var> whose <a href="#hit-region's-set-of-pixels" id="hit-regions:hit-region's-set-of-pixels-2">set of pixels</a> contains <var>pixel</var>, then return that
   <a href=#hit-region id=hit-regions:hit-region-13>hit region</a> and abort these steps.<li><p>Otherwise, return nothing.</ol>

  <p>To <dfn id=clear-regions-that-cover-the-pixels>clear regions that cover the pixels</dfn> <var>pixels</var> on a bitmap <var>bitmap</var>, the user agent must run the following steps:</p>

  <ol><li><p>Let <var>list</var> be the <a href=#hit-region-list id=hit-regions:hit-region-list-4>hit region list</a> associated with <var>bitmap</var>.<li><p>Remove all pixels in <var>pixels</var> from the <a href="#hit-region's-set-of-pixels" id="hit-regions:hit-region's-set-of-pixels-3">set of pixels</a> of each <a href=#hit-region id=hit-regions:hit-region-14>hit region</a> in <var>list</var>.<li><p><a href=#garbage-collect-the-regions id=hit-regions:garbage-collect-the-regions>Garbage-collect the regions</a> of <var>bitmap</var>.</ol>

  <p>To <dfn id=garbage-collect-the-regions>garbage-collect the regions</dfn> of a bitmap <var>bitmap</var>, the user
  agent must run the following steps:</p>

  <ol><li><p>Let <var>list</var> be the <a href=#hit-region-list id=hit-regions:hit-region-list-5>hit region list</a> associated with <var>bitmap</var>.<li><p><i>Loop</i>: Let <var>victim</var> be the first <a href=#hit-region id=hit-regions:hit-region-15>hit region</a> in <var>list</var> to have an empty <a href="#hit-region's-set-of-pixels" id="hit-regions:hit-region's-set-of-pixels-4">set of
   pixels</a> and a zero <a href="#hit-region's-child-count" id="hit-regions:hit-region's-child-count">child count</a>, if any. If
   there is no such <a href=#hit-region id=hit-regions:hit-region-16>hit region</a>, abort these steps.<li><p>If <var>victim</var> has a <a href="#hit-region's-parent" id="hit-regions:hit-region's-parent-7">parent</a>, then
   decrement that <a href="#hit-region's-child-count" id="hit-regions:hit-region's-child-count-2">hit region's child count</a> by one.<li><p>Remove <var>victim</var> from <var>list</var>.<li><p>Jump back to the step labeled <i>loop</i>.</ol>

  <p class=note>Adding a new region and calling <code id=hit-regions:dom-context-2d-clearrect><a href=#dom-context-2d-clearrect>clearRect()</a></code> are the two ways this clearing algorithm can
  be invoked. The <a href=#hit-region-list id=hit-regions:hit-region-list-6>hit region list</a> itself is also reset when the rendering context is
  reset, e.g. when a <code id=hit-regions:canvasrenderingcontext2d><a href=#canvasrenderingcontext2d>CanvasRenderingContext2D</a></code> object is bound to or unbound from a
  <code id=hit-regions:the-canvas-element-12><a href=#the-canvas-element>canvas</a></code>, or when the dimensions of the bitmap are changed.</p>

  <hr>

  <p>An element is a <dfn id=supported-interactive-canvas-fallback-element>supported interactive canvas fallback element</dfn> if it is one of the
  following:</p>

  <ul class=brief><li><p>an <code id=hit-regions:the-a-element><a href=semantics.html#the-a-element>a</a></code> element that <a id=hit-regions:represents href=dom.html#represents>represents</a> a
   <a id=hit-regions:hyperlink href=semantics.html#hyperlink>hyperlink</a> and that does not have any <code id=hit-regions:the-img-element><a href=embedded-content.html#the-img-element>img</a></code> descendants<li><p>a <code id=hit-regions:the-button-element-2><a href=forms.html#the-button-element>button</a></code> element<li><p>an <code id=hit-regions:the-input-element><a href=forms.html#the-input-element>input</a></code> element whose <code id=hit-regions:attr-input-type><a href=forms.html#attr-input-type>type</a></code>
   attribute is in one of the <a href="forms.html#checkbox-state-(type=checkbox)" id="hit-regions:checkbox-state-(type=checkbox)">Checkbox</a> or <a href="forms.html#radio-button-state-(type=radio)" id="hit-regions:radio-button-state-(type=radio)">Radio Button</a> states<li><p>an <code id=hit-regions:the-input-element-2><a href=forms.html#the-input-element>input</a></code> element that is a <a href=forms.html#concept-button id=hit-regions:concept-button>button</a> but
   its <code id=hit-regions:attr-input-type-2><a href=forms.html#attr-input-type>type</a></code> attribute is not in the <a href="forms.html#image-button-state-(type=image)" id="hit-regions:image-button-state-(type=image)">Image Button</a> state<li><p>a <code id=hit-regions:the-select-element><a href=forms.html#the-select-element>select</a></code> element with a <code id=hit-regions:attr-select-multiple><a href=forms.html#attr-select-multiple>multiple</a></code> attribute or a <a href=forms.html#concept-select-size id=hit-regions:concept-select-size>display size</a> greater than 1<li><p>an <code id=hit-regions:the-option-element><a href=forms.html#the-option-element>option</a></code> element that is in a <a href=forms.html#concept-select-option-list id=hit-regions:concept-select-option-list>list of options</a> of a <code id=hit-regions:the-select-element-2><a href=forms.html#the-select-element>select</a></code> element
   with a <code id=hit-regions:attr-select-multiple-2><a href=forms.html#attr-select-multiple>multiple</a></code> attribute or a <a href=forms.html#concept-select-size id=hit-regions:concept-select-size-2>display size</a> greater than 1<li><p>a <a id=hit-regions:sorting-interface-th-element href=tables.html#sorting-interface-th-element>sorting interface <code>th</code> element</a><li><p>an element that would not be <a id=hit-regions:interactive-content-2 href=dom.html#interactive-content-2>interactive content</a> except for having the
   <code id=hit-regions:attr-tabindex><a href=interaction.html#attr-tabindex>tabindex</a></code> attribute specified<li><p>a non-<a href=dom.html#interactive-content-2 id=hit-regions:interactive-content-2-2>interactive</a> <code id=hit-regions:the-table-element><a href=tables.html#the-table-element>table</a></code>,
   <code id=hit-regions:the-caption-element><a href=tables.html#the-caption-element>caption</a></code>, <code id=hit-regions:the-thead-element><a href=tables.html#the-thead-element>thead</a></code>, <code id=hit-regions:the-tbody-element><a href=tables.html#the-tbody-element>tbody</a></code>, <code id=hit-regions:the-tfoot-element><a href=tables.html#the-tfoot-element>tfoot</a></code>,
   <code id=hit-regions:the-tr-element><a href=tables.html#the-tr-element>tr</a></code>, <code id=hit-regions:the-td-element><a href=tables.html#the-td-element>td</a></code>, or <code id=hit-regions:the-th-element><a href=tables.html#the-th-element>th</a></code> element</ul>

  <hr>

  <p>When the <dfn id=dom-context-2d-addhitregion><code>addHitRegion()</code></dfn> method is
  invoked, the user agent must run the following steps:</p>

  <ol><li><p>Let <var>arguments</var> be the dictionary object provided as the method's
   argument.<li><p>If the <var>arguments</var> object's <code id=hit-regions:dom-hitregionoptions-path><a href=#dom-hitregionoptions-path>path</a></code> member is not null, let <var>source
   path</var> be the <code id=hit-regions:dom-hitregionoptions-path-2><a href=#dom-hitregionoptions-path>path</a></code> member's value. Otherwise,
   let it be the <code id=hit-regions:canvasrenderingcontext2d-2><a href=#canvasrenderingcontext2d>CanvasRenderingContext2D</a></code> object's <a href=#current-default-path id=hit-regions:current-default-path-2>current default
   path</a>.<li><p>Transform all the coordinates and lines in <var>source path</var> by the current
   transform matrix, if the <var>arguments</var> object's <code id=hit-regions:dom-hitregionoptions-path-3><a href=#dom-hitregionoptions-path>path</a></code> member is not null.<li><p>Let <var>specified pixels</var> be the pixels contained in <var>source
   path</var>, using the <a href=#fill-rule id=hit-regions:fill-rule-2>fill rule</a> indicated by the <code id=hit-regions:dom-hitregionoptions-fillrule><a href=#dom-hitregionoptions-fillrule>fillRule</a></code> member.<li><p>Remove from <var>specified pixels</var> any pixels not contained within the
   <a href=#clipping-region id=hit-regions:clipping-region>clipping region</a>.<li><p>If the <var>arguments</var> object's <code id=hit-regions:dom-hitregionoptions-id><a href=#dom-hitregionoptions-id>id</a></code> member is the empty string, let it be null
   instead.<li><p>If the <var>arguments</var> object's <code id=hit-regions:dom-hitregionoptions-id-2><a href=#dom-hitregionoptions-id>id</a></code> member is not null, then let <var>previous
   region for this ID</var> be <a href=#the-region-identified-by-the-id id=hit-regions:the-region-identified-by-the-id>the region identified by the ID</a> given by the <code id=hit-regions:dom-hitregionoptions-id-3><a href=#dom-hitregionoptions-id>id</a></code> member's value in this <a href=#scratch-bitmap id=hit-regions:scratch-bitmap>scratch bitmap</a>, if
   any. If the <code id=hit-regions:dom-hitregionoptions-id-4><a href=#dom-hitregionoptions-id>id</a></code> member is null or no such region
   currently exists, let <var>previous region for this ID</var> be null.<li><p>If the <var>arguments</var> object's <code id=hit-regions:dom-hitregionoptions-parentid-2><a href=#dom-hitregionoptions-parentid>parentID</a></code> member is the empty string, let it be null
   instead.<li><p>If the <var>arguments</var> object's <code id=hit-regions:dom-hitregionoptions-parentid-3><a href=#dom-hitregionoptions-parentid>parentID</a></code> member is not null, then let <var>parent region</var> be <a href=#the-region-identified-by-the-id id=hit-regions:the-region-identified-by-the-id-2>the region identified by the ID</a> given by the <code id=hit-regions:dom-hitregionoptions-parentid-4><a href=#dom-hitregionoptions-parentid>parentID</a></code> member's value in the <a href=#scratch-bitmap id=hit-regions:scratch-bitmap-2>scratch
   bitmap</a>, if any. If the <code id=hit-regions:dom-hitregionoptions-parentid-5><a href=#dom-hitregionoptions-parentid>parentID</a></code> member
   is null or no such region currently exists, let <var>parent region</var> be
   null.<li><p>If the <var>arguments</var> object's <code id=hit-regions:dom-hitregionoptions-label><a href=#dom-hitregionoptions-label>label</a></code> member is the empty string, let it be null
   instead.<li>

    <p>If any of the following conditions are met, throw a <code id=hit-regions:notsupportederror><a href=infrastructure.html#notsupportederror>NotSupportedError</a></code> exception
    and abort these steps.</p>

    <ul class=brief><li><p>The <var>arguments</var> object's <code id=hit-regions:dom-hitregionoptions-control><a href=#dom-hitregionoptions-control>control</a></code> and <code id=hit-regions:dom-hitregionoptions-label-2><a href=#dom-hitregionoptions-label>label</a></code> members are both non-null.<li><p>The <var>arguments</var> object's <code id=hit-regions:dom-hitregionoptions-control-2><a href=#dom-hitregionoptions-control>control</a></code> and <code id=hit-regions:dom-hitregionoptions-role><a href=#dom-hitregionoptions-role>role</a></code> members are both non-null.<li><p>The <var>arguments</var> object's <code id=hit-regions:dom-hitregionoptions-role-2><a href=#dom-hitregionoptions-role>role</a></code> member's value is the empty string, and the
     <code id=hit-regions:dom-hitregionoptions-label-3><a href=#dom-hitregionoptions-label>label</a></code> member's value is either null or the
     empty string.<li><p>The <var>specified pixels</var> has no pixels.<li><p>The <var>arguments</var> object's <code id=hit-regions:dom-hitregionoptions-control-3><a href=#dom-hitregionoptions-control>control</a></code> member is neither null nor a
     <a href=#supported-interactive-canvas-fallback-element id=hit-regions:supported-interactive-canvas-fallback-element-2>supported interactive canvas fallback element</a>.<li><p>The <var>parent region</var> is not null but has a <a href="#hit-region's-control" id="hit-regions:hit-region's-control-5">control</a>.<li><p>The <var>previous region for this ID</var> is the same <a href=#hit-region id=hit-regions:hit-region-17>hit region</a> as
     the <var>parent region</var>.<li><p>The <var>previous region for this ID</var> is an <a href=#ancestor-region id=hit-regions:ancestor-region-2>ancestor region</a>
     of the <var>parent region</var>.</ul>

   <li><p>If the <code id=hit-regions:dom-hitregionoptions-parentid-6><a href=#dom-hitregionoptions-parentid>parentID</a></code> member is not null but
   <var>parent region</var> is null, then throw a <code id=hit-regions:notfounderror><a href=infrastructure.html#notfounderror>NotFoundError</a></code> exception and
   abort these steps.<li>

    <p>If any of the following conditions are met, throw a <code id=hit-regions:syntaxerror><a href=infrastructure.html#syntaxerror>SyntaxError</a></code> exception and
    abort these steps.</p>

    <ul class=brief><li>The <var>arguments</var> object's <code id=hit-regions:dom-hitregionoptions-cursor><a href=#dom-hitregionoptions-cursor>cursor</a></code> member is not null but is neither an
     <a id=hit-regions:ascii-case-insensitive href=infrastructure.html#ascii-case-insensitive>ASCII case-insensitive</a> match for the string "<code>inherit</code>", nor a
     valid CSS 'cursor' property value. <a href=references.html#refsCSSUI>[CSSUI]</a><li>The <var>arguments</var> object's <code id=hit-regions:dom-hitregionoptions-role-3><a href=#dom-hitregionoptions-role>role</a></code> member is not null but its value is not an
     <a id=hit-regions:ordered-set-of-unique-space-separated-tokens href=infrastructure.html#ordered-set-of-unique-space-separated-tokens>ordered set of unique space-separated tokens</a> whose tokens are all
     <a id=hit-regions:case-sensitive-2 href=infrastructure.html#case-sensitive>case-sensitive</a> matches for names of non-abstract WAI-ARIA roles. <a href=references.html#refsARIA>[ARIA]</a></ul>

   <li>

    <p>Let <var>region</var> be a newly created <a href=#hit-region id=hit-regions:hit-region-18>hit region</a>, with its
    information configured as follows:</p>

    <dl><dt><a href="#hit-region's-set-of-pixels" id="hit-regions:hit-region's-set-of-pixels-5">Hit region's set of pixels</a>

     <dd><p>The <var>specified pixels</var>


     <dt><a href="#hit-region's-bounding-circumference" id="hit-regions:hit-region's-bounding-circumference">Hit region's bounding circumference</a>

     <dd><p>A user-agent-defined shape that wraps the pixels contained in <var>source
     path</var>. (In the simplest case, this can just be the bounding rectangle; this specification
     allows it to be any shape in order to allow other interfaces.)


     <dt><a href="#hit-region's-id" id="hit-regions:hit-region's-id-2">Hit region's ID</a>

     <dd><p>If the <var>arguments</var> object's <code id=hit-regions:dom-hitregionoptions-id-5><a href=#dom-hitregionoptions-id>id</a></code> member is not null: the value of the <code id=hit-regions:dom-hitregionoptions-id-6><a href=#dom-hitregionoptions-id>id</a></code> member. Otherwise, <var>region</var> has no
     <a href="#hit-region's-id" id="hit-regions:hit-region's-id-3">id</a>.


     <dt><a href="#hit-region's-parent" id="hit-regions:hit-region's-parent-8">Hit region's parent</a>

     <dd><p>If <var>parent region</var> is not null: <var>parent region</var>.
     Otherwise, <var>region</var> has no <a href="#hit-region's-parent" id="hit-regions:hit-region's-parent-9">parent</a>.


     <dt><a href="#hit-region's-child-count" id="hit-regions:hit-region's-child-count-3">Hit region's child count</a>

     <dd><p>Initially zero.


     <dt><a href="#hit-region's-cursor-specification" id="hit-regions:hit-region's-cursor-specification-3">Hit region's cursor specification</a>

     <dd><p>If the <var>arguments</var> object's <code id=hit-regions:dom-hitregionoptions-cursor-2><a href=#dom-hitregionoptions-cursor>cursor</a></code> member is not null: the value of the <code id=hit-regions:dom-hitregionoptions-cursor-3><a href=#dom-hitregionoptions-cursor>cursor</a></code> member. Otherwise, the string "<code>inherit</code>".


     <dt><a href="#hit-region's-control" id="hit-regions:hit-region's-control-6">Hit region's control</a>

     <dd><p>If the <var>arguments</var> object's <code id=hit-regions:dom-hitregionoptions-control-4><a href=#dom-hitregionoptions-control>control</a></code> member is not null: the value of the <code id=hit-regions:dom-hitregionoptions-control-5><a href=#dom-hitregionoptions-control>control</a></code> member. Otherwise, <var>region</var> has no <a href="#hit-region's-control" id="hit-regions:hit-region's-control-7">control</a>.


     <dt><a href="#hit-region's-label" id="hit-regions:hit-region's-label">Hit region's label</a>

     <dd><p>If the <var>arguments</var> object's <code id=hit-regions:dom-hitregionoptions-label-4><a href=#dom-hitregionoptions-label>label</a></code> member is not null: the value of the <code id=hit-regions:dom-hitregionoptions-label-5><a href=#dom-hitregionoptions-label>label</a></code> member. Otherwise, <var>region</var>
     has no <a href="#hit-region's-label" id="hit-regions:hit-region's-label-2">label</a>.


     <dt><a href="#hit-region's-aria-role" id="hit-regions:hit-region's-aria-role">Hit region's ARIA role</a>

     <dd><p>If the <var>arguments</var> object's <code id=hit-regions:dom-hitregionoptions-role-4><a href=#dom-hitregionoptions-role>role</a></code> member is not null: the value of the <code id=hit-regions:dom-hitregionoptions-role-5><a href=#dom-hitregionoptions-role>role</a></code> member (which might be the empty string).
     Otherwise, if the <var>arguments</var> object's <code id=hit-regions:dom-hitregionoptions-label-6><a href=#dom-hitregionoptions-label>label</a></code> member is not null: the empty string.
     Otherwise, <var>region</var> has no <a href="#hit-region's-aria-role" id="hit-regions:hit-region's-aria-role-2">ARIA
     role</a>.


    </dl>

   <li>

    <p>If the <var>arguments</var> object's <code id=hit-regions:dom-hitregionoptions-cursor-4><a href=#dom-hitregionoptions-cursor>cursor</a></code> member is not null, then act as if a CSS rule
    for the <code id=hit-regions:the-canvas-element-13><a href=#the-canvas-element>canvas</a></code> element setting its 'cursor' property had been seen, whose value was
    the <a href="#hit-region's-cursor-specification" id="hit-regions:hit-region's-cursor-specification-4">hit region's cursor specification</a>.</p>

    <p class=note>For example, if the user agent prefetches cursor values, this would cause that
    to happen in response to an appropriately-formed <code id=hit-regions:dom-context-2d-addhitregion-4><a href=#dom-context-2d-addhitregion>addHitRegion()</a></code> call.</p>

   <li><p>If there is a <var>previous region with this ID</var>, remove it, and all <a href=#hit-region id=hit-regions:hit-region-19>hit regions</a> for which it is an <a href=#ancestor-region id=hit-regions:ancestor-region-3>ancestor region</a>, from the
   <a href=#scratch-bitmap id=hit-regions:scratch-bitmap-3>scratch bitmap</a>'s <a href=#hit-region-list id=hit-regions:hit-region-list-7>hit region list</a>; then, if it had a <a href="#hit-region's-parent" id="hit-regions:hit-region's-parent-10">parent</a> region, decrement that <a href="#hit-region's-child-count" id="hit-regions:hit-region's-child-count-4">hit region's child count</a> by
   one.<li><p>If there is a <var>parent region</var>, increment its <a href="#hit-region's-child-count" id="hit-regions:hit-region's-child-count-5">hit region's child
   count</a> by one.<li><p><a href=#clear-regions-that-cover-the-pixels id=hit-regions:clear-regions-that-cover-the-pixels>Clear regions that cover the pixels</a> in <var>region</var>'s <a href="#hit-region's-set-of-pixels" id="hit-regions:hit-region's-set-of-pixels-6">set of pixels</a> on this <a href=#scratch-bitmap id=hit-regions:scratch-bitmap-4>scratch
   bitmap</a>.<li><p>Add <var>region</var> to the <a href=#scratch-bitmap id=hit-regions:scratch-bitmap-5>scratch bitmap</a>'s element's <a href=#hit-region-list id=hit-regions:hit-region-list-8>hit
   region list</a>.</ol>

  <p>When the <dfn id=dom-context-2d-removehitregion><code>removeHitRegion()</code></dfn>
  method is invoked, the user agent must run the following steps:</p>

  <ol><li>

    <p>Let <var>region</var> be <a href=#the-region-identified-by-the-id id=hit-regions:the-region-identified-by-the-id-3>the region identified by the ID</a> given by the
    method's argument in the rendering context's <a href=#scratch-bitmap id=hit-regions:scratch-bitmap-6>scratch bitmap</a>. If no such region
    currently exists, abort these steps.</p>

    <p class=note>If the method's argument is the empty string, then no region will match.</p>

   <li><p>Remove <var>region</var>, and all <a href=#hit-region id=hit-regions:hit-region-20>hit regions</a> for
   which it is an <a href=#ancestor-region id=hit-regions:ancestor-region-4>ancestor region</a>, from the rendering context's <a href=#scratch-bitmap id=hit-regions:scratch-bitmap-7>scratch
   bitmap</a>'s <a href=#hit-region-list id=hit-regions:hit-region-list-9>hit region list</a>; then, if it had a <a href="#hit-region's-parent" id="hit-regions:hit-region's-parent-11">parent</a> region, decrement that <a href="#hit-region's-child-count" id="hit-regions:hit-region's-child-count-6">hit region's child count</a> by
   one.<li><p><a href=#garbage-collect-the-regions id=hit-regions:garbage-collect-the-regions-2>Garbage-collect the regions</a> of the rendering context's <a href=#scratch-bitmap id=hit-regions:scratch-bitmap-8>scratch
   bitmap</a>.</ol>

  <p>When the <dfn id=dom-context-2d-clearhitregions><code>clearHitRegions()</code></dfn>
  method is invoked, the user agent must remove all the <a href=#hit-region id=hit-regions:hit-region-21>hit regions</a>
  from the rendering context's <a href=#scratch-bitmap id=hit-regions:scratch-bitmap-9>scratch bitmap</a>'s <a href=#hit-region-list id=hit-regions:hit-region-list-10>hit region list</a>.</p>

  

  <hr>

  <p>The <code id=hit-regions:mouseevent-2><a href=infrastructure.html#mouseevent>MouseEvent</a></code> interface is extended to support hit regions:</p>

  <pre class=idl>partial interface <a id=MouseEvent-partial href=infrastructure.html#mouseevent>MouseEvent</a> {
  readonly attribute DOMString? <a href=#dom-mouseevent-region id=hit-regions:dom-mouseevent-region-2>region</a>;
};

partial dictionary <a id=hit-regions:mouseeventinit href=infrastructure.html#mouseeventinit>MouseEventInit</a> {
  DOMString? region;
};</pre>

  <dl class=domintro><dt><var>event</var> . <code id=hit-regions:dom-mouseevent-region-3><a href=#dom-mouseevent-region>region</a></code><dd>

    <p>If the mouse was over a <a href=#hit-region id=hit-regions:hit-region-22>hit region</a>, then this returns the <a href="#hit-region's-id" id="hit-regions:hit-region's-id-4">hit region's
    ID</a>, if it has one.</p>

    <p>Otherwise, returns null.</p>

   </dl>

  

  <p>The <dfn id=dom-mouseevent-region><code>region</code></dfn> attribute on
  <code id=hit-regions:mouseevent-3><a href=infrastructure.html#mouseevent>MouseEvent</a></code> objects must return the value it was initialised to. When the object is
  created, this attribute must be initialised to null. It represents the <a href="#hit-region's-id" id="hit-regions:hit-region's-id-5">hit region's
  ID</a> if the mouse was over a hit region when the event was fired.</p>

  <p>When a <code id=hit-regions:mouseevent-4><a href=infrastructure.html#mouseevent>MouseEvent</a></code> is to be fired at a <code id=hit-regions:the-canvas-element-14><a href=#the-canvas-element>canvas</a></code> element by the user
  agent in response to a pointing device action other than a click (e.g. a <code id=hit-regions:event-mousedown><a href=infrastructure.html#event-mousedown>mousedown</a></code> event or a <code id=hit-regions:event-mousemove><a href=infrastructure.html#event-mousemove>mousemove</a></code> event), the user agent must run the <a href=#canvas-mouseevent-rerouting-steps id=hit-regions:canvas-mouseevent-rerouting-steps>canvas
  <code>MouseEvent</code> rerouting steps</a> immediately prior to dispatching the event. This does not affect default actions (so for instance, if the
  event gets rerouted to an element that has a default action for <code id=hit-regions:event-mousemove-2><a href=infrastructure.html#event-mousemove>mousemove</a></code> events, this default action doesn't trigger).</p>

  <p class=note>Actual clicks are handled by the <a id=hit-regions:run-authentic-click-activation-steps href=interaction.html#run-authentic-click-activation-steps>run authentic click activation
  steps</a>, which also invoke these steps.</p>

  <p>The <dfn id=canvas-mouseevent-rerouting-steps>canvas <code>MouseEvent</code> rerouting steps</dfn> are as follows. If these steps
  say to <i>act as normal</i>, that means that the event must be fired as it would have had these
  requirements not been applied.</p>

  <ol><li><p>If the pointing device is not indicating a pixel on the <code id=hit-regions:the-canvas-element-15><a href=#the-canvas-element>canvas</a></code>, then act as
   normal and abort these steps.<li><p>If the <code id=hit-regions:the-canvas-element-16><a href=#the-canvas-element>canvas</a></code> element has no <a href=#hit-region-list id=hit-regions:hit-region-list-11>hit region list</a>, then act as normal
   and abort these steps.<li><p>Let <var>pixel</var> be the pixel indicated by the pointing device.<li><p>Let <var>region</var> be the <a href=#hit-region id=hit-regions:hit-region-23>hit region</a> that is <a href=#the-region-for-a-pixel id=hit-regions:the-region-for-a-pixel>the region for the pixel</a> <var>pixel</var> on this
   <code id=hit-regions:the-canvas-element-17><a href=#the-canvas-element>canvas</a></code> element's bitmap, if any.<li><p>If there is no <var>region</var>, then act as normal and abort these
   steps.<li><p>Let <var>id</var> be the <var>region</var>'s <a href="#hit-region's-id" id="hit-regions:hit-region's-id-6">ID</a>, if any.<li><p>If there is an <var>id</var>, then initialise the event object's <code id=hit-regions:dom-mouseevent-region-4><a href=#dom-mouseevent-region>region</a></code> attribute to <var>id</var>.<li><p>Let <var>control</var> be the <a href=#the-control-represented-by-a-region id=hit-regions:the-control-represented-by-a-region>control represented by</a> <var>region</var> for this <code id=hit-regions:the-canvas-element-18><a href=#the-canvas-element>canvas</a></code>
   element, if any.<li><p>If there is a <var>control</var>, then target the event object at <var>control</var> instead of the <code id=hit-regions:the-canvas-element-19><a href=#the-canvas-element>canvas</a></code> element.<li><p>Continue dispatching the event, but with the updated event object and target as given in
   the above steps.</ol>

  <hr>

  

  <p>The <code id=hit-regions:touch><a href=infrastructure.html#touch>Touch</a></code> interface is extended to support hit regions also: <a href=references.html#refsTOUCH>[TOUCH]</a></p>

  <pre class=idl>partial interface <a id=Touch-partial href=infrastructure.html#touch>Touch</a> {
  readonly attribute DOMString? <a href=#dom-touch-region id=hit-regions:dom-touch-region>region</a>;
};</pre>

  <dl class=domintro><dt><var>touch</var> . <code id=hit-regions:dom-touch-region-2><a href=#dom-touch-region>region</a></code><dd>

    <p>If the <a id=hit-regions:touch-point href=infrastructure.html#touch-point>touch point</a> was over a <a href=#hit-region id=hit-regions:hit-region-24>hit region</a> when it was first placed
    on the surface, then this returns the <a href="#hit-region's-id" id="hit-regions:hit-region's-id-7">hit region's ID</a>, if it has one.</p>

    <p>Otherwise, returns null.</p>

   </dl>

  

  <p>The <dfn id=dom-touch-region><code>region</code></dfn> attribute on a <code id=hit-regions:touch-2><a href=infrastructure.html#touch>Touch</a></code>
  object representing a <a id=hit-regions:touch-point-2 href=infrastructure.html#touch-point>touch point</a> <var>T</var> must return the value
  obtained by running the following algorithm when <var>T</var> was first placed on the
  surface: <a href=references.html#refsTOUCH>[TOUCH]</a></p>

  <ol><li><p>If the <a id=hit-regions:touch-point-3 href=infrastructure.html#touch-point>touch point</a> is not on a pixel on the <code id=hit-regions:the-canvas-element-20><a href=#the-canvas-element>canvas</a></code>, then return
   null and abort these steps.<li><p>If the <code id=hit-regions:the-canvas-element-21><a href=#the-canvas-element>canvas</a></code> element has no <a href=#hit-region-list id=hit-regions:hit-region-list-12>hit region list</a>, then return null
   and abort these steps.<li><p>Let <var>pixel</var> be the pixel that the <a id=hit-regions:touch-point-4 href=infrastructure.html#touch-point>touch point</a> is
   on.<li><p>Let <var>region</var> be the <a href=#hit-region id=hit-regions:hit-region-25>hit region</a> that is <a href=#the-region-for-a-pixel id=hit-regions:the-region-for-a-pixel-2>the region for the pixel</a> <var>pixel</var> on this
   <code id=hit-regions:the-canvas-element-22><a href=#the-canvas-element>canvas</a></code> element's bitmap, if any.<li><p>If there is no <var>region</var>, then return null and abort these
   steps.<li><p>Let <var>id</var> be the <var>region</var>'s <a href="#hit-region's-id" id="hit-regions:hit-region's-id-8">ID</a>, if any, or else null.<li><p>Return <var>id</var>.</ol>

  

  

  <hr>

  <p>When a user's pointing device cursor is positioned over a <code id=hit-regions:the-canvas-element-23><a href=#the-canvas-element>canvas</a></code> element, user
  agents should render the pointing device cursor according to the cursor specification described by
  <a href=#the-cursor-for-a-hit-region id=hit-regions:the-cursor-for-a-hit-region>the cursor for the hit region</a> that is <a href=#the-region-for-a-pixel id=hit-regions:the-region-for-a-pixel-3>the region for the pixel</a> that the pointing device designates
  on the <code id=hit-regions:the-canvas-element-24><a href=#the-canvas-element>canvas</a></code> element's bitmap.</p>

  <hr>

  <p>User agents are encouraged to make use of the information present in a <code id=hit-regions:the-canvas-element-25><a href=#the-canvas-element>canvas</a></code>
  element's <a href=#hit-region-list id=hit-regions:hit-region-list-13>hit region list</a> to improve the accessibility of <code id=hit-regions:the-canvas-element-26><a href=#the-canvas-element>canvas</a></code>
  elements.</p>

  <p>Each <a href=#hit-region id=hit-regions:hit-region-26>hit region</a> should be handled in a fashion equivalent to a node in a virtual
  DOM tree rooted at the <code id=hit-regions:the-canvas-element-27><a href=#the-canvas-element>canvas</a></code> element. The hierarchy of this virtual DOM tree must
  match the hierarchy of the <a href=#hit-region id=hit-regions:hit-region-27>hit regions</a>, as described by the <a href="#hit-region's-parent" id="hit-regions:hit-region's-parent-12">parent</a> of each region. Regions without a <a href="#hit-region's-parent" id="hit-regions:hit-region's-parent-13">parent</a> must be treated as children of the <code id=hit-regions:the-canvas-element-28><a href=#the-canvas-element>canvas</a></code> element for
  the purpose of this virtual DOM tree. For each node in such a DOM tree, the <a href="#hit-region's-bounding-circumference" id="hit-regions:hit-region's-bounding-circumference-2">hit region's
  bounding circumference</a> gives the region of the screen to use when representing the node (if
  appropriate).</p>

  <p>The semantics of a <a href=#hit-region id=hit-regions:hit-region-28>hit region</a> for the purposes of this virtual DOM tree are those
  of the <a href=#the-control-represented-by-a-region id=hit-regions:the-control-represented-by-a-region-2>the control represented by the
  region</a>, if it has one, or else of a non-interactive element whose ARIA role, if any, is
  that given by the <a href="#hit-region's-aria-role" id="hit-regions:hit-region's-aria-role-3">hit region's ARIA role</a>, and whose textual representation, if any,
  is given by the <a href="#hit-region's-label" id="hit-regions:hit-region's-label-3">hit region's label</a>.</p>

  <p>For the purposes of accessibility tools, when an element <var>C</var> is a descendant
  of a <code id=hit-regions:the-canvas-element-29><a href=#the-canvas-element>canvas</a></code> element and there is <a href=#the-region-representing-the-control id=hit-regions:the-region-representing-the-control>a
  region representing the control</a> <var>C</var> for that <code id=hit-regions:the-canvas-element-30><a href=#the-canvas-element>canvas</a></code>
  element's bitmap, then the element's position relative to the document should be presented as if
  it was that region in the <code id=hit-regions:the-canvas-element-31><a href=#the-canvas-element>canvas</a></code> element's virtual DOM tree.</p>

  <p>The semantics of a <a href=#hit-region id=hit-regions:hit-region-29>hit region</a> for the purposes of this virtual DOM tree are those
  of the <a href=#the-control-represented-by-a-region id=hit-regions:the-control-represented-by-a-region-3>the control represented by the
  region</a>, if it has one, or else of a non-interactive element whose ARIA role, if any, is
  that given by the <a href="#hit-region's-aria-role" id="hit-regions:hit-region's-aria-role-4">hit region's ARIA role</a>, and whose textual representation, if any,
  is given by the <a href="#hit-region's-label" id="hit-regions:hit-region's-label-4">hit region's label</a>.</p>

  <p class=note>Thus, for instance, a user agent on a touch-screen device could provide haptic
  feedback when the user croses over a <a href="#hit-region's-bounding-circumference" id="hit-regions:hit-region's-bounding-circumference-3">hit region's bounding circumference</a>, and then
  read the <a href="#hit-region's-label" id="hit-regions:hit-region's-label-5">hit region's label</a> to the user. Similarly, a desktop user agent with a
  virtual accessibility focus separate from the keyboard input focus could allow the user to
  navigate through the hit regions, using the virtual DOM tree described above to enable
  hierarchical navigation. When an interactive control inside the <code id=hit-regions:the-canvas-element-32><a href=#the-canvas-element>canvas</a></code> element
  <a id=hit-regions:gains-focus href=interaction.html#gains-focus>gains focus</a>, if the control has a corresponding region, then that <a href="#hit-region's-bounding-circumference" id="hit-regions:hit-region's-bounding-circumference-4">hit region's
  bounding circumference</a> could be used to determine what area of the display to magnify.</p>

  


  <h6 id=pixel-manipulation>4.12.4.2.16 <dfn>Pixel manipulation</dfn></h6>

  <dl class=domintro><dt><var>imagedata</var> = new <code id=pixel-manipulation:dom-imagedata><a href=#dom-imagedata>ImageData</a></code>(<var>sw</var>, <var>sh</var>)<dt><var>imagedata</var> = <var>context</var> . <code id=pixel-manipulation:dom-context-2d-createimagedata><a href=#dom-context-2d-createimagedata>createImageData</a></code>(<var>sw</var>, <var>sh</var>)<dd>

    <p>Returns an <code id=pixel-manipulation:imagedata><a href=#imagedata>ImageData</a></code> object with the given dimensions. All the pixels in the
    returned object are transparent black.</p>

    <p>Throws an <code id=pixel-manipulation:indexsizeerror><a href=infrastructure.html#indexsizeerror>IndexSizeError</a></code> exception if either of the width or height
    arguments are zero.</p>

   <dt><var>imagedata</var> = <var>context</var> . <code id=pixel-manipulation:dom-context-2d-createimagedata-2><a href=#dom-context-2d-createimagedata>createImageData</a></code>(<var>imagedata</var>)<dd>

    <p>Returns an <code id=pixel-manipulation:imagedata-2><a href=#imagedata>ImageData</a></code> object with the same dimensions as the argument. All the
    pixels in the returned object are transparent black.</p>

   <dt><var>imagedata</var> = new <code id=pixel-manipulation:dom-imagedata-2><a href=#dom-imagedata>ImageData</a></code>(<var>data</var>, <var>sw</var> [, <var>sh</var> ] )<dd>

    <p>Returns an <code id=pixel-manipulation:imagedata-3><a href=#imagedata>ImageData</a></code> object using the data provided in the <code id=pixel-manipulation:uint8clampedarray><a href=infrastructure.html#uint8clampedarray>Uint8ClampedArray</a></code> argument, interpreted using the given dimensions.</p>

    <p>As each pixel in the data is represented by four numbers, the length of the data needs to be
    a multiple of four times the given width. If the height is provided as well, then the length
    needs to be exactly the width times the height times 4.</p>

    <p>Throws an <code id=pixel-manipulation:indexsizeerror-2><a href=infrastructure.html#indexsizeerror>IndexSizeError</a></code> exception if the given data and dimensions can't be
    interpreted consistently, or if either dimension is zero.</p>

   <dt><var>imagedata</var> = <var>context</var> . <code id=pixel-manipulation:dom-context-2d-getimagedata><a href=#dom-context-2d-getimagedata>getImageData</a></code>(<var>sx</var>, <var>sy</var>, <var>sw</var>, <var>sh</var>)<dd>

    <p>Returns an <code id=pixel-manipulation:imagedata-4><a href=#imagedata>ImageData</a></code> object containing the image data for the given rectangle of
    the bitmap.</p>

    <p>Throws an <code id=pixel-manipulation:indexsizeerror-3><a href=infrastructure.html#indexsizeerror>IndexSizeError</a></code> exception if the either of the width or height
    arguments are zero.</p>

   <dt><var>imagedata</var> . <code id=pixel-manipulation:dom-imagedata-width><a href=#dom-imagedata-width>width</a></code><dt><var>imagedata</var> . <code id=pixel-manipulation:dom-imagedata-height><a href=#dom-imagedata-height>height</a></code><dd>

    <p>Returns the actual dimensions of the data in the <code id=pixel-manipulation:imagedata-5><a href=#imagedata>ImageData</a></code> object, in
    pixels.</p>

   <dt><var>imagedata</var> . <code id=pixel-manipulation:dom-imagedata-data><a href=#dom-imagedata-data>data</a></code><dd>

    <p>Returns the one-dimensional array containing the data in RGBA order, as integers in the range
    0 to 255.</p>

   <dt><var>context</var> . <code id=pixel-manipulation:dom-context-2d-putimagedata><a href=#dom-context-2d-putimagedata>putImageData</a></code>(<var>imagedata</var>, <var>dx</var>, <var>dy</var> [, <var>dirtyX</var>, <var>dirtyY</var>, <var>dirtyWidth</var>, <var>dirtyHeight</var> ] )<dd>

    <p>Paints the data from the given <code id=pixel-manipulation:imagedata-6><a href=#imagedata>ImageData</a></code> object onto the bitmap. If a dirty
    rectangle is provided, only the pixels from that rectangle are painted.</p>

    <p>The <code id=pixel-manipulation:dom-context-2d-globalalpha><a href=#dom-context-2d-globalalpha>globalAlpha</a></code> and <code id=pixel-manipulation:dom-context-2d-globalcompositeoperation><a href=#dom-context-2d-globalcompositeoperation>globalCompositeOperation</a></code> attributes, as
    well as the shadow attributes, are ignored for the purposes of this method call; pixels in the
    canvas are replaced wholesale, with no composition, alpha blending, no shadows, etc.</p>

    <p>Throws a <code id=pixel-manipulation:notsupportederror><a href=infrastructure.html#notsupportederror>NotSupportedError</a></code> exception if any of the arguments are not finite.</p>

    <p>Throws an <code id=pixel-manipulation:invalidstateerror><a href=infrastructure.html#invalidstateerror>InvalidStateError</a></code> exception if the <var>imagedata</var>
    object's data has been <a href=infrastructure.html#concept-transferable-neutered id=pixel-manipulation:concept-transferable-neutered>neutered</a>.</p>

   </dl>

  

  <p>The <dfn id=dom-imagedata><code>ImageData()</code></dfn> constructors and the <dfn id=dom-context-2d-createimagedata><code>createImageData()</code></dfn> methods are used to
  instantiate new <code id=pixel-manipulation:imagedata-7><a href=#imagedata>ImageData</a></code> objects.</p>

  <p>When the <code id=pixel-manipulation:dom-imagedata-3><a href=#dom-imagedata>ImageData()</a></code> constructor is invoked with two
  numeric arguments <var>sw</var> and <var>sh</var>, it must return a new
  <code id=pixel-manipulation:imagedata-8><a href=#imagedata>ImageData</a></code> object representing a transparent black rectangle with a width equal to
  <var>sw</var> and a height equal to <var>sh</var>, if both <var>sw</var> and <var>sh</var> are non-zero. If one or both of <var>sw</var> and <var>sh</var> are zero, then the constructor must throw an
  <code id=pixel-manipulation:indexsizeerror-4><a href=infrastructure.html#indexsizeerror>IndexSizeError</a></code> exception instead.</p>

  <p>When the <code id=pixel-manipulation:dom-imagedata-4><a href=#dom-imagedata>ImageData()</a></code> constructor is invoked with its first
  argument being an <code id=pixel-manipulation:uint8clampedarray-2><a href=infrastructure.html#uint8clampedarray>Uint8ClampedArray</a></code> <var>source</var> and its second and
  (optionally) third argument(s) being numeric arguments <var>sw</var> and <var>sh</var>, it must run the following steps:

  <ol><li><p>Let <var>length</var> be the number of bytes in <var>source</var>.<li><p>If <var>length</var> is not a non-zero integral multiple of four, throw an
   <code id=pixel-manipulation:invalidstateerror-2><a href=infrastructure.html#invalidstateerror>InvalidStateError</a></code> exception and abort these steps.<li><p>Let <var>length</var> be <var>length</var> divided by four.</p>

   <li>

    <p>If <var>length</var> is not an integral multiple of <var>sw</var>,
    throw an <code id=pixel-manipulation:indexsizeerror-5><a href=infrastructure.html#indexsizeerror>IndexSizeError</a></code> exception and abort these steps.</p>

    <p class=note>At this step, the length is guaranteed to be greater than zero (otherwise the
    second step above would have aborted the steps), so if <var>sw</var> is zero, this
    step will throw the exception and abort these steps.</p>

   <li><p>Let <var>height</var> be <var>length</var> divided by <var>sw</var>.<li><p>If the <var>sh</var> argument was not omitted, and its value is not equal to
   <var>height</var>, then throw an <code id=pixel-manipulation:indexsizeerror-6><a href=infrastructure.html#indexsizeerror>IndexSizeError</a></code> exception and abort these
   steps.<li>

    <p>Return a new <code id=pixel-manipulation:imagedata-9><a href=#imagedata>ImageData</a></code> object whose width is <var>sw</var>, whose
    height is <var>height</var>, and whose data is <var>source</var>.</p>

    <p class=note>The resulting object's data is not a <em>copy</em> of <var>source</var>, it's the actual <code id=pixel-manipulation:uint8clampedarray-3><a href=infrastructure.html#uint8clampedarray>Uint8ClampedArray</a></code> object passed as the
    first argument to the constructor.</p>

   </ol>

  <p>When the <code id=pixel-manipulation:dom-context-2d-createimagedata-3><a href=#dom-context-2d-createimagedata>createImageData()</a></code> method is
  invoked with two numeric arguments <var>sw</var> and <var>sh</var>, it must
  return a new <code id=pixel-manipulation:imagedata-10><a href=#imagedata>ImageData</a></code> object representing a transparent black rectangle with a width
  equal to the absolute magnitude of <var>sw</var> and a height equal to the absolute
  magnitude of <var>sh</var>, if both <var>sw</var> and <var>sh</var>
  are non-zero. If one or both of <var>sw</var> and <var>sh</var> are zero, then
  the constructor must throw an <code id=pixel-manipulation:indexsizeerror-7><a href=infrastructure.html#indexsizeerror>IndexSizeError</a></code> exception instead.</p>

  <p>When the <code id=pixel-manipulation:dom-context-2d-createimagedata-4><a href=#dom-context-2d-createimagedata>createImageData()</a></code> method is
  invoked with a single <var>imagedata</var> argument, it must return a new
  <code id=pixel-manipulation:imagedata-11><a href=#imagedata>ImageData</a></code> object representing a transparent black rectangle with the same dimensions
  as the <code id=pixel-manipulation:imagedata-12><a href=#imagedata>ImageData</a></code> object passed as the argument.</p>

  <p>The <dfn id=dom-context-2d-getimagedata><code>getImageData(<var>sx</var>,
  <var>sy</var>, <var>sw</var>, <var>sh</var>)</code></dfn> method must,
  if either the <var>sw</var> or <var>sh</var> arguments are zero, throw an
  <code id=pixel-manipulation:indexsizeerror-8><a href=infrastructure.html#indexsizeerror>IndexSizeError</a></code> exception; otherwise,
  
  if the <a href=#scratch-bitmap id=pixel-manipulation:scratch-bitmap>scratch bitmap</a>'s <a href=#concept-canvas-origin-clean id=pixel-manipulation:concept-canvas-origin-clean>origin-clean</a>
  flag is set to false, it must throw a <code id=pixel-manipulation:securityerror><a href=infrastructure.html#securityerror>SecurityError</a></code> exception;
  
  otherwise, it must return an <code id=pixel-manipulation:imagedata-13><a href=#imagedata>ImageData</a></code> object with width <var>sw</var> and
  height <var>sh</var> representing the <a href=#scratch-bitmap id=pixel-manipulation:scratch-bitmap-2>scratch bitmap</a> for the area of that
  bitmap denoted by the rectangle whose corners are the four points (<var>sx</var>, <var>sy</var>), (<span><var>sx</var>+<var>sw</var></span>, <var>sy</var>), (<span><var>sx</var>+<var>sw</var></span>,
  <span><var>sy</var>+<var>sh</var></span>), (<var>sx</var>,
  <span><var>sy</var>+<var>sh</var></span>), in the bitmap's
  coordinate space units. Pixels outside the <a href=#scratch-bitmap id=pixel-manipulation:scratch-bitmap-3>scratch bitmap</a> must be returned as
  transparent black. Pixels must be returned as non-premultiplied alpha values.</p>

  <p>New <code id=pixel-manipulation:imagedata-14><a href=#imagedata>ImageData</a></code> objects must be initialised so that their <dfn id=dom-imagedata-width><code>width</code></dfn> attribute is set to the number of pixels per
  row in the image data, their <dfn id=dom-imagedata-height><code>height</code></dfn>
  attribute is set to the number of rows in the image data, and their <dfn id=dom-imagedata-data><code>data</code></dfn> attribute, except where an existing array is
  provided, is initialised to a new <code id=pixel-manipulation:uint8clampedarray-4><a href=infrastructure.html#uint8clampedarray>Uint8ClampedArray</a></code> object. The
  <code id=pixel-manipulation:uint8clampedarray-5><a href=infrastructure.html#uint8clampedarray>Uint8ClampedArray</a></code> object must use a new <a href=#canvas-pixel-arraybuffer id=pixel-manipulation:canvas-pixel-arraybuffer>Canvas Pixel
  <code>ArrayBuffer</code></a> for its storage, and must have a zero start offset and a length
  equal to the length of its storage, in bytes. The <a href=#canvas-pixel-arraybuffer id=pixel-manipulation:canvas-pixel-arraybuffer-2>Canvas Pixel
  <code>ArrayBuffer</code></a> must contain the image data. At least one pixel's worth of image
  data must be returned. <a href=references.html#refsECMA262>[ECMA262]</a></p>

  <p>A <dfn id=canvas-pixel-arraybuffer>Canvas Pixel <code>ArrayBuffer</code></dfn> is an <code id=pixel-manipulation:arraybuffer><a href=infrastructure.html#arraybuffer>ArrayBuffer</a></code> whose data is
  represented in left-to-right order, row by row top to bottom, starting with the top left, with
  each pixel's red, green, blue, and alpha components being given in that order for each pixel. Each
  component of each pixel represented in this array must be in the range 0..255, representing the 8
  bit value for that component. The components must be assigned consecutive indices starting with 0
  for the top left pixel's red component. <a href=references.html#refsECMA262>[ECMA262]</a></p>

  <p>The <dfn id=dom-context-2d-putimagedata><code>putImageData()</code></dfn> method writes
  data from <code id=pixel-manipulation:imagedata-15><a href=#imagedata>ImageData</a></code> structures back to the rendering context's <a href=#scratch-bitmap id=pixel-manipulation:scratch-bitmap-4>scratch
  bitmap</a>. Its arguments are: <var>imagedata</var>, <var>dx</var>, <var>dy</var>, <var>dirtyX</var>, <var>dirtyY</var>, <var>dirtyWidth</var>, and <var>dirtyHeight</var>.</p>

  <p>When the last four arguments to this method are omitted, they must be assumed to have the
  values 0, 0, the <code id=pixel-manipulation:dom-imagedata-width-2><a href=#dom-imagedata-width>width</a></code> member of the <var>imagedata</var> structure, and the <code id=pixel-manipulation:dom-imagedata-height-2><a href=#dom-imagedata-height>height</a></code>
  member of the <var>imagedata</var> structure, respectively.</p>

  <p>When invoked, the method must act as follows:</p>

  <ol><li>

    <p>If the <var>imagedata</var> argument's <code id=pixel-manipulation:dom-imagedata-data-2><a href=#dom-imagedata-data>data</a></code> attribute has been <a href=infrastructure.html#concept-transferable-neutered id=pixel-manipulation:concept-transferable-neutered-2>neutered</a>, throw an <code id=pixel-manipulation:invalidstateerror-3><a href=infrastructure.html#invalidstateerror>InvalidStateError</a></code>
    exception and abort these steps.</p>

   <li>

    <p>If <var>dirtyWidth</var> is negative, let <var>dirtyX</var> be <span><var>dirtyX</var>+<var>dirtyWidth</var></span>, and let <var>dirtyWidth</var> be equal to the absolute magnitude of <var>dirtyWidth</var>.</p>

    <p>If <var>dirtyHeight</var> is negative, let <var>dirtyY</var> be <span><var>dirtyY</var>+<var>dirtyHeight</var></span>, and let <var>dirtyHeight</var> be equal to the absolute magnitude of <var>dirtyHeight</var>.</p>

   <li>

    <p>If <var>dirtyX</var> is negative, let <var>dirtyWidth</var> be <span><var>dirtyWidth</var>+<var>dirtyX</var></span>, and let <var>dirtyX</var> be zero.</p>

    <p>If <var>dirtyY</var> is negative, let <var>dirtyHeight</var> be <span><var>dirtyHeight</var>+<var>dirtyY</var></span>, and let <var>dirtyY</var> be zero.</p>

   <li>

    <p>If <span><var>dirtyX</var>+<var>dirtyWidth</var></span> is greater
    than the <code id=pixel-manipulation:dom-imagedata-width-3><a href=#dom-imagedata-width>width</a></code> attribute of the <var>imagedata</var> argument, let <var>dirtyWidth</var> be the value of that <code id=pixel-manipulation:dom-imagedata-width-4><a href=#dom-imagedata-width>width</a></code> attribute, minus the value of <var>dirtyX</var>.</p>

    <p>If <span><var>dirtyY</var>+<var>dirtyHeight</var></span> is
    greater than the <code id=pixel-manipulation:dom-imagedata-height-3><a href=#dom-imagedata-height>height</a></code> attribute of the <var>imagedata</var> argument, let <var>dirtyHeight</var> be the value of that
    <code id=pixel-manipulation:dom-imagedata-height-4><a href=#dom-imagedata-height>height</a></code> attribute, minus the value of <var>dirtyY</var>.</p>

   <li>

    <p>If, after those changes, either <var>dirtyWidth</var> or <var>dirtyHeight</var> is negative or zero, stop these steps without affecting any
    bitmaps.</p>

   <li><p>For all integer values of <var>x</var> and <var>y</var> where <span><var>dirtyX</var> ≤ <var>x</var> &lt; <span><var>dirtyX</var>+<var>dirtyWidth</var></span></span> and <span><var>dirtyY</var> ≤ <var>y</var> &lt; <span><var>dirtyY</var>+<var>dirtyHeight</var></span></span>, copy the
   four channels of the pixel with coordinate (<var>x</var>, <var>y</var>) in
   the <var>imagedata</var> data structure's <a href=#canvas-pixel-arraybuffer id=pixel-manipulation:canvas-pixel-arraybuffer-3>Canvas Pixel
   <code>ArrayBuffer</code></a> to the pixel with coordinate (<span><var>dx</var>+<var>x</var></span>, <span><var>dy</var>+<var>y</var></span>) in the rendering context's <a href=#scratch-bitmap id=pixel-manipulation:scratch-bitmap-5>scratch bitmap</a>.</ol>

  <p>The handling of pixel rounding when the specified coordinates are not integers is not defined
  by this specification, except that the following must result in no visible changes to the
  rendering:</p>

  <pre>context.putImageData(context.getImageData(x, y, w, h), p, q);</pre>

  <p>...for any value of <var>x</var>, <var>y</var>, <var>w</var>, and
  <var>h</var> and where <var>p</var> is the smaller of <var>x</var>
  and the sum of <var>x</var> and <var>w</var>, and <var>q</var> is
  the smaller of <var>y</var> and the sum of <var>y</var> and <var>h</var>; and except that the following two calls:</p>

  <pre>context.createImageData(w, h);
context.getImageData(0, 0, w, h);</pre>

  <p>...must return <code id=pixel-manipulation:imagedata-16><a href=#imagedata>ImageData</a></code> objects with the same dimensions as each other, for any
  value of <var>w</var> and <var>h</var>. In other words, while user agents may
  round the arguments of these methods, any rounding performed must be performed consistently for
  all of the methods described in this section. (The constructors only work with integer
  values.)</p>

  <p class=note>Due to the lossy nature of converting to and from premultiplied alpha colour
  values, pixels that have just been set using <code id=pixel-manipulation:dom-context-2d-putimagedata-2><a href=#dom-context-2d-putimagedata>putImageData()</a></code> might be returned to an equivalent
  <code id=pixel-manipulation:dom-context-2d-getimagedata-2><a href=#dom-context-2d-getimagedata>getImageData()</a></code> as different values.</p>

  <p>The current path, <a href=#transformations id=pixel-manipulation:transformations>transformation matrix</a>,
  <a href=#shadows id=pixel-manipulation:shadows>shadow attributes</a>, <a href=#dom-context-2d-globalalpha id=pixel-manipulation:dom-context-2d-globalalpha-2>global
  alpha</a>, the <a href=#clipping-region id=pixel-manipulation:clipping-region>clipping region</a>, and <a href=#dom-context-2d-globalcompositeoperation id=pixel-manipulation:dom-context-2d-globalcompositeoperation-2>global composition operator</a> must not
  affect the methods described in this section.</p>

  

  <div class=example>

   <p>In the following example, the script generates an <code id=pixel-manipulation:imagedata-17><a href=#imagedata>ImageData</a></code> object so that it can
   draw onto it.</p>

   <pre>// canvas is a reference to a &lt;canvas> element
var context = canvas.getContext('2d');

// create a blank slate
var data = context.createImageData(canvas.width, canvas.height);

// create some plasma
FillPlasma(data, 'green'); // green plasma

// add a cloud to the plasma
AddCloud(data, data.width/2, data.height/2); // put a cloud in the middle

// paint the plasma+cloud on the canvas
context.putImageData(data, 0, 0);

// support methods
function FillPlasma(data, color) { ... }
function AddCloud(data, x, y) { ... }</pre>

  </div>

  <div class=example>

   <p>Here is an example of using <code id=pixel-manipulation:dom-context-2d-getimagedata-3><a href=#dom-context-2d-getimagedata>getImageData()</a></code> and <code id=pixel-manipulation:dom-context-2d-putimagedata-3><a href=#dom-context-2d-putimagedata>putImageData()</a></code> to implement an edge detection
   filter.</p>

   <pre>&lt;!DOCTYPE HTML>
&lt;html>
 &lt;head>
  &lt;title>Edge detection demo&lt;/title>
  &lt;script>
   var image = new Image();
   function init() {
     image.onload = demo;
     image.src = "image.jpeg";
   }
   function demo() {
     var canvas = document.getElementsByTagName('canvas')[0];
     var context = canvas.getContext('2d');

     // draw the image onto the canvas
     context.drawImage(image, 0, 0);

     // get the image data to manipulate
     var input = context.getImageData(0, 0, canvas.width, canvas.height);

     // get an empty slate to put the data into
     var output = context.createImageData(canvas.width, canvas.height);

     // alias some variables for convenience
     // notice that we are using input.width and input.height here
     // as they might not be the same as canvas.width and canvas.height
     // (in particular, they might be different on high-res displays)
     var w = input.width, h = input.height;
     var inputData = input.data;
     var outputData = output.data;

     // edge detection
     for (var y = 1; y &lt; h-1; y += 1) {
       for (var x = 1; x &lt; w-1; x += 1) {
         for (var c = 0; c &lt; 3; c += 1) {
           var i = (y*w + x)*4 + c;
           outputData[i] = 127 + -inputData[i - w*4 - 4] -   inputData[i - w*4] - inputData[i - w*4 + 4] +
                                 -inputData[i - 4]       + 8*inputData[i]       - inputData[i + 4] +
                                 -inputData[i + w*4 - 4] -   inputData[i + w*4] - inputData[i + w*4 + 4];
         }
         outputData[(y*w + x)*4 + 3] = 255; // alpha
       }
     }

     // put the image data back after manipulation
     context.putImageData(output, 0, 0);
   }
  &lt;/script>
 &lt;/head>
 &lt;body onload="init()">
  &lt;canvas>&lt;/canvas>
 &lt;/body>
&lt;/html></pre>

  </div>




  <h6 id=compositing>4.12.4.2.17 Compositing</h6>

  <dl class=domintro><dt><var>context</var> . <code id=compositing:dom-context-2d-globalalpha><a href=#dom-context-2d-globalalpha>globalAlpha</a></code> [ = <var>value</var> ]<dd>

    <p>Returns the current alpha value applied to rendering operations.</p>

    <p>Can be set, to change the alpha value. Values outside of the range 0.0 .. 1.0 are
    ignored.</p>

   <dt><var>context</var> . <code id=compositing:dom-context-2d-globalcompositeoperation><a href=#dom-context-2d-globalcompositeoperation>globalCompositeOperation</a></code> [ = <var>value</var> ]<dd>

    <p>Returns the current composition operation, from the values defined in the Compositing and
    Blending specification. <a href=references.html#refsCOMPOSITE>[COMPOSITE]</a>.</p>

    <p>Can be set, to change the composition operation. Unknown values are ignored.</p>

   </dl>

  

  <p>All drawing operations are affected by the global compositing attributes, <code id=compositing:dom-context-2d-globalalpha-2><a href=#dom-context-2d-globalalpha>globalAlpha</a></code> and <code id=compositing:dom-context-2d-globalcompositeoperation-2><a href=#dom-context-2d-globalcompositeoperation>globalCompositeOperation</a></code>.</p>

  

  <p>The <dfn id=dom-context-2d-globalalpha><code>globalAlpha</code></dfn> attribute gives an
  alpha value that is applied to shapes and images before they are composited onto the <a href=#scratch-bitmap id=compositing:scratch-bitmap>scratch
  bitmap</a>. The value must be in the range from 0.0 (fully transparent) to 1.0 (no additional
  transparency). If an attempt is made to set the attribute to a value outside this range, including
  Infinity and Not-a-Number (NaN) values, the attribute must retain its previous value. When the
  context is created, the <code id=compositing:dom-context-2d-globalalpha-3><a href=#dom-context-2d-globalalpha>globalAlpha</a></code> attribute must
  initially have the value 1.0.</p>

  <p>The <dfn id=dom-context-2d-globalcompositeoperation><code>globalCompositeOperation</code></dfn> attribute
  sets the <dfn id=current-composition-operator>current composition operator</dfn>, which controls how shapes and images are drawn onto the
  <a href=#scratch-bitmap id=compositing:scratch-bitmap-2>scratch bitmap</a>, once they have had <code id=compositing:dom-context-2d-globalalpha-4><a href=#dom-context-2d-globalalpha>globalAlpha</a></code> and the current transformation matrix
  applied. The possible values are those defined in the Compositing and Blending specification, and
  include the values <dfn id=gcop-source-over><code>source-over</code></dfn>
  and <dfn id=gcop-copy><code>copy</code></dfn>.
  <a href=references.html#refsCOMPOSITE>[COMPOSITE]</a>

  <p>These values are all case-sensitive — they must be used exactly as defined. User agents
  must not recognise values that are not a <a id=compositing:case-sensitive href=infrastructure.html#case-sensitive>case-sensitive</a> match for one of the values
  given in the Compositing and Blending specification. <a href=references.html#refsCOMPOSITE>[COMPOSITE]</a></p>

  <p>On setting, if the user agent does not recognise the specified value, it must be ignored,
  leaving the value of <code id=compositing:dom-context-2d-globalcompositeoperation-3><a href=#dom-context-2d-globalcompositeoperation>globalCompositeOperation</a></code> unaffected.
  Otherwise, the attribute must be set to the given new value.</p>

  <p>When the context is created, the <code id=compositing:dom-context-2d-globalcompositeoperation-4><a href=#dom-context-2d-globalcompositeoperation>globalCompositeOperation</a></code> attribute must
  initially have the value <code id=compositing:gcop-source-over><a href=#gcop-source-over>source-over</a></code>.</p>

  



  <h6 id=image-smoothing>4.12.4.2.18 Image smoothing</h6>

  <dl class=domintro><dt><var>context</var> . <code id=image-smoothing:dom-context-2d-imagesmoothingenabled><a href=#dom-context-2d-imagesmoothingenabled>imageSmoothingEnabled</a></code> [ = <var>value</var> ]<dd>

    <p>Returns whether pattern fills and the <code id=image-smoothing:dom-context-2d-drawimage><a href=#dom-context-2d-drawimage>drawImage()</a></code> method will attempt to smooth images if
    their pixels don't line up exactly with the display, when scaling images up.</p>

    <p>Can be set, to change whether images are smoothed (true) or not (false).</p>

   </dl>

  

  <p>The <dfn id=dom-context-2d-imagesmoothingenabled><code>imageSmoothingEnabled</code></dfn>
  attribute, on getting, must return the last value it was set to. On setting, it must be set to the
  new value. When the <code id=image-smoothing:canvasrenderingcontext2d><a href=#canvasrenderingcontext2d>CanvasRenderingContext2D</a></code> object is created, the attribute must be
  set to true.</p>

  


  <h6 id=shadows>4.12.4.2.19 <dfn>Shadows</dfn></h6>

  <p>All drawing operations are affected by the four global shadow attributes.</p>

  <dl class=domintro><dt><var>context</var> . <code id=shadows:dom-context-2d-shadowcolor><a href=#dom-context-2d-shadowcolor>shadowColor</a></code> [ = <var>value</var> ]<dd>

    <p>Returns the current shadow colour.</p>

    <p>Can be set, to change the shadow colour. Values that cannot be parsed as CSS colours are ignored.</p>

   <dt><var>context</var> . <code id=shadows:dom-context-2d-shadowoffsetx><a href=#dom-context-2d-shadowoffsetx>shadowOffsetX</a></code> [ = <var>value</var> ]<dt><var>context</var> . <code id=shadows:dom-context-2d-shadowoffsety><a href=#dom-context-2d-shadowoffsety>shadowOffsetY</a></code> [ = <var>value</var> ]<dd>

    <p>Returns the current shadow offset.</p>

    <p>Can be set, to change the shadow offset. Values that are not finite numbers are ignored.</p>

   <dt><var>context</var> . <code id=shadows:dom-context-2d-shadowblur><a href=#dom-context-2d-shadowblur>shadowBlur</a></code> [ = <var>value</var> ]<dd>

    <p>Returns the current level of blur applied to shadows.</p>

    <p>Can be set, to change the blur level. Values that are not finite numbers greater than or
    equal to zero are ignored.</p>

   </dl>

  

  <p>The <dfn id=dom-context-2d-shadowcolor><code>shadowColor</code></dfn> attribute sets the
  colour of the shadow.</p>

  <p>When the context is created, the <code id=shadows:dom-context-2d-shadowcolor-2><a href=#dom-context-2d-shadowcolor>shadowColor</a></code>
  attribute initially must be fully-transparent black.</p>

  <p>On getting, the <a href=#serialisation-of-a-colour id=shadows:serialisation-of-a-colour>serialisation of the colour</a>
  must be returned.</p>

  <p>On setting, the new value must be <a id=shadows:parsed-as-a-css-color-value href=infrastructure.html#parsed-as-a-css-color-value>parsed as a CSS &lt;color> value</a> and the
  colour assigned. If the value cannot be parsed as a CSS &lt;color> value then it must be
  ignored, and the attribute must retain its previous value. <a href=references.html#refsCSSCOLOR>[CSSCOLOR]</a></p>

  <p>The <dfn id=dom-context-2d-shadowoffsetx><code>shadowOffsetX</code></dfn> and <dfn id=dom-context-2d-shadowoffsety><code>shadowOffsetY</code></dfn> attributes specify the distance
  that the shadow will be offset in the positive horizontal and positive vertical distance
  respectively. Their values are in coordinate space units. They are not affected by the current
  transformation matrix.</p>

  <p>When the context is created, the shadow offset attributes must initially have the value
  0.</p>

  <p>On getting, they must return their current value. On setting, the attribute being set must be
  set to the new value, except if the value is infinite or NaN, in which case the new value must be
  ignored.</p>

  <p>The <dfn id=dom-context-2d-shadowblur><code>shadowBlur</code></dfn> attribute specifies
  the level of the blurring effect. (The units do not map to coordinate space units, and are not
  affected by the current transformation matrix.)</p>

  <p>When the context is created, the <code id=shadows:dom-context-2d-shadowblur-2><a href=#dom-context-2d-shadowblur>shadowBlur</a></code>
  attribute must initially have the value 0.</p>

  <p>On getting, the attribute must return its current value. On setting the attribute must be set
  to the new value, except if the value is negative, infinite or NaN, in which case the new value
  must be ignored.</p>

  <p><dfn id=when-shadows-are-drawn>Shadows are only drawn if</dfn> the opacity component of
  the alpha component of the colour of <code id=shadows:dom-context-2d-shadowcolor-3><a href=#dom-context-2d-shadowcolor>shadowColor</a></code> is
  non-zero and either the <code id=shadows:dom-context-2d-shadowblur-3><a href=#dom-context-2d-shadowblur>shadowBlur</a></code> is non-zero, or
  the <code id=shadows:dom-context-2d-shadowoffsetx-2><a href=#dom-context-2d-shadowoffsetx>shadowOffsetX</a></code> is non-zero, or the <code id=shadows:dom-context-2d-shadowoffsety-2><a href=#dom-context-2d-shadowoffsety>shadowOffsetY</a></code> is non-zero.</p>

  <p><a href=#when-shadows-are-drawn id=shadows:when-shadows-are-drawn>When shadows are drawn</a>, they must be rendered as follows:</p>

  <ol><li><p>Let <var>A</var> be an infinite transparent black bitmap on which the source
   image for which a shadow is being created has been rendered.<li><p>Let <var>B</var> be an infinite transparent black bitmap, with a coordinate
   space and an origin identical to <var>A</var>.<li><p>Copy the alpha channel of <var>A</var> to <var>B</var>, offset by <code id=shadows:dom-context-2d-shadowoffsetx-3><a href=#dom-context-2d-shadowoffsetx>shadowOffsetX</a></code> in the positive <var>x</var>
   direction, and <code id=shadows:dom-context-2d-shadowoffsety-3><a href=#dom-context-2d-shadowoffsety>shadowOffsetY</a></code> in the positive
   <var>y</var> direction.<li>

    <p>If <code id=shadows:dom-context-2d-shadowblur-4><a href=#dom-context-2d-shadowblur>shadowBlur</a></code> is greater than 0:</p>

    <ol><li> <p>Let <var>σ</var> be half the value of <code id=shadows:dom-context-2d-shadowblur-5><a href=#dom-context-2d-shadowblur>shadowBlur</a></code>.<li> <p>Perform a 2D Gaussian Blur on <var>B</var>, using <var>σ</var>
     as the standard deviation.</p>  </ol>

    <p>User agents may limit values of <var>σ</var> to an implementation-specific
    maximum value to avoid exceeding hardware limitations during the Gaussian blur operation.</p>

   <li><p>Set the red, green, and blue components of every pixel in <var>B</var> to the
   red, green, and blue components (respectively) of the colour of <code id=shadows:dom-context-2d-shadowcolor-4><a href=#dom-context-2d-shadowcolor>shadowColor</a></code>.<li><p>Multiply the alpha component of every pixel in <var>B</var> by the alpha
   component of the colour of <code id=shadows:dom-context-2d-shadowcolor-5><a href=#dom-context-2d-shadowcolor>shadowColor</a></code>.<li><p>The shadow is in the bitmap <var>B</var>, and is rendered as part of the
   <a href=#drawing-model id=shadows:drawing-model>drawing model</a> described below.</ol>

  

  <p>If the current composition operation is <code id=shadows:gcop-copy><a href=#gcop-copy>copy</a></code>, shadows
  effectively won't render (since the shape will overwrite the shadow).</p>



  

  <h6 id=drawing-model>4.12.4.2.20 <dfn>Drawing model</dfn></h6>

  <p>When a shape or image is painted, user agents must follow these steps, in the order given (or
  act as if they do):</p>

  <ol><li><p>Render the shape or image onto an infinite transparent black bitmap, creating image <var>A</var>, as described in the previous sections. For shapes, the current fill, stroke,
   and line styles must be honored, and the stroke must itself also be subjected to the current
   transformation matrix.<li><p><a href=#when-shadows-are-drawn id=drawing-model:when-shadows-are-drawn>When shadows are drawn</a>, render the shadow from image <var>A</var>,
   using the current shadow styles, creating image <var>B</var>.<li><p><a href=#when-shadows-are-drawn id=drawing-model:when-shadows-are-drawn-2>When shadows are drawn</a>, multiply the alpha component of every pixel in <var>B</var> by <code id=drawing-model:dom-context-2d-globalalpha><a href=#dom-context-2d-globalalpha>globalAlpha</a></code>.<li><p><a href=#when-shadows-are-drawn id=drawing-model:when-shadows-are-drawn-3>When shadows are drawn</a>, composite <var>B</var> within the
   <a href=#clipping-region id=drawing-model:clipping-region>clipping region</a> over the current <a href=#scratch-bitmap id=drawing-model:scratch-bitmap>scratch bitmap</a> using the <a href=#current-composition-operator id=drawing-model:current-composition-operator>current
   composition operator</a>.<li><p>Multiply the alpha component of every pixel in <var>A</var> by <code id=drawing-model:dom-context-2d-globalalpha-2><a href=#dom-context-2d-globalalpha>globalAlpha</a></code>.<li><p>Composite <var>A</var> within the <a href=#clipping-region id=drawing-model:clipping-region-2>clipping region</a> over the current
   <a href=#scratch-bitmap id=drawing-model:scratch-bitmap-2>scratch bitmap</a> using the <a href=#current-composition-operator id=drawing-model:current-composition-operator-2>current composition operator</a>.</ol>

  <p>When compositing onto the <a href=#scratch-bitmap id=drawing-model:scratch-bitmap-3>scratch bitmap</a>, pixels that would fall outside of the
  <a href=#scratch-bitmap id=drawing-model:scratch-bitmap-4>scratch bitmap</a> must be discarded.</p>

  




  <h6 id=best-practices>4.12.4.2.21 Best practices</h6>

  <p>When a canvas is interactive, authors should include focusable elements in the element's
  fallback content corresponding to each focusable part of the canvas, as in the <a href=#drawCustomFocusRingExample>example above</a>.</p>

  <p>To expose text and interactive content on a <code id=best-practices:the-canvas-element><a href=#the-canvas-element>canvas</a></code> to users of accessibility
  tools, authors should use the <code id=best-practices:dom-context-2d-addhitregion><a href=#dom-context-2d-addhitregion>addHitRegion()</a></code>
  API. When rendering focus rings, to ensure that focus rings have the appearance of native focus
  rings, authors should use the <code id=best-practices:dom-context-2d-drawfocusifneeded><a href=#dom-context-2d-drawfocusifneeded>drawFocusIfNeeded()</a></code> method, passing it the
  element for which a ring is being drawn. This method only draws the focus ring if the element is
  <a id=best-practices:focused href=interaction.html#focused>focused</a>, so that it can simply be called whenever drawing the element, without
  checking whether the element is focused or not first.</p>

  <p>In addition to drawing focus rings, authors should use the <code id=best-practices:dom-context-2d-scrollpathintoview><a href=#dom-context-2d-scrollpathintoview>scrollPathIntoView()</a></code> method when an element in
  the canvas is focused, to make sure it is visible on the screen (if applicable).</p>

  <p id=no-text-editing-in-canvas-please>Authors should avoid implementing text editing controls
  using the <code id=best-practices:the-canvas-element-2><a href=#the-canvas-element>canvas</a></code> element. Doing so has a large number of disadvantages:</p>

  <ul><li>Mouse placement of the caret has to be reimplemented.<li>Keyboard movement of the caret has to be reimplemented (possibly across lines, for multiline
   text input).<li>Scrolling of the text field has to be implemented (horizontally for long lines, vertically
   for multiline input).<li>Native features such as copy-and-paste have to be reimplemented.<li>Native features such as spell-checking have to be reimplemented.<li>Native features such as drag-and-drop have to be reimplemented.<li>Native features such as page-wide text search have to be reimplemented.<li>Native features specific to the user, for example custom text services, have to be
   reimplemented. This is close to impossible since each user might have different services
   installed, and there is an unbounded set of possible such services.<li>Bidirectional text editing has to be reimplemented.<li>For multiline text editing, line wrapping has to be implemented for all relevant
   languages.<li>Text selection has to be reimplemented.<li>Dragging of bidirectional text selections has to be reimplemented.<li>Platform-native keyboard shortcuts have to be reimplemented.<li>Platform-native input method editors (IMEs) have to be reimplemented.<li>Undo and redo functionality has to be reimplemented.<li>Accessibility features such as magnification following the caret or selection have to be
   reimplemented.</ul>

  <p>This is a huge amount of work, and authors are most strongly encouraged to avoid doing any of
  it by instead using the <code id=best-practices:the-input-element><a href=forms.html#the-input-element>input</a></code> element, the <code id=best-practices:the-textarea-element><a href=forms.html#the-textarea-element>textarea</a></code> element, or the
  <code id=best-practices:attr-contenteditable><a href=interaction.html#attr-contenteditable>contenteditable</a></code> attribute.</p>


  <h6 id=examples>4.12.4.2.22 Examples</h6>

  <p><i>This section is non-normative.</i></p>

  <div class=example>

  <p>Here is an example of a script that uses canvas to draw <a href="data:text/html;charset=utf-8;base64,PCFET0NUWVBFIEhUTUw%2BDQo8aHRtbCBsYW5nPSJlbiI%2BDQogPGhlYWQ%2BDQogIDx0aXRsZT5QcmV0dHkgR2xvd2luZyBMaW5lczwvdGl0bGU%2BDQogPC9oZWFkPg0KIDxib2R5Pg0KPGNhbnZhcyB3aWR0aD0iODAwIiBoZWlnaHQ9IjQ1MCI%2BPC9jYW52YXM%2BDQo8c2NyaXB0Pg0KDQogdmFyIGNvbnRleHQgPSBkb2N1bWVudC5nZXRFbGVtZW50c0J5VGFnTmFtZSgnY2FudmFzJylbMF0uZ2V0Q29udGV4dCgnMmQnKTsNCg0KIHZhciBsYXN0WCA9IGNvbnRleHQuY2FudmFzLndpZHRoICogTWF0aC5yYW5kb20oKTsNCiB2YXIgbGFzdFkgPSBjb250ZXh0LmNhbnZhcy5oZWlnaHQgKiBNYXRoLnJhbmRvbSgpOw0KIHZhciBodWUgPSAwOw0KIGZ1bmN0aW9uIGxpbmUoKSB7DQogICBjb250ZXh0LnNhdmUoKTsNCiAgIGNvbnRleHQudHJhbnNsYXRlKGNvbnRleHQuY2FudmFzLndpZHRoLzIsIGNvbnRleHQuY2FudmFzLmhlaWdodC8yKTsNCiAgIGNvbnRleHQuc2NhbGUoMC45LCAwLjkpOw0KICAgY29udGV4dC50cmFuc2xhdGUoLWNvbnRleHQuY2FudmFzLndpZHRoLzIsIC1jb250ZXh0LmNhbnZhcy5oZWlnaHQvMik7DQogICBjb250ZXh0LmJlZ2luUGF0aCgpOw0KICAgY29udGV4dC5saW5lV2lkdGggPSA1ICsgTWF0aC5yYW5kb20oKSAqIDEwOw0KICAgY29udGV4dC5tb3ZlVG8obGFzdFgsIGxhc3RZKTsNCiAgIGxhc3RYID0gY29udGV4dC5jYW52YXMud2lkdGggKiBNYXRoLnJhbmRvbSgpOw0KICAgbGFzdFkgPSBjb250ZXh0LmNhbnZhcy5oZWlnaHQgKiBNYXRoLnJhbmRvbSgpOw0KICAgY29udGV4dC5iZXppZXJDdXJ2ZVRvKGNvbnRleHQuY2FudmFzLndpZHRoICogTWF0aC5yYW5kb20oKSwNCiAgICAgICAgICAgICAgICAgICAgICAgICBjb250ZXh0LmNhbnZhcy5oZWlnaHQgKiBNYXRoLnJhbmRvbSgpLA0KICAgICAgICAgICAgICAgICAgICAgICAgIGNvbnRleHQuY2FudmFzLndpZHRoICogTWF0aC5yYW5kb20oKSwNCiAgICAgICAgICAgICAgICAgICAgICAgICBjb250ZXh0LmNhbnZhcy5oZWlnaHQgKiBNYXRoLnJhbmRvbSgpLA0KICAgICAgICAgICAgICAgICAgICAgICAgIGxhc3RYLCBsYXN0WSk7DQoNCiAgIGh1ZSA9IGh1ZSArIDEwICogTWF0aC5yYW5kb20oKTsNCiAgIGNvbnRleHQuc3Ryb2tlU3R5bGUgPSAnaHNsKCcgKyBodWUgKyAnLCA1MCUsIDUwJSknOw0KICAgY29udGV4dC5zaGFkb3dDb2xvciA9ICd3aGl0ZSc7DQogICBjb250ZXh0LnNoYWRvd0JsdXIgPSAxMDsNCiAgIGNvbnRleHQuc3Ryb2tlKCk7DQogICBjb250ZXh0LnJlc3RvcmUoKTsNCiB9DQogc2V0SW50ZXJ2YWwobGluZSwgNTApOw0KDQogZnVuY3Rpb24gYmxhbmsoKSB7DQogICBjb250ZXh0LmZpbGxTdHlsZSA9ICdyZ2JhKDAsMCwwLDAuMSknOw0KICAgY29udGV4dC5maWxsUmVjdCgwLCAwLCBjb250ZXh0LmNhbnZhcy53aWR0aCwgY29udGV4dC5jYW52YXMuaGVpZ2h0KTsNCiB9DQogc2V0SW50ZXJ2YWwoYmxhbmssIDQwKTsNCg0KPC9zY3JpcHQ%2BDQogPC9ib2R5Pg0KPC9odG1sPg0K">pretty glowing lines</a>.</p>

  <pre>&lt;canvas width="800" height="450">&lt;/canvas>
&lt;script>

 var context = document.getElementsByTagName('canvas')[0].getContext('2d');

 var lastX = context.canvas.width * Math.random();
 var lastY = context.canvas.height * Math.random();
 var hue = 0;
 function line() {
   context.save();
   context.translate(context.canvas.width/2, context.canvas.height/2);
   context.scale(0.9, 0.9);
   context.translate(-context.canvas.width/2, -context.canvas.height/2);
   context.beginPath();
   context.lineWidth = 5 + Math.random() * 10;
   context.moveTo(lastX, lastY);
   lastX = context.canvas.width * Math.random();
   lastY = context.canvas.height * Math.random();
   context.bezierCurveTo(context.canvas.width * Math.random(),
                         context.canvas.height * Math.random(),
                         context.canvas.width * Math.random(),
                         context.canvas.height * Math.random(),
                         lastX, lastY);

   hue = hue + 10 * Math.random();
   context.strokeStyle = 'hsl(' + hue + ', 50%, 50%)';
   context.shadowColor = 'white';
   context.shadowBlur = 10;
   context.stroke();
   context.restore();
 }
 setInterval(line, 50);

 function blank() {
   context.fillStyle = 'rgba(0,0,0,0.1)';
   context.fillRect(0, 0, context.canvas.width, context.canvas.height);
 }
 setInterval(blank, 40);

&lt;/script></pre>

  </div>

  <div class=example>

   <p>The 2D rendering context for <code id=examples:the-canvas-element><a href=#the-canvas-element>canvas</a></code> is often used for sprite-based games. The
   following example demonstrates this:</p>

   <iframe src=https://whatwg.org/demos/canvas/blue-robot/index-idle.html width=396 height=216></iframe>

   <p>Here is the source for this example:</p>

   <pre>&lt;!DOCTYPE HTML>
&lt;title>Blue Robot Demo&lt;/title>
&lt;base href="https://www.whatwg.org/demos/canvas/blue-robot/">
&lt;style>
  html { overflow: hidden; min-height: 200px; min-width: 380px; }
  body { height: 200px; position: relative; margin: 8px; }
  .buttons { position: absolute; bottom: 0px; left: 0px; margin: 4px; }
&lt;/style>
&lt;canvas width="380" height="200">&lt;/canvas>
&lt;script>
 var Landscape = function (context, width, height) {
   this.offset = 0;
   this.width = width;
   this.advance = function (dx) {
     this.offset += dx;
   };
   this.horizon = height * 0.7;
   // This creates the sky gradient (from a darker blue to white at the bottom)
   this.sky = context.createLinearGradient(0, 0, 0, this.horizon);
   this.sky.addColorStop(0.0, 'rgb(55,121,179)');
   this.sky.addColorStop(0.7, 'rgb(121,194,245)');
   this.sky.addColorStop(1.0, 'rgb(164,200,214)');
   // this creates the grass gradient (from a darker green to a lighter green)
   this.earth = context.createLinearGradient(0, this.horizon, 0, height);
   this.earth.addColorStop(0.0, 'rgb(81,140,20)');
   this.earth.addColorStop(1.0, 'rgb(123,177,57)');
   this.paintBackground = function (context, width, height) {
     // first, paint the sky and grass rectangles
     context.fillStyle = this.sky;
     context.fillRect(0, 0, width, this.horizon);
     context.fillStyle = this.earth;
     context.fillRect(0, this.horizon, width, height-this.horizon);
     // then, draw the cloudy banner
     // we make it cloudy by having the draw text off the top of the
     // canvas, and just having the blurred shadow shown on the canvas
     context.save();
     context.translate(width-((this.offset+(this.width*3.2)) % (this.width*4.0))+0, 0);
     context.shadowColor = 'white';
     context.shadowOffsetY = 30+this.horizon/3; // offset down on canvas
     context.shadowBlur = '5';
     context.fillStyle = 'white';
     context.textAlign = 'left';
     context.textBaseline = 'top';
     context.font = '20px sans-serif';
     context.fillText('WHATWG ROCKS', 10, -30); // text up above canvas
     context.restore();     
     // then, draw the background tree
     context.save();
     context.translate(width-((this.offset+(this.width*0.2)) % (this.width*1.5))+30, 0);
     context.beginPath();
     context.fillStyle = 'rgb(143,89,2)';
     context.lineStyle = 'rgb(10,10,10)';
     context.lineWidth = 2;
     context.rect(0, this.horizon+5, 10, -50); // trunk
     context.fill();
     context.stroke();
     context.beginPath();
     context.fillStyle = 'rgb(78,154,6)';
     context.arc(5, this.horizon-60, 30, 0, Math.PI*2); // leaves
     context.fill();
     context.stroke();
     context.restore();
   };
   this.paintForeground = function (context, width, height) {
     // draw the box that goes in front
     context.save();
     context.translate(width-((this.offset+(this.width*0.7)) % (this.width*1.1))+0, 0);
     context.beginPath();
     context.rect(0, this.horizon - 5, 25, 25);
     context.fillStyle = 'rgb(220,154,94)';
     context.lineStyle = 'rgb(10,10,10)';
     context.lineWidth = 2;
     context.fill();
     context.stroke();
     context.restore();
   };
 };
&lt;/script>
&lt;script>
 var BlueRobot = function () {
   this.sprites = new Image();
   this.sprites.src = 'blue-robot.png'; // this sprite sheet has 8 cells
   this.targetMode = 'idle';
   this.walk = function () {
     this.targetMode = 'walk';
   };
   this.stop = function () {
     this.targetMode = 'idle';
   };
   this.frameIndex = {
     'idle': [0], // first cell is the idle frame
     'walk': [1,2,3,4,5,6], // the walking animation is cells 1-6
     'stop': [7], // last cell is the stopping animation
   };
   this.mode = 'idle';
   this.frame = 0; // index into frameIndex
   this.tick = function () {
     // this advances the frame and the robot
     // the return value is how many pixels the robot has moved
     this.frame += 1;
     if (this.frame >= this.frameIndex[this.mode].length) {
       // we've reached the end of this animation cycle
       this.frame = 0;
       if (this.mode != this.targetMode) {
         // switch to next cycle
         if (this.mode == 'walk') {
           // we need to stop walking before we decide what to do next
           this.mode = 'stop';
         } else if (this.mode == 'stop') {
           if (this.targetMode == 'walk')
             this.mode = 'walk';
           else
             this.mode = 'idle';
         } else if (this.mode == 'idle') {
           if (this.targetMode == 'walk')
             this.mode = 'walk';
         }
       }
     }
     if (this.mode == 'walk')
       return 8;
     return 0;
   },
   this.paint = function (context, x, y) {
     if (!this.sprites.complete) return;
     // draw the right frame out of the sprite sheet onto the canvas
     // we assume each frame is as high as the sprite sheet
     // the x,y coordinates give the position of the bottom center of the sprite
     context.drawImage(this.sprites,
                       this.frameIndex[this.mode][this.frame] * this.sprites.height, 0, this.sprites.height, this.sprites.height,
                       x-this.sprites.height/2, y-this.sprites.height, this.sprites.height, this.sprites.height);
   };
 };
&lt;/script>
&lt;script>
 var canvas = document.getElementsByTagName('canvas')[0];
 var context = canvas.getContext('2d');
 var landscape = new Landscape(context, canvas.width, canvas.height);
 var blueRobot = new BlueRobot();
 // paint when the browser wants us to, using requestAnimationFrame()
 function paint() {
   context.clearRect(0, 0, canvas.width, canvas.height);
   landscape.paintBackground(context, canvas.width, canvas.height);
   blueRobot.paint(context, canvas.width/2, landscape.horizon*1.1);
   landscape.paintForeground(context, canvas.width, canvas.height);
   requestAnimationFrame(paint);
 }
 paint();
 // but tick every 150ms, so that we don't slow down when we don't paint
 setInterval(function () {
   var dx = blueRobot.tick();
   landscape.advance(dx);
 }, 100);
&lt;/script>
&lt;p class="buttons">
 &lt;input type=button value="Walk" onclick="blueRobot.walk()">
 &lt;input type=button value="Stop" onclick="blueRobot.stop()">
&lt;footer>
 &lt;small> Blue Robot Player Sprite by &lt;a href="http://johncolburn.deviantart.com/">JohnColburn&lt;/a>.
 Licensed under the terms of the Creative Commons Attribution Share-Alike 3.0 Unported license.&lt;/small>
 &lt;small> This work is itself licensed under a &lt;a rel="license" href="http://creativecommons.org/licenses/by-sa/3.0/">Creative
 Commons Attribution-ShareAlike 3.0 Unported License&lt;/a>.&lt;/small>
&lt;/footer>
</pre>

  </div>




  

  <h5 id=colour-spaces-and-colour-correction>4.12.4.3 Colour spaces and colour correction</h5>

  <p>The <code id=colour-spaces-and-colour-correction:the-canvas-element><a href=#the-canvas-element>canvas</a></code> APIs must perform colour correction at only two points: when rendering
  images with their own gamma correction and colour space information onto a bitmap, to convert the
  image to the colour space used by the bitmaps (e.g. using the 2D Context's <code id=colour-spaces-and-colour-correction:dom-context-2d-drawimage><a href=#dom-context-2d-drawimage>drawImage()</a></code> method with an <code id=colour-spaces-and-colour-correction:htmlimageelement><a href=embedded-content.html#htmlimageelement>HTMLImageElement</a></code>
  object), and when rendering the actual canvas bitmap to the output device.</p>

  <p class=note>Thus, in the 2D context, colours used to draw shapes onto the canvas will exactly
  match colours obtained through the <code id=colour-spaces-and-colour-correction:dom-context-2d-getimagedata><a href=#dom-context-2d-getimagedata>getImageData()</a></code> method.</p>

  <p>The <code id=colour-spaces-and-colour-correction:dom-canvas-todataurl><a href=#dom-canvas-todataurl>toDataURL()</a></code> method must not include colour space
  information in the resources they return. Where the output format allows it, the colour of pixels
  in resources created by <code id=colour-spaces-and-colour-correction:dom-canvas-todataurl-2><a href=#dom-canvas-todataurl>toDataURL()</a></code> must match those
  returned by the <code id=colour-spaces-and-colour-correction:dom-context-2d-getimagedata-2><a href=#dom-context-2d-getimagedata>getImageData()</a></code> method.</p>

  <p>In user agents that support CSS, the colour space used by a <code id=colour-spaces-and-colour-correction:the-canvas-element-2><a href=#the-canvas-element>canvas</a></code> element must
  match the colour space used for processing any colours for that element in CSS.</p>

  <p>The gamma correction and colour space information of images must be handled in such a way that
  an image rendered directly using an <code id=colour-spaces-and-colour-correction:the-img-element><a href=embedded-content.html#the-img-element>img</a></code> element would use the same colours as one
  painted on a <code id=colour-spaces-and-colour-correction:the-canvas-element-3><a href=#the-canvas-element>canvas</a></code> element that is then itself rendered. Furthermore, the rendering
  of images that have no colour correction information (such as those returned by the <code id=colour-spaces-and-colour-correction:dom-canvas-todataurl-3><a href=#dom-canvas-todataurl>toDataURL()</a></code> method) must be rendered with no colour
  correction.</p>

  <p class=note>Thus, in the 2D context, calling the <code id=colour-spaces-and-colour-correction:dom-context-2d-drawimage-2><a href=#dom-context-2d-drawimage>drawImage()</a></code> method to render the output of the <code id=colour-spaces-and-colour-correction:dom-canvas-todataurl-4><a href=#dom-canvas-todataurl>toDataURL()</a></code> method to the canvas, given the appropriate
  dimensions, has no visible effect.</p>

  



  <h5 id=serialising-bitmaps-to-a-file>4.12.4.4 Serialising bitmaps to a file</h5>

  

  <p>When a user agent is to create <dfn id=a-serialisation-of-the-bitmap-as-a-file>a serialisation of the bitmap as a file</dfn>, optionally
  with some given <var>arguments</var>, and optionally with a <var>native</var> flag set, it must
  create an image file in the format given by the first value of <var>arguments</var>, or, if there
  are no <var>arguments</var>, in the PNG format. <a href=references.html#refsPNG>[PNG]</a></p>

  <p>If the <var>native</var> flag is set, or if the bitmap has one pixel per coordinate space unit,
  then the image file must have the same pixel data (before compression, if applicable) as the
  bitmap, and if the file format used supports encoding resolution metadata, the resolution of that
  bitmap (device pixels per coordinate space units being interpreted as image pixels per CSS pixel)
  must be given as well.</p>

  <p>Otherwise, the image file's pixel data must be the bitmap's pixel data scaled to one image
  pixel per coordinate space unit, and if the file format used supports encoding resolution
  metadata, the resolution must be given as 96dpi (one image pixel per CSS pixel).</p>

  <p>If <var>arguments</var> is not empty, the first value must be interpreted as a <a href=infrastructure.html#mime-type id=serialising-bitmaps-to-a-file:mime-type>MIME type</a> giving the format to use. If the type has any parameters, it
  must be treated as not supported.</p>

  <p class=example>For example, the value "<code id=serialising-bitmaps-to-a-file:image/png><a href=indices.html#image/png>image/png</a></code>" would mean to generate a PNG
  image, the value "<code id=serialising-bitmaps-to-a-file:image/jpeg><a href=indices.html#image/jpeg>image/jpeg</a></code>" would mean to generate a JPEG image, and the value
  "<code id=serialising-bitmaps-to-a-file:image/svg+xml><a href=indices.html#image/svg+xml>image/svg+xml</a></code>" would mean to generate an SVG image (which would require that the
  user agent track how the bitmap was generated, an unlikely, though potentially awesome,
  feature).</p>

  <p>User agents must support PNG ("<code id=serialising-bitmaps-to-a-file:image/png-2><a href=indices.html#image/png>image/png</a></code>"). User agents may support other types.
  If the user agent does not support the requested type, it must create the file using the PNG
  format. <a href=references.html#refsPNG>[PNG]</a></p>

  <p>User agents must <a href=infrastructure.html#converted-to-ascii-lowercase id=serialising-bitmaps-to-a-file:converted-to-ascii-lowercase>convert the provided type to ASCII
  lowercase</a> before establishing if they support that type.</p>

  <p>For image types that do not support an alpha channel, the serialised image must be the bitmap
  image composited onto a solid black background using the source-over operator.</p>

  <p>If the first argument in <var>arguments</var> gives a type corresponding to one of the
  types given in the first column of the following table, and the user agent supports that type,
  then the subsequent arguments, if any, must be treated as described in the second cell of that
  row.</p>

  

  <table id=canvas-serialisation-arguments><caption>Arguments for serialisation methods</caption><thead><tr><th> Type <th> Other arguments <th> Reference
   <tbody><tr><td> <code id=serialising-bitmaps-to-a-file:image/jpeg-2><a href=indices.html#image/jpeg>image/jpeg</a></code>
     <td> The second argument, if it is a number in the range 0.0 to 1.0
     inclusive, must be treated as the desired quality level. If it is not a number or is outside that range, the user agent must use its
     default value, as if the argument had been omitted.
     <td> <a href=references.html#refsJPEG>[JPEG]</a>
  </table>

  

  <p>For the purposes of these rules, an argument is considered to be a number if it is converted to
  an IDL double value by the rules for handling arguments of type <code>any</code> in the
  Web IDL specification. <a href=references.html#refsWEBIDL>[WEBIDL]</a></p>

  <p>Other arguments must be ignored and must not cause the user agent to throw an exception. A
  future version of this specification will probably define other parameters to be passed to these
  methods to allow authors to more carefully control compression settings, image metadata, etc.</p>

  



  

  <h5 id=security-with-canvas-elements>4.12.4.5 Security with <code id=security-with-canvas-elements:the-canvas-element><a href=#the-canvas-element>canvas</a></code> elements</h5>

  <p><i>This section is non-normative.</i></p>

  <p><strong>Information leakage</strong> can occur if scripts from one <a id=security-with-canvas-elements:origin-2 href=browsers.html#origin-2>origin</a> can
  access information (e.g. read pixels) from images from another origin (one that isn't the <a href=browsers.html#same-origin id=security-with-canvas-elements:same-origin>same</a>).</p>

  <p>To mitigate this, bitmaps used with <code id=security-with-canvas-elements:the-canvas-element-2><a href=#the-canvas-element>canvas</a></code> elements are defined to have a flag
  indicating whether they are <a href=#concept-canvas-origin-clean id=security-with-canvas-elements:concept-canvas-origin-clean>origin-clean</a>. All
  bitmaps start with their <a href=#concept-canvas-origin-clean id=security-with-canvas-elements:concept-canvas-origin-clean-2>origin-clean</a> set to
  true. The flag is set to false when cross-origin images or fonts are used.</p>

  <p>The <code id=security-with-canvas-elements:dom-canvas-todataurl><a href=#dom-canvas-todataurl>toDataURL()</a></code>, <code id=security-with-canvas-elements:dom-canvas-toblob><a href=#dom-canvas-toblob>toBlob()</a></code>, and <code id=security-with-canvas-elements:dom-context-2d-getimagedata><a href=#dom-context-2d-getimagedata>getImageData()</a></code> methods check the flag and will
  throw a <code id=security-with-canvas-elements:securityerror><a href=infrastructure.html#securityerror>SecurityError</a></code> exception rather than leak cross-origin data.</p>

  <p>The flag can be reset in certain situations; for example, when a
  <code id=security-with-canvas-elements:canvasrenderingcontext2d><a href=#canvasrenderingcontext2d>CanvasRenderingContext2D</a></code> is bound to a new <code id=security-with-canvas-elements:the-canvas-element-3><a href=#the-canvas-element>canvas</a></code>, the bitmap is cleared
  and its flag reset.</p>

  




  <h3 id=common-idioms>4.13 Common idioms without dedicated elements</h3>

  <h4 id=the-main-part-of-the-content>4.13.1 The main part of the content</h4>

  <p>The main content of a page — not including headers and footers, navigation links,
  sidebars, advertisements, and so forth — can be marked up in a variety of ways, depending on
  the needs of the author.</p>

  <p>The simplest solution is to not mark up the main content at all, and just leave it as implicit.
  Another way to think of this is that the <code id=the-main-part-of-the-content:the-body-element><a href=semantics.html#the-body-element>body</a></code> elements marks up the main content of
  the page, and the bits that aren't main content are excluded through the use of more appropriate
  elements like <code id=the-main-part-of-the-content:the-aside-element><a href=semantics.html#the-aside-element>aside</a></code> and <code id=the-main-part-of-the-content:the-nav-element><a href=semantics.html#the-nav-element>nav</a></code>.</p>

  <div class=example>

   <p>Here is a short Web page marked up along this minimalistic school of thought. The main content
   is highlighted. Notice how all the <em>other</em> content in the <code id=the-main-part-of-the-content:the-body-element-2><a href=semantics.html#the-body-element>body</a></code> is marked up
   with elements to indicate that it's not part of the main content, in this case
   <code id=the-main-part-of-the-content:the-header-element><a href=semantics.html#the-header-element>header</a></code>, <code id=the-main-part-of-the-content:the-nav-element-2><a href=semantics.html#the-nav-element>nav</a></code>, and <code id=the-main-part-of-the-content:the-footer-element><a href=semantics.html#the-footer-element>footer</a></code>.</p>

   <pre>&lt;!DOCTYPE HTML>
&lt;html>
 &lt;head>
  &lt;title> My Toys &lt;/title>
 &lt;/head>
 &lt;body>
  &lt;header>
   &lt;h1>My toys&lt;/h1>
  &lt;/header>
  &lt;nav>
   &lt;p>&lt;a href="/">Home&lt;/a>&lt;/p>
   &lt;p>&lt;a href="/contact">Contact&lt;/a>&lt;/p>
  &lt;/nav>
<strong>  &lt;p>I really like my chained book and my telephone. I'm not such a
  fan of my big ball.&lt;/p>
  &lt;p>Another toy I like is my mirror.&lt;/p></strong>
  &lt;footer>
   &lt;p>© copyright 2010 by the boy&lt;/p>
  &lt;/footer>
 &lt;/body>
&lt;/html></pre>

  </div>

  <p>If the main content is an independent unit of content that one could imagine syndicating
  independently, then the <code id=the-main-part-of-the-content:the-article-element><a href=semantics.html#the-article-element>article</a></code> element would be appropriate to mark up the main
  content of the document.</p>

  <div class=example>

   <p>The document in the previous example is here recast as a blog post:</p>

   <pre>&lt;!DOCTYPE HTML>
&lt;html>
 &lt;head>
  &lt;title> The Boy Blog: My Toys &lt;/title>
 &lt;/head>
 &lt;body>
  &lt;header>
   &lt;h1>The Boy Blog&lt;/h1>
  &lt;/header>
  &lt;nav>
   &lt;p>&lt;a href="/">Home&lt;/a>&lt;/p>
   &lt;p>&lt;a href="/contact">Contact&lt;/a>&lt;/p>
  &lt;/nav>
<strong>  &lt;article>
   &lt;header>
    &lt;h1>My toys&lt;/h1>
    &lt;p>Published August 4th&lt;/p>
   &lt;/header>
   &lt;p>I really like my chained book and my telephone. I'm not such a
   fan of my big ball.&lt;/p>
   &lt;p>Another toy I like is my mirror.&lt;/p>
  &lt;/article></strong>
  &lt;footer>
   &lt;p>© copyright 2010 by the boy&lt;/p>
  &lt;/footer>
 &lt;/body>
&lt;/html></pre>

  </div>

  <p>If the main content is not an independent unit of content so much as a section of a larger
  work, for instance a chapter, then the <code id=the-main-part-of-the-content:the-section-element><a href=semantics.html#the-section-element>section</a></code> element would be appropriate to mark
  up the main content of the document.</p>

  <div class=example>

   <p>Here is the same document, but as a chapter in an online book:</p>

   <pre>&lt;!DOCTYPE HTML>
&lt;html>
 &lt;head>
  &lt;title> Chapter 2: My Toys — The Book of the Boy &lt;/title>
 &lt;/head>
 &lt;body>
  &lt;header>
   &lt;hgroup>
    &lt;h1>The Book of the Boy&lt;/h1>
    &lt;h2>A book about boy stuff&lt;/h2>
   &lt;/hgroup>
  &lt;/header>
  &lt;nav>
   &lt;p>&lt;a href="/">Front Page&lt;/a>&lt;/p>
   &lt;p>&lt;a href="/toc">Table of Contents&lt;/a>&lt;/p>
   &lt;p>&lt;a href="/c1">Chapter 1&lt;/a> — &lt;a href="/c3">Chapter 3&lt;/a>&lt;/p>
  &lt;/nav>
<strong>  &lt;section>
   &lt;h1>Chapter 2: My Toys&lt;/h1>
   &lt;p>I really like my chained book and my telephone. I'm not such a
   fan of my big ball.&lt;/p>
   &lt;p>Another toy I like is my mirror.&lt;/p>
  &lt;/section></strong>
 &lt;/body>
&lt;/html></pre>

  </div>

  <p>If neither <code id=the-main-part-of-the-content:the-article-element-2><a href=semantics.html#the-article-element>article</a></code> nor <code id=the-main-part-of-the-content:the-section-element-2><a href=semantics.html#the-section-element>section</a></code> would be appropriate, but the main
  content still needs an explicit element, for example for styling purposes, then the
  <code id=the-main-part-of-the-content:the-main-element><a href=semantics.html#the-main-element>main</a></code> element can be used.</p>

  <div class=example>

   <p>This is the same as the original example, but using <code id=the-main-part-of-the-content:the-main-element-2><a href=semantics.html#the-main-element>main</a></code> for the main content
   instead of leaving it implied:</p>

   <pre>&lt;!DOCTYPE HTML>
&lt;html>
 &lt;head>
  &lt;title> My Toys &lt;/title>
  &lt;style>
   body > main { background: navy; color: yellow; }
  &lt;/style>
 &lt;/head>
 &lt;body>
  &lt;header>
   &lt;h1>My toys&lt;/h1>
  &lt;/header>
  &lt;nav>
   &lt;p>&lt;a href="/">Home&lt;/a>&lt;/p>
   &lt;p>&lt;a href="/contact">Contact&lt;/a>&lt;/p>
  &lt;/nav>
<strong>  &lt;main>
   &lt;p>I really like my chained book and my telephone. I'm not such a
   fan of my big ball.&lt;/p>
   &lt;p>Another toy I like is my mirror.&lt;/p>
  &lt;/main></strong>
  &lt;footer>
   &lt;p>© copyright 2010 by the boy&lt;/p>
  &lt;/footer>
 &lt;/body>
&lt;/html></pre>

  </div>


  <h4 id=rel-up>4.13.2 Bread crumb navigation</h4>

  <p>This specification does not provide a machine-readable way of describing bread-crumb navigation
  menus. Authors are encouraged to just use a series of links in a paragraph. The <code id=rel-up:the-nav-element><a href=semantics.html#the-nav-element>nav</a></code>
  element can be used to mark the section containing these paragraphs as being navigation
  blocks.</p>

  

  <div class=example>

   <p>In the following example, the current page can be reached via two paths.</p>

   <pre>&lt;nav>
 &lt;p>
  &lt;a href="/">Main&lt;/a> ▸
  &lt;a href="/products/">Products&lt;/a> ▸
  &lt;a href="/products/dishwashers/">Dishwashers&lt;/a> ▸
  &lt;a>Second hand&lt;/a>
 &lt;/p>
 &lt;p>
  &lt;a href="/">Main&lt;/a> ▸
  &lt;a href="/second-hand/">Second hand&lt;/a> ▸
  &lt;a>Dishwashers&lt;/a>
 &lt;/p>
&lt;/nav></pre>

  </div>


  <h4 id=tag-clouds>4.13.3 Tag clouds</h4>

  <p id=tag-cloud>This specification does not define any markup specifically for marking up lists
  of keywords that apply to a group of pages (also known as <i>tag clouds</i>). In general, authors
  are encouraged to either mark up such lists using <code id=tag-clouds:the-ul-element><a href=semantics.html#the-ul-element>ul</a></code> elements with explicit inline
  counts that are then hidden and turned into a presentational effect using a style sheet, or to use
  SVG.</p>

  <div class=example>

   <p>Here, three tags are included in a short tag cloud:</p>

   <pre>&lt;style>
@media screen, print, handheld, tv {
  /* should be ignored by non-visual browsers */
  .tag-cloud > li > span { display: none; }
  .tag-cloud > li { display: inline; }
  .tag-cloud-1 { font-size: 0.7em; }
  .tag-cloud-2 { font-size: 0.9em; }
  .tag-cloud-3 { font-size: 1.1em; }
  .tag-cloud-4 { font-size: 1.3em; }
  .tag-cloud-5 { font-size: 1.5em; }
}
&lt;/style>
...
&lt;ul class="tag-cloud">
 &lt;li class="tag-cloud-4">&lt;a title="28 instances" href="/t/apple">apple&lt;/a> &lt;span>(popular)&lt;/span>
 &lt;li class="tag-cloud-2">&lt;a title="6 instances"  href="/t/kiwi">kiwi&lt;/a> &lt;span>(rare)&lt;/span>
 &lt;li class="tag-cloud-5">&lt;a title="41 instances" href="/t/pear">pear&lt;/a> &lt;span>(very popular)&lt;/span>
&lt;/ul></pre>

   <p>The actual frequency of each tag is given using the <code id=tag-clouds:attr-title><a href=dom.html#attr-title>title</a></code>
   attribute. A CSS style sheet is provided to convert the markup into a cloud of differently-sized
   words, but for user agents that do not support CSS or are not visual, the markup contains
   annotations like "(popular)" or "(rare)" to categorise the various tags by frequency, thus
   enabling all users to benefit from the information.</p>

   <p>The <code id=tag-clouds:the-ul-element-2><a href=semantics.html#the-ul-element>ul</a></code> element is used (rather than <code id=tag-clouds:the-ol-element><a href=semantics.html#the-ol-element>ol</a></code>) because the order is not
   particularly important: while the list is in fact ordered alphabetically, it would convey the
   same information if ordered by, say, the length of the tag.</p>

   <p>The <code id=tag-clouds:link-type-tag><a href=semantics.html#link-type-tag>tag</a></code> <code id=tag-clouds:attr-hyperlink-rel><a href=semantics.html#attr-hyperlink-rel>rel</a></code>-keyword is
   <em>not</em> used on these <code id=tag-clouds:the-a-element><a href=semantics.html#the-a-element>a</a></code> elements because they do not represent tags that apply
   to the page itself; they are just part of an index listing the tags themselves.</p>

  </div>


  <h4 id=conversations>4.13.4 Conversations</h4>

  

  <p>This specification does not define a specific element for marking up conversations, meeting
  minutes, chat transcripts, dialogues in screenplays, instant message logs, and other situations
  where different players take turns in discourse.</p>

  <p>Instead, authors are encouraged to mark up conversations using <code id=conversations:the-p-element><a href=semantics.html#the-p-element>p</a></code> elements and
  punctuation. Authors who need to mark the speaker for styling purposes are encouraged to use
  <code id=conversations:the-span-element><a href=semantics.html#the-span-element>span</a></code> or <code id=conversations:the-b-element><a href=semantics.html#the-b-element>b</a></code>. Paragraphs with their text wrapped in the <code id=conversations:the-i-element><a href=semantics.html#the-i-element>i</a></code>
  element can be used for marking up stage directions.</p>

  <div class=example>

   <p>This example demonstrates this using an extract from Abbot and Costello's famous sketch,
   <cite>Who's on first</cite>:</p>

<pre>&lt;p> Costello: Look, you gotta first baseman?
&lt;p> Abbott: Certainly.
&lt;p> Costello: Who's playing first?
&lt;p> Abbott: That's right.
&lt;p> Costello becomes exasperated.
&lt;p> Costello: When you pay off the first baseman every month, who gets the money?
&lt;p> Abbott: Every dollar of it.</pre>

  </div>

  <div class=example>

   <p>The following extract shows how an IM conversation log could be marked up, using the
   <code id=conversations:the-data-element><a href=semantics.html#the-data-element>data</a></code> element to provide Unix timestamps for each line. Note that the timestamps are
   provided in a format that the <code id=conversations:the-time-element><a href=semantics.html#the-time-element>time</a></code> element does not support, so the
   <code id=conversations:the-data-element-2><a href=semantics.html#the-data-element>data</a></code> element is used instead (namely, Unix <code>time_t</code> timestamps).
   Had the author wished to mark up the data using one of the date and time formats supported by the
   <code id=conversations:the-time-element-2><a href=semantics.html#the-time-element>time</a></code> element, that element could have been used instead of <code id=conversations:the-data-element-3><a href=semantics.html#the-data-element>data</a></code>. This
   could be advantageous as it would allow data analysis tools to detect the timestamps
   unambiguously, without coordination with the page author.</p>

   <pre>&lt;p> &lt;data value="1319898155">14:22&lt;/data> &lt;b>egof&lt;/b> I'm not that nerdy, I've only seen 30% of the star trek episodes
&lt;p> &lt;data value="1319898192">14:23&lt;/data> &lt;b>kaj&lt;/b> if you know what percentage of the star trek episodes you have seen, you are inarguably nerdy
&lt;p> &lt;data value="1319898200">14:23&lt;/data> &lt;b>egof&lt;/b> it's unarguably
&lt;p> &lt;data value="1319898228">14:23&lt;/data> &lt;i>* kaj blinks&lt;/i>
&lt;p> &lt;data value="1319898260">14:24&lt;/data> &lt;b>kaj&lt;/b> you are not helping your case</pre>
   

  </div>

  <div class=example>

   <p>HTML does not have a good way to mark up graphs, so descriptions of interactive conversations
   from games are more difficult to mark up. This example shows one possible convention using
   <code id=conversations:the-dl-element><a href=semantics.html#the-dl-element>dl</a></code> elements to list the possible responses at each point in the conversation.
   Another option to consider is describing the conversation in the form of a DOT file, and
   outputting the result as an SVG image to place in the document. <a href=references.html#refsDOT>[DOT]</a></p>

   <pre>&lt;p> Next, you meet a fisherman. You can say one of several greetings:
&lt;dl>
 &lt;dt> "Hello there!"
 &lt;dd>
  &lt;p> He responds with "Hello, how may I help you?"; you can respond with:
  &lt;dl>
   &lt;dt> "I would like to buy a fish."
   &lt;dd> &lt;p> He sells you a fish and the conversation finishes.
   &lt;dt> "Can I borrow your boat?"
   &lt;dd>
    &lt;p> He is surprised and asks "What are you offering in return?".
    &lt;dl>
     &lt;dt> "Five gold." (if you have enough)
     &lt;dt> "Ten gold." (if you have enough)
     &lt;dt> "Fifteen gold." (if you have enough)
     &lt;dd> &lt;p> He lends you his boat. The conversation ends.
     &lt;dt> "A fish." (if you have one)
     &lt;dt> "A newspaper." (if you have one)
     &lt;dt> "A pebble." (if you have one)
     &lt;dd> &lt;p> "No thanks", he replies. Your conversation options
     at this point are the same as they were after asking to borrow
     his boat, minus any options you've suggested before.
    &lt;/dl>
   &lt;/dd>
  &lt;/dl>
 &lt;/dd>
 &lt;dt> "Vote for me in the next election!"
 &lt;dd> &lt;p> He turns away. The conversation finishes.
 &lt;dt> "Sir, are you aware that your fish are running away?"
 &lt;dd>
  &lt;p> He looks at you skeptically and says "Fish cannot run, sir".
  &lt;dl>
   &lt;dt> "You got me!"
   &lt;dd> &lt;p> The fisherman sighs and the conversation ends.
   &lt;dt> "Only kidding."
   &lt;dd> &lt;p> "Good one!" he retorts. Your conversation options at this
   point are the same as those following "Hello there!" above.
   &lt;dt> "Oh, then what are they doing?"
   &lt;dd> &lt;p> He looks at his fish, giving you an opportunity to steal
   his boat, which you do. The conversation ends.
  &lt;/dl>
 &lt;/dd>
&lt;/dl></pre>

  </div>

  <div class=example>

   <p>In some games, conversations are simpler: each character merely has a fixed set of lines that
   they say. In this example, a game FAQ/walkthrough lists some of the known possible responses for
   each character:</p>

   <pre>&lt;section>
 &lt;h1>Dialogue&lt;/h1>
 &lt;p>&lt;small>Some characters repeat their lines in order each time you interact
 with them, others randomly pick from amongst their lines. Those who respond in
 order have numbered entries in the lists below.&lt;/small>
 &lt;h2>The Shopkeeper&lt;/h2>
 &lt;ul>
  &lt;li>How may I help you?
  &lt;li>Fresh apples!
  &lt;li>A loaf of bread for madam?
 &lt;/ul>
 &lt;h2>The pilot&lt;/h2>
 &lt;p>Before the accident:
 &lt;ul>
  &lt;/li>I'm about to fly out, sorry!
  &lt;/li>Sorry, I'm just waiting for flight clearance and then I'll be off!
 &lt;/ul>
 &lt;p>After the accident:
 &lt;ol>
  &lt;li>I'm about to fly out, sorry!
  &lt;li>Ok, I'm not leaving right now, my plane is being cleaned.
  &lt;li>Ok, it's not being cleaned, it needs a minor repair first.
  &lt;li>Ok, ok, stop bothering me! Truth is, I had a crash.
 &lt;/ol>
 &lt;h2>Clan Leader&lt;/h2>
 &lt;p>During the first clan meeting:
 &lt;ul>
  &lt;li>Hey, have you seen my daughter? I bet she's up to something nefarious again...
  &lt;li>Nice weather we're having today, eh?
  &lt;li>The name is Bailey, Jeff Bailey. How can I help you today?
  &lt;li>A glass of water? Fresh from the well!
 &lt;/ul>
 &lt;p>After the earthquake:
 &lt;ol>
  &lt;li>Everyone is safe in the shelter, we just have to put out the fire!
  &lt;li>I'll go and tell the fire brigade, you keep hosing it down!
 &lt;/ol>
&lt;/section></pre>

  </div>


  <h4 id=footnotes>4.13.5 Footnotes</h4>

  <p>HTML does not have a dedicated mechanism for marking up footnotes. Here are the suggested
  alternatives.</p>

  <hr>

  <p>For short inline annotations, the <code id=footnotes:attr-title><a href=dom.html#attr-title>title</a></code> attribute could  be used.</p>

  <div class=example>

   <p>In this example, two parts of a dialogue are annotated with footnote-like content using the
   <code id=footnotes:attr-title-2><a href=dom.html#attr-title>title</a></code> attribute.</p>

   <pre>&lt;p> &lt;b>Customer&lt;/b>: Hello! I wish to register a complaint. Hello. Miss?
&lt;p> &lt;b>Shopkeeper&lt;/b>: <strong>&lt;span title="Colloquial pronunciation of 'What do you'"</strong>
>Watcha&lt;/span> mean, miss?
&lt;p> &lt;b>Customer&lt;/b>: Uh, I'm sorry, I have a cold. I wish to make a complaint.
&lt;p> &lt;b>Shopkeeper&lt;/b>: Sorry, &lt;span <strong>title="This is, of course, a lie."</strong>>we're
closing for lunch&lt;/span>.</pre>

  </div>

  
  <p class=note>Unfortunately, relying on the <code id=footnotes:attr-title-3><a href=dom.html#attr-title>title</a></code> attribute is
  currently discouraged as many user agents do not expose the attribute in an accessible manner as
  required by this specification (e.g. requiring a pointing device such as a mouse to cause a
  tooltip to appear, which excludes keyboard-only users and touch-only users, such as anyone with a
  modern phone or tablet).</p>

  <p class=note>If the <code id=footnotes:attr-title-4><a href=dom.html#attr-title>title</a></code> attribute is used, CSS can used to
  draw the reader's attention to the elements with the attribute.</p>

  <div class=example>

   <p>For example, the following CSS places a dashed line below elements that have a <code id=footnotes:attr-title-5><a href=dom.html#attr-title>title</a></code> attribute.</p>

   <pre>[title] { border-bottom: thin dashed; }</pre>

  </div>

  <hr>

  <p>For longer annotations, the <code id=footnotes:the-a-element><a href=semantics.html#the-a-element>a</a></code> element should be used, pointing to an element later
  in the document. The convention is that the contents of the link be a number in square
  brackets.</p>

  <div class=example>

   <p>In this example, a footnote in the dialogue links to a paragraph below the dialogue. The
   paragraph then reciprocally links back to the dialogue, allowing the user to return to the
   location of the footnote.</p>

   <pre>&lt;p> Announcer: Number 16: The &lt;i>hand&lt;/i>.
&lt;p> Interviewer: Good evening. I have with me in the studio tonight
Mr Norman St John Polevaulter, who for the past few years has been
contradicting people. Mr Polevaulter, why &lt;em>do&lt;/em> you
contradict people?
&lt;p> Norman: I don't. &lt;sup>&lt;a href="#fn1" id="r1">[1]&lt;/a>&lt;/sup>
&lt;p> Interviewer: You told me you did!
<em>...</em>
&lt;section>
 &lt;p id="fn1">&lt;a href="#r1">[1]&lt;/a> This is, naturally, a lie,
 but paradoxically if it were true he could not say so without
 contradicting the interviewer and thus making it false.&lt;/p>
&lt;/section></pre>

  </div>

  <hr>

  <p>For side notes, longer annotations that apply to entire sections of the text rather than just
  specific words or sentences, the <code id=footnotes:the-aside-element><a href=semantics.html#the-aside-element>aside</a></code> element should be used.</p>

  <div class=example>

   <p>In this example, a sidebar is given after a dialogue, giving it some context.</p>

   <pre>&lt;p> &lt;span class="speaker">Customer&lt;/span>: I will not buy this record, it is scratched.
&lt;p> &lt;span class="speaker">Shopkeeper&lt;/span>: I'm sorry?
&lt;p> &lt;span class="speaker">Customer&lt;/span>: I will not buy this record, it is scratched.
&lt;p> &lt;span class="speaker">Shopkeeper&lt;/span>: No no no, this's'a tobacconist's.
&lt;aside>
 &lt;p>In 1970, the British Empire lay in ruins, and foreign
 nationalists frequented the streets — many of them Hungarians
 (not the streets — the foreign nationals). Sadly, Alexander
 Yalt has been publishing incompetently-written phrase books.
&lt;/aside></pre>

  </div>

  <hr>

  <p>For figures or tables, footnotes can be included in the relevant <code id=footnotes:the-figcaption-element><a href=semantics.html#the-figcaption-element>figcaption</a></code> or
  <code id=footnotes:the-caption-element><a href=tables.html#the-caption-element>caption</a></code> element, or in surrounding prose.</p>

  <div class=example>

   <p>In this example, a  table has cells with footnotes that are given in prose. A
   <code id=footnotes:the-figure-element><a href=semantics.html#the-figure-element>figure</a></code> element is used to give a single legend to the combination of the table and
   its footnotes.</p>

   <pre>&lt;figure>
 &lt;figcaption>Table 1. Alternative activities for knights.&lt;/figcaption>
 &lt;table>
  &lt;tr>
   &lt;th> Activity
   &lt;th> Location
   &lt;th> Cost
  &lt;tr>
   &lt;td> Dance
   &lt;td> Wherever possible
   &lt;td> £0&lt;sup>&lt;a href="#fn1">1&lt;/a>&lt;/sup>
  &lt;tr>
   &lt;td> Routines, chorus scenes&lt;sup>&lt;a href="#fn2">2&lt;/a>&lt;/sup>
   &lt;td> Undisclosed
   &lt;td> Undisclosed
  &lt;tr>
   &lt;td> Dining&lt;sup>&lt;a href="#fn3">3&lt;/a>&lt;/sup>
   &lt;td> Camelot
   &lt;td> Cost of ham, jam, and spam&lt;sup>&lt;a href="#fn4">4&lt;/a>&lt;/sup>
 &lt;/table>
 &lt;p id="fn1">1. Assumed.&lt;/p>
 &lt;p id="fn2">2. Footwork impeccable.&lt;/p>
 &lt;p id="fn3">3. Quality described as "well".&lt;/p>
 &lt;p id="fn4">4. A lot.&lt;/p>
&lt;/figure></pre>

  </div>


  <h3 id=disabled-elements>4.14 Disabled elements</h3>

  <p>An element is said to be <dfn id=concept-element-disabled>actually disabled</dfn> if it
  one of the following:</p>

  <ul><li>a <code id=disabled-elements:the-button-element><a href=forms.html#the-button-element>button</a></code> element that is <a href=forms.html#concept-fe-disabled id=disabled-elements:concept-fe-disabled>disabled</a><li>an <code id=disabled-elements:the-input-element><a href=forms.html#the-input-element>input</a></code> element that is <a href=forms.html#concept-fe-disabled id=disabled-elements:concept-fe-disabled-2>disabled</a><li>a <code id=disabled-elements:the-select-element><a href=forms.html#the-select-element>select</a></code> element that is <a href=forms.html#concept-fe-disabled id=disabled-elements:concept-fe-disabled-3>disabled</a><li>a <code id=disabled-elements:the-textarea-element><a href=forms.html#the-textarea-element>textarea</a></code> element that is <a href=forms.html#concept-fe-disabled id=disabled-elements:concept-fe-disabled-4>disabled</a><li>an <code id=disabled-elements:the-optgroup-element><a href=forms.html#the-optgroup-element>optgroup</a></code> element that has a <code id=disabled-elements:attr-optgroup-disabled><a href=forms.html#attr-optgroup-disabled>disabled</a></code> attribute<li>an <code id=disabled-elements:the-option-element><a href=forms.html#the-option-element>option</a></code> element that is <a href=forms.html#concept-option-disabled id=disabled-elements:concept-option-disabled>disabled</a><li>a <code id=disabled-elements:the-menuitem-element><a href=forms.html#the-menuitem-element>menuitem</a></code> element that has a <code id=disabled-elements:attr-menuitem-disabled><a href=forms.html#attr-menuitem-disabled>disabled</a></code> attribute<li>a <code id=disabled-elements:the-fieldset-element><a href=forms.html#the-fieldset-element>fieldset</a></code> element that is a <a href=forms.html#concept-fieldset-disabled id=disabled-elements:concept-fieldset-disabled>disabled fieldset</a></ul>

  <p class=note>This definition is used to determine what elements <a href=interaction.html#specially-focusable id=disabled-elements:specially-focusable>can be focused</a> and which elements match the <code id=disabled-elements:selector-disabled><a href=#selector-disabled>:disabled</a></code> pseudo-class.</p>


  



  <h3 id=selectors>4.15 Matching HTML elements using selectors</h3>

  <h4 id=case-sensitivity>4.15.1 Case-sensitivity</h4>

  <p>The Selectors specification leaves the case-sensitivity of element names, attribute names, and
  attribute values to be defined by the host language. <a href=references.html#refsSELECTORS>[SELECTORS]</a></p>

  <p class=note>The Selectors specification defines that ID and class selectors, when matched
  against elements in documents that are in <a id=case-sensitivity:quirks-mode href=infrastructure.html#quirks-mode>quirks mode</a>, will be work in an <a id=case-sensitivity:ascii-case-insensitive href=infrastructure.html#ascii-case-insensitive>ASCII
  case-insensitive</a>.</p>

  <p>When comparing a CSS element type selector to the names of <a id=case-sensitivity:html-elements href=infrastructure.html#html-elements>HTML elements</a> in
  <a id=case-sensitivity:html-documents href=infrastructure.html#html-documents>HTML documents</a>, the CSS element type selector must first be <a id=case-sensitivity:converted-to-ascii-lowercase href=infrastructure.html#converted-to-ascii-lowercase>converted to ASCII
  lowercase</a>. The same selector when compared to other elements must be compared according to
  its original case. In both cases, the comparison is <a id=case-sensitivity:case-sensitive href=infrastructure.html#case-sensitive>case-sensitive</a>.</p>
  

  <p>When comparing the name part of a CSS attribute selector to the names of namespace-less
  attributes on <a id=case-sensitivity:html-elements-2 href=infrastructure.html#html-elements>HTML elements</a> in <a id=case-sensitivity:html-documents-2 href=infrastructure.html#html-documents>HTML documents</a>, the name part of the CSS
  attribute selector must first be <a id=case-sensitivity:converted-to-ascii-lowercase-2 href=infrastructure.html#converted-to-ascii-lowercase>converted to ASCII lowercase</a>. The same selector when
  compared to other attributes must be compared according to its original case. In both cases, the
  comparison is <a id=case-sensitivity:case-sensitive-2 href=infrastructure.html#case-sensitive>case-sensitive</a>.</p>
  

  <p>Everything else must be treated as entirely <a id=case-sensitivity:case-sensitive-3 href=infrastructure.html#case-sensitive>case-sensitive</a> for the purposes of
  selector matching. This includes:</p>

  <ul class=brief><li> IDs and classes in <a id=case-sensitivity:no-quirks-mode href=infrastructure.html#no-quirks-mode>no-quirks mode</a> and <a id=case-sensitivity:limited-quirks-mode href=infrastructure.html#limited-quirks-mode>limited-quirks mode</a>
   <li> the names of elements not in the <a id=case-sensitivity:html-namespace-2 href=infrastructure.html#html-namespace-2>HTML namespace</a>
   <li> the names of <a id=case-sensitivity:html-elements-3 href=infrastructure.html#html-elements>HTML elements</a> in <a id=case-sensitivity:xml-documents href=infrastructure.html#xml-documents>XML documents</a>
   <li> the names of attributes of elements not in the <a id=case-sensitivity:html-namespace-2-2 href=infrastructure.html#html-namespace-2>HTML namespace</a>
   <li> the names of attributes of <a id=case-sensitivity:html-elements-4 href=infrastructure.html#html-elements>HTML elements</a> in <a id=case-sensitivity:xml-documents-2 href=infrastructure.html#xml-documents>XML documents</a>
   <li> the names of attributes that themselves have namespaces
   <li> all attribute values
  </ul>


  <h4 id=pseudo-classes>4.15.2 Pseudo-classes</h4>

  <p>There are a number of dynamic selectors that can be used with HTML. This section defines when
  these selectors match HTML elements. <a href=references.html#refsSELECTORS>[SELECTORS]</a> <a href=references.html#refsCSSUI>[CSSUI]</a></p>

  <dl><dt><dfn id=selector-link><code>:link</code></dfn><dt><dfn id=selector-visited><code>:visited</code></dfn><dd>

    <p>All <code id=pseudo-classes:the-a-element><a href=semantics.html#the-a-element>a</a></code> elements that have an <code id=pseudo-classes:attr-hyperlink-href><a href=semantics.html#attr-hyperlink-href>href</a></code>
    attribute, all <code id=pseudo-classes:the-area-element><a href=embedded-content.html#the-area-element>area</a></code> elements that have an <code id=pseudo-classes:attr-hyperlink-href-2><a href=semantics.html#attr-hyperlink-href>href</a></code> attribute, and all <code id=pseudo-classes:the-link-element><a href=semantics.html#the-link-element>link</a></code> elements that have
    an <code id=pseudo-classes:attr-link-href><a href=semantics.html#attr-link-href>href</a></code> attribute, must match one of <code id=pseudo-classes:selector-link><a href=#selector-link>:link</a></code> and <code id=pseudo-classes:selector-visited><a href=#selector-visited>:visited</a></code>.</p>

    <p>Other specifications might apply more specific rules regarding how these elements are to
    match these pseudo-classes, to mitigate some privacy concerns that apply with straightforward
    implementations of this requirement.</p>

   <dt><dfn id=selector-active><code>:active</code></dfn><dd>

    <p>The <code id=pseudo-classes:selector-active><a href=#selector-active>:active</a></code> pseudo-class is defined to match an element
    <q cite=http://dev.w3.org/csswg/selectors3/#the-user-action-pseudo-classes-hover-act>while an
    element is <dfn id=concept-selector-active><i>being activated</i></dfn> by the user</q>.</p>

    <p>To determine whether a particular element is <i id=pseudo-classes:concept-selector-active><a href=#concept-selector-active>being activated</a></i> for the purposes of
    defining the <code id=pseudo-classes:selector-active-2><a href=#selector-active>:active</a></code> pseudo-class only, an HTML user agent
    must use the first relevant entry in the following list.</p>

    <dl><dt>If the element has a descendant that is currently matching the <code id=pseudo-classes:selector-active-3><a href=#selector-active>:active</a></code> pseudo-class<dd><p>The element is <i id=pseudo-classes:concept-selector-active-2><a href=#concept-selector-active>being activated</a></i>.<dt>If the element is the <a id=pseudo-classes:labeled-control href=forms.html#labeled-control>labeled control</a> of a <code id=pseudo-classes:the-label-element><a href=forms.html#the-label-element>label</a></code> element that is
     currently matching <a href=#selector-active id=pseudo-classes:selector-active-4>:active</a><dd><p>The element is <i id=pseudo-classes:concept-selector-active-3><a href=#concept-selector-active>being activated</a></i>.<dt>If the element is a <code id=pseudo-classes:the-button-element><a href=forms.html#the-button-element>button</a></code> element<dt>If the element is an <code id=pseudo-classes:the-input-element><a href=forms.html#the-input-element>input</a></code> element whose <code id=pseudo-classes:attr-input-type><a href=forms.html#attr-input-type>type</a></code> attribute is in the <a href="forms.html#submit-button-state-(type=submit)" id="pseudo-classes:submit-button-state-(type=submit)">Submit Button</a>, <a href="forms.html#image-button-state-(type=image)" id="pseudo-classes:image-button-state-(type=image)">Image Button</a>, <a href="forms.html#reset-button-state-(type=reset)" id="pseudo-classes:reset-button-state-(type=reset)">Reset
     Button</a>, or <a href="forms.html#button-state-(type=button)" id="pseudo-classes:button-state-(type=button)">Button</a> state<dd>

      <p>The element is <i id=pseudo-classes:concept-selector-active-4><a href=#concept-selector-active>being activated</a></i> if it is <a href=#in-a-formal-activation-state id=pseudo-classes:in-a-formal-activation-state>in a formal activation state</a>
      and it is not <a href=forms.html#concept-fe-disabled id=pseudo-classes:concept-fe-disabled>disabled</a>.</p>

      <p class=example>For example, if the user is using a keyboard to push a <code id=pseudo-classes:the-button-element-2><a href=forms.html#the-button-element>button</a></code>
      element by pressing the space bar, the element would match this pseudo-class in between the
      time that the element received the <code id=pseudo-classes:event-keydown><a href=infrastructure.html#event-keydown>keydown</a></code> event and the
      time the element received the <code id=pseudo-classes:event-keyup><a href=infrastructure.html#event-keyup>keyup</a></code> event.</p>

     <dt>If the element is a <code id=pseudo-classes:the-menuitem-element><a href=forms.html#the-menuitem-element>menuitem</a></code> element<dd><p>The element is <i id=pseudo-classes:concept-selector-active-5><a href=#concept-selector-active>being activated</a></i> if it is <a href=#in-a-formal-activation-state id=pseudo-classes:in-a-formal-activation-state-2>in a formal activation state</a>
     and it does not have a <code id=pseudo-classes:attr-menuitem-disabled><a href=forms.html#attr-menuitem-disabled>disabled</a></code>
     attribute.<dt>If the element is an <code id=pseudo-classes:the-a-element-2><a href=semantics.html#the-a-element>a</a></code> element that has an <code id=pseudo-classes:attr-hyperlink-href-3><a href=semantics.html#attr-hyperlink-href>href</a></code> attribute<dt>If the element is an <code id=pseudo-classes:the-area-element-2><a href=embedded-content.html#the-area-element>area</a></code> element that has an <code id=pseudo-classes:attr-hyperlink-href-4><a href=semantics.html#attr-hyperlink-href>href</a></code> attribute<dt>If the element is a <code id=pseudo-classes:the-link-element-2><a href=semantics.html#the-link-element>link</a></code> element that has an <code id=pseudo-classes:attr-link-href-2><a href=semantics.html#attr-link-href>href</a></code> attribute<dt>If the element has its <a id=pseudo-classes:specially-focusable href=interaction.html#specially-focusable>tabindex focus flag</a> set<dd><p>The element is <i id=pseudo-classes:concept-selector-active-6><a href=#concept-selector-active>being activated</a></i> if it is <a href=#in-a-formal-activation-state id=pseudo-classes:in-a-formal-activation-state-3>in a formal activation
     state</a>.<dt>If the element is <a href=#being-actively-pointed-at id=pseudo-classes:being-actively-pointed-at>being actively pointed at</a><dd><p>The element is <i id=pseudo-classes:concept-selector-active-7><a href=#concept-selector-active>being activated</a></i>.</dl>

    <p>An element is said to be <dfn id=in-a-formal-activation-state>in a formal activation state</dfn> between the time the user
    begins to indicate an intent to trigger the element's <a id=pseudo-classes:activation-behaviour href=interaction.html#activation-behaviour>activation behaviour</a> and
    either the time the user stops indicating an intent to trigger the element's <a id=pseudo-classes:activation-behaviour-2 href=interaction.html#activation-behaviour>activation
    behaviour</a>, or the time the element's <a id=pseudo-classes:activation-behaviour-3 href=interaction.html#activation-behaviour>activation behaviour</a> has finished
    running, which ever comes first.</p>

    <p>An element is said to be <dfn id=being-actively-pointed-at>being actively pointed at</dfn> while the user indicates the
    element using a pointing device while that pointing device is in the "down" state (e.g. for a
    mouse, between the time the mouse button is pressed and the time it is depressed; for a finger
    in a multitouch environment, while the finger is touching the display surface).</p>

   <dt><dfn id=selector-hover><code>:hover</code></dfn><dd>

    <p>The <code id=pseudo-classes:selector-hover><a href=#selector-hover>:hover</a></code> pseudo-class is defined to match an element <q cite=http://dev.w3.org/csswg/selectors3/#the-user-action-pseudo-classes-hover-act>while the
    user <i>designates</i> an element with a pointing device</q>. For the purposes of defining the
    <code id=pseudo-classes:selector-hover-2><a href=#selector-hover>:hover</a></code> pseudo-class only, an HTML user agent must consider
    an element as being one that the user <i>designates</i> if it is:</p>

    <ul><li>

      <p>An element that the user indicates using a pointing device.</p>

     <li>

      <p>An element that has a descendant that the user indicates using a pointing device.</p>

     <li>

      <p>An element that is the <a id=pseudo-classes:labeled-control-2 href=forms.html#labeled-control>labeled control</a> of a <code id=pseudo-classes:the-label-element-2><a href=forms.html#the-label-element>label</a></code> element that is
      currently matching <a href=#selector-hover id=pseudo-classes:selector-hover-3>:hover</a>.</p>

     </ul>


    <div class=example>

     <p>Consider in particular a fragment such as:</p>

     <pre>&lt;p> &lt;label for=c> &lt;input id=a> &lt;/label> &lt;span id=b> &lt;input id=c> &lt;/span> &lt;/p></pre>

     <p>If the user designates the element with ID "<code>a</code>" with their pointing
     device, then the <code id=pseudo-classes:the-p-element><a href=semantics.html#the-p-element>p</a></code> element (and all its ancestors not shown in the snippet above),
     the <code id=pseudo-classes:the-label-element-3><a href=forms.html#the-label-element>label</a></code> element, the element with ID "<code>a</code>", and the element
     with ID "<code>c</code>" will match the <a href=#selector-hover id=pseudo-classes:selector-hover-4>:hover</a>
     pseudo-class. The element with ID "<code>a</code>" matches it from condition 1, the
     <code id=pseudo-classes:the-label-element-4><a href=forms.html#the-label-element>label</a></code> and <code id=pseudo-classes:the-p-element-2><a href=semantics.html#the-p-element>p</a></code> elements match it because of condition 2 (one of their
     descendants is designated), and the element with ID "<code>c</code>" matches it
     through condition 3 (its <code id=pseudo-classes:the-label-element-5><a href=forms.html#the-label-element>label</a></code> element matches <a href=#selector-hover id=pseudo-classes:selector-hover-5>:hover</a>). However, the element with ID "<code>b</code>"
     does <em>not</em> match <a href=#selector-hover id=pseudo-classes:selector-hover-6>:hover</a>: its descendant is not
     designated, even though it matches <a href=#selector-hover id=pseudo-classes:selector-hover-7>:hover</a>.</p>

    </div>

   <dt><dfn id=selector-focus><code>:focus</code></dfn><dd>

    <p>For the purposes of the CSS ':focus' pseudo-class, an <dfn id=element-has-the-focus>element has the focus</dfn> when
    its <a id=pseudo-classes:top-level-browsing-context href=browsers.html#top-level-browsing-context>top-level browsing context</a> has the system focus, it is not itself a
    <a id=pseudo-classes:browsing-context-container href=browsers.html#browsing-context-container>browsing context container</a>, and it is one of the elements listed in the <a id=pseudo-classes:focus-chain href=interaction.html#focus-chain>focus
    chain</a> of the <a href=interaction.html#currently-focused-area-of-a-top-level-browsing-context id=pseudo-classes:currently-focused-area-of-a-top-level-browsing-context>currently focused area of the top-level browsing context</a>.</p>

   <dt><dfn id=selector-enabled><code>:enabled</code></dfn><dd>

    <p>The <code id=pseudo-classes:selector-enabled><a href=#selector-enabled>:enabled</a></code> pseudo-class must match any element
    that is one of the following:</p>

    <ul><li>a <code id=pseudo-classes:the-button-element-3><a href=forms.html#the-button-element>button</a></code> element that is not <a href=forms.html#concept-fe-disabled id=pseudo-classes:concept-fe-disabled-2>disabled</a><li>an <code id=pseudo-classes:the-input-element-2><a href=forms.html#the-input-element>input</a></code> element that is not <a href=forms.html#concept-fe-disabled id=pseudo-classes:concept-fe-disabled-3>disabled</a><li>a <code id=pseudo-classes:the-select-element><a href=forms.html#the-select-element>select</a></code> element that is not <a href=forms.html#concept-fe-disabled id=pseudo-classes:concept-fe-disabled-4>disabled</a><li>a <code id=pseudo-classes:the-textarea-element><a href=forms.html#the-textarea-element>textarea</a></code> element that is not <a href=forms.html#concept-fe-disabled id=pseudo-classes:concept-fe-disabled-5>disabled</a><li>an <code id=pseudo-classes:the-optgroup-element><a href=forms.html#the-optgroup-element>optgroup</a></code> element that does not have a <code id=pseudo-classes:attr-optgroup-disabled><a href=forms.html#attr-optgroup-disabled>disabled</a></code> attribute<li>an <code id=pseudo-classes:the-option-element><a href=forms.html#the-option-element>option</a></code> element that is not <a href=forms.html#concept-option-disabled id=pseudo-classes:concept-option-disabled>disabled</a><li>a <code id=pseudo-classes:the-menuitem-element-2><a href=forms.html#the-menuitem-element>menuitem</a></code> element that does not have a <code id=pseudo-classes:attr-menuitem-disabled-2><a href=forms.html#attr-menuitem-disabled>disabled</a></code> attribute<li>a <code id=pseudo-classes:the-fieldset-element><a href=forms.html#the-fieldset-element>fieldset</a></code> element that is not a <a href=forms.html#concept-fieldset-disabled id=pseudo-classes:concept-fieldset-disabled>disabled fieldset</a></ul>

   <dt><dfn id=selector-disabled><code>:disabled</code></dfn><dd>

    <p>The <code id=pseudo-classes:selector-disabled><a href=#selector-disabled>:disabled</a></code> pseudo-class must match any element that
    is <a href=#concept-element-disabled id=pseudo-classes:concept-element-disabled>actually disabled</a>.</p>

   <dt><dfn id=selector-checked><code>:checked</code></dfn><dd>

    <p>The <code id=pseudo-classes:selector-checked><a href=#selector-checked>:checked</a></code> pseudo-class must match any element
    falling into one of the following categories:</p>

    <ul><li><code id=pseudo-classes:the-input-element-3><a href=forms.html#the-input-element>input</a></code> elements whose <code id=pseudo-classes:attr-input-type-2><a href=forms.html#attr-input-type>type</a></code> attribute is in
     the <a href="forms.html#checkbox-state-(type=checkbox)" id="pseudo-classes:checkbox-state-(type=checkbox)">Checkbox</a> state and whose <a href=forms.html#concept-fe-checked id=pseudo-classes:concept-fe-checked>checkedness</a> state is true<li><code id=pseudo-classes:the-input-element-4><a href=forms.html#the-input-element>input</a></code> elements whose <code id=pseudo-classes:attr-input-type-3><a href=forms.html#attr-input-type>type</a></code> attribute is in
     the <a href="forms.html#radio-button-state-(type=radio)" id="pseudo-classes:radio-button-state-(type=radio)">Radio Button</a> state and whose <a href=forms.html#concept-fe-checked id=pseudo-classes:concept-fe-checked-2>checkedness</a> state is true<li><code id=pseudo-classes:the-option-element-2><a href=forms.html#the-option-element>option</a></code> elements whose <a href=forms.html#concept-option-selectedness id=pseudo-classes:concept-option-selectedness>selectedness</a> is true<li><code id=pseudo-classes:the-menuitem-element-3><a href=forms.html#the-menuitem-element>menuitem</a></code> elements whose <code id=pseudo-classes:attr-menuitem-type><a href=forms.html#attr-menuitem-type>type</a></code> attribute
     is in the <a href=forms.html#attr-menuitem-type-state-checkbox id=pseudo-classes:attr-menuitem-type-state-checkbox>Checkbox</a> state and that have a
     <code id=pseudo-classes:attr-menuitem-checked><a href=forms.html#attr-menuitem-checked>checked</a></code> attribute<li><code id=pseudo-classes:the-menuitem-element-4><a href=forms.html#the-menuitem-element>menuitem</a></code> elements whose <code id=pseudo-classes:attr-menuitem-type-2><a href=forms.html#attr-menuitem-type>type</a></code> attribute
     is in the <a href=forms.html#attr-menuitem-type-state-radio id=pseudo-classes:attr-menuitem-type-state-radio>Radio</a> state and that have a <code id=pseudo-classes:attr-menuitem-checked-2><a href=forms.html#attr-menuitem-checked>checked</a></code> attribute</ul>

   <dt><dfn id=selector-indeterminate><code>:indeterminate</code></dfn><dd>

    <p>The <code id=pseudo-classes:selector-indeterminate><a href=#selector-indeterminate>:indeterminate</a></code> pseudo-class must match any
    element falling into one of the following categories:</p>

    <ul><li><code id=pseudo-classes:the-input-element-5><a href=forms.html#the-input-element>input</a></code> elements whose <code id=pseudo-classes:attr-input-type-4><a href=forms.html#attr-input-type>type</a></code> attribute is in
     the <a href="forms.html#checkbox-state-(type=checkbox)" id="pseudo-classes:checkbox-state-(type=checkbox)-2">Checkbox</a> state and whose <code id=pseudo-classes:dom-input-indeterminate><a href=forms.html#dom-input-indeterminate>indeterminate</a></code> IDL attribute is set to true<li><code id=pseudo-classes:the-input-element-6><a href=forms.html#the-input-element>input</a></code> elements whose <code id=pseudo-classes:attr-input-type-5><a href=forms.html#attr-input-type>type</a></code> attribute is in
     the <a href="forms.html#radio-button-state-(type=radio)" id="pseudo-classes:radio-button-state-(type=radio)-2">Radio Button</a> state and whose <a id=pseudo-classes:radio-button-group href=forms.html#radio-button-group>radio button
     group</a> contains no <code id=pseudo-classes:the-input-element-7><a href=forms.html#the-input-element>input</a></code> elements whose <a href=forms.html#concept-fe-checked id=pseudo-classes:concept-fe-checked-3>checkedness</a> state is true.<li><code id=pseudo-classes:the-progress-element><a href=forms.html#the-progress-element>progress</a></code> elements with no <code id=pseudo-classes:attr-progress-value><a href=forms.html#attr-progress-value>value</a></code>
     content attribute</ul>

   <dt><dfn id=selector-default><code>:default</code></dfn><dd>

    <p>The <code id=pseudo-classes:selector-default><a href=#selector-default>:default</a></code> pseudo-class must match any element
    falling into one of the following categories:</p>

    <ul><li><code id=pseudo-classes:the-button-element-4><a href=forms.html#the-button-element>button</a></code> elements that are their form's <a id=pseudo-classes:default-button href=forms.html#default-button>default button</a><li><code id=pseudo-classes:the-input-element-8><a href=forms.html#the-input-element>input</a></code> elements whose <code id=pseudo-classes:attr-input-type-6><a href=forms.html#attr-input-type>type</a></code> attribute is in
     the <a href="forms.html#submit-button-state-(type=submit)" id="pseudo-classes:submit-button-state-(type=submit)-2">Submit Button</a> or <a href="forms.html#image-button-state-(type=image)" id="pseudo-classes:image-button-state-(type=image)-2">Image Button</a> state, and that are their form's
     <a id=pseudo-classes:default-button-2 href=forms.html#default-button>default button</a><li><code id=pseudo-classes:the-input-element-9><a href=forms.html#the-input-element>input</a></code> elements to which the <code id=pseudo-classes:attr-input-checked><a href=forms.html#attr-input-checked>checked</a></code>
     attribute applies and that have a <code id=pseudo-classes:attr-input-checked-2><a href=forms.html#attr-input-checked>checked</a></code>
     attribute<li><code id=pseudo-classes:the-option-element-3><a href=forms.html#the-option-element>option</a></code> elements that have a <code id=pseudo-classes:attr-option-selected><a href=forms.html#attr-option-selected>selected</a></code>
     attribute</ul>

   <dt><dfn id=selector-valid><code>:valid</code></dfn><dd>

    <p>The <code id=pseudo-classes:selector-valid><a href=#selector-valid>:valid</a></code> pseudo-class must match any element falling
    into one of the following categories:</p>

    <ul><li>elements that are <a href=forms.html#candidate-for-constraint-validation id=pseudo-classes:candidate-for-constraint-validation>candidates for
     constraint validation</a> and that <a href=forms.html#concept-fv-valid id=pseudo-classes:concept-fv-valid>satisfy their
     constraints</a><li><code id=pseudo-classes:the-form-element><a href=forms.html#the-form-element>form</a></code> elements that are not the <a id=pseudo-classes:form-owner href=forms.html#form-owner>form owner</a> of any elements that
     themselves are <a href=forms.html#candidate-for-constraint-validation id=pseudo-classes:candidate-for-constraint-validation-2>candidates for constraint
     validation</a> but do not <a href=forms.html#concept-fv-valid id=pseudo-classes:concept-fv-valid-2>satisfy their
     constraints</a><li><code id=pseudo-classes:the-fieldset-element-2><a href=forms.html#the-fieldset-element>fieldset</a></code> elements that have no descendant elements that themselves are <a href=forms.html#candidate-for-constraint-validation id=pseudo-classes:candidate-for-constraint-validation-3>candidates for constraint validation</a> but do
     not <a href=forms.html#concept-fv-valid id=pseudo-classes:concept-fv-valid-3>satisfy their constraints</a></ul>

   <dt><dfn id=selector-invalid><code>:invalid</code></dfn><dd>

    <p>The <code id=pseudo-classes:selector-invalid><a href=#selector-invalid>:invalid</a></code> pseudo-class must match any element
    falling into one of the following categories:</p>

    <ul><li>elements that are <a href=forms.html#candidate-for-constraint-validation id=pseudo-classes:candidate-for-constraint-validation-4>candidates for
     constraint validation</a> but that do not <a href=forms.html#concept-fv-valid id=pseudo-classes:concept-fv-valid-4>satisfy their
     constraints</a><li><code id=pseudo-classes:the-form-element-2><a href=forms.html#the-form-element>form</a></code> elements that are the <a id=pseudo-classes:form-owner-2 href=forms.html#form-owner>form owner</a> of one or more elements
     that themselves are <a href=forms.html#candidate-for-constraint-validation id=pseudo-classes:candidate-for-constraint-validation-5>candidates for constraint
     validation</a> but do not <a href=forms.html#concept-fv-valid id=pseudo-classes:concept-fv-valid-5>satisfy their
     constraints</a><li><code id=pseudo-classes:the-fieldset-element-3><a href=forms.html#the-fieldset-element>fieldset</a></code> elements that have of one or more descendant elements that themselves
     are <a href=forms.html#candidate-for-constraint-validation id=pseudo-classes:candidate-for-constraint-validation-6>candidates for constraint
     validation</a> but do not <a href=forms.html#concept-fv-valid id=pseudo-classes:concept-fv-valid-6>satisfy their
     constraints</a></ul>

   <dt><dfn id=selector-in-range><code>:in-range</code></dfn><dd>

    <p>The <code id=pseudo-classes:selector-in-range><a href=#selector-in-range>:in-range</a></code> pseudo-class must match all elements
    that are <a href=forms.html#candidate-for-constraint-validation id=pseudo-classes:candidate-for-constraint-validation-7>candidates for constraint
    validation</a>, <a id=pseudo-classes:have-range-limitations href=forms.html#have-range-limitations>have range limitations</a>, and that are neither <a id=pseudo-classes:suffering-from-an-underflow href=forms.html#suffering-from-an-underflow>suffering
    from an underflow</a> nor <a id=pseudo-classes:suffering-from-an-overflow href=forms.html#suffering-from-an-overflow>suffering from an overflow</a>.</p>

   <dt><dfn id=selector-out-of-range><code>:out-of-range</code></dfn><dd>

    <p>The <code id=pseudo-classes:selector-out-of-range><a href=#selector-out-of-range>:out-of-range</a></code> pseudo-class must match all
    elements that are <a href=forms.html#candidate-for-constraint-validation id=pseudo-classes:candidate-for-constraint-validation-8>candidates for constraint
    validation</a>, <a id=pseudo-classes:have-range-limitations-2 href=forms.html#have-range-limitations>have range limitations</a>, and that are either <a id=pseudo-classes:suffering-from-an-underflow-2 href=forms.html#suffering-from-an-underflow>suffering from
    an underflow</a> or <a id=pseudo-classes:suffering-from-an-overflow-2 href=forms.html#suffering-from-an-overflow>suffering from an overflow</a>.</p>

   <dt><dfn id=selector-required><code>:required</code></dfn><dd>

    <p>The <code id=pseudo-classes:selector-required><a href=#selector-required>:required</a></code> pseudo-class must match any element
    falling into one of the following categories:</p>

    <ul><li><code id=pseudo-classes:the-input-element-10><a href=forms.html#the-input-element>input</a></code> elements that are <i id=pseudo-classes:concept-input-required><a href=forms.html#concept-input-required>required</a></i><li><code id=pseudo-classes:the-select-element-2><a href=forms.html#the-select-element>select</a></code> elements that have a <code id=pseudo-classes:attr-select-required><a href=forms.html#attr-select-required>required</a></code>
     attribute<li><code id=pseudo-classes:the-textarea-element-2><a href=forms.html#the-textarea-element>textarea</a></code> elements that have a <code id=pseudo-classes:attr-textarea-required><a href=forms.html#attr-textarea-required>required</a></code> attribute</ul>

   <dt><dfn id=selector-optional><code>:optional</code></dfn><dd>

    <p>The <code id=pseudo-classes:selector-optional><a href=#selector-optional>:optional</a></code> pseudo-class must match any element
    falling into one of the following categories:</p>

    <ul><li><code id=pseudo-classes:the-input-element-11><a href=forms.html#the-input-element>input</a></code> elements to which the <code id=pseudo-classes:attr-input-required><a href=forms.html#attr-input-required>required</a></code>
     attribute applies that are not <i id=pseudo-classes:concept-input-required-2><a href=forms.html#concept-input-required>required</a></i><li><code id=pseudo-classes:the-select-element-3><a href=forms.html#the-select-element>select</a></code> elements that do not have a <code id=pseudo-classes:attr-select-required-2><a href=forms.html#attr-select-required>required</a></code> attribute<li><code id=pseudo-classes:the-textarea-element-3><a href=forms.html#the-textarea-element>textarea</a></code> elements that do not have a <code id=pseudo-classes:attr-textarea-required-2><a href=forms.html#attr-textarea-required>required</a></code> attribute</ul>

   <dt><dfn id=selector-read-only><code>:read-only</code></dfn><dt><dfn id=selector-read-write><code>:read-write</code></dfn><dd>

    <p>The <code id=pseudo-classes:selector-read-write><a href=#selector-read-write>:read-write</a></code> pseudo-class must match any element
    falling into one of the following categories, which for the purposes of Selectors are thus
    considered <i>user-alterable</i>: <a href=references.html#refsSELECTORS>[SELECTORS]</a></p>

    <ul><li><code id=pseudo-classes:the-input-element-12><a href=forms.html#the-input-element>input</a></code> elements to which the <code id=pseudo-classes:attr-input-readonly><a href=forms.html#attr-input-readonly>readonly</a></code>
     attribute applies, and that are <i id=pseudo-classes:concept-fe-mutable><a href=forms.html#concept-fe-mutable>mutable</a></i> (i.e. that do not
     have the <code id=pseudo-classes:attr-input-readonly-2><a href=forms.html#attr-input-readonly>readonly</a></code> attribute specified and that are not
     <a href=forms.html#concept-fe-disabled id=pseudo-classes:concept-fe-disabled-6>disabled</a>)<li><code id=pseudo-classes:the-textarea-element-4><a href=forms.html#the-textarea-element>textarea</a></code> elements that do not have a <code id=pseudo-classes:attr-textarea-readonly><a href=forms.html#attr-textarea-readonly>readonly</a></code> attribute, and that are not <a href=forms.html#concept-fe-disabled id=pseudo-classes:concept-fe-disabled-7>disabled</a><li>elements that are <a href=interaction.html#editing-host id=pseudo-classes:editing-host>editing hosts</a> or <a id=pseudo-classes:editable href=interaction.html#editable>editable</a>
     and are neither <code id=pseudo-classes:the-input-element-13><a href=forms.html#the-input-element>input</a></code> elements nor <code id=pseudo-classes:the-textarea-element-5><a href=forms.html#the-textarea-element>textarea</a></code> elements</ul>

    <p>The <code id=pseudo-classes:selector-read-only><a href=#selector-read-only>:read-only</a></code> pseudo-class must match all other
    <a id=pseudo-classes:html-elements href=infrastructure.html#html-elements>HTML elements</a>.</p>

   <dt><dfn id=selector-ltr><code>:dir(ltr)</code></dfn><dd>

    <p>The <code id=pseudo-classes:selector-ltr><a href=#selector-ltr>:dir(ltr)</a></code> pseudo-class must match all elements whose
    <a href=dom.html#the-directionality id=pseudo-classes:the-directionality>directionality</a> is '<a href=dom.html#concept-ltr id=pseudo-classes:concept-ltr>ltr</a>'.</p>

   <dt><dfn id=selector-rtl><code>:dir(rtl)</code></dfn><dd>

    <p>The <code id=pseudo-classes:selector-rtl><a href=#selector-rtl>:dir(rtl)</a></code> pseudo-class must match all elements whose
    <a href=dom.html#the-directionality id=pseudo-classes:the-directionality-2>directionality</a> is '<a href=dom.html#concept-rtl id=pseudo-classes:concept-rtl>rtl</a>'.</p>

   </dl>

  <p class=note>Another section of this specification defines the <i id=pseudo-classes:target-element><a href=browsers.html#target-element>target element</a></i> used with the <code id=pseudo-classes:selector-target><a href=browsers.html#selector-target>:target</a></code>
  pseudo-class.</p>

  <p class=note>This specification does not define when an element matches the <code>:lang()</code> dynamic pseudo-class, as it is defined in sufficient
  detail in a language-agnostic fashion in the Selectors specification. <a href=references.html#refsSELECTORS>[SELECTORS]</a></p>



  




  <nav><a href=forms.html>← 4.10 Forms</a> — <a href=index.html>Table of Contents</a> — <a href=microdata.html>5 Microdata →</a></nav>
